mw.loader.implement("Hlsjs",function($){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Hls=e()}}(function(){return function s(e,t,r){function i(a,d){if(!t[a]){if(!e[a]){var l="function"==typeof require&&require;if(!d&&l)return l(a,!0);if(n)return n(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var o=t[a]={exports:{}};e[a][0].call(o.exports,function(t){var r=e[a][1][t];return i(r?r:t)},o,o.exports,s,e,t,r)}return t[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(s,a,o){function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function t(e){return"function"==typeof e}function n(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}a.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},e.prototype.emit=function(l){var s,e,u,a,n,o;if(this._events||(this._events={}),"error"===l&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(s=arguments[1],s instanceof Error)throw s;throw TypeError('Uncaught, unspecified "error" event.')}if(e=this._events[l],i(e))return!1;if(t(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),e.apply(this,a)}else if(r(e))for(a=Array.prototype.slice.call(arguments,1),o=e.slice(),u=o.length,n=0;u>n;n++)o[n].apply(this,a);return!0},e.prototype.addListener=function(a,n){var s;if(!t(n))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,t(n.listener)?n.listener:n),this._events[a]?r(this._events[a])?this._events[a].push(n):this._events[a]=[this._events[a],n]:this._events[a]=n,r(this._events[a])&&!this._events[a].warned&&(s=i(this._maxListeners)?e.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[a].length>s&&(this._events[a].warned=!0,"function"==typeof console.trace)),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(i,e){function r(){this.removeListener(i,r),a||(a=!0,e.apply(this,arguments))}if(!t(e))throw TypeError("listener must be a function");var a=!1;return r.listener=e,this.on(i,r),this},e.prototype.removeListener=function(a,i){var e,s,o,n;if(!t(i))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(e=this._events[a],o=e.length,s=-1,e===i||t(e.listener)&&e.listener===i)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,i);else if(r(e)){for(n=o;n-->0;)if(e[n]===i||e[n].listener&&e[n].listener===i){s=n;break}if(0>s)return this;1===e.length?(e.length=0,delete this._events[a]):e.splice(s,1),this._events.removeListener&&this.emit("removeListener",a,i)}return this},e.prototype.removeAllListeners=function(r){var i,e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[r]&&delete this._events[r],this;if(0===arguments.length){for(i in this._events)"removeListener"!==i&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events={},this}if(e=this._events[r],t(e))this.removeListener(r,e);else if(e)for(;e.length;)this.removeListener(r,e[e.length-1]);return delete this._events[r],this},e.prototype.listeners=function(e){var r;return r=this._events&&this._events[e]?t(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.prototype.listenerCount=function(r){if(this._events){var e=this._events[r];if(t(e))return 1;if(e)return e.length}return 0},e.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(n,i,s){var a=arguments[3],e=arguments[4],r=arguments[5],t=JSON.stringify;i.exports=function(l){for(var i,s=Object.keys(r),n=0,d=s.length;d>n;n++){var o=s[n],u=r[o].exports;if(u===l||u.default===l){i=o;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},n=0,d=s.length;d>n;n++){var o=s[n];f[o]=o}e[i]=[Function(["require","module","exports"],"("+l+")(self)"),f]}var h=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[i]=i,e[h]=[Function(["require"],"var f = require("+t(i)+");(f.default ? f.default : f)(self);"),c];var g="("+a+")({"+Object.keys(e).map(function(r){return t(r)+":["+e[r][0]+","+t(e[r][1])+"]"}).join(",")+"},{},["+t(h)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(v.createObjectURL(new Blob([g],{type:"text/javascript"})))}},{}],3:[function(e,m,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0});var l=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),c=e("../events"),t=r(c),d=e("../event-handler"),a=r(d),h=e("../helper/buffer-helper"),o=r(h),s=e("../errors"),i=e("../utils/logger"),p=e("./ewma-bandwidth-estimator"),u=r(p),y=function(r){function e(i){f(this,e);var r=v(this,Object.getPrototypeOf(e).call(this,i,t.default.FRAG_LOADING,t.default.FRAG_LOADED,t.default.ERROR));return r.lastLoadedFragLevel=0,r._autoLevelCapping=-1,r._nextAutoLevel=-1,r.hls=i,r.bwEstimator=new u.default(i),r.onCheck=r.abandonRulesCheck.bind(r),r}return g(e,r),l(e,[{key:"destroy",value:function(){this.clearTimer(),a.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){this.timer||(this.timer=setInterval(this.onCheck,100)),this.fragCurrent=e.frag}},{key:"abandonRulesCheck",value:function(){var a=this.hls,n=a.media,e=this.fragCurrent;if(!e.loader||e.loader.stats&&e.loader.stats.aborted)return i.logger.warn("frag loader destroy or aborted, disarm abandonRulesCheck"),void this.clearTimer();if(n&&(!n.paused||!n.readyState)&&e.autoLevel&&e.level){var u=performance.now()-e.trequest;if(u>500*e.duration){var f=Math.max(1,1e3*e.loaded/u);e.expectedLen<e.loaded&&(e.expectedLen=e.loaded);var h=n.currentTime,d=(e.expectedLen-e.loaded)/f,s=o.default.bufferInfo(n,h,a.config.maxBufferHole).end-h;if(s<2*e.duration&&d>s){var l=void 0,r=void 0;for(r=e.level-1;r>=0&&(l=e.duration*a.levels[r].bitrate/(6.4*f),i.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+r+"] :"+d.toFixed(1)+"/"+s.toFixed(1)+"/"+l.toFixed(1)),!(s>l));r--);d>l&&(r=Math.max(0,r),a.nextLoadLevel=r,this.bwEstimator.sample(u,e.loaded),i.logger.warn("loading too slow, abort fragment loading and switch to level "+r),e.loader.abort(),this.clearTimer(),a.trigger(t.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e}))}}}}},{key:"onFragLoaded",value:function(e){var t=e.stats;void 0===t.aborted&&1===e.frag.loadCounter&&this.bwEstimator.sample(performance.now()-t.trequest,t.loaded),this.clearTimer(),this.lastLoadedFragLevel=e.frag.level,this._nextAutoLevel=-1}},{key:"onError",value:function(e){switch(e.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e,r,i=this.hls,t=i.levels,a=i.config;if(r=-1===this._autoLevelCapping&&t&&t.length?t.length-1:this._autoLevelCapping,-1!==this._nextAutoLevel)return Math.min(this._nextAutoLevel,r);var n=this.bwEstimator.getEstimate(),s=void 0;for(e=0;r>=e;e++)if(s=e<=this.lastLoadedFragLevel?a.abrBandWidthFactor*n:a.abrBandWidthUpFactor*n,s<t[e].bitrate)return Math.max(0,e-1);return e-1},set:function(e){this._nextAutoLevel=e}}]),e}(a.default);n.default=y},{"../errors":21,"../event-handler":22,"../events":23,"../helper/buffer-helper":24,"../utils/logger":38,"./ewma-bandwidth-estimator":6}],4:[function(i,g,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=i("../events"),e=n(l),d=i("../event-handler"),s=n(d),t=i("../utils/logger"),r=i("../errors"),o=function(a){function i(r){u(this,i);var t=f(this,Object.getPrototypeOf(i).call(this,r,e.default.MEDIA_ATTACHING,e.default.MEDIA_DETACHING,e.default.BUFFER_RESET,e.default.BUFFER_APPENDING,e.default.BUFFER_CODECS,e.default.BUFFER_EOS,e.default.BUFFER_FLUSHING));return t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t}return h(i,a),c(i,[{key:"destroy",value:function(){s.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(r){var t=this.media=r.media;if(t){var e=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),e.addEventListener("sourceopen",this.onmso),e.addEventListener("sourceended",this.onmse),e.addEventListener("sourceclose",this.onmsc),t.src=URL.createObjectURL(e)}}},{key:"onMediaDetaching",value:function(){var r=this.mediaSource;if(r){if("open"===r.readyState)try{r.endOfStream()}catch(e){t.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}r.removeEventListener("sourceopen",this.onmso),r.removeEventListener("sourceended",this.onmse),r.removeEventListener("sourceclose",this.onmsc);try{this.media.src="",this.media.removeAttribute("src")}catch(e){t.logger.warn("onMediaDetaching:"+e.message+" while unlinking video.src")}this.mediaSource=null,this.media=null,this.pendingTracks=null,this.sourceBuffer=null}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(e.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){t.logger.log("media source opened"),this.hls.trigger(e.default.MEDIA_ATTACHED,{media:this.media}),this.mediaSource.removeEventListener("sourceopen",this.onmso);var r=this.pendingTracks;r&&(this.onBufferCodecs(r),this.pendingTracks=null,this.doAppending())}},{key:"onMediaSourceClose",value:function(){t.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){t.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){this._needsFlush&&this.doFlush(),this._needsEos&&this.onBufferEos(),this.hls.trigger(e.default.BUFFER_APPENDED),this.doAppending()}},{key:"onSBUpdateError",value:function(i){t.logger.error("sourceBuffer error:"+i),this.hls.trigger(e.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;if(e){for(var r in e){var t=e[r];try{this.mediaSource.removeSourceBuffer(t),t.removeEventListener("updateend",this.onsbue),t.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer=null}this.flushRange=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){var r=this.mediaSource;if(!r||"open"!==r.readyState)return void(this.pendingTracks=e);if(!this.sourceBuffer){var a={};for(var n in e){var i=e[n],l=i.levelCodec||i.codec,s=i.container+";codecs="+l;t.logger.log("creating sourceBuffer with mimeType:"+s);var o=a[n]=r.addSourceBuffer(s);o.addEventListener("updateend",this.onsbue),o.addEventListener("error",this.onsbe)}this.sourceBuffer=a}}},{key:"onBufferAppending",value:function(e){this.segments?this.segments.push(e):this.segments=[e],this.doAppending()}},{key:"onBufferAppendFail",value:function(i){t.logger.error("sourceBuffer error:"+i.event),this.hls.trigger(e.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(){var e=this.sourceBuffer,r=this.mediaSource;r&&"open"===r.readyState&&(e.audio&&e.audio.updating||e.video&&e.video.updating?this._needsEos=!0:(t.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment"),r.endOfStream(),this._needsEos=!1))}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset}),this.flushBufferCounter=0,this.doFlush()}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var r=this.flushRange[0];if(!this.flushBuffer(r.start,r.end))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var i=0,t=this.sourceBuffer;if(t)for(var a in t)i+=t[a].buffered.length;this.appended=i,this.hls.trigger(e.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var n=this.hls,s=this.sourceBuffer,a=this.segments;if(s){if(this.media.error)return a=[],void t.logger.error("trying to append although a media error occured, flush segment and abort");for(var l in s)if(s[l].updating)return;if(a.length){var o=a.shift();try{s[o.type].appendBuffer(o.data),this.appendError=0,this.appended++}catch(s){t.logger.error("error while trying to append buffer:"+s.message),a.unshift(o);var i={type:r.ErrorTypes.MEDIA_ERROR};if(22!==s.code){if(this.appendError?this.appendError++:this.appendError=1,i.details=r.ErrorDetails.BUFFER_APPEND_ERROR,i.frag=this.fragCurrent,this.appendError>n.config.appendErrorMaxRetry)return t.logger.log("fail "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),a=[],i.fatal=!0,void n.trigger(e.default.ERROR,i);i.fatal=!1,n.trigger(e.default.ERROR,i)}else a=[],i.details=r.ErrorDetails.BUFFER_FULL_ERROR,n.trigger(e.default.ERROR,i)}}}}},{key:"flushBuffer",value:function(l,s){var e,r,o,n,i,a;if(this.flushBufferCounter<this.appended&&this.sourceBuffer)for(var u in this.sourceBuffer){if(e=this.sourceBuffer[u],e.updating)return t.logger.warn("cannot flush, sb updating in progress"),!1;for(r=0;r<e.buffered.length;r++)if(o=e.buffered.start(r),n=e.buffered.end(r),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&s===Number.POSITIVE_INFINITY?(i=l,a=s):(i=Math.max(o,l),a=Math.min(n,s)),Math.min(a,n)-i>.5)return this.flushBufferCounter++,t.logger.log("flush "+u+" ["+i+","+a+"], of ["+o+","+n+"], pos:"+this.media.currentTime),e.remove(i,a),!1}else t.logger.warn("abort flushing too many retries");return t.logger.log("buffer flushed"),!0}}]),i}(s.default);a.default=o},{"../errors":21,"../event-handler":22,"../events":23,"../utils/logger":38}],5:[function(e,h,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function f(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e("../events"),i=r(l),d=e("../event-handler"),s=r(d),u=function(t){function e(t){return a(this,e),n(this,Object.getPrototypeOf(e).call(this,t,i.default.MEDIA_ATTACHING,i.default.MANIFEST_PARSED))}return f(e,t),o(e,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){this.hls.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,this.hls.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;e&&(this.hls.autoLevelCapping=this.getMaxLevel(e-1),this.hls.autoLevelCapping>this.autoLevelCapping&&this.hls.streamController.nextLevelSwitch(),this.autoLevelCapping=this.hls.autoLevelCapping)}}},{key:"getMaxLevel",value:function(n){var r=void 0,e=void 0,t=void 0,s=this.mediaWidth,o=this.mediaHeight,i=0,a=0;for(e=0;n>=e&&(t=this.levels[e],r=e,i=t.width,a=t.height,!(i>=s||a>=o));e++);return r}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}},{key:"mediaWidth",get:function(){var e=void 0;return this.media&&(e=this.media.width||this.media.clientWidth||this.media.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0;return this.media&&(e=this.media.height||this.media.clientHeight||this.media.offsetHeight,e*=this.contentScaleFactor),e}}]),e}(s.default);t.default=u},{"../event-handler":22,"../events":23}],6:[function(r,l,e){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=r("../utils/ewma"),t=i(s),o=function(){function e(r){a(this,e),this.hls=r,this.defaultEstimate_=5e5,this.minWeight_=.001,this.minDelayMs_=50,this.fast_=new t.default(r.config.abrEwmaFast),this.slow_=new t.default(r.config.abrEwmaSlow)}return n(e,[{key:"sample",value:function(e,i){e=Math.max(e,this.minDelayMs_);var t=8e3*i/e,r=e/1e3;this.fast_.sample(r,t),this.slow_.sample(r,t)}},{key:"getEstimate",value:function(){return this.fast_.getTotalWeight()<this.minWeight_?this.defaultEstimate_:Math.min(this.fast_.getEstimate(),this.slow_.getEstimate())}},{key:"destroy",value:function(){}}]),e}();e.default=o},{"../utils/ewma":37}],7:[function(i,g,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=i("../events"),t=n(l),d=i("../event-handler"),f=n(d),r=i("../utils/logger"),e=i("../errors"),o=function(a){function i(r){u(this,i);var e=h(this,Object.getPrototypeOf(i).call(this,r,t.default.MANIFEST_LOADED,t.default.LEVEL_LOADED,t.default.ERROR));return e.ontick=e.tick.bind(e),e._manualLevel=e._autoLevelCapping=-1,e}return s(i,a),c(i,[{key:"destroy",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0,this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(l){var s,a,n=[],i=[],u={},d=!1,f=!1,o=this.hls;if(l.levels.forEach(function(e){e.videoCodec&&(d=!0),e.audioCodec&&(f=!0);var t=u[e.bitrate];void 0===t?(u[e.bitrate]=n.length,e.url=[e.url],e.urlId=0,n.push(e)):n[t].url.push(e.url)}),d&&f?n.forEach(function(e){e.videoCodec&&i.push(e)}):i=n,i=i.filter(function(e){var i=function(e){return MediaSource.isTypeSupported("audio/mp4;codecs="+e)},a=function(e){return MediaSource.isTypeSupported("video/mp4;codecs="+e)},t=e.audioCodec,r=e.videoCodec;return(!t||i(t))&&(!r||a(r))}),i.length){for(s=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i,a=0;a<i.length;a++)if(i[a].bitrate===s){this._firstLevel=a,r.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+s);break}o.trigger(t.default.MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:l.stats})}else o.trigger(t.default.ERROR,{type:e.ErrorTypes.MEDIA_ERROR,details:e.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:o.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(i){var n=this._levels;if(i>=0&&i<n.length){this.timer&&(clearTimeout(this.timer),this.timer=null),this._level=i,r.logger.log("switching to level "+i),this.hls.trigger(t.default.LEVEL_SWITCH,{level:i});var a=n[i];if(void 0===a.details||a.details.live===!0){r.logger.log("(re)loading playlist for level "+i);var s=a.urlId;this.hls.trigger(t.default.LEVEL_LOADING,{url:a.url[s],level:i,id:s})}}else this.hls.trigger(t.default.ERROR,{type:e.ErrorTypes.OTHER_ERROR,details:e.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(n){if(!n.fatal){var a=n.details,o=this.hls,s=void 0,i=void 0,l=!1;switch(a){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:s=n.frag.level;break;case e.ErrorDetails.LEVEL_LOAD_ERROR:case e.ErrorDetails.LEVEL_LOAD_TIMEOUT:s=n.level,l=!0}if(void 0!==s)if(i=this._levels[s],i.urlId<i.url.length-1)i.urlId++,i.details=void 0,r.logger.warn("level controller,"+a+" for level "+s+": switching to redundant stream id "+i.urlId);else{var u=-1===this._manualLevel&&s;u?(r.logger.warn("level controller,"+a+": emergency switch-down for next fragment"),o.abrController.nextAutoLevel=0):i&&i.details&&i.details.live?(r.logger.warn("level controller,"+a+" on live stream, discard"),l&&(this._level=void 0)):a!==e.ErrorDetails.FRAG_LOAD_ERROR&&a!==e.ErrorDetails.FRAG_LOAD_TIMEOUT&&(r.logger.error("cannot recover "+a+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),n.fatal=!0,o.trigger(t.default.ERROR,n))}}}},{key:"onLevelLoaded",value:function(t){if(t.level===this._level){var i=t.details;if(i.live){var e=1e3*i.targetduration,n=this._levels[t.level],a=n.details;a&&i.endSN===a.endSN&&(e/=2,r.logger.log("same live playlist, reload twice faster")),e-=performance.now()-t.stats.trequest,e=Math.max(1e3,Math.round(e)),r.logger.log("live playlist, reload in "+e+" ms"),this.timer=setTimeout(this.ontick,e)}else this.timer=null}}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var r=this._levels[e],i=r.urlId;this.hls.trigger(t.default.LEVEL_LOADING,{url:r.url[i],level:e,id:i})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){return void 0===this._startLevel?this._firstLevel:this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),i}(f.default);a.default=o},{"../errors":21,"../event-handler":22,"../events":23,"../utils/logger":38}],8:[function(a,A,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(o,"__esModule",{value:!0});var m=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),b=a("../demux/demuxer"),_=n(b),d=a("../events"),r=n(d),R=a("../event-handler"),l=n(R),t=a("../utils/logger"),v=a("../utils/binary-search"),p=n(v),y=a("../helper/buffer-helper"),s=n(y),E=a("../helper/level-helper"),u=n(E),i=a("../errors"),e={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},f=function(n){function a(t){h(this,a);var e=c(this,Object.getPrototypeOf(a).call(this,t,r.default.MEDIA_ATTACHED,r.default.MEDIA_DETACHING,r.default.MANIFEST_LOADING,r.default.MANIFEST_PARSED,r.default.LEVEL_LOADED,r.default.KEY_LOADED,r.default.FRAG_LOADED,r.default.FRAG_LOAD_EMERGENCY_ABORTED,r.default.FRAG_PARSING_INIT_SEGMENT,r.default.FRAG_PARSING_DATA,r.default.FRAG_PARSED,r.default.ERROR,r.default.BUFFER_APPENDED,r.default.BUFFER_FLUSHED));return e.config=t.config,e.audioCodecSwap=!1,e.ticks=0,e.ontick=e.tick.bind(e),e}return g(a,n),m(a,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),l.default.prototype.destroy.call(this),this.state=e.STOPPED}},{key:"startLoad",value:function(){var a=arguments.length<=0||void 0===arguments[0]?0:arguments[0];if(this.levels){var r=this.media,i=this.lastCurrentTime;this.stopLoad(),this.demuxer=new _.default(this.hls),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,r&&i?(t.logger.log("configure startPosition @"+i),this.lastPaused||(t.logger.log("resuming video"),r.play()),this.state=e.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:a,this.state=e.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else t.logger.warn("cannot start loading as manifest not parsed yet"),this.state=e.STOPPED}},{key:"stopLoad",value:function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=e.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var _,l,n,E=this,f=this.hls,o=f.config;switch(this.state){case e.ERROR:case e.PAUSED:break;case e.STARTING:var b=f.startLevel;-1===b&&(b=0,this.fragBitrateTest=!0),this.level=f.nextLoadLevel=b,this.state=e.WAITING_LEVEL,this.loadedmetadata=!1;break;case e.IDLE:if(!this.media&&(this.startFragRequested||!o.startFragPrefetch))break;_=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition,l=f.nextLoadLevel;var h,R=s.default.bufferInfo(this.media,_,o.maxBufferHole),T=R.len,u=R.end,c=this.fragPrevious;if(this.levels[l].hasOwnProperty("bitrate")?(h=Math.max(8*o.maxBufferSize/this.levels[l].bitrate,o.maxBufferLength),h=Math.min(h,o.maxMaxBufferLength)):h=o.maxBufferLength,h>T){if(f.nextLoadLevel=l,this.level=l,n=this.levels[l].details,"undefined"==typeof n||n.live&&this.levelLastLoaded!==l){this.state=e.WAITING_LEVEL;break}var d=n.fragments,g=d.length,v=d[0].start,y=d[g-1].start+d[g-1].duration,a=void 0;if(n.live){var S=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*n.targetduration;if(u<Math.max(v,y-S)){var w=void 0!==o.liveSyncDuration?o.liveSyncDuration:o.liveSyncDurationCount*n.targetduration;this.seekAfterBuffered=v+Math.max(0,n.totalduration-w),t.logger.log("buffer end: "+u+" is located too far from the end of live sliding playlist, media position will be reseted to: "+this.seekAfterBuffered.toFixed(3)),u=this.seekAfterBuffered}if(n.PTSKnown&&u>y)break;if(this.startFragRequested&&!n.PTSKnown){if(c){var m=c.sn+1;m>=n.startSN&&m<=n.endSN&&(a=d[m-n.startSN],t.logger.log("live playlist, switching playlist, load frag with next SN: "+a.sn))}a||(a=d[Math.min(g-1,Math.round(g/2))],t.logger.log("live playlist, switching playlist, unknown, load middle frag : "+a.sn))}}else v>u&&(a=d[0]);if(a||!function(){var i=void 0,s=o.maxFragLookUpTolerance;y>u?(u>y-s&&(s=0),i=p.default.search(d,function(e){return e.start+e.duration-s<=u?1:e.start-s>u?-1:0})):i=d[g-1],i&&(a=i,v=i.start,c&&a.level===c.level&&a.sn===c.sn&&(a.sn<n.endSN?(a=d[a.sn+1-n.startSN],t.logger.log("SN just loaded, load next one: "+a.sn)):(n.live||(E.hls.trigger(r.default.BUFFER_EOS),E.media.seeking||(E.state=e.ENDED)),a=null)))}(),a)if(null!=a.decryptdata.uri&&null==a.decryptdata.key)t.logger.log("Loading key for "+a.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+l),this.state=e.KEY_LOADING,f.trigger(r.default.KEY_LOADING,{frag:a});else{if(t.logger.log("Loading "+a.sn+" of ["+n.startSN+" ,"+n.endSN+"],level "+l+", currentTime:"+_+",bufferEnd:"+u.toFixed(3)),a.autoLevel=f.autoLevelEnabled,this.levels.length>1&&(a.expectedLen=Math.round(a.duration*this.levels[l].bitrate/8),a.trequest=performance.now()),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,a.loadCounter){a.loadCounter++;var A=o.fragLoadingLoopThreshold;if(a.loadCounter>A&&Math.abs(this.fragLoadIdx-a.loadIdx)<A)return void f.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:a})}else a.loadCounter=1;a.loadIdx=this.fragLoadIdx,this.fragCurrent=a,this.startFragRequested=!0,f.trigger(r.default.FRAG_LOADING,{frag:a}),this.state=e.FRAG_LOADING}}break;case e.WAITING_LEVEL:l=this.levels[this.level],l&&l.details&&(this.state=e.IDLE);break;case e.FRAG_LOADING_WAITING_RETRY:var D=performance.now(),L=this.retryDate,k=this.media,O=k&&k.seeking;(!L||D>=L||O)&&(t.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=e.IDLE);break;case e.STOPPED:case e.FRAG_LOADING:case e.PARSING:case e.PARSED:case e.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"getBufferRange",value:function(i){var e,t,r=this.bufferRange;if(r)for(e=r.length-1;e>=0;e--)if(t=r[e],i>=t.start&&i<=t.end)return t;return null}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"isBuffered",value:function(r){var i=this.media;if(i)for(var t=i.buffered,e=0;e<t.length;e++)if(r>=t.start(e)&&r<=t.end(e))return!0;return!1}},{key:"_checkFragmentChanged",value:function(){var t,e,i=this.media;if(i&&i.seeking===!1&&(e=i.currentTime,e>i.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=e),this.isBuffered(e)?t=this.getBufferRange(e):this.isBuffered(e+.1)&&(t=this.getBufferRange(e+.1)),t)){var a=t.frag;a!==this.fragPlaying&&(this.fragPlaying=a,this.hls.trigger(r.default.FRAG_CHANGED,{frag:a}))}}},{key:"immediateLevelSwitch",value:function(){t.logger.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,this.previouslyPaused=this.media.paused,this.media.pause());var i=this.fragCurrent;i&&i.loader&&i.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=e.PAUSED,this.hls.trigger(r.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY})}},{key:"immediateLevelSwitchEnd",value:function(){this.immediateSwitch=!1;var e=this.media;e&&e.readyState&&(e.currentTime-=1e-4,this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var t=this.media;if(t&&t.readyState){var n=void 0,a=void 0,i=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,a=this.getBufferRange(t.currentTime),a&&a.start>1&&(this.state=e.PAUSED,this.hls.trigger(r.default.BUFFER_FLUSHING,{startOffset:0,endOffset:a.start-1})),t.paused)n=0;else{var l=this.hls.nextLoadLevel,u=this.levels[l],o=this.fragLastKbps;n=o&&this.fragCurrent?this.fragCurrent.duration*u.bitrate/(1e3*o)+1:0}if(i=this.getBufferRange(t.currentTime+n),i&&(i=this.followingBufferRange(i))){var s=this.fragCurrent;s&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.state=e.PAUSED,this.hls.trigger(r.default.BUFFER_FLUSHING,{startOffset:i.start,endOffset:Number.POSITIVE_INFINITY})}}}},{key:"onMediaAttached",value:function(t){var e=this.media=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended),this.levels&&this.config.autoStartLoad&&this.hls.startLoad()}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(t.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var r=this.levels;r&&r.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){if(this.state===e.FRAG_LOADING){if(0===s.default.bufferInfo(this.media,this.media.currentTime,this.config.maxBufferHole).len){t.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");var r=this.fragCurrent;r&&(r.loader&&r.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.state=e.IDLE}}else this.state===e.ENDED&&(this.state=e.IDLE);this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaSeeked",value:function(){this.tick()}},{key:"onMediaEnded",value:function(){t.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){t.logger.log("trigger BUFFER_RESET"),this.hls.trigger(r.default.BUFFER_RESET),this.bufferRange=[],this.stalled=!1}},{key:"onManifestParsed",value:function(r){var e,i=!1,a=!1;r.levels.forEach(function(t){e=t.audioCodec,e&&(-1!==e.indexOf("mp4a.40.2")&&(i=!0),-1!==e.indexOf("mp4a.40.5")&&(a=!0))}),this.audioCodecSwitch=i&&a,this.audioCodecSwitch&&t.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startLevelLoaded=!1,this.startFragRequested=!1,this.config.autoStartLoad&&this.hls.startLoad()}},{key:"onLevelLoaded",value:function(s){var i=s.details,a=s.level,o=this.levels[a],l=i.totalduration,n=0;if(t.logger.log("level "+a+" loaded ["+i.startSN+","+i.endSN+"],duration:"+l),this.levelLastLoaded=a,i.live){var d=o.details;d?(u.default.mergeDetails(d,i),n=i.fragments[0].start,i.PTSKnown?t.logger.log("live playlist sliding:"+n.toFixed(3)):t.logger.log("live playlist - outdated PTS, unknown sliding")):(i.PTSKnown=!1,t.logger.log("live playlist - first load, unknown sliding"))}else i.PTSKnown=!1;if(o.details=i,this.hls.trigger(r.default.LEVEL_UPDATED,{details:i,level:a}),this.startFragRequested===!1){if(i.live){var f=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*i.targetduration;this.startPosition=Math.max(0,n+l-f)}this.nextLoadPosition=this.startPosition}this.state===e.WAITING_LEVEL&&(this.state=e.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===e.KEY_LOADING&&(this.state=e.IDLE,this.tick())}},{key:"onFragLoaded",value:function(a){var i=this.fragCurrent;if(this.state===e.FRAG_LOADING&&i&&a.frag.level===i.level&&a.frag.sn===i.sn)if(t.logger.log("Loaded  "+i.sn+" of level "+i.level),this.fragBitrateTest===!0)this.state=e.IDLE,this.fragBitrateTest=!1,this.startFragRequested=!1,a.stats.tparsed=a.stats.tbuffered=performance.now(),this.hls.trigger(r.default.FRAG_BUFFERED,{stats:a.stats,frag:i});else{this.state=e.PARSING,this.stats=a.stats;var s=this.levels[this.level],o=s.details,f=o.totalduration,h=void 0!==i.startDTS?i.startDTS:i.start,l=i.level,u=i.sn,n=s.audioCodec||this.config.defaultAudioCodec;this.audioCodecSwap&&(t.logger.log("swapping playlist audio codec"),void 0===n&&(n=this.lastAudioCodec),n&&(n=-1!==n.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingAppending=0,t.logger.log("Demuxing "+u+" of ["+o.startSN+" ,"+o.endSN+"],level "+l);var d=this.demuxer;d&&d.push(a.payload,n,s.videoCodec,h,i.cc,l,u,f,i.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(l){if(this.state===e.PARSING){var o,i,a=l.tracks;if(i=a.audio){var n=this.levels[this.level].audioCodec,u=navigator.userAgent.toLowerCase();n&&this.audioCodecSwap&&(t.logger.log("swapping playlist audio codec"),n=-1!==n.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===u.indexOf("firefox")&&(n="mp4a.40.5"),-1!==u.indexOf("android")&&(n="mp4a.40.2",t.logger.log("Android: force audio codec to"+n)),i.levelCodec=n}if(i=a.video,i&&(i.levelCodec=this.levels[this.level].videoCodec),l.unique){var s={codec:"",levelCodec:""};for(o in l.tracks)i=a[o],s.container=i.container,s.codec&&(s.codec+=",",s.levelCodec+=","),i.codec&&(s.codec+=i.codec),i.levelCodec&&(s.levelCodec+=i.levelCodec);a={audiovideo:s}}this.hls.trigger(r.default.BUFFER_CODECS,a);for(o in a){i=a[o],t.logger.log("track:"+o+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var d=i.initSegment;d&&(this.pendingAppending++,this.hls.trigger(r.default.BUFFER_APPENDING,{type:o,data:d}))}this.tick()}}},{key:"onFragParsingData",value:function(i){var o=this;if(this.state===e.PARSING){this.tparse2=Date.now();var a=this.levels[this.level],n=this.fragCurrent;t.logger.log("parsed "+i.type+",PTS:["+i.startPTS.toFixed(3)+","+i.endPTS.toFixed(3)+"],DTS:["+i.startDTS.toFixed(3)+"/"+i.endDTS.toFixed(3)+"],nb:"+i.nb);var l=u.default.updateFragPTSDTS(a.details,n.sn,i.startPTS,i.endPTS,i.startDTS,i.endDTS),s=this.hls;s.trigger(r.default.LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:l}),[i.data1,i.data2].forEach(function(e){e&&(o.pendingAppending++,s.trigger(r.default.BUFFER_APPENDING,{type:i.type,data:e}))}),this.nextLoadPosition=i.endPTS,this.bufferRange.push({type:i.type,start:i.startPTS,end:i.endPTS,frag:n}),this.tick()}else t.logger.warn("not in PARSING state but "+this.state+", ignoring FRAG_PARSING_DATA event")}},{key:"onFragParsed",value:function(){this.state===e.PARSING&&(this.stats.tparsed=performance.now(),this.state=e.PARSED,this._checkAppendedParsed())}},{key:"onBufferAppended",value:function(){switch(this.state){case e.PARSING:case e.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===e.PARSED&&0===this.pendingAppending){var a=this.fragCurrent,i=this.stats;a&&(this.fragPrevious=a,i.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*i.length/(i.tbuffered-i.tfirst)),this.hls.trigger(r.default.FRAG_BUFFERED,{stats:i,frag:a}),t.logger.log("media buffered : "+this.timeRangesToString(this.media.buffered)),this.state=e.IDLE),this.tick()}}},{key:"onError",value:function(a){switch(a.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!a.fatal){var n=this.fragLoadError;if(n?n++:n=1,n<=this.config.fragLoadingMaxRetry){this.fragLoadError=n,a.frag.loadCounter=0;var s=Math.min(Math.pow(2,n-1)*this.config.fragLoadingRetryDelay,64e3);t.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=performance.now()+s,this.state=e.FRAG_LOADING_WAITING_RETRY}else t.logger.error("mediaController: "+a.details+" reaches max retry, redispatch as fatal ..."),a.fatal=!0,this.hls.trigger(r.default.ERROR,a),this.state=e.ERROR}break;case i.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case i.ErrorDetails.LEVEL_LOAD_ERROR:case i.ErrorDetails.LEVEL_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==e.ERROR&&(this.state=a.fatal?e.ERROR:e.IDLE,t.logger.warn("mediaController: "+a.details+" while loading frag,switch to "+this.state+" state ..."));break;case i.ErrorDetails.BUFFER_FULL_ERROR:this.config.maxMaxBufferLength/=2,t.logger.warn("reduce max buffer length to "+this.config.maxMaxBufferLength+"s and trigger a nextLevelSwitch to flush old buffer and fix QuotaExceededError"),this.nextLevelSwitch()}}},{key:"_checkBuffer",value:function(){var e=this.media;if(e){var v=e.readyState;if(v){var a,n,d=this.seekAfterBuffered;if(d)e.duration>=d&&(a=d,this.seekAfterBuffered=void 0);else{n=e.currentTime;var p=this.loadedmetadata;!p&&e.buffered.length&&(this.loadedmetadata=!0,n||n===this.startPosition||(a=this.startPosition))}a&&(n=a,t.logger.log("target seek position:"+a));var l=s.default.bufferInfo(e,n,0),m=!(e.paused||e.ended||e.seeking||0===e.buffered.length),f=.4,h=n>e.playbackRate*this.lastCurrentTime;if(this.stalled&&h&&(this.stalled=!1,t.logger.log("playback not stuck anymore @"+n)),m&&l.len<=f){if(h?(f=0,this.seekHoleNudgeDuration=0):this.stalled?this.seekHoleNudgeDuration+=this.config.seekHoleNudgeDuration:(this.seekHoleNudgeDuration=0,t.logger.log("playback seems stuck @"+n),this.hls.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1}),this.stalled=!0),l.len<=f){var o=l.nextStart,c=o-n;if(o&&c<this.config.maxSeekHole&&c>0&&!e.seeking){t.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+o+" + nudge "+this.seekHoleNudgeDuration);var y=o+this.seekHoleNudgeDuration-e.currentTime;e.currentTime=o+this.seekHoleNudgeDuration,this.hls.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:y})}}}else{var g=e.currentTime;if(a&&g!==a){if(0===l.len){var u=l.nextStart;void 0!==u&&u-a<this.config.maxSeekHole&&(a=u,t.logger.log("target seek position not buffered, seek to next buffered "+a))}t.logger.log("adjust currentTime from "+g+" to "+a),e.currentTime=a}}}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=e.IDLE,this.tick()}},{key:"onBufferFlushed",value:function(){var t,r,i=[];for(r=0;r<this.bufferRange.length;r++)t=this.bufferRange[r],this.isBuffered((t.start+t.end)/2)&&i.push(t);this.bufferRange=i,this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.state=e.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"timeRangesToString",value:function(t){for(var r="",i=t.length,e=0;i>e;e++)r+="["+t.start(e)+","+t.end(e)+"]";return r}},{key:"currentLevel",get:function(){if(this.media){var e=this.getBufferRange(this.media.currentTime);if(e)return e.frag.level}return-1}},{key:"nextBufferRange",get:function(){return this.media?this.followingBufferRange(this.getBufferRange(this.media.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}}]),a}(l.default);o.default=f},{"../demux/demuxer":17,"../errors":21,"../event-handler":22,"../events":23,"../helper/buffer-helper":24,"../helper/level-helper":25,"../utils/binary-search":35,"../utils/logger":38}],9:[function(t,g,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var c=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=t("../events"),e=r(l),d=t("../event-handler"),a=r(d),h=t("../utils/cea-708-interpreter"),o=r(h),u=function(r){function t(i){f(this,t);var r=n(this,Object.getPrototypeOf(t).call(this,i,e.default.MEDIA_ATTACHING,e.default.MEDIA_DETACHING,e.default.FRAG_PARSING_USERDATA,e.default.MANIFEST_LOADING,e.default.FRAG_LOADED));return r.hls=i,r.config=i.config,r.config.enableCEA708Captions&&(r.cea708Interpreter=new o.default),r}return s(t,r),c(t,[{key:"destroy",value:function(){a.default.prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;this.cea708Interpreter.attach(t)}},{key:"onMediaDetaching",value:function(){this.cea708Interpreter.detach()}},{key:"onManifestLoading",value:function(){this.lastPts=Number.POSITIVE_INFINITY}},{key:"onFragLoaded",value:function(t){var e=t.frag.start;e<=this.lastPts&&this.cea708Interpreter.clear(),this.lastPts=e}},{key:"onFragParsingUserdata",value:function(t){for(var e=0;e<t.samples.length;e++)this.cea708Interpreter.push(t.samples[e].pts,t.samples[e].bytes)}}]),t}(a.default);i.default=u},{"../event-handler":22,"../events":23,"../utils/cea-708-interpreter":36}],10:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(f){t(this,e),this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute();var i,s,r,o,l,n=this._tables[0][4],u=this._tables[1],a=f.length,d=1;if(4!==a&&6!==a&&8!==a)throw new Error("Invalid aes key size="+a);for(o=f.slice(0),l=[],this._key=[o,l],i=a;4*a+28>i;i++)r=o[i-1],(i%a===0||8===a&&i%a===4)&&(r=n[r>>>24]<<24^n[r>>16&255]<<16^n[r>>8&255]<<8^n[255&r],i%a===0&&(r=r<<8^r>>>24^d<<24,d=d<<1^283*(d>>7))),o[i]=o[i-a]^r;for(s=0;i;s++,i--)r=o[3&s?i:i-4],4>=i||4>s?l[s]=r:l[s]=u[0][n[r>>>24]]^u[1][n[r>>16&255]]^u[2][n[r>>8&255]]^u[3][n[255&r]]}return r(e,[{key:"_precompute",value:function(){var e,i,r,u,f,d,t,s,l,n=this._tables[0],o=this._tables[1],h=n[4],g=o[4],a=[],c=[];for(e=0;256>e;e++)c[(a[e]=e<<1^283*(e>>7))^e]=e;for(i=r=0;!h[i];i^=u||1,r=c[r]||1)for(t=r^r<<1^r<<2^r<<3^r<<4,t=t>>8^255&t^99,h[i]=t,g[t]=i,d=a[f=a[u=a[i]]],l=16843009*d^65537*f^257*u^16843008*i,s=257*a[t]^16843008*t,e=0;4>e;e++)n[e][i]=s=s<<24^s>>>8,o[e][t]=l=l<<24^l>>>8;for(e=0;5>e;e++)n[e]=n[e].slice(0),o[e]=o[e].slice(0)}},{key:"decrypt",value:function(R,p,_,b,E,m){var h,v,g,n,e=this._key[1],t=R^e[0],i=b^e[1],a=_^e[2],r=p^e[3],y=e.length/4-2,s=4,o=this._tables[1],f=o[0],d=o[1],u=o[2],l=o[3],c=o[4];for(n=0;y>n;n++)h=f[t>>>24]^d[i>>16&255]^u[a>>8&255]^l[255&r]^e[s],v=f[i>>>24]^d[a>>16&255]^u[r>>8&255]^l[255&t]^e[s+1],g=f[a>>>24]^d[r>>16&255]^u[t>>8&255]^l[255&i]^e[s+2],r=f[r>>>24]^d[t>>16&255]^u[i>>8&255]^l[255&a]^e[s+3],s+=4,t=h,i=v,a=g;for(n=0;4>n;n++)E[(3&-n)+m]=c[t>>>24]<<24^c[i>>16&255]<<16^c[a>>8&255]<<8^c[255&r]^e[s++],h=t,t=i,i=a,a=r,r=h}}]),e}();e.default=i},{}],11:[function(t,l,e){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=t("./aes"),s=r(n),o=function(){function e(t,r){i(this,e),this.key=t,this.iv=r}return a(e,[{key:"ntoh",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"doDecrypt",value:function(i,v,a){var u,h,o,f,l,c,d,n,e,r=new Int32Array(i.buffer,i.byteOffset,i.byteLength>>2),p=new s.default(Array.prototype.slice.call(v)),g=new Uint8Array(i.byteLength),t=new Int32Array(g.buffer);for(u=~~a[0],h=~~a[1],o=~~a[2],f=~~a[3],e=0;e<r.length;e+=4)l=~~this.ntoh(r[e]),c=~~this.ntoh(r[e+1]),d=~~this.ntoh(r[e+2]),n=~~this.ntoh(r[e+3]),p.decrypt(l,c,d,n,t,e),t[e]=this.ntoh(t[e]^u),t[e+1]=this.ntoh(t[e+1]^h),t[e+2]=this.ntoh(t[e+2]^o),t[e+3]=this.ntoh(t[e+3]^f),u=l,h=c,o=d,f=n;return g}},{key:"localDecrypt",value:function(e,t,r,i){var a=this.doDecrypt(e,t,r);i.set(a,e.byteOffset)}},{key:"decrypt",value:function(n){var r=32e3,t=new Int32Array(n),i=new Uint8Array(n.byteLength),e=0,s=this.key,a=this.iv;for(this.localDecrypt(t.subarray(e,e+r),s,a,i),e=r;e<t.length;e+=r)a=new Uint32Array([this.ntoh(t[e-4]),this.ntoh(t[e-3]),this.ntoh(t[e-2]),this.ntoh(t[e-1])]),this.localDecrypt(t.subarray(e,e+r),s,a,i);return i}}]),e}();e.default=o},{"./aes":10}],12:[function(t,d,r){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var u=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=t("./aes128-decrypter"),o=l(s),i=t("../errors"),e=t("../utils/logger"),n=function(){function t(r){a(this,t),this.hls=r;try{var e=window?window.crypto:crypto;this.subtle=e.subtle||e.webkitSubtle,this.disableWebCrypto=!this.subtle}catch(e){this.disableWebCrypto=!0}}return u(t,[{key:"destroy",value:function(){}},{key:"decrypt",value:function(e,t,r,i){this.disableWebCrypto&&this.hls.config.enableSoftwareAES?this.decryptBySoftware(e,t,r,i):this.decryptByWebCrypto(e,t,r,i)}},{key:"decryptByWebCrypto",value:function(t,r,i,a){var n=this;e.logger.log("decrypting by WebCrypto API"),this.subtle.importKey("raw",r,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(e){n.subtle.decrypt({name:"AES-CBC",iv:i.buffer},e,t).then(a).catch(function(e){n.onWebCryptoError(e,t,r,i,a)})}).catch(function(e){n.onWebCryptoError(e,t,r,i,a)})}},{key:"decryptBySoftware",value:function(r,i,a,n){e.logger.log("decrypting by JavaScript Implementation");var t=new DataView(i.buffer),s=new Uint32Array([t.getUint32(0),t.getUint32(4),t.getUint32(8),t.getUint32(12)]);t=new DataView(a.buffer);var l=new Uint32Array([t.getUint32(0),t.getUint32(4),t.getUint32(8),t.getUint32(12)]),u=new o.default(s,l);n(u.decrypt(r).buffer)}},{key:"onWebCryptoError",value:function(t,r,a,n,s){this.hls.config.enableSoftwareAES?(e.logger.log("disabling to use WebCrypto API"),this.disableWebCrypto=!0,this.decryptBySoftware(r,a,n,s)):(e.logger.error("decrypting error : "+t.message),this.hls.trigger(Event.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))}}]),t}();r.default=n},{"../errors":21,"../utils/logger":38,"./aes128-decrypter":11}],13:[function(e,f,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),d=e("./adts"),o=r(d),l=e("../utils/logger"),u=e("../demux/id3"),i=r(u),s=function(){function e(t,r){a(this,e),this.observer=t,this.remuxerClass=r,this.remuxer=new this.remuxerClass(t),this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}return n(e,[{key:"push",value:function(t,p,R,m,_,b,E,y){var a,n,v,c,e,s,f,u,g,r=this._aacTrack,d=new i.default(t),h=90*d.timeStamp;for(e=d.length,u=t.length;u-1>e&&(255!==t[e]||240!==(240&t[e+1]));e++);for(r.audiosamplerate||(a=o.default.getAudioConfig(this.observer,t,e,p),r.config=a.config,r.audiosamplerate=a.samplerate,r.channelCount=a.channelCount,r.codec=a.codec,r.duration=y,l.logger.log("parsed codec:"+r.codec+",rate:"+a.samplerate+",nb channel:"+a.channelCount)),c=0,v=9216e4/r.audiosamplerate;u>e+5&&(s=1&t[e+1]?7:9,n=(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5,n-=s,n>0&&u>=e+s+n);)for(f=h+c*v,g={unit:t.subarray(e+s,e+s+n),pts:f,dts:f},r.samples.push(g),r.len+=n,e+=n+s,c++;u-1>e&&(255!==t[e]||240!==(240&t[e+1]));e++);this.remuxer.remux(this._aacTrack,{samples:[]},{samples:[{pts:h,dts:h,unit:d.payload}]},{samples:[]},m)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(t){var e,r,a=new i.default(t);if(a.hasTimeStamp)for(e=a.length,r=t.length;r-1>e;e++)if(255===t[e]&&240===(240&t[e+1]))return!0;return!1}}]),e}();t.default=s},{"../demux/id3":19,"../utils/logger":38,"./adts":14}],14:[function(e,o,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e("../utils/logger"),r=e("../errors"),s=function(){function e(){i(this,e)}return a(e,null,[{key:"getAudioConfig",value:function(h,u,l,a){var i,e,s,o,t,f=navigator.userAgent.toLowerCase(),d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return i=((192&u[l+2])>>>6)+1,e=(60&u[l+2])>>>2,e>d.length-1?void h.trigger(Event.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+e}):(o=(1&u[l+2])<<2,o|=(192&u[l+3])>>>6,n.logger.log("manifest codec:"+a+",ADTS data:type:"+i+",sampleingIndex:"+e+"["+d[e]+"Hz],channelConfig:"+o),-1!==f.indexOf("firefox")?e>=6?(i=5,t=new Array(4),s=e-3):(i=2,t=new Array(2),s=e):-1!==f.indexOf("android")?(i=2,t=new Array(2),s=e):(i=5,t=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&e>=6?s=e-3:((a&&-1!==a.indexOf("mp4a.40.2")&&e>=6&&1===o||!a&&1===o)&&(i=2,t=new Array(2)),s=e)),t[0]=i<<3,t[0]|=(14&e)>>1,t[1]|=(1&e)<<7,t[1]|=o<<3,5===i&&(t[1]|=(14&s)>>1,t[2]=(1&s)<<7,t[2]|=8,t[3]=0),{config:t,samplerate:d[e],channelCount:o,codec:"mp4a.40."+i})}}]),e}();t.default=s},{"../errors":21,"../utils/logger":38}],15:[function(e,y,i){"use strict";function t(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var h=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),g=e("../events"),o=t(g),a=e("../errors"),p=e("../demux/aacdemuxer"),n=t(p),f=e("../demux/tsdemuxer"),r=t(f),c=e("../remux/mp4-remuxer"),s=t(c),v=e("../remux/passthrough-remuxer"),u=t(v),l=function(){function e(t,r){d(this,e),this.hls=t,this.typeSupported=r}return h(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(i,l,d,f,h,c,g,v){var e=this.demuxer;if(!e){var t=this.hls;if(r.default.probe(i))e=this.typeSupported.mp2t===!0?new r.default(t,u.default):new r.default(t,s.default);else{if(!n.default.probe(i))return void t.trigger(o.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});e=new n.default(t,s.default)}this.demuxer=e}e.push(i,l,d,f,h,c,g,v)}}]),e}();i.default=l},{"../demux/aacdemuxer":13,"../demux/tsdemuxer":20,"../errors":21,"../events":23,"../remux/mp4-remuxer":32,"../remux/passthrough-remuxer":33}],16:[function(t,d,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var a=t("../demux/demuxer-inline"),u=r(a),s=t("../events"),e=r(s),l=t("events"),n=r(l),o=function(r){var t=new n.default;t.trigger=function(i){for(var r=arguments.length,a=Array(r>1?r-1:0),e=1;r>e;e++)a[e-1]=arguments[e];t.emit.apply(t,[i,i].concat(a))},t.off=function(a){for(var r=arguments.length,i=Array(r>1?r-1:0),e=1;r>e;e++)i[e-1]=arguments[e];t.removeListener.apply(t,[a].concat(i))},r.addEventListener("message",function(i){var e=i.data;switch(e.cmd){case"init":r.demuxer=new u.default(t,e.typeSupported);break;case"demux":r.demuxer.push(new Uint8Array(e.data),e.audioCodec,e.videoCodec,e.timeOffset,e.cc,e.level,e.sn,e.duration)}}),t.on(e.default.FRAG_PARSING_INIT_SEGMENT,function(t,e){r.postMessage({event:t,tracks:e.tracks,unique:e.unique})}),t.on(e.default.FRAG_PARSING_DATA,function(i,e){var t={event:i,type:e.type,startPTS:e.startPTS,endPTS:e.endPTS,startDTS:e.startDTS,endDTS:e.endDTS,data1:e.data1.buffer,data2:e.data2.buffer,nb:e.nb};r.postMessage(t,[t.data1,t.data2])}),t.on(e.default.FRAG_PARSED,function(e){r.postMessage({event:e})}),t.on(e.default.ERROR,function(e,t){r.postMessage({event:e,data:t})}),t.on(e.default.FRAG_PARSING_METADATA,function(e,t){var i={event:e,samples:t.samples};r.postMessage(i)}),t.on(e.default.FRAG_PARSING_USERDATA,function(e,t){var i={event:e,samples:t.samples};r.postMessage(i)})};i.default=o},{"../demux/demuxer-inline":15,"../events":23,events:1}],17:[function(t,v,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var h=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=t("../events"),e=r(s),g=t("../demux/demuxer-inline"),a=r(g),d=t("../demux/demuxer-worker"),f=r(d),n=t("../utils/logger"),c=t("../crypt/decrypter"),l=r(c),o=function(){function r(e){u(this,r),this.hls=e;var i={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:e.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t")};if(e.config.enableWorker&&"undefined"!=typeof Worker){n.logger.log("demuxing in webworker");try{var s=t("webworkify");this.w=s(f.default),this.onwmsg=this.onWorkerMessage.bind(this),this.w.addEventListener("message",this.onwmsg),this.w.postMessage({cmd:"init",typeSupported:i})}catch(t){n.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),this.demuxer=new a.default(e,i)}}else this.demuxer=new a.default(e,i);this.demuxInitialized=!0}return h(r,[{key:"destroy",value:function(){this.w?(this.w.removeEventListener("message",this.onwmsg),this.w.terminate(),this.w=null):(this.demuxer.destroy(),this.demuxer=null),this.decrypter&&(this.decrypter.destroy(),this.decrypter=null)}},{key:"pushDecrypted",value:function(e,t,r,i,a,n,s,o){this.w?this.w.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:r,timeOffset:i,cc:a,level:n,sn:s,duration:o},[e]):this.demuxer.push(new Uint8Array(e),t,r,i,a,n,s,o)}},{key:"push",value:function(t,r,i,a,n,s,o,u,e){if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){null==this.decrypter&&(this.decrypter=new l.default(this.hls));var d=this;this.decrypter.decrypt(t,e.key,e.iv,function(e){d.pushDecrypted(e,r,i,a,n,s,o,u)})}else this.pushDecrypted(t,r,i,a,n,s,o,u)}},{key:"onWorkerMessage",value:function(i){var t=i.data;switch(t.event){case e.default.FRAG_PARSING_INIT_SEGMENT:var r={};r.tracks=t.tracks,r.unique=t.unique,this.hls.trigger(e.default.FRAG_PARSING_INIT_SEGMENT,r);break;case e.default.FRAG_PARSING_DATA:this.hls.trigger(e.default.FRAG_PARSING_DATA,{data1:new Uint8Array(t.data1),data2:new Uint8Array(t.data2),startPTS:t.startPTS,endPTS:t.endPTS,startDTS:t.startDTS,endDTS:t.endDTS,type:t.type,nb:t.nb});break;case e.default.FRAG_PARSING_METADATA:this.hls.trigger(e.default.FRAG_PARSING_METADATA,{samples:t.samples});break;case e.default.FRAG_PARSING_USERDATA:this.hls.trigger(e.default.FRAG_PARSING_USERDATA,{samples:t.samples});break;default:this.hls.trigger(t.event,t.data)}}}]),r}();i.default=o},{"../crypt/decrypter":12,"../demux/demuxer-inline":15,"../demux/demuxer-worker":16,"../events":23,"../utils/logger":38,webworkify:2}],18:[function(t,s,e){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),a=t("../utils/logger"),n=function(){function e(t){r(this,e),this.data=t,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function(){var t=this.data.byteLength-this.bytesAvailable,r=new Uint8Array(4),e=Math.min(4,this.bytesAvailable);if(0===e)throw new Error("no bytes available");r.set(this.data.subarray(t,t+e)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*e,this.bytesAvailable-=e}},{key:"skipBits",value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(t){var e=Math.min(this.bitsAvailable,t),r=this.word>>>32-e;return t>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),e=t-e,e>0?r<<e|this.readBits(e):r}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(a){var t,i,r=8,e=8;for(t=0;a>t;t++)0!==e&&(i=this.readEG(),e=(r+i+256)%256),r=0===e?r:e}},{key:"readSPS",value:function(){var t,v,p,l,a,n,i,o,r,s=0,d=0,f=0,h=0,c=1;if(this.readUByte(),t=this.readUByte(),v=this.readBits(5),this.skipBits(3),p=this.readUByte(),this.skipUEG(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var g=this.readUEG();if(3===g&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(o=3!==g?8:12,r=0;o>r;r++)this.readBoolean()&&(6>r?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var u=this.readUEG();if(0===u)this.readUEG();else if(1===u)for(this.skipBits(1),this.skipEG(),this.skipEG(),l=this.readUEG(),r=0;l>r;r++)this.skipEG();if(this.skipUEG(),this.skipBits(1),a=this.readUEG(),n=this.readUEG(),i=this.readBits(1),0===i&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(s=this.readUEG(),d=this.readUEG(),f=this.readUEG(),h=this.readUEG()),this.readBoolean()&&this.readBoolean()){var e=void 0,y=this.readUByte();switch(y){case 1:e=[1,1];break;case 2:e=[12,11];break;case 3:e=[10,11];break;case 4:e=[16,11];break;case 5:e=[40,33];break;case 6:e=[24,11];break;case 7:e=[20,11];break;case 8:e=[32,11];break;case 9:e=[80,33];break;case 10:e=[18,11];break;case 11:e=[15,11];break;case 12:e=[64,33];break;case 13:e=[160,99];break;case 14:e=[4,3];break;case 15:e=[3,2];break;case 16:e=[2,1];break;case 255:e=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()]}e&&(c=e[0]/e[1])}return{width:Math.ceil((16*(a+1)-2*s-2*d)*c),height:(2-i)*(n+1)*16-(i?2:4)*(f+h)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();e.default=n},{"../utils/logger":38}],19:[function(r,s,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),e=r("../utils/logger"),n=function(){function t(a){i(this,t),this._hasTimeStamp=!1;for(var l,u,d,f,h,s,o,n,r=0;;)if(o=this.readUTF(a,r,3),r+=3,"ID3"===o)r+=3,l=127&a[r++],u=127&a[r++],d=127&a[r++],f=127&a[r++],h=(l<<21)+(u<<14)+(d<<7)+f,s=r+h,this._parseID3Frames(a,r,s),r=s;else{if("3DI"!==o)return r-=3,n=r,void(n&&(this.hasTimeStamp||e.logger.warn("ID3 tag found, but no timestamp"),this._length=n,this._payload=a.subarray(0,n)));r+=7,e.logger.log("3DI footer found, end: "+r)}}return a(t,[{key:"readUTF",value:function(i,e,a){var t="",r=e,n=e+a;do t+=String.fromCharCode(i[r++]);while(n>r);return t}},{key:"_parseID3Frames",value:function(r,t,n){for(var a,s,o,l,i;n>=t+8;)switch(a=this.readUTF(r,t,4),t+=4,s=r[t++]<<24+r[t++]<<16+r[t++]<<8+r[t++],l=r[t++]<<8+r[t++],o=t,a){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(r,t,44)){t+=44,t+=4;var u=1&r[t++];this._hasTimeStamp=!0,i=((r[t++]<<23)+(r[t++]<<15)+(r[t++]<<7)+r[t++])/45,u&&(i+=47721858.84),i=Math.round(i),e.logger.trace("ID3 timestamp found: "+i),this._timeStamp=i}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),t}();t.default=n},{"../utils/logger":38}],20:[function(t,g,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var f=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),h=t("./adts"),c=i(h),l=t("../events"),n=i(l),d=t("./exp-golomb"),s=i(d),e=t("../utils/logger"),r=t("../errors"),o=function(){function t(e,r){u(this,t),this.observer=e,this.remuxerClass=r,this.lastCC=0,this.remuxer=new this.remuxerClass(e)}return f(t,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0},this._aacTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcNaluState=0,this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(i,A,k,R,p,m,E,L){var s,o,l,t,d,u,y,a,c=i.length,b=this.remuxer.passthrough,g=!1;this.audioCodec=A,this.videoCodec=k,this.timeOffset=R,this._duration=L,this.contiguous=!1,p!==this.lastCC&&(e.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=p),m!==this.lastLevel?(e.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=m):E===this.lastSN+1&&(this.contiguous=!0),this.lastSN=E;var v=this.pmtParsed,h=this._avcTrack.id,f=this._aacTrack.id,_=this._id3Track.id;for(c-=c%188,t=0;c>t;t+=188)if(71===i[t]){if(d=!!(64&i[t+1]),u=((31&i[t+1])<<8)+i[t+2],y=(48&i[t+3])>>4,y>1){if(a=t+5+i[t+4],a===t+188)continue}else a=t+4;if(v)if(u===h){if(d){if(s&&(this._parseAVCPES(this._parsePES(s)),b&&this._avcTrack.codec&&(-1===f||this._aacTrack.codec)))return void this.remux(i);s={data:[],size:0}}s&&(s.data.push(i.subarray(a,t+188)),s.size+=t+188-a)}else if(u===f){if(d){if(o&&(this._parseAACPES(this._parsePES(o)),b&&this._aacTrack.codec&&(-1===h||this._avcTrack.codec)))return void this.remux(i);o={data:[],size:0}}o&&(o.data.push(i.subarray(a,t+188)),o.size+=t+188-a)}else u===_&&(d&&(l&&this._parseID3PES(this._parsePES(l)),l={data:[],size:0}),l&&(l.data.push(i.subarray(a,t+188)),l.size+=t+188-a));else d&&(a+=i[a]+1),0===u?this._parsePAT(i,a):u===this._pmtId?(this._parsePMT(i,a),v=this.pmtParsed=!0,h=this._avcTrack.id,f=this._aacTrack.id,_=this._id3Track.id,g&&(e.logger.log("reparse from beginning"),g=!1,t=-188)):(e.logger.log("unknown PID found before PAT/PMT"),g=!0)}else this.observer.trigger(n.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});s&&this._parseAVCPES(this._parsePES(s)),o&&this._parseAACPES(this._parsePES(o)),l&&this._parseID3PES(this._parsePES(l)),this.remux(null)}},{key:"remux",value:function(e){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this._txtTrack,this.timeOffset,this.contiguous,e)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){this._pmtId=(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(r,t){var a,n,s,i;for(a=(15&r[t+1])<<8|r[t+2],n=t+3+a-4,s=(15&r[t+10])<<8|r[t+11],t+=12+s;n>t;){switch(i=(31&r[t+1])<<8|r[t+2],r[t]){case 15:this._aacTrack.id=i;break;case 21:this._id3Track.id=i;break;case 27:this._avcTrack.id=i;break;default:e.logger.log("unkown stream type:"+r[t])}t+=((15&r[t+3])<<8|r[t+4])+5}}},{key:"_parsePES",value:function(o){var e,n,h,d,u,l,i,r,t,f=0,s=o.data;if(e=s[0],h=(e[0]<<16)+(e[1]<<8)+e[2],1===h){for(d=(e[4]<<8)+e[5],n=e[7],192&n&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,i>4294967295&&(i-=8589934592),64&n?(r=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2,r>4294967295&&(r-=8589934592)):r=i),u=e[8],t=u+9,o.size-=t,l=new Uint8Array(o.size);s.length;){e=s.shift();var a=e.byteLength;if(t){if(t>a){t-=a;continue}e=e.subarray(t),a-=t,t=0}l.set(e,f),f+=a}return{data:l,pts:i,dts:r,len:d}}return null}},{key:"_parseAVCPES",value:function(i){var t,m,n,o,y=this,r=this._avcTrack,u=r.samples,p=this._parseAVCNALu(i.data),d=[],l=!1,c=!1,f=0;if(0===p.length&&u.length>0){var g=u[u.length-1],h=g.units.units[g.units.units.length-1],v=new Uint8Array(h.data.byteLength+i.data.byteLength);v.set(h.data,0),v.set(i.data,h.data.byteLength),h.data=v,g.units.length+=i.data.byteLength,r.len+=i.data.byteLength}i.data=null;var a="",E=function(){d.length&&((c===!0||r.sps&&(u.length||this.contiguous))&&(m={units:{units:d,length:f},pts:i.pts,dts:i.dts,key:c},u.push(m),r.len+=f,r.nbNalu+=d.length),d=[],f=0)}.bind(this);p.forEach(function(e){switch(e.type){case 1:n=!0,l&&(a+="NDR ");break;case 5:n=!0,l&&(a+="IDR "),c=!0;break;case 6:n=!0,l&&(a+="SEI "),t=new s.default(e.data),t.readUByte();var b=t.readUByte();if(4===b){var v=0;do v=t.readUByte();while(255===v);var A=t.readUByte();if(181===A){var R=t.readUShort();if(49===R){var L=t.readUInt();if(1195456820===L){var T=t.readUByte();if(3===T){var g=t.readUByte(),_=t.readUByte(),S=31&g,h=[g,_];for(o=0;S>o;o++)h.push(t.readUByte()),h.push(t.readUByte()),h.push(t.readUByte());y._txtTrack.samples.push({type:3,pts:i.pts,bytes:h})}}}}}break;case 7:if(n=!0,l&&(a+="SPS "),!r.sps){t=new s.default(e.data);var p=t.readSPS();r.width=p.width,r.height=p.height,r.sps=[e.data],r.duration=y._duration;var k=e.data.subarray(1,4),m="avc1.";for(o=0;3>o;o++){var u=k[o].toString(16);u.length<2&&(u="0"+u),m+=u}r.codec=m}break;case 8:n=!0,l&&(a+="PPS "),r.pps||(r.pps=[e.data]);break;case 9:n=!1,l&&(a+="AUD "),E();break;default:n=!1,a+="unknown NAL "+e.type+" "}n&&(d.push(e),f+=e.data.byteLength)}),(l||a.length)&&e.logger.log(a),E()}},{key:"_parseAVCNALu",value:function(r){for(var s,i,l,_,n,d,t=0,v=r.byteLength,e=this.avcNaluState,g=[];v>t;)switch(s=r[t++],e){case 0:0===s&&(e=1);break;case 1:e=0===s?2:0;break;case 2:case 3:if(0===s)e=3;else if(1===s&&v>t){if(_=31&r[t],n)l={data:r.subarray(n,t-e-1),type:d},g.push(l);else{var a=this.avcNaluState;if(a&&4-a>=t){var m=this._avcTrack,c=m.samples;if(c.length){var p=c[c.length-1],R=p.units.units,u=R[R.length-1];u.state&&(u.data=u.data.subarray(0,u.data.byteLength-a),p.units.length-=a,m.len-=a)}}if(i=t-e-1,i>0){var y=this._avcTrack,h=y.samples;if(h.length){var E=h[h.length-1],b=E.units.units,o=b[b.length-1],f=new Uint8Array(o.data.byteLength+i);f.set(o.data,0),f.set(r.subarray(0,i),o.data.byteLength),o.data=f,E.units.length+=i,y.len+=i}}}n=t,d=_,e=0}else e=0}return n&&(l={data:r.subarray(n,v),type:d,state:e},g.push(l),this.avcNaluState=e),g}},{key:"_parseAACPES",value:function(R){var l,o,p,E,t,d,f,s,_,a=this._aacTrack,i=R.data,g=R.pts,k=0,L=this._duration,A=this.audioCodec,u=this.aacOverFlow,b=this.aacLastPTS;if(u){var m=new Uint8Array(u.byteLength+i.byteLength);m.set(u,0),m.set(i,u.byteLength),i=m}for(t=k,s=i.length;s-1>t&&(255!==i[t]||240!==(240&i[t+1]));t++);if(t){var y,h;if(s-1>t?(y="AAC PES did not start with ADTS header,offset:"+t,h=!1):(y="no ADTS header found in AAC PES",h=!0),this.observer.trigger(n.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:h,reason:y}),h)return}if(a.audiosamplerate||(l=c.default.getAudioConfig(this.observer,i,t,A),a.config=l.config,a.audiosamplerate=l.samplerate,a.channelCount=l.channelCount,a.codec=l.codec,a.duration=L,e.logger.log("parsed codec:"+a.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)),E=0,p=9216e4/a.audiosamplerate,u&&b){var v=b+p;Math.abs(v-g)>1&&(e.logger.log("AAC: align PTS for overlapping frames by "+Math.round((v-g)/90)),g=v)}for(;s>t+5&&(d=1&i[t+1]?7:9,o=(3&i[t+3])<<11|i[t+4]<<3|(224&i[t+5])>>>5,o-=d,o>0&&s>=t+d+o);)for(f=g+E*p,_={unit:i.subarray(t+d,t+d+o),pts:f,dts:f},a.samples.push(_),a.len+=o,t+=o+d,E++;s-1>t&&(255!==i[t]||240!==(240&i[t+1]));t++);u=s>t?i.subarray(t,s):null,this.aacOverFlow=u,this.aacLastPTS=f}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),t}();a.default=o},{"../errors":21,"../events":23,"../utils/logger":38,"./adts":14,"./exp-golomb":18}],21:[function(t,r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},e.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],22:[function(e,f,t){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},d=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),o=e("./utils/logger"),r=e("./errors"),u=e("./events"),s=i(u),l=function(){function e(n){a(this,e),this.hls=n,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,i=Array(r>1?r-1:0),t=1;r>t;t++)i[t-1]=arguments[t];this.handledEvents=i,this.useGenericHandler=!0,this.registerListeners()}return d(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===n(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var i=function(t,r){var e="on"+t.replace("hls","");if("function"!=typeof this[e])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+e+")");return this[e].bind(this,r)};try{i.call(this,e,t).call()}catch(t){o.logger.error("internal error happened while processing "+e+":"+t.message),this.hls.trigger(s.default.ERROR,{type:r.ErrorTypes.OTHER_ERROR,details:r.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}}}]),e}();t.default=l},{"./errors":21,"./events":23,"./utils/logger":38}],23:[function(t,e,r){"use strict";e.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded"}},{}],24:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return r(e,null,[{key:"bufferInfo",value:function(r,a,n){if(r){var e,t=r.buffered,i=[];for(e=0;e<t.length;e++)i.push({start:t.start(e),end:t.end(e)});return this.bufferedInfo(i,a,n)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(r,i,s){var o,l,a,h,e,t=[];for(r.sort(function(e,t){var r=e.start-t.start;return r?r:t.end-e.end}),e=0;e<r.length;e++){var u=t.length;if(u){var d=t[u-1].end;r[e].start-d<s?r[e].end>d&&(t[u-1].end=r[e].end):t.push(r[e])}else t.push(r[e])}for(e=0,o=0,l=a=i;e<t.length;e++){var n=t[e].start,f=t[e].end;if(i+s>=n&&f>i)l=n,a=f,o=a-i;else if(n>i+s){h=n;break}}return{len:o,start:l,end:a,nextStart:h}}}]),e}();e.default=i},{}],25:[function(r,s,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),e=r("../utils/logger"),n=function(){function t(){i(this,t)}return a(t,null,[{key:"mergeDetails",value:function(s,i){var a,c=Math.max(s.startSN,i.startSN)-i.startSN,h=Math.min(s.endSN,i.endSN)-i.startSN,u=i.startSN-s.startSN,f=s.fragments,l=i.fragments,d=0;if(c>h)return void(i.PTSKnown=!1);for(var r=c;h>=r;r++){var o=f[u+r],n=l[r];d=o.cc-n.cc,isNaN(o.startPTS)||(n.start=n.startPTS=o.startPTS,n.endPTS=o.endPTS,n.duration=o.duration,a=n)}if(d)for(e.logger.log("discontinuity sliding from playlist, take drift into account"),r=0;r<l.length;r++)l[r].cc+=d;if(a)t.updateFragPTSDTS(i,a.sn,a.startPTS,a.endPTS,a.startDTS,a.endDTS);else if(u>=0&&u<f.length){var g=f[u].start;for(r=0;r<l.length;r++)l[r].start+=g}i.PTSKnown=s.PTSKnown}},{key:"updateFragPTSDTS",value:function(i,u,a,s,l,d){var o,n,e,r;if(u<i.startSN||u>i.endSN)return 0;o=u-i.startSN,n=i.fragments,e=n[o],isNaN(e.startPTS)||(a=Math.min(a,e.startPTS),s=Math.max(s,e.endPTS),l=Math.min(l,e.startDTS),d=Math.max(d,e.endDTS));var f=a-e.start;for(e.start=e.startPTS=a,e.endPTS=s,e.startDTS=l,e.endDTS=d,e.duration=s-a,r=o;r>0;r--)t.updatePTS(n,r,r-1);for(r=o;r<n.length-1;r++)t.updatePTS(n,r,r+1);return i.PTSKnown=!0,f}},{key:"updatePTS",value:function(s,i,a){var t=s[i],r=s[a],n=r.startPTS;isNaN(n)?a>i?r.start=t.start+t.duration:r.start=t.start-r.duration:a>i?(t.duration=n-t.start,t.duration<0&&e.logger.error("negative duration computed for frag "+t.sn+",level "+t.level+", there should be some duration drift between playlist and fragment!")):(r.duration=t.start-n,r.duration<0&&e.logger.error("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!"))}}]),t}();t.default=n},{"../utils/logger":38}],26:[function(t,I,a){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),k=t("./events"),i=r(k),s=t("./errors"),u=t("./loader/playlist-loader"),d=r(u),f=t("./loader/fragment-loader"),h=r(f),c=t("./controller/abr-controller"),g=r(c),v=t("./controller/buffer-controller"),P=r(v),y=t("./controller/cap-level-controller"),m=r(y),E=t("./controller/stream-controller"),b=r(E),_=t("./controller/level-controller"),R=r(_),A=t("./controller/timeline-controller"),L=r(A),e=t("./utils/logger"),T=t("./utils/xhr-loader"),S=r(T),w=t("events"),D=r(w),O=t("./loader/key-loader"),p=r(O),l=function(){function t(){var r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];o(this,t);var n=t.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var a in n)a in r||(r[a]=n[a]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,e.enableLogs)(r.debug),this.config=r;var i=this.observer=new D.default;i.trigger=function(r){for(var t=arguments.length,a=Array(t>1?t-1:0),e=1;t>e;e++)a[e-1]=arguments[e];i.emit.apply(i,[r,r].concat(a))},i.off=function(a){for(var t=arguments.length,r=Array(t>1?t-1:0),e=1;t>e;e++)r[e-1]=arguments[e];i.removeListener.apply(i,[a].concat(r))},this.on=i.on.bind(i),this.off=i.off.bind(i),this.trigger=i.trigger.bind(i),this.playlistLoader=new d.default(this),this.fragmentLoader=new h.default(this),this.levelController=new R.default(this),this.abrController=new r.abrController(this),this.bufferController=new r.bufferController(this),this.capLevelController=new r.capLevelController(this),this.streamController=new r.streamController(this),this.timelineController=new r.timelineController(this),this.keyLoader=new p.default(this)}return n(t,null,[{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function(){return i.default}},{key:"ErrorTypes",get:function(){return s.ErrorTypes}},{key:"ErrorDetails",get:function(){return s.ErrorDetails}},{key:"DefaultConfig",get:function(){return t.defaultConfig||(t.defaultConfig={autoStartLoad:!0,debug:!1,capLevelToPlayerSize:!1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,seekHoleNudgeDuration:.01,stalledInBufferedNudgeThreshold:10,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,appendErrorMaxRetry:3,loader:S.default,fLoader:void 0,pLoader:void 0,abrController:g.default,bufferController:P.default,capLevelController:m.default,streamController:b.default,timelineController:L.default,enableCEA708Captions:!0,enableMP2TPassThrough:!1,abrEwmaFast:0,abrEwmaSlow:0,abrBandWidthFactor:.8,abrBandWidthUpFactor:.7}),t.defaultConfig},set:function(e){t.defaultConfig=e}}]),n(t,[{key:"destroy",value:function(){e.logger.log("destroy"),this.trigger(i.default.DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.streamController.destroy(),this.timelineController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(t){e.logger.log("attachMedia"),this.media=t,this.trigger(i.default.MEDIA_ATTACHING,{media:t})}},{key:"detachMedia",value:function(){e.logger.log("detachMedia"),this.trigger(i.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(t){e.logger.log("loadSource:"+t),this.url=t,this.trigger(i.default.MANIFEST_LOADING,{url:t})}},{key:"startLoad",value:function(){var t=arguments.length<=0||void 0===arguments[0]?0:arguments[0];e.logger.log("startLoad"),this.levelController.startLoad(),this.streamController.startLoad(t)}},{key:"stopLoad",value:function(){e.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad()}},{key:"swapAudioCodec",value:function(){e.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){e.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){e.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){e.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){e.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return this.levelController.firstLevel},set:function(t){e.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){e.logger.log("set startLevel:"+t),this.levelController.startLevel=t}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(t){e.logger.log("set autoLevelCapping:"+t),this.abrController.autoLevelCapping=t}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}}]),t}();a.default=l},{"./controller/abr-controller":3,"./controller/buffer-controller":4,"./controller/cap-level-controller":5,"./controller/level-controller":7,"./controller/stream-controller":8,"./controller/timeline-controller":9,"./errors":21,"./events":23,"./loader/fragment-loader":28,"./loader/key-loader":29,"./loader/playlist-loader":30,"./utils/logger":38,"./utils/xhr-loader":40,events:1}],27:[function(e,t,r){"use strict";t.exports=e("./hls.js").default},{"./hls.js":26}],28:[function(r,c,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var h=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r("../events"),e=a(l),d=r("../event-handler"),n=a(d),t=r("../errors"),o=function(i){function r(t){return u(this,r),f(this,Object.getPrototypeOf(r).call(this,t,e.default.FRAG_LOADING))}return s(r,i),h(r,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),n.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function(r){var t=r.frag;this.frag=t,this.frag.loaded=0;var e=this.hls.config;t.loader=this.loader="undefined"!=typeof e.fLoader?new e.fLoader(e):new e.loader(e),this.loader.load(t.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),e.fragLoadingTimeOut,1,0,this.loadprogress.bind(this),t)}},{key:"loadsuccess",value:function(i,t){var r=i.currentTarget.response;t.length=r.byteLength,this.frag.loader=void 0,this.hls.trigger(e.default.FRAG_LOADED,{payload:r,frag:this.frag,stats:t})}},{key:"loaderror",value:function(r){this.loader&&this.loader.abort(),this.hls.trigger(e.default.ERROR,{type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:this.frag,response:r})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(e.default.ERROR,{type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(r,t){this.frag.loaded=t.loaded,this.hls.trigger(e.default.FRAG_LOAD_PROGRESS,{frag:this.frag,stats:t})}}]),r}(n.default);i.default=o},{"../errors":21,"../event-handler":22,"../events":23}],29:[function(r,c,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(i,"__esModule",{value:!0});var h=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r("../events"),e=a(l),d=r("../event-handler"),n=a(d),t=r("../errors"),o=function(i){function r(i){u(this,r);var t=f(this,Object.getPrototypeOf(r).call(this,i,e.default.KEY_LOADING));return t.decryptkey=null,t.decrypturl=null,t}return s(r,i),h(r,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),n.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(n){var t=this.frag=n.frag,a=t.decryptdata,i=a.uri;if(i!==this.decrypturl||null===this.decryptkey){var r=this.hls.config;t.loader=this.loader=new r.loader(r),this.decrypturl=i,this.decryptkey=null,t.loader.load(i,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),r.fragLoadingTimeOut,r.fragLoadingMaxRetry,r.fragLoadingRetryDelay,this.loadprogress.bind(this),t)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(e.default.KEY_LOADED,{frag:t}))}},{key:"loadsuccess",value:function(r){var t=this.frag;this.decryptkey=t.decryptdata.key=new Uint8Array(r.currentTarget.response),t.loader=void 0,this.hls.trigger(e.default.KEY_LOADED,{frag:t})}},{key:"loaderror",value:function(r){this.loader&&this.loader.abort(),this.hls.trigger(e.default.ERROR,{type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:this.frag,response:r})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(e.default.ERROR,{type:t.ErrorTypes.NETWORK_ERROR,details:t.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(){}}]),r}(n.default);i.default=o},{"../errors":21,"../event-handler":22,"../events":23}],30:[function(r,y,s){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(s,"__esModule",{value:!0});var o=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=r("../events"),t=i(l),p=r("../event-handler"),n=i(p),e=r("../errors"),c=r("../utils/url"),g=i(c),v=r("../utils/attr-list"),a=i(v),u=function(i){function r(e){return d(this,r),f(this,Object.getPrototypeOf(r).call(this,e,t.default.MANIFEST_LOADING,t.default.LEVEL_LOADING))}return h(r,i),o(r,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),this.url=this.id=null,n.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,null)}},{key:"onLevelLoading",value:function(e){this.load(e.url,e.level,e.id)}},{key:"load",value:function(t,n,s){var r,i,a,e=this.hls.config;if(this.loading&&this.loader){if(this.url===t&&this.id===n&&this.id2===s)return;this.loader.abort()}this.url=t,this.id=n,this.id2=s,null===this.id?(r=e.manifestLoadingMaxRetry,i=e.manifestLoadingTimeOut,a=e.manifestLoadingRetryDelay):(r=e.levelLoadingMaxRetry,i=e.levelLoadingTimeOut,a=e.levelLoadingRetryDelay),this.loader="undefined"!=typeof e.pLoader?new e.pLoader(e):new e.loader(e),this.loading=!0,this.loader.load(t,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),i,r,a)}},{key:"resolve",value:function(e,t){return g.default.buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(f,u){for(var l=[],i=void 0,d=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;null!=(i=d.exec(f));){var e={},r=e.attrs=new a.default(i[1]);e.url=this.resolve(i[2],u);var s=r.decimalResolution("RESOLUTION");s&&(e.width=s.width,e.height=s.height),e.bitrate=r.decimalInteger("AVERAGE-BANDWIDTH")||r.decimalInteger("BANDWIDTH"),e.name=r.NAME;var t=r.CODECS;if(t){t=t.split(",");for(var o=0;o<t.length;o++){var n=t[o];-1!==n.indexOf("avc1")?e.videoCodec=this.avc1toavcoti(n):e.audioCodec=n}}l.push(e)}return l}},{key:"avc1toavcoti",value:function(r){var e,t=r.split(".");return t.length>2?(e=t.shift()+".",e+=parseInt(t.shift()).toString(16),e+=("000"+parseInt(t.shift()).toString(16)).substr(-4)):e=r,e}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"parseLevelPlaylist",value:function(L,s,A){var e,b,u,n,g=0,o=0,i={url:s,fragments:[],live:!0,startSN:0},r={method:null,key:null,iv:null,uri:null},y=0,d=null,t=null;for(b=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.*))|(?:#EXT(INF):([\d\.]+)[^\r\n]*([\r\n]+[^#|\r\n]+)?)|(?:#EXT-X-(BYTERANGE):([\d]+[@[\d]*)]*[\r\n]+([^#|\r\n]+)?|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.*)[\r\n]+([^#|\r\n]+)?)/g;null!==(e=b.exec(L));)switch(e.shift(),e=e.filter(function(e){return void 0!==e}),e[0]){case"MEDIA-SEQUENCE":g=i.startSN=parseInt(e[1]);break;case"TARGETDURATION":i.targetduration=parseFloat(e[1]);break;case"ENDLIST":i.live=!1;break;case"DIS":y++;break;case"BYTERANGE":var h=e[1].split("@");n=1===h.length?u:parseInt(h[1]),u=parseInt(h[0])+n,t&&!t.url&&(t.byteRangeStartOffset=n,t.byteRangeEndOffset=u,t.url=this.resolve(e[2],s));break;case"INF":var c=parseFloat(e[1]);if(!isNaN(c)){var f,m=g++;if(r.method&&r.uri&&!r.iv){f=this.cloneObj(r);for(var E=new Uint8Array(16),l=12;16>l;l++)E[l]=m>>8*(15-l)&255;f.iv=E}else f=r;var k=e[2]?this.resolve(e[2],s):null;t={url:k,duration:c,start:o,sn:m,level:A,cc:y,byteRangeStartOffset:n,byteRangeEndOffset:u,decryptdata:f,programDateTime:d},i.fragments.push(t),o+=c,n=null,d=null}break;case"KEY":var R=e[1],v=new a.default(R),p=v.enumeratedString("METHOD"),_=v.URI,T=v.hexadecimalInteger("IV");p&&(r={method:null,key:null,iv:null,uri:null},_&&"AES-128"===p&&(r.method=p,r.uri=this.resolve(_,s),r.key=null,r.iv=T));break;case"PROGRAM-DATE-TIME":d=new Date(Date.parse(e[1])),t&&!t.url&&e.length>=3&&(t.url=this.resolve(e[2],s),t.programDateTime=d)}return t&&!t.url&&(i.fragments.pop(),o-=t.duration),i.totalduration=o,i.endSN=g-1,i}},{key:"loadsuccess",value:function(u,i){var s,o=u.currentTarget,n=o.responseText,r=o.responseURL,l=this.id,d=this.id2,a=this.hls;if(this.loading=!1,void 0===r&&(r=this.url),i.tload=performance.now(),i.mtime=new Date(o.getResponseHeader("Last-Modified")),0===n.indexOf("#EXTM3U"))if(n.indexOf("#EXTINF:")>0)if(null===this.id)a.trigger(t.default.MANIFEST_LOADED,{levels:[{url:r}],url:r,stats:i});else{var f=this.parseLevelPlaylist(n,r,l);i.tparsed=performance.now(),a.trigger(t.default.LEVEL_LOADED,{details:f,level:l,id:d,stats:i})}else s=this.parseMasterPlaylist(n,r),s.length?a.trigger(t.default.MANIFEST_LOADED,{levels:s,url:r,stats:i}):a.trigger(t.default.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:r,reason:"no level found in manifest"});else a.trigger(t.default.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:e.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:r,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(a){var r,i;null===this.id?(r=e.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0):(r=e.ErrorDetails.LEVEL_LOAD_ERROR,i=!1),this.loader&&this.loader.abort(),this.loading=!1,this.hls.trigger(t.default.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:this.url,loader:this.loader,response:a.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function(){var r,i;null===this.id?(r=e.ErrorDetails.MANIFEST_LOAD_TIMEOUT,i=!0):(r=e.ErrorDetails.LEVEL_LOAD_TIMEOUT,i=!1),this.loader&&this.loader.abort(),this.loading=!1,this.hls.trigger(t.default.ERROR,{type:e.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]),r}(n.default);s.default=u},{"../errors":21,"../event-handler":22,"../events":23,"../utils/attr-list":34,"../utils/url":39}],31:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return r(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:a};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var r=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,r,l,r,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))}},{key:"box",value:function(a){for(var t,i=Array.prototype.slice.call(arguments,1),e=8,r=i.length,n=r;r--;)e+=i[r].byteLength;for(t=new Uint8Array(e),t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=255&e,t.set(a,4),r=0,e=8;n>r;r++)t.set(i[r],e),e+=i[r].byteLength;return t}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"mdhd",value:function(t,r){return r*=t,e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"minf",value:function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))}},{key:"moof",value:function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))}},{key:"moov",value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))}},{key:"mvex",value:function(r){for(var t=r.length,i=[];t--;)i[t]=e.trex(r[t]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function(t,r){r*=t;var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)}},{key:"sdtp",value:function(n){var r,t,i=n.samples||[],a=new Uint8Array(4+i.length);for(t=0;t<i.length;t++)r=i[t].flags,a[t+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,a)}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function(t){var r,a,n,i=[],s=[];for(r=0;r<t.sps.length;r++)a=t.sps[r],n=a.byteLength,i.push(n>>>8&255),i.push(255&n),i=i.concat(Array.prototype.slice.call(a));for(r=0;r<t.pps.length;r++)a=t.pps[r],n=a.byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(a));var u=e.box(e.types.avcC,new Uint8Array([1,i[3],i[4],i[5],255,224|t.sps.length].concat(i).concat([t.pps.length]).concat(s))),o=t.width,l=t.height;return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,o>>8&255,255&o,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}},{key:"mp4a",value:function(t){var r=t.audiosamplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))}},{key:"stsd",value:function(t){return"audio"===t.type?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))}},{key:"tkhd",value:function(t){var r=t.id,i=t.duration*t.timescale,a=t.width,n=t.height;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,n>>8&255,255&n,0,0]))}},{key:"traf",value:function(i,t){var a=e.sdtp(i),r=i.id;return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t])),e.trun(i,a.length+16+16+8+16+8+8),a)}},{key:"trak",value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"trex",value:function(r){var t=r.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(h,o){var i,a,n,s,t,l,d=h.samples||[],r=d.length,f=12+16*r,u=new Uint8Array(f);for(o+=8+f,u.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,o>>>24&255,o>>>16&255,o>>>8&255,255&o],0),i=0;r>i;i++)a=d[i],n=a.duration,s=a.size,t=a.flags,l=a.cts,u.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,s>>>24&255,s>>>16&255,s>>>8&255,255&s,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,61440&t.degradPrio,15&t.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,u)}},{key:"initSegment",value:function(i){e.types||e.init();var t,r=e.moov(i);return t=new Uint8Array(e.FTYP.byteLength+r.byteLength),t.set(e.FTYP),t.set(r,e.FTYP.byteLength),t}}]),e}();e.default=i},{}],32:[function(i,h,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var l=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),f=i("../events"),t=n(f),e=i("../utils/logger"),u=i("../remux/mp4-generator"),r=n(u),s=i("../errors"),d=function(){function i(e){o(this,i),this.observer=e,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return l(i,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(r,i,a,n,e,s){this.ISGenerated||this.generateIS(r,i,e),this.ISGenerated&&(i.samples.length&&this.remuxVideo(i,e,s),r.samples.length&&this.remuxAudio(r,e,s)),a.samples.length&&this.remuxID3(a,e),n.samples.length&&this.remuxText(n,e),this.observer.trigger(t.default.FRAG_PARSED)}},{key:"generateIS",value:function(i,a,h){var n,o,c=this.observer,g=i.samples,d=a.samples,f=this.PES_TIMESCALE,l={},v={tracks:l,unique:!1},u=void 0===this._initPTS;u&&(n=o=1/0),i.config&&g.length&&(i.timescale=i.audiosamplerate,i.timescale*i.duration>Math.pow(2,32)&&!function(){var e=function r(t,e){return e?r(e,t%e):t};i.timescale=i.audiosamplerate/e(i.audiosamplerate,1024)}(),e.logger.log("audio mp4 timescale :"+i.timescale),l.audio={container:"audio/mp4",codec:i.codec,initSegment:r.default.initSegment([i]),metadata:{channelCount:i.channelCount}},u&&(n=o=g[0].pts-f*h)),a.sps&&a.pps&&d.length&&(a.timescale=this.MP4_TIMESCALE,l.video={container:"video/mp4",codec:a.codec,initSegment:r.default.initSegment([a]),metadata:{width:a.width,height:a.height}},u&&(n=Math.min(n,d[0].pts-f*h),o=Math.min(o,d[0].dts-f*h))),Object.keys(l).length?(c.trigger(t.default.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=!0,u&&(this._initPTS=n,this._initDTS=o)):c.trigger(t.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(a,w,S){var L,s,p,A,f,d,T,k,R,g,_,v,o,i,n,E=8,c=this.PES_TIMESCALE,h=this.PES2MP4SCALEFACTOR,u=[];for(d=new Uint8Array(a.len+4*a.nbNalu+8),L=new DataView(d.buffer),L.setUint32(0,d.byteLength),d.set(r.default.types.mdat,4);a.samples.length;){for(s=a.samples.shift(),A=0;s.units.units.length;)f=s.units.units.shift(),L.setUint32(E,f.data.byteLength),E+=4,d.set(f.data,E),E+=f.data.byteLength,A+=4+f.data.byteLength;if(_=s.pts-this._initDTS,v=s.dts-this._initDTS,v=Math.min(_,v),void 0!==g){o=this._PTSNormalize(_,g),i=this._PTSNormalize(v,g);var m=(i-g)/h;0>=m&&(e.logger.log("invalid sample duration at PTS/DTS: "+s.pts+"/"+s.dts+":"+m),m=1),p.duration=m}else{var y=void 0,l=void 0;y=S?this.nextAvcDts:w*c,o=this._PTSNormalize(_,y),i=this._PTSNormalize(v,y),l=Math.round((i-y)/90),S&&l&&(l>1?e.logger.log("AVC:"+l+" ms hole between fragments detected,filling it"):-1>l&&e.logger.log("AVC:"+-l+" ms overlapping between fragments detected"),i=y,o=Math.max(o-l,i),e.logger.log("Video/PTS/DTS adjusted: "+o+"/"+i+",delta:"+l)),k=Math.max(0,o),R=Math.max(0,i)}p={size:A,duration:0,cts:(o-i)/h,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}},n=p.flags,s.key===!0?(n.dependsOn=2,n.isNonSync=0):(n.dependsOn=1,n.isNonSync=1),u.push(p),g=i}var b=0;u.length>=2&&(b=u[u.length-2].duration,p.duration=b),this.nextAvcDts=i+b*h,a.len=0,a.nbNalu=0,u.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(n=u[0].flags,n.dependsOn=2,n.isNonSync=0),a.samples=u,T=r.default.moof(a.sequenceNumber++,R/h,a),a.samples=[],this.observer.trigger(t.default.FRAG_PARSING_DATA,{data1:T,data2:d,startPTS:k/c,endPTS:(o+h*b)/c,startDTS:R/c,endDTS:this.nextAvcDts/c,type:"video",nb:u.length})}},{key:"remuxAudio",value:function(i,D,S){var T,p,n,h,d,k,L,b,u,v,R,o,a,A=8,s=this.PES_TIMESCALE,w=i.timescale,f=s/w,E=1024*i.timescale/i.audiosamplerate,m=[],_=[];for(i.samples.sort(function(e,t){return e.pts-t.pts}),_=i.samples;_.length;){if(p=_.shift(),h=p.unit,v=p.pts-this._initDTS,R=p.dts-this._initDTS,void 0!==u)o=this._PTSNormalize(v,u),a=this._PTSNormalize(R,u),n.duration=(a-u)/f,Math.abs(n.duration-E)>E/10&&e.logger.log("invalid AAC sample duration at PTS "+Math.round(v/90)+",should be 1024,found :"+Math.round(n.duration*i.audiosamplerate/i.timescale)),n.duration=E,o=a=E*f+u;else{var c=void 0,l=void 0;if(c=S?this.nextAacPts:D*s,o=this._PTSNormalize(v,c),a=this._PTSNormalize(R,c),l=Math.round(1e3*(o-c)/s),S&&l){if(l>0)e.logger.log(l+" ms hole between AAC samples detected,filling it");else if(-12>l){e.logger.log(-l+" ms overlapping between AAC samples detected, drop frame"),i.len-=h.byteLength;continue}o=a=c}if(L=Math.max(0,o),b=Math.max(0,a),!(i.len>0))return;d=new Uint8Array(i.len+8),T=new DataView(d.buffer),T.setUint32(0,d.byteLength),d.set(r.default.types.mdat,4)}d.set(h,A),A+=h.byteLength,n={size:h.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},m.push(n),u=a}var y=0,g=m.length;g>=2&&(y=m[g-2].duration,n.duration=y),g&&(this.nextAacPts=o+f*y,i.len=0,i.samples=m,k=r.default.moof(i.sequenceNumber++,b/f,i),i.samples=[],this.observer.trigger(t.default.FRAG_PARSING_DATA,{data1:k,data2:d,startPTS:L/s,endPTS:this.nextAacPts/s,startDTS:b/s,endDTS:(a+f*y)/s,type:"audio",nb:g}))}},{key:"remuxID3",value:function(r,a){var e,n=r.samples.length;if(n){for(var i=0;n>i;i++)e=r.samples[i],e.pts=(e.pts-this._initPTS)/this.PES_TIMESCALE,e.dts=(e.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(t.default.FRAG_PARSING_METADATA,{samples:r.samples})}r.samples=[],a=a}},{key:"remuxText",value:function(e,a){e.samples.sort(function(e,t){return e.pts-t.pts});var r,n=e.samples.length;if(n){for(var i=0;n>i;i++)r=e.samples[i],r.pts=(r.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(t.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],a=a}},{key:"_PTSNormalize",value:function(e,t){var r;if(void 0===t)return e;for(r=e>t?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}},{key:"passthrough",get:function(){return!1}}]),i}();a.default=d},{"../errors":21,"../events":23,"../remux/mp4-generator":31,"../utils/logger":38}],33:[function(r,l,e){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=r("../events"),t=i(s),o=function(){function e(t){a(this,e),this.observer=t,this.ISGenerated=!1}return n(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(o,s,f,d,a,u){var n=this.observer;if(!this.ISGenerated){var l={},i={tracks:l,unique:!0},e=s,r=e.codec;r&&(i.tracks.video={container:e.container,codec:r,metadata:{width:e.width,height:e.height}}),e=o,r=e.codec,r&&(i.tracks.audio={container:e.container,codec:r,metadata:{channelCount:e.channelCount}}),this.ISGenerated=!0,n.trigger(t.default.FRAG_PARSING_INIT_SEGMENT,i)}n.trigger(t.default.FRAG_PARSING_DATA,{data1:u,startPTS:a,startDTS:a,type:"audiovideo",nb:1})}},{key:"passthrough",get:function(){return!0}}]),e}();e.default=o},{"../events":23}],34:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(r){t(this,e),"string"==typeof r&&(r=e.parseAttrList(r));for(var i in r)r.hasOwnProperty(i)&&(this[i]=r[i])}return r(e,[{key:"decimalInteger",value:function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}},{key:"hexadecimalInteger",value:function(r){if(this[r]){var e=(this[r]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var i=new Uint8Array(e.length/2),t=0;t<e.length/2;t++)i[t]=parseInt(e.slice(2*t,2*t+2),16);return i}return null}},{key:"hexadecimalIntegerAsNumber",value:function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(t){var e=/^(\d+)x(\d+)$/.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}}],[{key:"parseAttrList",value:function(a){for(var t,n=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,r={};null!==(t=n.exec(a));){var e=t[2],i='"';0===e.indexOf(i)&&e.lastIndexOf(i)===e.length-1&&(e=e.slice(1,-1)),r[t[1]]=e}return r}}]),e}();e.default=i},{}],35:[function(r,e,i){"use strict";var t={search:function(a,s){for(var t=0,r=a.length-1,e=null,i=null;r>=t;){e=(t+r)/2|0,i=a[e];var n=s(i);if(n>0)t=e+1;else{if(!(0>n))return i;r=e-1}}return null}};e.exports=t},{}],36:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return r(e,[{key:"attach",value:function(e){this.media=e,this.display=[],this.memory=[]}},{key:"detach",value:function(){this.clear()}},{key:"destroy",value:function(){}},{key:"_createCue",value:function(){var t=window.VTTCue||window.TextTrackCue,e=this.cue=new t(-1,-1,"");e.text="",e.pauseOnExit=!1,e.startTime=Number.MAX_VALUE,e.endTime=Number.MAX_VALUE,this.memory.push(e)}},{key:"clear",value:function(){var e=this._textTrack;if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"push",value:function(r,i){this.cue||this._createCue();for(var a,t,e,s,o,u=31&i[0],n=2,l=0;u>l;l++)if(a=i[n++],t=127&i[n++],e=127&i[n++],s=0!==(4&a),o=3&a,(0!==t||0!==e)&&s&&0===o){if(32&t||64&t)this.cue.text+=this._fromCharCode(t)+this._fromCharCode(e);else if((17===t||25===t)&&e>=48&&63>=e)switch(e){case 48:this.cue.text+="®";break;case 49:this.cue.text+="°";break;case 50:this.cue.text+="½";break;case 51:this.cue.text+="¿";break;case 52:this.cue.text+="™";break;case 53:this.cue.text+="¢";break;case 54:this.cue.text+="";break;case 55:this.cue.text+="£";break;case 56:this.cue.text+="♪";break;case 57:this.cue.text+=" ";break;case 58:this.cue.text+="è";break;case 59:this.cue.text+="â";break;case 60:this.cue.text+="ê";break;case 61:this.cue.text+="î";break;case 62:this.cue.text+="ô";break;case 63:this.cue.text+="û"}if((17===t||25===t)&&e>=32&&47>=e)switch(e){case 32:break;case 33:break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:break;case 42:break;case 43:break;case 44:break;case 45:break;case 46:break;case 47:}if((20===t||28===t)&&e>=32&&47>=e)switch(e){case 32:this._clearActiveCues(r);break;case 33:this.cue.text=this.cue.text.substr(0,this.cue.text.length-1);break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:this._clearActiveCues(r);break;case 42:break;case 43:break;case 44:this._clearActiveCues(r);break;case 45:break;case 46:this._text="";break;case 47:this._flipMemory(r)}if((23===t||31===t)&&e>=33&&35>=e)switch(e){case 33:break;case 34:break;case 35:}}}},{key:"_fromCharCode",value:function(e){switch(e){case 42:return"á";case 2:return"á";case 2:return"é";case 4:return"í";case 5:return"ó";case 6:return"ú";case 3:return"ç";case 4:return"÷";case 5:return"Ñ";case 6:return"ñ";case 7:return"█";default:return String.fromCharCode(e)}}},{key:"_flipMemory",value:function(e){this._clearActiveCues(e),this._flushCaptions(e)}},{key:"_flushCaptions",value:function(s){this._has708||(this._textTrack=this.media.addTextTrack("captions","English","en"),this._has708=!0);var e=!0,i=!1,a=void 0;try{for(var n,t=this.memory[Symbol.iterator]();!(e=(n=t.next()).done);e=!0){var r=n.value;r.startTime=s,this._textTrack.addCue(r),this.display.push(r)}}catch(e){i=!0,a=e}finally{try{!e&&t.return&&t.return()}finally{if(i)throw a}}this.memory=[],this.cue=null}},{key:"_clearActiveCues",value:function(n){var e=!0,r=!1,i=void 0;try{for(var a,t=this.display[Symbol.iterator]();!(e=(a=t.next()).done);e=!0){var s=a.value;s.endTime=n}}catch(e){r=!0,i=e}finally{try{!e&&t.return&&t.return()}finally{if(r)throw i}}this.display=[]}},{key:"_clearBufferedCues",value:function(){}}]),e}();e.default=i},{}],37:[function(a,n,e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),i=function(){function e(r){t(this,e),this.alpha_=r?Math.exp(Math.log(.5)/r):0,this.estimate_=0,this.totalWeight_=0}return r(e,[{key:"sample",value:function(e,r){var t=Math.pow(this.alpha_,e);this.estimate_=r*(1-t)+t*this.estimate_,this.totalWeight_+=e}},{key:"getTotalWeight",value:function(){return this.totalWeight_}},{key:"getEstimate",value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_}}]),e}();e.default=i},{}],38:[function(l,u,r){"use strict";function e(){}function a(t,e){return e="["+t+"] > "+e}function n(t){var r=window.console[t];return r?function(){for(var n=arguments.length,e=Array(n),i=0;n>i;i++)e[i]=arguments[i];e[0]&&(e[0]=a(t,e[0])),r.apply(window.console,e)}:e}function s(r){for(var i=arguments.length,a=Array(i>1?i-1:0),e=1;i>e;e++)a[e-1]=arguments[e];a.forEach(function(e){t[e]=r[e]?r[e].bind(r):n(e)})}Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},i={trace:e,debug:e,log:e,warn:e,info:e,error:e},t=i;r.enableLogs=function(e){if(e===!0||"object"===("undefined"==typeof e?"undefined":o(e))){s(e,"debug","log","info","warn","error");try{t.log()}catch(e){t=i}}else t=i},r.logger=t},{}],39:[function(r,t,i){"use strict";var e={buildAbsoluteURL:function(r,t){if(t=t.trim(),/^[a-z]+:/i.test(t))return t;var l=null,o=null,n=/^([^#]*)(.*)$/.exec(t);n&&(o=n[2],t=n[1]);var s=/^([^\?]*)(.*)$/.exec(t);s&&(l=s[2],t=s[1]);var f=/^([^#]*)(.*)$/.exec(r);f&&(r=f[1]);var u=/^([^\?]*)(.*)$/.exec(r);u&&(r=u[1]);var i=/^(([a-z]+:)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?)?(\/.*)$/i.exec(r);if(!i)throw new Error("Error trying to parse base URL.");var h=i[2]||"",d=i[1]||"",c=i[4],a=null;return a=/^\/\//.test(t)?h+"//"+e.buildAbsolutePath("",t.substring(2)):/^\//.test(t)?d+"/"+e.buildAbsolutePath("",t.substring(1)):e.buildAbsolutePath(d+c,t),l&&(a+=l),o&&(a+=o),a},buildAbsolutePath:function(n,s){for(var i,e,o=s,a="",t=n.replace(/[^\/]*$/,o.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),r=0;e=t.indexOf("/../",r),e>-1;r=e+i)i=/^\/(?:\.\.\/)*/.exec(t.slice(e))[0].length,a=(a+t.substring(r,e)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(i-1)/3+"}$"),"/");return a+t.substr(r)}};t.exports=e},{}],40:[function(r,s,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(i,r){for(var t=0;t<r.length;t++){var e=r[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(i,e.key,e)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),e=r("../utils/logger"),n=function(){function t(e){i(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return a(t,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var e=this.loader,t=this.timeoutHandle;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),t&&window.clearTimeout(t)}},{key:"load",value:function(t,r,i,a,n,s,o,l){var u=arguments.length<=8||void 0===arguments[8]?null:arguments[8],e=arguments.length<=9||void 0===arguments[9]?null:arguments[9];this.url=t,!e||isNaN(e.byteRangeStartOffset)||isNaN(e.byteRangeEndOffset)||(this.byteRange=e.byteRangeStartOffset+"-"+(e.byteRangeEndOffset-1)),this.responseType=r,this.onSuccess=i,this.onProgress=u,this.onTimeout=n,this.onError=a,this.stats={trequest:performance.now(),retry:0},this.timeout=s,this.maxRetry=o,this.retryDelay=l,this.loadInternal()}},{key:"loadInternal",value:function(){var e;e="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,e.onloadend=this.loadend.bind(this),e.onprogress=this.loadprogress.bind(this),e.open("GET",this.url,!0),this.byteRange&&e.setRequestHeader("Range","bytes="+this.byteRange),e.responseType=this.responseType,this.stats.tfirst=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(e,this.url),this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),this.timeout),e.send()}},{key:"loadend",value:function(i){var a=i.currentTarget,r=a.status,t=this.stats;t.aborted||(r>=200&&300>r?(window.clearTimeout(this.timeoutHandle),t.tload=performance.now(),this.onSuccess(i,t)):t.retry<this.maxRetry?(e.logger.warn(r+" while loading "+this.url+", retrying in "+this.retryDelay+"..."),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),t.retry++):(window.clearTimeout(this.timeoutHandle),e.logger.error(r+" while loading "+this.url),this.onError(i)))}},{key:"loadtimeout",value:function(t){e.logger.warn("timeout while loading "+this.url),this.onTimeout(t,this.stats)}},{key:"loadprogress",value:function(t){var e=this.stats;null===e.tfirst&&(e.tfirst=performance.now()),e.loaded=t.loaded,this.onProgress&&this.onProgress(t,e)}}]),t}();t.default=n},{"../utils/logger":38}]},{},[27])(27)});(function(mw,$,Hls){"use strict";if(Hls.isSupported()&&!mw.isNativeApp()&&!mw.isChromeCast()&&!mw.isDesktopSafari()&&!mw.getConfig("disableHLSOnJs")){var orig_supportsFlash=mw.supportsFlash.bind(mw);mw.supportsFlash=function(){return false;};$(mw).bind('EmbedPlayerUpdateMediaPlayers',function(event,mediaPlayers){if(Hls.isSupported()){var hlsPlayer=new mw.MediaPlayer('hlsPlayer',['video/h264','video/mp4','application/vnd.apple.mpegurl'],'Native');mediaPlayers.addPlayer(hlsPlayer);mw.EmbedTypes.mediaPlayers.setMIMETypePlayers('application/vnd.apple.mpegurl','Native');}});var hlsjs=mw.KBasePlugin.extend({defaultConfig:{withCredentials:false,options:{liveSyncDurationCount:3,liveMaxLatencyDurationCount:6},maxErrorRetryCount:2,hlsLogs:false},mediaErrorRecoveryCounter:0,playerErrorRecoveryCounter:0,debugInfoInterval:4,debugInfoCounter:0,LoadHLS:false,loaded:false,mediaAttached:false,isLevelSwitching:false,afterInitialSeeking:false,levelIndex:-1,version:"v0.5.23",ptsID3Data:{},isSafeEnviornment:function(){return Hls.isSupported();},setup:function(){this.log("version: "+Hls.version?Hls.version:this.version);mw.setConfig('isHLS_JS',true);this.addBindings();},addBindings:function(){this.bind("SourceChange",this.isNeeded.bind(this));this.bind("playerReady",this.initHls.bind(this));this.bind("onChangeMedia",this.clean.bind(this));this.bind("onLiveOffSynchChanged",this.onLiveOffSyncChanged.bind(this));if(mw.getConfig("hlsLogs")){this.bind("monitorEvent",this.monitorDebugInfo.bind(this));}},isNeeded:function(){if(this.getPlayer().mediaElement.selectedSource.mimeType==="application/vnd.apple.mpegurl"){this.LoadHLS=true;}else{this.LoadHLS=false;}},clean:function(){this.log("Clean");if(this.LoadHLS&&this.loaded){this.LoadHLS=false;this.loaded=false;this.unRegisterHlsEvents();this.restorePlayerMethods();this.hls.detachMedia();this.mediaAttached=false;this.hls.destroy();this.hls=null;}},initHls:function(){if(this.LoadHLS&&!this.loaded){this.log("Init");this.embedPlayer.streamerType='hls';var hlsConfig=this.getConfig("options");if(this.getConfig("withCredentials")){hlsConfig.xhrSetup=function(xhr,url){xhr.withCredentials=true;}}this.hls=new Hls(hlsConfig);this.loaded=true;this.mediaErrorRecoveryCounter=0;this.getPlayer().skipUpdateSource=true;this.registerHlsEvents();this.overridePlayerMethods();$(this.getPlayer().getPlayerElement()).one("canplay",function(){this.afterInitialSeeking=true;}.bind(this));this.bind("seeking",this.onSeekBeforePlay.bind(this));this.bind("firstPlay",function(){this.unbind("firstPlay");this.unbind("seeking");this.hls.attachMedia(this.getPlayer().getPlayerElement());}.bind(this));}},registerHlsEvents:function(){this.onMediaAttachedHandler=this.onMediaAttached.bind(this);this.hls.on(Hls.Events.MEDIA_ATTACHED,this.onMediaAttachedHandler);this.onManifestParsedHandler=this.onManifestParsed.bind(this);this.hls.on(Hls.Events.MANIFEST_PARSED,this.onManifestParsedHandler);this.onFragLoadingHandler=this.onFragLoading.bind(this);this.hls.on(Hls.Events.FRAG_LOADING,this.onFragLoadingHandler);this.onFragLoadedHandler=this.onFragLoaded.bind(this);this.hls.on(Hls.Events.FRAG_LOADED,this.onFragLoadedHandler);this.onFragParsingMetadataHandler=this.onFragParsingMetadata.bind(this);this.hls.on(Hls.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadataHandler);this.onFragParsingDataHandler=this.onFragParsingData.bind(this);this.hls.on(Hls.Events.FRAG_PARSING_DATA,this.onFragParsingDataHandler);this.onPTSUpdatedHandler=this.onPTSUpdated.bind(this);this.hls.on(Hls.Events.LEVEL_PTS_UPDATED,this.onPTSUpdatedHandler);this.onFragBufferedHandler=this.onFragBuffered.bind(this);this.hls.on(Hls.Events.FRAG_BUFFERED,this.onFragBufferedHandler);this.onLevelSwitchHandler=this.onLevelSwitch.bind(this);this.hls.on(Hls.Events.LEVEL_SWITCH,this.onLevelSwitchHandler);this.onFragChangedHandler=this.onFragChanged.bind(this);this.hls.on(Hls.Events.FRAG_CHANGED,this.onFragChangedHandler);this.onErrorHandler=this.onError.bind(this);this.hls.on(Hls.Events.ERROR,this.onErrorHandler);this.onDropFramesHandler=this.onDropFrames.bind(this);this.hls.on(Hls.Events.FPS_DROP,this.onDropFramesHandler);},unRegisterHlsEvents:function(){this.hls.off(Hls.Events.MEDIA_ATTACHED,this.onMediaAttachedHandler);this.onMediaAttachedHandler=null;this.hls.off(Hls.Events.MANIFEST_PARSED,this.onManifestParsedHandler);this.onManifestParsedHandler=null;this.hls.off(Hls.Events.FRAG_LOADING,this.onFragLoadingHandler);this.onFragLoadingHandler=null;this.hls.off(Hls.Events.FRAG_LOADED,this.onFragLoadedHandler);this.onFragLoadedHandler=null;this.hls.off(Hls.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadataHandler);this.onFragParsingMetadataHandler=null;this.hls.off(Hls.Events.FRAG_PARSING_DATA,this.onFragParsingDataHandler);this.onFragParsingDataHandler=null;this.hls.off(Hls.Events.LEVEL_PTS_UPDATED,this.onPTSUpdatedHandler);this.onPTSUpdatedHandler=null;this.hls.off(Hls.Events.FRAG_BUFFERED,this.onFragBufferedHandler);this.onFragBufferedHandler=null;this.hls.off(Hls.Events.LEVEL_SWITCH,this.onLevelSwitchHandler);this.onLevelSwitchHandler=null;this.hls.off(Hls.Events.FRAG_CHANGED,this.onFragChangedHandler);this.onFragChangedHandler=null;this.hls.off(Hls.Events.ERROR,this.onErrorHandler);this.onErrorHandler=null;this.hls.off(Hls.Events.FPS_DROP,this.onDropFramesHandler);this.onDropFramesHandler=null;},onMediaAttached:function(){this.log("Media attached");this.mediaAttached=true;var selectedSource=this.getPlayer().getSrc();if(selectedSource){this.getPlayer().resolveSrcURL(selectedSource).then(function(source){this.hls.loadSource(source);}.bind(this),function(){this.hls.loadSource(selectedSource);}.bind(this));}},onFragLoading:function(e,data){this.getPlayer().triggerHelper('hlsFragLoading',data.frag.url);},onFragLoaded:function(e,data){this.getPlayer().triggerHelper('hlsFragLoaded',data.frag.url);},onFragParsingMetadata:function(e,data){data.samples.forEach(function(sample){var sampleData=String.fromCharCode.apply(null,new Uint8Array(sample.data));var sampleString=sampleData.substring(sampleData.indexOf("{"),sampleData.lastIndexOf("}")+1);var id3Tag=JSON.parse(sampleString);this.ptsID3Data[Math.round(sample.pts)]=id3Tag;}.bind(this));},onFragParsingData:function(e,data){this.getPlayer().triggerHelper('hlsFragParsingData',data);},onPTSUpdated:function(e,data){this.getPlayer().triggerHelper('hlsUpdatePTS',data);},onFragBuffered:function(e,data){this.getPlayer().triggerHelper('hlsFragBuffered',data.frag.url);},onDropFrames:function(e,data){this.getPlayer().triggerHelper('hlsDropFPS',data.totalDropped);mw.log("hlsjs :: onDropFrames | totalDropped = "+data.totalDropped);},onManifestParsed:function(event,data){this.log("manifest loaded, found "+data.levels.length+" quality level");this.addAbrFlavors(data.levels);},onLevelSwitch:function(event,data){var source=this.hls.levels[data.level];var currentBitrate=Math.round(source.bitrate/1024);var previousBitrate=this.getPlayer().currentBitrate;this.getPlayer().currentBitrate=currentBitrate;this.getPlayer().triggerHelper('bitrateChange',currentBitrate);if(this.isLevelSwitching&&this.levelIndex==data.level){this.getPlayer().triggerHelper("sourceSwitchingStarted",previousBitrate);}this.getPlayer().triggerHelper('hlsCurrentBitrate',currentBitrate);mw.log("hlsjs :: onLevelSwitch | level = "+data.level+" | current bitrate = "+currentBitrate);},onFragChanged:function(event,data){if(data&&data.frag){if(data.frag.duration){this.fragmentDuration=data.frag.duration;}if(this.isLevelSwitching&&(this.levelIndex==data.frag.level)){this.isLevelSwitching=false;this.getPlayer().triggerHelper("sourceSwitchingEnd",this.getPlayer().currentBitrate);}this.getPlayer().triggerHelper('hlsFragChanged',data.frag);}},onError:function(event,data){this.log("Error: "+data.type+", "+data.details);if(this.mediaErrorRecoveryCounter>this.getConfig("maxErrorRetryCount")){this.handleUnRecoverableError(data);return;}switch(data.type){case Hls.ErrorTypes.NETWORK_ERROR:if(data.fatal){this.log("fatal network error encountered, try to recover");this.hls.startLoad();this.mediaErrorRecoveryCounter+=1;}else{if(this.isProtocolMismatch(data)){this.log("Error: protocol mismatch - probably caused by mixed content warning");this.handleUnRecoverableError(data);}}break;case Hls.ErrorTypes.MEDIA_ERROR:if(data.fatal){if(this.mediaErrorRecoveryCounter>1){this.log("fatal media error encountered, try to recover - switch audio codec");this.hls.swapAudioCodec();}this.log("fatal media error encountered, try to recover");this.hls.recoverMediaError();this.mediaErrorRecoveryCounter+=1;}else{switch(data.details){case Hls.ErrorDetails.BUFFER_STALLED_ERROR:this.getPlayer().bufferStart();break;}}break;default:if(data.fatal){this.handleUnRecoverableError(data);}break;}},isProtocolMismatch:function(data){var protocolMismatch=false;var hostPageProtocol=this.getProtocol(kWidgetSupport.getHostPageUrl());var currentUrl=null;switch(data.details){case Hls.ErrorDetails.FRAG_LOAD_ERROR:currentUrl=data.frag.url;break;case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:case Hls.ErrorDetails.LEVEL_LOAD_ERROR:currentUrl=data.url;break;}if(currentUrl!==null){var urlProtocol=this.getProtocol(currentUrl);if(urlProtocol!==hostPageProtocol){protocolMismatch=true;}}return protocolMismatch;},getProtocol:function(url){try{var parser=document.createElement('a');parser.href=url;return parser.protocol;}catch(e){return"";}},handleUnRecoverableError:function(data){this.log("fatal media error encountered, cannot recover: "+data.type+", "+data.details);this.clean();if(orig_supportsFlash()){this.log("Try flash fallback");this.fallbackToFlash();}else{this.getPlayer().triggerHelper('embedPlayerError',[data]);}},fallbackToFlash:function(){mw.EmbedTypes.mediaPlayers.removeMIMETypePlayers('application/vnd.apple.mpegurl','Native');mw.EmbedTypes.mediaPlayers.setMIMETypePlayers('application/vnd.apple.mpegurl','Kplayer');mw.EmbedTypes.addFlashPlayer();var embedPlayer=this.getPlayer();embedPlayer.setKalturaConfig("","LeadWithHLSOnJs",false);embedPlayer.setKalturaConfig("","LeadWithHLSOnFlash",true);embedPlayer.stop();embedPlayer.autoplay=true;embedPlayer.setupSourcePlayer();},addAbrFlavors:function(levels){if(levels&&levels.length>1){var flavors=levels.map(function(level,index){var sourceAspect=Math.round((level.width/level.height)*100)/100;return{'data-bandwidth':level.bitrate,'data-width':level.width,'data-height':level.height,'data-aspect':sourceAspect,'type':'video/mp4','data-frameRate':level.frameRate,'data-assetid':index};});this.getPlayer().setKDPAttribute('sourceSelector','visible',true);this.getPlayer().onFlavorsListChanged(flavors);}},overridePlayerMethods:function(){this.orig_backToLive=this.getPlayer().backToLive;this.orig_switchSrc=this.getPlayer().switchSrc;this.orig_playerSwitchSource=this.getPlayer().playerSwitchSource;this.orig_load=this.getPlayer().load;this.orig_onerror=this.getPlayer()._onerror;this.orig_ontimeupdate=this.getPlayer()._ontimeupdate;if(this.getPlayer()._onseeking){this.orig_onseeking=this.getPlayer()._onseeking.bind(this.getPlayer());}if(this.getPlayer()._onseeked){this.orig_onseeked=this.getPlayer()._onseeked.bind(this.getPlayer());}this.getPlayer().backToLive=this.backToLive.bind(this);this.getPlayer().switchSrc=this.switchSrc.bind(this);this.getPlayer().playerSwitchSource=this.playerSwitchSource.bind(this);this.getPlayer().load=this.load.bind(this);this.getPlayer()._onerror=this._onerror.bind(this);this.getPlayer()._ontimeupdate=this._ontimeupdate.bind(this);this.getPlayer()._onseeking=this._onseeking.bind(this);this.getPlayer()._onseeked=this._onseeked.bind(this);},restorePlayerMethods:function(){this.getPlayer().backToLive=this.orig_backToLive;this.getPlayer().switchSrc=this.orig_switchSrc;this.getPlayer().playerSwitchSource=this.orig_playerSwitchSource;this.getPlayer().load=this.orig_load;this.getPlayer()._onerror=this.orig_onerror;this.getPlayer()._ontimeupdate=this.orig_ontimeupdate;this.getPlayer()._onseeking=this.orig_onseeking;this.getPlayer()._onseeked=this.orig_onseeked;},backToLive:function(){var _this=this;var vid=this.getPlayer().getPlayerElement();this.embedPlayer.goingBackToLive=true;vid.currentTime=vid.duration-(this.fragmentDuration||10)*3;setTimeout(function(){_this.getPlayer().triggerHelper('movingBackToLive');_this.embedPlayer.goingBackToLive=false;},1000);},onLiveOffSyncChanged:function(event,status){if(this.getConfig("options")&&!this.defaultLiveMaxLatencyDurationCount){this.defaultLiveMaxLatencyDurationCount=this.getConfig("options").liveMaxLatencyDurationCount;}if(status){this.hls.config.liveMaxLatencyDurationCount=Hls.DefaultConfig["liveMaxLatencyDurationCount"];}else{this.hls.config.liveMaxLatencyDurationCount=this.defaultLiveMaxLatencyDurationCount;}},switchSrc:function(source){if(source!==-1){var sourceIndex=this.getPlayer().getSourceIndex(source);if(sourceIndex!=null){this.isLevelSwitching=true;this.levelIndex=sourceIndex;if(this.hls.currentLevel==sourceIndex){this.onLevelSwitch(Hls.Events.LEVEL_SWITCH,{level:sourceIndex});this.onFragChanged(Hls.Events.LEVEL_LOADED,{frag:{level:sourceIndex}});this.getPlayer().currentBitrate=source.getBitrate();this.getPlayer().triggerHelper('bitrateChange',source.getBitrate());}else{this.hls.nextLevel=sourceIndex;}}}else{this.hls.nextLevel=-1;}},load:function(){if(!this.getPlayer().isInSequence()){this.hls.startLoad();}},playerSwitchSource:function(src,switchCallback,doneCallback){if(!this.mediaAttached){this.unbind("firstPlay");this.unbind("seeking");this.hls.attachMedia(this.getPlayer().getPlayerElement());}this.getPlayer().play();if($.isFunction(switchCallback)){switchCallback();}},_onerror:function(evt){var errorTxt,mediaError=evt.currentTarget.error;switch(mediaError.code){case mediaError.MEDIA_ERR_ABORTED:errorTxt="You aborted the video playback";break;case mediaError.MEDIA_ERR_DECODE:errorTxt="The video playback was aborted due to a corruption problem or because the video used features your browser did not support. Trying to handle MediaError.";this.handleMediaError();break;case mediaError.MEDIA_ERR_NETWORK:errorTxt="A network error caused the video download to fail part-way";break;case mediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:errorTxt="The video could not be loaded, either because the server or network failed or because the format is not supported";break;}mw.log("HLS.JS ERROR: "+errorTxt);},_ontimeupdate:function(e){this.getPlayer().triggerHelper(e.type,e);var time=Math.round(e.currentTarget.currentTime);if(this.ptsID3Data[time]){this.getPlayer().triggerHelper('onId3Tag',this.ptsID3Data[time]);}},_onseeking:function(){if(this.afterInitialSeeking){this.orig_onseeking();}},_onseeked:function(){if(this.afterInitialSeeking){this.orig_onseeked();}},onSeekBeforePlay:function(){if(this.LoadHLS){this.unbind("firstPlay");this.unbind("seeking");this.hls.attachMedia(this.getPlayer().getPlayerElement());}},handleMediaError:function(){if(this.canRecover()){this.hls.recoverMediaError();}},canRecover:function(){if(this.playerErrorRecoveryCounter>2){this.playerErrorRecoveryCounter=0;return false;}this.playerErrorRecoveryCounter+=1;return true;},monitorDebugInfo:function(){this.debugInfoCounter++;if(this.debugInfoCounter===this.debugInfoInterval){this.debugInfoCounter=0;this.getPlayer().triggerHelper('hlsCurrentBuffer',mw.seconds2npt(this.getPlayer().getCurrentBufferLength()));if(mw.isChrome()||mw.isDesktopSafari()){this.getPlayer().triggerHelper('hlsDroppedFrames',this.getPlayer().getPlayerElement().webkitDroppedFrameCount);}else{this.getPlayer().triggerHelper('hlsDroppedFrames','not supported');}this.getPlayer().triggerHelper('hlsFPS','not supported');}}});mw.PluginManager.add('hlsjs',hlsjs);}})(window.mw,window.jQuery,window.Hls);;},{},{});mw.loader.implement("acCheck",function($){(function(mw,$){"use strict";var acCheck=function(embedPlayer){var ac=embedPlayer.kalturaContextData;var acStatus=kWidgetSupport.getAccessControlStatus(ac,embedPlayer);if(acStatus!==true){embedPlayer.setError(acStatus);return;}};mw.addKalturaConfCheck(function(embedPlayer,callback){if(embedPlayer.kalturaContextData){acCheck(embedPlayer);}callback();});})(window.mw,jQuery);;},{},{});mw.loader.implement("acPreview",function($){(function(mw,$){"use strict";var acPreview=function(embedPlayer){function acEndPreview(){mw.log('KWidgetSupport:: acEndPreview >');$(embedPlayer).trigger('KalturaSupport_FreePreviewEnd');mw.log('KWidgetSupport:: KalturaSupport_FreePreviewEnd set onDoneInterfaceFlag = false');embedPlayer.onDoneInterfaceFlag=false;var closeAcMessage=function(){$(embedPlayer).unbind('.acpreview');embedPlayer.layoutBuilder.closeMenuOverlay();embedPlayer.onClipDone();};$(embedPlayer).bind('onChangeMedia.acpreview',closeAcMessage);if(embedPlayer.getKalturaConfig('','disableAlerts')!==true){embedPlayer.layoutBuilder.displayMenuOverlay($('<div />').append($('<h3 />').append(embedPlayer.getKalturaMsg('FREE_PREVIEW_END_TITLE')),$('<span />').text(embedPlayer.getKalturaMsg('FREE_PREVIEW_END')),$('<br />'),$('<br />'),$('<button />').attr({'type':"button"}).addClass("ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only").append($('<span />').addClass("ui-button-text").text('Ok').css('margin','10')).click(closeAcMessage)),closeAcMessage);}};$(embedPlayer).unbind('.acPreview');var ac=embedPlayer.kalturaContextData;if(ac.isAdmin===false&&ac.isSessionRestricted===true&&ac.previewLength&&ac.previewLength!=-1){$(embedPlayer).bind('postEnded.acPreview',function(){acEndPreview(embedPlayer);});$(embedPlayer).bind('monitorEvent.acPreview',function(){if(embedPlayer.currentTime>=ac.previewLength){embedPlayer.stop();if(mw.isIOS()){embedPlayer.getPlayerElement().webkitExitFullScreen();}acEndPreview(embedPlayer);}});}};mw.addKalturaConfCheck(function(embedPlayer,callback){if(embedPlayer.kalturaContextData){acPreview(embedPlayer);}callback();});})(window.mw,jQuery);;},{},{});mw.loader.implement("base64_decode",function($){window['base64_decode']=function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;var _keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=_keyStr.indexOf(input.charAt(i++));enc2=_keyStr.indexOf(input.charAt(i++));enc3=_keyStr.indexOf(input.charAt(i++));enc4=_keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}if(enc4!=64){output=output+String.fromCharCode(chr3);}}return output;};},{},{});mw.loader.implement("base64_encode",function($){window['base64_encode']=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data;}data=utf8_encode(data+'');do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);}while(i<data.length);enc=tmp_arr.join('');var r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3);};;},{},{});mw.loader.implement("class",function($){(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret;};})(name,prop[name]):prop[name];}function Class(){if(!initializing&&this.init)this.init.apply(this,arguments);}Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class;};})();;},{},{});mw.loader.implement("closedCaptions",function($){(function(mw,$){"use strict";mw.PluginManager.add('closedCaptions',mw.KBaseComponent.extend({defaultConfig:{"parent":"controlsContainer","order":62,"displayImportance":"high","iconClass":"icon-cc","align":"right","showTooltip":true,"layout":"ontop","displayCaptions":null,"defaultLanguageKey":null,"whiteListLanguagesCodes":null,"useCookie":true,"hideWhenEmpty":false,"showEmbeddedCaptions":false,"hideClosedCaptions":false,"showEmbeddedCaptionsStyle":false,"showOffButton":true,"toggleActiveCaption":false,"useExternalClosedCaptions":false,"offButtonPosition":"first","forceLoadLanguage":false,"title":gM('mwe-embedplayer-timed_text'),"smartContainer":"qualitySettings",'smartContainerCloseEvent':'changedClosedCaptions',"forceWebVTT":false,"enableOptionsMenu":false,"sortCaptionsAlphabetically":false},textSources:[],defaultBottom:15,lastActiveCaption:null,updateLayoutEventFired:false,ended:false,setup:function(){var _this=this;this.cookieName=this.pluginName+'_languageKey';if((this.getConfig('useCookie')&&$.cookie(this.cookieName)&&$.cookie(this.cookieName)=='None')||(this.getConfig('hideClosedCaptions')===true)){this.setConfig('displayCaptions',false);}if(_this.getConfig("enableOptionsMenu")){this.optionsMenu=new mw.closedCaptions.cvaa(this.getPlayer(),function(){},"cvaa");if(!this.optionsMenu.isSafeEnviornment()){this.setConfig('enableOptionsMenu',false);}}if((this.embedPlayer.isOverlayControls()&&!this.embedPlayer.getInterface().find('.controlBarContainer').is(':hidden'))||this.embedPlayer.useNativePlayerControls()){if(this.embedPlayer.layoutBuilder){this.defaultBottom+=this.embedPlayer.layoutBuilder.getHeight();}}this.embedPlayer.bindHelper("propertyChangedEvent",function(event,data){if(data.plugin===_this.pluginName){if(data.property==="captions"){_this.getMenu().$el.find("li a")[data.value].click();}}});if(this.getConfig('showEmbeddedCaptions')===true){if(this.getConfig('showEmbeddedCaptionsStyle')===true){this.bind('textTrackIndexChanged',function(e,captionData){if(captionData.ttml){var xml=$.parseXML(mw.html.unescape(decodeURIComponent(captionData.ttml)));_this.selectedSource.parseStylesTTML(xml);}});}this.bind('onEmbeddedData',function(e,captions){_this.handleEmbeddedData(captions);});this.bind('changedClosedCaptions',function(){_this.getPlayer().triggerHelper('newClosedCaptionsData');_this.embedPlayer.getInterface().find('.track').empty();_this.getPlayer().triggerHelper('changeEmbeddedTextTrack',_this.selectedSource);});this.bind('textTracksReceived',function(e,data){if(data&&$.isArray(data.languages)&&data.languages.length){_this.destory();var newSources=[];$.each(data.languages,function(inx,src){var source=new mw.TextSource($.extend({srclang:src.label},src),_this.embedPlayer);source.loaded=true;newSources.push(source);});_this.buildMenu(newSources);outOfBandCaptionEventHandlers.call(_this);}});}else{if(!this.getConfig("useExternalClosedCaptions")){this.bind('playerReady',function(){_this.destory();_this.setupTextSources(function(){_this.buildMenu(_this.textSources);});});outOfBandCaptionEventHandlers.call(this);}}if(this.getConfig("useExternalClosedCaptions")){this.bind('loadExternalClosedCaptions',function(e,data){if(!(data&&$.isArray(data.languages))){data.languages=[];}var languages=$.map(data.languages,function(language){var textSource=language;if(!(language instanceof mw.TextSource)){textSource=_this.addTextSource(language);}return textSource;});_this.destory();_this.buildMenu(languages);});outOfBandCaptionEventHandlers.call(this);}function outOfBandCaptionEventHandlers(){var _this=this;this.bind('timeupdate',function(){if(_this.getConfig('displayCaptions')===true&&_this.selectedSource){_this.monitor();}});this.bind('ended',function(){_this.ended=true;});this.bind('playing',function(){_this.ended=false;});this.bind('resizeEvent',function(){if(_this.selectedSource.mimeType==="text/vtt"){mw.log('mw.ClosedCaptions:: resizeEvent: remove captions');_this.getPlayer().getInterface().find('.track').remove();}})}this.bind('onplay',function(){_this.playbackStarted=true;_this.getMenu().close();});this.bind('hidePlayerControls',function(){_this.getComponent().removeClass('open');_this.getMenu().close();});this.bind('showHideClosedCaptions',function(){if(_this.getConfig('displayCaptions')===true){_this.setConfig('displayCaptions',false);}else{_this.setConfig('displayCaptions',true);}});this.bind('showClosedCaptions preHideScreen hideMobileComponents',function(){if(!_this.embedPlayer.changeMediaStarted&&_this.getConfig('displayCaptions')===false&&_this.selectedSource){_this.setConfig('displayCaptions',true);}});this.bind('hideClosedCaptions preShowScreen showMobileComponents',function(){if(_this.getConfig('displayCaptions')===true){_this.setConfig('displayCaptions',false);}});this.bind('updateLayout',function(){if(_this.updateLayoutEventFired){return;}if(_this.getConfig("displayCaptions")==true){_this.updateTextSize();}});if(this.getConfig('layout')=='below'){this.updateBelowVideoCaptionContainer();}if(this.getConfig('layout')=='ontop'){this.bind('onHideControlBar onShowControlBar',function(event,layout){if(!_this.ended&&_this.getPlayer().isOverlayControls()){_this.defaultBottom=layout.bottom;_this.getPlayer().getInterface().find('.track').animate(layout,'fast');}});}this.bind("AdSupport_StartAdPlayback",function(){_this.setConfig('displayCaptions',false);_this.hideCaptions();});this.bind("AdSupport_EndAdPlayback",function(){_this.setConfig('displayCaptions',true);_this.showCaptions();});this.bind("playSegmentEvent",function(){_this.updateTimeOffset();});this.bind('onDisableInterfaceComponents',function(e,arg){_this.getMenu().close();});this.bind('newCaptionsStyles',function(e,stylesObj){_this.customStyle=stylesObj;});},addTextSource:function(captionData){var embedSource=this.embedPlayer.mediaElement.tryAddSource($('<track />').attr({'kind':'subtitles','language':captionData.language,'srclang':captionData.languageCode,'label':captionData.label||captionData.language,'fileExt':captionData.fileExt,'src':captionData.src,'title':captionData.label,'default':captionData.isDefault})[0]);return new mw.TextSource(embedSource,this.embedPlayer);},updateTextSize:function(){var textOffset=this.getPlayer().layoutBuilder.isInFullScreen()?mw.getConfig("TimedText.BottomPadding")*2:mw.getConfig("TimedText.BottomPadding");var textCss=this.getInterfaceSizeTextCss({'width':this.getPlayer().getInterface().width(),'height':this.getPlayer().getInterface().height()});this.log('set text size for: : '+this.getPlayer().getInterface().width()+' = '+textCss['font-size']);this.getPlayer().getInterface().find('.track').css(textCss).css({'bottom':textOffset+'px'});if(this.getConfig('layout')=='below'){var _this=this;setTimeout(function(){_this.updateBelowVideoCaptionContainer();},50)}},getUserLanguageKeyPrefrence:function(){if(!this.getConfig('useCookie')){return false;}return $.cookie(this.cookieName);},onConfigChange:function(property,value){switch(property){case'displayCaptions':if(value===false){this.hideCaptions();}else{this.showCaptions();}break;}this._super(property,value);},hideCaptions:function(){if(!this.getConfig('displayCaptions')||this.textSources.length===0){this.getMenu().clearActive();if(this.getConfig('showOffButton')){this.getMenu().$el.find('.offBtn').addClass('active');}this.getCaptionsOverlay().hide();var $cc=this.embedPlayer.getInterface().find('.captionContainer');$cc.remove();this.embedPlayer.doUpdateLayout(true);this.getPlayer().triggerHelper('closedCaptionsHidden');}},showCaptions:function(){if(this.getConfig('displayCaptions')){this.getMenu().clearActive();this.getCaptionsOverlay().show();if(this.selectedSource!=null){this.getPlayer().triggerHelper('closedCaptionsDisplayed',{language:this.selectedSource.label});this.getMenu().$el.find("li").eq(this.lastActiveCaption).addClass('active');}if(this.getConfig('layout')=='below'){this.updateBelowVideoCaptionContainer();}}},getCaptionURL:function(captionId){if(this.captionURLs&&this.captionURLs[captionId]){return this.captionURLs[captionId];}return null;},updateTimeOffset:function(){if(this.embedPlayer.supportsURLTimeEncoding()&&this.embedPlayer.startTime){this.timeOffset=this.embedPlayer.startTime;}},setupTextSources:function(callback){var _this=this;this.updateTimeOffset();$.each(this.getPlayer().getTextTracks(),function(inx,textSource){var textSource=new mw.TextSource(textSource,_this.embedPlayer);if(!_this.textSourcesInSources(_this.textSources,textSource)){_this.textSources.push(textSource);}});this.loadCaptionsFromApi(function(captions){$.each(captions,function(){var textSource=_this.getTextSourceFromDB(this);if(!_this.textSourcesInSources(_this.textSources,textSource)){_this.textSources.push(textSource);}});_this.getPlayer().triggerHelper('ccDataLoaded',[_this.textSources,function(textSources){_this.textSources=textSources;}]);if(_this.getConfig('forceLoadLanguage')){_this.forceLoadLanguage();}if(_this.getConfig('displayCaptions')!==false||($.cookie(_this.cookieName)!=='None'&&$.cookie(_this.cookieName))){_this.autoSelectSource();if(_this.selectedSource){_this.setTextSource(_this.selectedSource,false);}}callback();});},textSourcesInSources:function(sources,textSource){for(var i=0;i<sources.length;i++){if(sources[i].id===textSource.id){return true;}}return false;},loadCaptionsFromApi:function(callback){if(!this.getPlayer().kentryid){this.log('loadCaptionsFromApi:: Entry Id not found, exit.');callback([]);return;}var _this=this;this.getKalturaClient().doRequest({'service':'caption_captionasset','action':'list','filter:objectType':'KalturaAssetFilter','filter:entryIdEqual':this.getPlayer().kentryid,'filter:statusEqual':2,'pager:pageSize':50},function(data){mw.log("mw.ClosedCaptions:: loadCaptionsFromApi: "+data.totalCount,data.objects);if(data.objects&&data.objects.length){if(_this.getConfig("whiteListLanguagesCodes")!=null){mw.log("mw.ClosedCaptions:: whitelist : "+_this.getConfig("whiteListLanguagesCodes"));var whiteListedLaguages=new Array();var whiteListArr=_this.getConfig("whiteListLanguagesCodes").split(",");for(var j=0;j<whiteListArr.length;j++){for(var i=data.objects.length-1;i>-1;i--){if(data.objects[i].languageCode==whiteListArr[j]){whiteListedLaguages.push(data.objects[i]);}}}data.objects=whiteListedLaguages;if(!data.objects.length&&_this.getConfig("hideWhenEmpty")==true){_this.getBtn().hide();}}_this.loadCaptionsURLsFromApi(data.objects,callback);}else{callback([]);}});},loadCaptionsURLsFromApi:function(captions,callback){var _this=this;var multiRequest=[],captionIds=[];$.each(captions,function(inx,caption){multiRequest.push({'service':'caption_captionasset','action':'getUrl','id':caption.id});captionIds.push(caption.id);});if(multiRequest.length){this.getKalturaClient().doRequest(multiRequest,function(result){var captionsURLs={};if(typeof result=='string'){captionsURLs[captionIds[0]]=result;}else{$.each(result,function(idx,captionUrl){captionsURLs[captionIds[idx]]=captionUrl;});}_this.captionURLs=captionsURLs;mw.log('mw.ClosedCaptions:: loadCaptionsURLsFromApi> total captions count: '+captions.length);if(_this.getConfig("sortCaptionsAlphabetically")){captions=_this.sortByKey(captions,'language');callback(captions);}callback(captions);});}},sortByKey:function(array,key){return array.sort(function(a,b){var x=a[key];var y=b[key];return((x<y)?-1:((x>y)?1:0));});},getTextSourceFromDB:function(dbTextSource){var _this=this;if(!dbTextSource.fileExt){switch(dbTextSource.format){case'1':dbTextSource.fileExt='srt';break;case'2':dbTextSource.fileExt='xml';break;case'3':dbTextSource.fileExt='vtt';break;}}var captionsSrc;if(mw.isIphone()&&!mw.getConfig('disableTrackElement')&&!this.getConfig('forceLoadLanguage')||this.getConfig("forceWebVTT")){captionsSrc=mw.getConfig('Kaltura.ServiceUrl')+"/api_v3/index.php/service/caption_captionasset/action/serveWebVTT/captionAssetId/"+dbTextSource.id+"/segmentIndex/-1/version/2/captions.vtt";}else{captionsSrc=this.getCaptionURL(dbTextSource.id)+'/.'+dbTextSource.fileExt;}this.bind('onChangeMediaDone',function(){_this.embedPlayer.getInterface().find('track').remove();});var embedSource=this.embedPlayer.mediaElement.tryAddSource($('<track />').attr({'kind':'subtitles','language':dbTextSource.language,'srclang':dbTextSource.languageCode,'label':dbTextSource.label||dbTextSource.language,'id':dbTextSource.id,'fileExt':dbTextSource.fileExt,'src':captionsSrc,'title':dbTextSource.label,'default':dbTextSource.isDefault})[0]);return new mw.TextSource(embedSource,_this.embedPlayer);},forceLoadLanguage:function(){var lang=this.getConfig('forceLoadLanguage');var source=this.selectSourceByLangKey(lang);if(source&&!source.loaded){source.load($.proxy(function(){this.getPlayer().triggerHelper('forcedCaptionLoaded',source);},this));}},autoSelectSource:function(){var _this=this;this.selectedSource=null;if(!this.textSources.length){this.log("Error:: autoSelectSource no textSources set");return;}var source=null;if(this.getUserLanguageKeyPrefrence()){source=this.selectSourceByLangKey(this.getUserLanguageKeyPrefrence());if(source){this.log('autoSelectSource: select by user preference');this.selectedSource=source;return;}}var defaultLangKey=this.getConfig('defaultLanguageKey');if(!this.selectedSource&&defaultLangKey){if(defaultLangKey=='None'){return;}source=this.selectSourceByLangKey(defaultLangKey);if(source){this.log('autoSelectSource: select by defaultLanguageKey: '+defaultLangKey);this.selectedSource=source;this.embedPlayer.getInterface().find('[srclang='+defaultLangKey+']').attr("default","true");return;}}if(!this.selectedSource){source=this.selectDefaultSource();if(source){this.log('autoSelectSource: select by default caption');this.selectedSource=source;}}if(!this.selectedSource&&mw.getConfig('Kaltura.UserLanguage')){$.each(mw.getConfig('Kaltura.UserLanguage'),function(lang,priority){source=_this.selectSourceByLangKey(lang);if(source){_this.log('autoSelectSource: select by browser language: '+lang);_this.selectedSource=source;return true;}});}if(!this.selectedSource){this.log('autoSelectSource: select first caption');this.selectedSource=this.textSources[0];}},selectSourceByLangKey:function(langKey){var _this=this;var selectedSource=null;$.each(this.textSources,function(idx,source){if(source.srclang&&langKey==source.srclang.toLowerCase()){selectedSource=source;_this.embedPlayer.triggerHelper("sourceSelectedByLangKey",[selectedSource.label]);return false;}});return selectedSource;},selectDefaultSource:function(){var selectedSource=null;$.each(this.textSources,function(idx,source){if(source['default']){selectedSource=source;return false;}});return selectedSource;},monitor:function(){if(this.selectedSource&&this.selectedSource.captions&&this.selectedSource.captions.length>0){this.updateSourceDisplay(this.selectedSource,this.getPlayer().currentTime);}},updateSourceDisplay:function(source,time){var _this=this;if(this.timeOffset){time=time+parseInt(this.timeOffset);}var activeCaptions=source.getCaptionForTime(time);var addedCaption=false;$.each(activeCaptions,function(capId,caption){if(_this.embedPlayer.getInterface().find('.track[data-capId="'+capId+'"]').length==0){_this.addCaption(source,capId,caption);addedCaption=true;}});_this.embedPlayer.getInterface().find('.track').each(function(inx,caption){if(!activeCaptions[$(caption).attr('data-capId')]){if(addedCaption){$(caption).remove();}else{$(caption).fadeOut(mw.getConfig('EmbedPlayer.MonitorRate'),function(){$(this).remove();});}}});},addCaptionAsDomElement:function(source,capId,caption){var $textTarget=$('<div />').addClass('track').attr('data-capId',capId).html($(caption.content).addClass('caption').css('pointer-events','auto').css("background-color",(this.customStyle&&this.customStyle.windowColor)?this.customStyle.windowColor:"none"));this.displayTextTarget($textTarget);var captionDiv=$('.caption div');captionDiv.css("background-color","transparent");captionDiv.css(this.getCaptionCss());this.getCaptionsOverlay().css('margin','1.5%');},addCaptionAsText:function(source,capId,caption){var $textTarget=$('<div />').addClass('track').attr('data-capId',capId).hide();var $windowTarget=$('<div />').css("background-color",(this.customStyle&&this.customStyle.windowColor)?this.customStyle.windowColor:"none").addClass('trackWindow');$textTarget.append($windowTarget.append($('<span />').addClass('ttmlStyled').css('pointer-events','auto').css(this.getCaptionCss()).append($('<span>').css('position','relative').html(caption.content))));$textTarget.attr('lang',source.srclang.toLowerCase());$textTarget.find('a').attr('target','_blank');if(this.getConfig('layout')=='ontop'){if(caption.css){$textTarget.css(caption.css);}else{$textTarget.css(this.getDefaultStyle());}}this.displayTextTarget($textTarget);$textTarget.css(this.getInterfaceSizeTextCss({'width':this.embedPlayer.getInterface().width(),'height':this.embedPlayer.getInterface().height()}));if(caption.styleId){var capCss=source.getStyleCssById(caption.styleId);$textTarget.find('span.ttmlStyled').css(capCss);}$textTarget.fadeIn('fast');this.getCaptionsOverlay().css('margin','0px');},addCaption:function(source,capId,caption){if(source.mimeType==="text/vtt"){this.addCaptionAsDomElement(source,capId,caption)}else{this.addCaptionAsText(source,capId,caption);}},displayTextTarget:function($textTarget){var embedPlayer=this.embedPlayer;var $interface=embedPlayer.getInterface();if(this.getConfig('layout')=='ontop'){this.addTextOverlay($textTarget);}else if(this.getConfig('layout')=='below'){this.addTextBelowVideo($textTarget);}else{this.log("Possible Error, layout mode not recognized: "+this.getConfig('layout'));}embedPlayer.triggerHelper("captionsUpdated",$textTarget.html());},getInterfaceSizeTextCss:function(size){return{'font-size':this.getInterfaceSizePercent(size)+'%'};},getCaptionsOverlay:function(){return this.getPlayer().getInterface().find('.captionsOverlay');},addTextOverlay:function($textTarget){var _this=this;var $captionsOverlayTarget=this.getCaptionsOverlay();var layoutCss={'left':0,'top':0,'bottom':0,'right':0};if($captionsOverlayTarget.length==0){$captionsOverlayTarget=$('<div />').addClass('captionsOverlay').css(layoutCss).css('pointer-events','none');this.embedPlayer.getVideoHolder().append($captionsOverlayTarget);}$captionsOverlayTarget.append($textTarget);},addTextBelowVideo:function($textTarget){var $interface=this.embedPlayer.getInterface();this.embedPlayer.layoutBuilder.keepControlBarOnScreen=true;if(!$interface.find('.captionContainer').length||this.embedPlayer.useNativePlayerControls()){this.updateBelowVideoCaptionContainer();}$interface.find('.captionContainer').html($textTarget);},updateBelowVideoCaptionContainer:function(){var _this=this;mw.log("TimedText:: updateBelowVideoCaptionContainer");if(this.getConfig('displayCaptions')===false){return;}var $cc=_this.embedPlayer.getInterface().find('.captionContainer');if(!$cc.length){$cc=$('<div>').addClass('captionContainer block').css({'width':'100%','background-color':'#000','text-align':'center','padding-top':'5px'})
_this.embedPlayer.getVideoHolder().after($cc);}var height=(_this.getInterfaceSizePercent({'width':_this.embedPlayer.getInterface().width(),'height':_this.embedPlayer.getInterface().height()})/100)*mw.getConfig('TimedText.BelowVideoBlackBoxHeight');$cc.css('height',height+'px');this.updateLayoutEventFired=true;_this.embedPlayer.doUpdateLayout();this.updateLayoutEventFired=false;},getInterfaceSizePercent:function(size){var sizeFactor=4;if(size.height/size.width<.7){sizeFactor=6;}var textSize=size.width/sizeFactor;if(textSize<95){textSize=95;}if(textSize>200){textSize=200;}return textSize;},getCaptionCss:function(){var style;if(this.customStyle){style=this.getCustomCaptionCss();}else if(this.embedPlayer.playerConfig.layout.skin==="ott"){style=this.getOttCaptionCss();}else{style=this.getDefaultCaptionCss();}return style;},getOttCaptionCss:function(){var style={};style["display"]="inline";style["color"]="white";style["font-size"]=this.getEmFromFontSize(22);style["text-shadow"]="0px 1px 5px #000000";style["text-align"]="center";style["background"]="none";return style;},getDefaultCaptionCss:function(){var style={};style["display"]="inline";if(this.getConfig('bg')){style["background-color"]=mw.getHexColor(this.getConfig('bg'));}if(this.getConfig('fontColor')){style["color"]=mw.getHexColor(this.getConfig('fontColor'));}if(this.getConfig('fontFamily')){style["font-family"]=this.getConfig('fontFamily');}if(this.getConfig('fontsize')){var fontsize=parseInt(this.getConfig('fontsize'));style["font-size"]=this.getEmFromFontSize(fontsize);}if(this.getConfig('useGlow')&&this.getConfig('glowBlur')&&this.getConfig('glowColor')){var hShadow=this.getConfig('hShadow')?this.getConfig('hShadow'):0;var vShadow=this.getConfig('vShadow')?this.getConfig('vShadow'):0;style["text-shadow"]=hShadow+'px '+vShadow+'px '+this.getConfig('glowBlur')+'px '+mw.getHexColor(this.getConfig('glowColor'));}return style;},getCustomCaptionCss:function(){var style={};style["display"]="inline";style["font-family"]=this.customStyle.fontFamily;style["color"]=this.customStyle.fontColor;style["font-size"]=this.customStyle.fontSize;style["background-color"]=this.customStyle.backgroundColor;style["text-shadow"]=this.customStyle.edgeStyle;return style;},getEmFromFontSize:function(fontsize){var emFontMap={'6':.5,'7':.583,'8':.666,'9':.75,'10':.833,'11':.916,'12':1,'13':1.083,'14':1.166,'15':1.25,'16':1.333,'17':1.416,'18':1.5,'19':1.583,'20':1.666,'21':1.75,'22':1.833,'23':1.916,'24':2};var calculatedEm=(emFontMap[fontsize])?emFontMap[fontsize]:(fontsize>24)?emFontMap[24]:emFontMap[6];return(calculatedEm+'em');},getDefaultStyle:function(){var baseCss={'position':'absolute','bottom':this.defaultBottom,'width':'100%','display':'block','opacity':.8,'text-align':'center','z-index':2};baseCss=$.extend(baseCss,this.getInterfaceSizeTextCss({'width':this.embedPlayer.getInterface().width(),'height':this.embedPlayer.getInterface().height()}));return baseCss;},buildMenu:function(sources){for(var i=sources.length-1;i>=0;i--){if(sources[i].srclang&&sources[i].srclang==="multilingual"){sources.splice(i,1);}}var _this=this;mw.log('closedCaptions::buildMenu with sources: ',sources);this.getMenu().destroy();if(sources==0){this.setConfig('displayCaptions',false);if(this.getConfig('hideWhenEmpty')===true){this.getBtn().hide();}this.getMenu().addItem({'label':gM('mwe-timedtext-no-subtitles')});this.hideCaptions();this.getPlayer().triggerHelper('captionsMenuReady');this.getPlayer().triggerHelper("updatePropertyEvent",{"plugin":this.pluginName,"property":"captions","items":[{'label':gM('mwe-timedtext-no-subtitles'),'value':gM('mwe-timedtext-no-subtitles')}]});return this.getMenu();}else{if(this.getConfig('hideWhenEmpty')==true&&!this.embedPlayer.isMobileSkin()){this.setConfig('visible',true)}if(this.getConfig("parent")!=="smartContainer"){this.getComponent().show();}this.embedPlayer.triggerHelper("updateComponentsVisibilityDone");this.showCaptions();}this.getPlayer().triggerHelper('captionsMenuEmpty');if(this.getConfig('enableOptionsMenu')){this.addOptionsButton(this.optionsMenu.addOptionsBtn());}if(this.getConfig('showOffButton')&&this.getConfig('offButtonPosition')=='first'){this.addOffButton();}var items=[];for(var j=0;j<sources.length;j++){var src=sources[j];this.addSourceButton(src);items.push({'label':src.label,'value':src.label});}this.getActiveCaption();if(this.getConfig('showOffButton')&&this.getConfig('offButtonPosition')=='last'){this.addOffButton();}if(this.getConfig('showOffButton')){items.unshift({'label':'Off','value':'Off'});}if(this.embedPlayer.isMobileSkin()){var activeText=this.getMenu().$el.find('.active').text();var activeIndex=this.getMenu().mobileMenu.find('option[value="'+activeText+'"]').index();this.getMenu().setActive(activeIndex);}this.getPlayer().triggerHelper("updatePropertyEvent",{"plugin":this.pluginName,"property":"captions","items":items,"selectedItem":this.getMenu().$el.find('.active a').text()});this.getPlayer().triggerHelper('captionsMenuReady');},addSourceButton:function(src){var _this=this;_this.getMenu().addItem({'label':src.label,'callback':function(){if(_this.getConfig('toggleActiveCaption')&&_this.selectedSource===src){_this.selectedSource=null;_this.setConfig('displayCaptions',false);}else{_this.setTextSource(src);_this.embedPlayer.triggerHelper("selectClosedCaptions",src.label);_this.getActiveCaption();}},'active':(_this.selectedSource===src&&_this.getConfig("displayCaptions"))});},addOffButton:function(){var _this=this;this.getMenu().addItem({'label':'Off','attributes':{'class':"offBtn"},'callback':function(){_this.selectedSource=null;_this.embedPlayer.triggerHelper("selectClosedCaptions","Off");_this.embedPlayer.triggerHelper('changedClosedCaptions',{language:""});_this.setConfig('displayCaptions',false);_this.getPlayer().setCookie(_this.cookieName,'None');},'active':!_this.getConfig("displayCaptions")});},addOptionsButton:function(btnOptions){var _this=this;this.getMenu().addItem({'label':btnOptions.optionsLabel,'attributes':{'class':"cvaaOptions"},'callback':function(){_this.getPlayer().triggerHelper(btnOptions.optionsEvent);},'active':false});},setTextSource:function(source,setCookie){setCookie=(setCookie===undefined)?true:setCookie;var _this=this;if(!source.loaded){this.embedPlayer.getInterface().find('.track').css(this.getDefaultStyle()).html($('<div />').text(gM('mwe-timedtext-loading-text')));source.load(function(){_this.getPlayer().triggerHelper('newClosedCaptionsData',_this.selectedSource);if(_this.playbackStarted){_this.monitor();}});}this.selectedSource=source;if(!this.getConfig('displayCaptions')){_this.getActiveCaption();this.setConfig('displayCaptions',true);}if(setCookie&&this.getConfig('useCookie')){this.getPlayer().setCookie(this.cookieName,source.srclang.toLowerCase());}this.getPlayer().triggerHelper('changedClosedCaptions',{language:this.selectedSource.label?this.selectedSource.label:""});},getActiveCaption:function(){var _this=this;var currentActiveCaption=this.getMenu().$el.find('.active').index();if(this.lastActiveCaption===null){_this.lastActiveCaption=currentActiveCaption;return _this.lastActiveCaption;}if(this.lastActiveCaption!=currentActiveCaption){_this.lastActiveCaption=currentActiveCaption;return _this.lastActiveCaption;}},getComponent:function(){var _this=this;if(!this.$el){var $menu=$('<ul />').addClass('dropdown-menu');var $button=$('<button />').addClass('btn icon-cc').attr('title',_this.getConfig('title')).click(function(e){if(_this.getMenu().numOfChildren()>0){_this.getMenu().toggle();}else{_this.getPlayer().triggerHelper("showHideClosedCaptions");}});this.setAccessibility($button,gM('mwe-embedplayer-timed_text'));this.$el=$('<div />').addClass('dropup'+this.getCssClass()).append($button,$menu);}return this.$el;},getMenu:function(){if(!this.menu){this.menu=new mw.KMenu(this.getComponent().find('ul'),{tabIndex:this.getBtn().attr('tabindex')});}return this.menu;},getBtn:function(){return this.getComponent().find('button');},destory:function(){this.playbackStarted=false;this.textSources=[];this.selectedSource=null;},parseCaption:function(caption){var parsedCaption=caption.content;var regExp=/^\d{2}:\d{2}:\d{2}\.\d{3}\s-->\s\d{2}:\d{2}:\d{2}\.\d{3}\s/;if(regExp.test(parsedCaption))parsedCaption=parsedCaption.replace(regExp,"");regExp=/align:(left|middle|right)/;if(regExp.test(parsedCaption))parsedCaption=parsedCaption.replace(regExp,"");return{"content":parsedCaption};},handleEmbeddedData:function(captionData){var $tracks=this.embedPlayer.getInterface().find('.track');$tracks.each(function(inx,caption){if($(caption).attr('data-capId')==captionData.capId){$(caption).remove();}});if(this.getConfig('displayCaptions')===true){if(!this.selectedSource){this.selectedSource=captionData.source;}if(captionData.ttml){this.handleTTML(captionData);}else{this.handleVTT(captionData);}}},handleTTML:function(captionData){var timestamp=0;var xml=$.parseXML(mw.html.unescape(decodeURIComponent(captionData.ttml)));var p=$(xml).find('p')[0];captionData.caption=this.selectedSource.parseCaptionObjTTML(p);var attr=p.attributes;var i;for(i=0;i<attr.length;i++){if(attr[i].nodeName==="timestamp"){timestamp=parseFloat(attr[i].value);break;}}var captionContent=this.parseCaption(captionData.caption);var newCaption={start:captionData.caption.start+timestamp,end:captionData.caption.end+timestamp,content:captionContent.content};this.selectedSource.captions.push(newCaption);},handleVTT:function(captionData){var captionContent=this.parseCaption(captionData.caption);this.addCaption(this.selectedSource,captionData.capId,captionContent);}}));})(window.mw,window.jQuery);(function(mw,$){"use strict";mw.closedCaptions=mw.closedCaptions||{};mw.closedCaptions.cvaa=mw.KBaseScreen.extend({defaultConfig:{templatePath:'components/cvaa/cvaa.tmpl.html',usePreviewPlayer:false,previewPlayerEnabled:false,useCookie:true,cvaaDefaultSettings:{fontFamily:"Arial, Roboto, Arial Unicode Ms, Helvetica, Verdana, PT Sans Caption, sans-serif",fontColor:"#ffffff",fontOpacity:100,fontSize:12,backgroundColor:"#000000",backgroundOpacity:75,windowColor:"#ffffff",windowOpacity:0,edgeStyle:"none"},cvaaOptions:{"sliders":{"fontSize":{"min":6,"max":24,"default":"fontSize","selector":"kFontSize"},"fontOpacity":{"min":0,"max":100,"default":"fontOpacity","selector":"kFontOpacity"},"backgroundOpacity":{"min":0,"max":100,"default":"backgroundOpacity","selector":"kBackgroundOpacity"},"windowOpacity":{"min":0,"max":100,"default":"windowOpacity","selector":"kWindowOpacity"}},"edgeStyle":[{"prop":1,"text":"None","value":"none"},{"prop":2,"text":"Drop shadow","value":"rgb(34, 34, 34) 2px 2px 3px, rgb(34, 34, 34) 2px 2px 4px, rgb(34, 34, 34) 2px 2px 5px"},{"prop":3,"text":"Raised","value":"rgb(34, 34, 34) 1px 1px, rgb(34, 34, 34) 2px 2px, rgb(34, 34, 34) 3px 3px"},{"prop":4,"text":"Depressed","value":"rgb(204, 204, 204) 1px 1px, rgb(204, 204, 204) 0px 1px, rgb(34, 34, 34) -1px -1px, rgb(34, 34, 34) 0px -1px"},{"prop":5,"text":"Outlined","value":"rgb(34, 34, 34) 0px 0px 4px, rgb(34, 34, 34) 0px 0px 4px, rgb(34, 34, 34) 0px 0px 4px, rgb(34, 34, 34) 0px 0px 4px"}],"color":[{"prop":1,"text":"White","value":"#ffffff"},{"prop":2,"text":"Yellow","value":"#ffff00"},{"prop":3,"text":"Green","value":"#00ff00"},{"prop":4,"text":"Cyan","value":"#00ffff"},{"prop":5,"text":"Blue","value":"#0000ff"},{"prop":6,"text":"Magenta","value":"#ff00ff"},{"prop":7,"text":"Red","value":"#ff0000"},{"prop":8,"text":"Black","value":"#000000"}],"family":[{"prop":1,"text":"Monospaced Serif","value":"Courier New, Courier, Nimbus Mono L, Cutive Mono, monospace"},{"prop":2,"text":"Proportional Serif","value":"Times New Roman, Times, Georgia, Cambria, PT Serif Caption, serif"},{"prop":3,"text":"Monospaced Sans-Serif","value":"Lucida Console, Deja Vu Sans Mono, Monaco, Consolas, PT Mono, monospace"},{"prop":4,"text":"Proportional Sans-Serif","value":"Arial, Roboto, Arial Unicode Ms, Helvetica, Verdana, PT Sans Caption, sans-serif"},{"prop":5,"text":"Casual","value":"Comic Sans MS, Impact, Handlee, fantasy"},{"prop":6,"text":"Cursive","value":"Monotype Corsiva, URW Chancery L, Apple Chancery, Dancing Script, cursive"},{"prop":7,"text":"Small Capitals","value":"Verdana ,Arial Unicode Ms, Arial, Helvetica, Marcellus SC, sans-serif"}]}},locale:{"fontSizelabel":gM('mwe-cvaa-fontSize'),"fontOplabel":gM('mwe-cvaa-fontOpacity'),"backgroundOpLabel":gM('mwe-cvaa-backgroundOpacity'),"windowOplabel":gM('mwe-cvaa-windowOpacity'),"fontColorlabel":gM('mwe-cvaa-fontColor'),"backgroundColorlabel":gM('mwe-cvaa-backgroundColor'),"windowColorlabel":gM('mwe-cvaa-windowColor'),"fontFamilylabel":gM('mwe-cvaa-fontFamily'),"edgeStylelabel":gM('mwe-cvaa-edgeStyle'),"optionsBtnLabel":gM('mwe-cvaa-options'),"captionsPreviewText":gM('mwe-cvaa-previewText')},cvaaSettingsObj:null,cvaaSavedSettings:null,cvaaSentSettings:null,currentFontFamily:null,currentFontColor:null,currentFontOpacity:null,currentFontSize:null,currentBackgroundColor:null,currentBackgroundOpacity:null,currentWindowColor:null,currentWindowOpacity:null,currentEdgeStyle:null,firstInit:true,handlersAreSet:false,setup:function(){this.cvaaSettingsObj=this.getConfig("cvaaOptions");this.addBindings();},addScreenBindings:function(){var _this=this;$(".cvaa .icon-close").on("mousedown",function(e){_this.resetSettingsToLast();});},addBindings:function(){var _this=this;var embedPlayer=this.getPlayer();this.bind('playerReady',function(){_this.getCurrentSettings();_this.initPreviewUpdate();});this.bind('openCvaaOptions',function(){_this.getScreen().then(function(screen){_this.toggleScreen();});});this.bind('onChangeMedia',function(){_this.handlersAreSet=false;});this.bind('preShowScreen',function(event,screenName){_this.initPreviewUpdate();if(!_this.handlersAreSet){_this.setUpHandlers();}if(screenName==="cvaa"){_this.getScreen().then(function(screen){screen.addClass('semiTransparentBkg');embedPlayer.triggerHelper('onDisableKeyboardBinding');embedPlayer.triggerHelper("cvaaScreenOpen");embedPlayer.disablePlayControls(["cvaa"]);});}});this.bind('showScreen',function(event,screenName){if(screenName==="cvaa"){_this.getScreen().then(function(screen){$(embedPlayer.getPlayerElement()).addClass("blur");embedPlayer.getPlayerPoster().addClass("blur");});}});this.bind('preHideScreen',function(event,screenName){if(screenName==="cvaa"){if(_this.getPlayer().getPlayerElement()){$("#"+_this.getPlayer().getPlayerElement().id).removeClass("blur");_this.getPlayer().getPlayerPoster().removeClass("blur");}embedPlayer.triggerHelper('onEnableKeyboardBinding');if(!embedPlayer.isInSequence()){embedPlayer.enablePlayControls();}}});},updateSettingsAndPreview:function(option,value){var selectedItem;switch(option){case"kFontFamily":selectedItem=this.getValueByProp("family",value);this.updatePreview("text","font-family",selectedItem);this.cvaaSentSettings.fontFamily=selectedItem;this.cvaaSavedSettings.fontFamily=selectedItem;break;case"kFontColor":this.currentFontColor=this.getValueByProp("color",value);selectedItem=this.rgb2rgba(this.hex2rgb(this.currentFontColor),this.currentFontOpacity);this.updatePreview("text","color",selectedItem);this.cvaaSentSettings.fontColor=selectedItem;this.cvaaSavedSettings.fontColor=this.currentFontColor;break;case"kFontOpacity":this.currentFontOpacity=value;selectedItem=this.rgb2rgba(this.hex2rgb(this.currentFontColor),this.currentFontOpacity);this.updatePreview("text","color",selectedItem);this.cvaaSentSettings.fontColor=selectedItem;this.cvaaSavedSettings.fontOpacity=this.currentFontOpacity;break;case"kFontSize":this.currentFontSize=value;this.updatePreview("text","font-size",this.getFontSize(this.currentFontSize));this.cvaaSentSettings.fontSize=this.getFontSize(this.currentFontSize);this.cvaaSavedSettings.fontSize=this.currentFontSize;break;case"kBackgroundColor":this.currentBackgroundColor=this.getValueByProp("color",value);selectedItem=this.rgb2rgba(this.hex2rgb(this.currentBackgroundColor),this.currentBackgroundOpacity);this.updatePreview("text","background-color",selectedItem);this.cvaaSentSettings.backgroundColor=selectedItem;this.cvaaSavedSettings.backgroundColor=this.currentBackgroundColor;break;case"kBackgroundOpacity":this.currentBackgroundOpacity=value;selectedItem=this.rgb2rgba(this.hex2rgb(this.currentBackgroundColor),this.currentBackgroundOpacity);this.updatePreview("text","background-color",selectedItem);this.cvaaSentSettings.backgroundColor=selectedItem;this.cvaaSavedSettings.backgroundOpacity=this.currentBackgroundOpacity;break;case"kWindowColor":this.currentWindowColor=this.getValueByProp("color",value);selectedItem=this.rgb2rgba(this.hex2rgb(this.currentWindowColor),this.currentWindowOpacity);this.updatePreview("window","background-color",selectedItem);this.cvaaSentSettings.windowColor=selectedItem;this.cvaaSavedSettings.windowColor=this.currentWindowColor;break;case"kWindowOpacity":this.currentWindowOpacity=value;selectedItem=this.rgb2rgba(this.hex2rgb(this.currentWindowColor),this.currentWindowOpacity);this.updatePreview("window","background-color",selectedItem);this.cvaaSentSettings.windowColor=selectedItem;this.cvaaSavedSettings.windowOpacity=this.currentWindowOpacity;break;case"kEdgeStyle":selectedItem=this.getValueByProp("edgeStyle",value);this.updatePreview("text","text-shadow",selectedItem);this.cvaaSentSettings.edgeStyle=selectedItem;this.cvaaSavedSettings.edgeStyle=selectedItem;break;}},getValueByProp:function(option,propValue){var cvaaOptions=this.cvaaSettingsObj[option];for(var i=0;i<cvaaOptions.length;i++){if(cvaaOptions&&cvaaOptions[i].prop==propValue){return cvaaOptions[i].value;}}},getPropByValue:function(option,value){var cvaaOptions=this.cvaaSettingsObj[option];for(var i=0;i<cvaaOptions.length;i++){if(cvaaOptions&&cvaaOptions[i].value==value){return cvaaOptions[i].prop;}}},updatePreview:function(element,option,value){switch(element){case"window":this.getPlayer().getInterface().find("#previewWindow").css(option,value);break;case"text":this.getPlayer().getInterface().find("#previewText").css(option,value);break;}},getCurrentSettings:function(){var _this=this;_this.cvaaSentSettings=_this.getConfig('useCookie')&&$.cookie('cvaaSavedSettings')?JSON.parse($.cookie('cvaaSavedSettings')):$.extend(true,{},_this.getConfig("cvaaDefaultSettings"));if(_this.firstInit){_this.firstInit=false;_this.cvaaSavedSettings=$.extend(true,{},_this.cvaaSentSettings);}},initPreviewUpdate:function(){var _this=this;_this.currentFontFamily=_this.cvaaSavedSettings.fontFamily;$("#kFontFamily").val(_this.getPropByValue("family",_this.cvaaSentSettings.fontFamily));_this.updatePreview("text","font-family",_this.cvaaSentSettings.fontFamily);_this.currentFontColor=_this.cvaaSavedSettings.fontColor;_this.currentFontOpacity=_this.cvaaSavedSettings.fontOpacity;_this.cvaaSentSettings.fontColor=_this.rgb2rgba(_this.hex2rgb(_this.currentFontColor),_this.currentFontOpacity);$("#kFontColor[value='"+_this.getPropByValue("color",_this.cvaaSavedSettings.fontColor)+"']").addClass('active').siblings().removeClass('active');_this.updatePreview("text","color",_this.cvaaSentSettings.fontColor);_this.currentFontSize=_this.cvaaSavedSettings.fontSize;_this.cvaaSentSettings.fontSize=this.getFontSize(_this.currentFontSize);_this.updatePreview("text","font-size",_this.cvaaSentSettings.fontSize);_this.currentBackgroundColor=_this.cvaaSavedSettings.backgroundColor;_this.currentBackgroundOpacity=_this.cvaaSavedSettings.backgroundOpacity;_this.cvaaSentSettings.backgroundColor=_this.rgb2rgba(_this.hex2rgb(_this.currentBackgroundColor),_this.currentBackgroundOpacity);$("#kBackgroundColor[value='"+_this.getPropByValue("color",_this.cvaaSavedSettings.backgroundColor)+"']").addClass('active').siblings().removeClass('active');_this.updatePreview("text","background-color",_this.cvaaSentSettings.backgroundColor);_this.currentWindowColor=_this.cvaaSavedSettings.windowColor;_this.currentWindowOpacity=_this.cvaaSavedSettings.windowOpacity;_this.cvaaSentSettings.windowColor=_this.rgb2rgba(_this.hex2rgb(_this.currentWindowColor),_this.currentWindowOpacity);$("#kWindowColor[value='"+_this.getPropByValue("color",_this.cvaaSavedSettings.windowColor)+"']").addClass('active').siblings().removeClass('active');_this.updatePreview("window","background-color",_this.cvaaSentSettings.windowColor);_this.currentEdgeStyle=_this.cvaaSavedSettings.edgeStyle;$("#kEdgeStyle").val(_this.getPropByValue("edgeStyle",_this.cvaaSentSettings.edgeStyle));_this.updatePreview("text","text-shadow",_this.cvaaSentSettings.edgeStyle);_this.getPlayer().triggerHelper("newCaptionsStyles",_this.cvaaSentSettings);},setUpHandlers:function(){var _this=this;_this.handlersAreSet=true;var dropdowns=["kFontFamily","kEdgeStyle"];$.map(_this.cvaaSettingsObj.sliders,function(el){return el}).map(function(element){var sliderHolder=$("#"+element.selector);sliderHolder.slider({value:_this.cvaaSavedSettings[element["default"]],min:element.min,max:element.max,slide:function(event,ui){$("#"+element.selector+"Val").val(ui.value);_this.updateSettingsAndPreview(element.selector,ui.value);}});$("#"+element.selector+"Val").val(sliderHolder.slider("value"));});$(".colorContainer li").on('click keydown',function(event){if(event.which===32||event.which===13||event.type=="click"){$(this).addClass('active').siblings().removeClass('active');_this.updateSettingsAndPreview($(this)[0].id,$(this).val());}});dropdowns.map(function(option){$("#"+option).on("change keydown",function(event){if(event.which===32||event.which===13||event.type=="change"){_this.updateSettingsAndPreview($(this)[0].id,$(this).val());}});});_this.getPlayer().getInterface().find(".saveCvaaSettings").click(function(){_this.saveCvaaSettings();});_this.getPlayer().getInterface().find(".resetCvaaSettings").click(function(){_this.resetCvaaSettings();});},hex2rgb:function(hex){hex=hex.replace('#','');return[parseInt(hex.substring(0,2),16),parseInt(hex.substring(2,4),16),parseInt(hex.substring(4,6),16)];},rgb2rgba:function(color,opacity){if(opacity!==undefined){return'rgba('+color.join(',')+','+opacity/100+')';}else{return'rgb('+color.join(',')+')';}},getFontSize:function(fontsize){var emFontMap={'6':.5,'7':.583,'8':.666,'9':.75,'10':.833,'11':.916,'12':1,'13':1.083,'14':1.166,'15':1.25,'16':1.333,'17':1.416,'18':1.5,'19':1.583,'20':1.666,'21':1.75,'22':1.833,'23':1.916,'24':2};return(emFontMap[fontsize])?emFontMap[fontsize]+'em':(fontsize>24)?emFontMap[24]+'em':emFontMap[6];},saveCvaaSettings:function(){this.getPlayer().setCookie('cvaaSavedSettings',JSON.stringify(this.cvaaSavedSettings),{expires:356,path:'/',domain:''});this.getPlayer().triggerHelper("newCaptionsStyles",this.cvaaSentSettings);this.hideScreen();},resetCvaaSettings:function(){this.getPlayer().setCookie('cvaaSavedSettings',null,{expires:-1,path:'/',domain:''});this.resetSettingsToLast();this.getPlayer().triggerHelper("newCaptionsStyles",this.cvaaSentSettings);},resetSettingsToLast:function(){this.firstInit=true;this.getCurrentSettings();this.initPreviewUpdate();this.resetSliders();},resetSliders:function(){$("#kFontOpacity").slider("option","value",this.currentFontOpacity);$("#kFontOpacityVal").val(this.currentFontOpacity);$("#kBackgroundOpacity").slider("option","value",this.currentBackgroundOpacity);$("#kBackgroundOpacityVal").val(this.currentBackgroundOpacity);$("#kWindowOpacity").slider("option","value",this.currentWindowOpacity);$("#kWindowOpacityVal").val(this.currentWindowOpacity);$("#kFontSize").slider("option","value",this.currentFontSize);$("#kFontSizeVal").val(this.currentFontSize);},addOptionsBtn:function(){return{"optionsLabel":this.locale.optionsBtnLabel,"optionsEvent":"openCvaaOptions"}},getTemplateData:function(){return{'cvaa':this,'cvaaOptions':this.cvaaSettingsObj};},isSafeEnviornment:function(){return!mw.isIphone()&&!mw.isIE8();}});})(window.mw,window.jQuery);;},{"all":".screen .cvaaScreenPanel{width:100%;height:100%;display:table-cell;vertical-align:middle}.cvaa .screen-content .tmpl{display:table;width:100%;height:100%}#cvaaPreview #previewWindow{padding:10px;display:inline-block}.screen .cvaaScreenPanel #cvaaPreview{text-align:center;margin-bottom:50px;height:50px}.size-small .screen .cvaaScreenPanel #cvaaPreview{margin-bottom:20px}.cvaa #kFontFamily,.cvaa #kEdgeStyle{width:100%}.fullscreen .screen .cvaaScreenPanel{padding-top:100px}.mobile.fullscreen .screen .cvaaScreenPanel{padding-top:20px}.screen .cvaaScreenPanel .column-1-2{float:left;width:50%;margin-top:-10px;margin-left:-30px}.size-small .screen .cvaaScreenPanel .column-1-2{margin-left:0}.screen .cvaaScreenPanel .column-1-4{float:left;width:25%}.cvaa .ui-slider{height:0.3em;cursor:pointer;background-color:#ffffff;margin:5px}.cvaa .ui-slider-handle{width:15px;height:15px;border-radius:50%;background-color:#ffffff}.cvaa .fontSizeContainer,.cvaa .fontOpacityContainer,.cvaa .backgroundOpacityContainer,.cvaa .windowOpacityContainer,.cvaa .fontFamilyContainer,.cvaa .fontEdgeStyleContainer{margin-bottom:25px}.cvaa input[type=\"text\"]{width:20px;float:right;color:#ffffff;background:transparent;border:none}.cvaa ul{list-style:none}.cvaa ul \x3e div{margin-bottom:5px}.cvaa li{float:left;margin:0 5px 5px 0}.cvaa li span{background-color:#000;font-size:1em;font-weight:bold;text-align:center;height:30px;width:30px;line-height:30px;display:block;cursor:pointer;border:1px solid #fff}.size-small .cvaa li span{height:12px;width:12px}.size-medium .cvaa li span{height:17px;width:17px}.cvaa #cvaaButtons{float:right;margin-top:60px;margin-right:25px}.size-small .cvaa #cvaaButtons{margin-top:0;margin-right:0}.size-medium .cvaa #cvaaButtons{margin-top:30px;margin-right:0}.fullscreen .cvaa #cvaaButtons{margin-top:150px}.mobile.fullscreen .cvaa #cvaaButtons{margin-top:15px}.cvaa .colorContainer{margin:10px auto;display:table}.cvaa .colorContainer span.White{background-color:#ffffff}.cvaa .colorContainer span.Yellow{background-color:#ffff00}.cvaa .colorContainer span.Green{background-color:#00ff00}.cvaa .colorContainer span.Cyan{background-color:#00ffff}.cvaa .colorContainer span.Blue{background-color:#0000ff}.cvaa .colorContainer span.Magenta{background-color:#ff00ff}.cvaa .colorContainer span.Red{background-color:#ff0000}.cvaa .colorContainer span.Black{background-color:#000000}.cvaa .active span{outline:3px solid #3EAFE6;outline-offset:1px}\n\n/* cache key: resourceloader:filter:minify-css:7:305e26e82d7ecd2b537f48187dd8c397 */\n"},{"mwe-timedtext-editor":"Timed text editor","mwe-timedtext-stage-transcribe":"Transcribe","mwe-timedtext-stage-sync":"Sync","mwe-timedtext-stage-translate":"Translate","mwe-timedtext-stage-upload":"Upload from local file","mwe-timedtext-select-language":"Select language","mwe-timedtext-file-language":"Subtitle file language","mwe-timedtext-back-btn":"Back","mwe-timedtext-choose-text":"Choose text","mwe-timedtext-upload-timed-text":"Add subtitles","mwe-timedtext-loading-text-edit":"Loading timed text editor","mwe-timedtext-search":"Search clip","mwe-timedtext-layout":"Layout","mwe-timedtext-layout-ontop":"On top of video","mwe-timedtext-layout-below":"Below video","mwe-timedtext-layout-off":"Hide subtitles","mwe-timedtext-loading-text":"Loading text ...","mwe-timedtext-key-language":"$1, $2","mwe-timedtext-textcat-cc":"Captions","mwe-timedtext-textcat-sub":"Subtitles","mwe-timedtext-textcat-tad":"Audio description","mwe-timedtext-textcat-ktv":"Karaoke","mwe-timedtext-textcat-tik":"Ticker text","mwe-timedtext-textcat-ar":"Active regions","mwe-timedtext-textcat-nb":"Annotation","mwe-timedtext-textcat-meta":"Timed metadata","mwe-timedtext-textcat-trx":"Transcript","mwe-timedtext-textcat-lrc":"Lyrics","mwe-timedtext-textcat-lin":"Linguistic markup","mwe-timedtext-textcat-cue":"Cue points","mwe-timedtext-language-subtitles-for-clip":"$1 subtitles for clip: $2","mwe-timedtext-language-no-subtitles-for-clip":"No $1 subtitles were found for clip: $2","mwe-timedtext-request-subs":"Request transcription","mwe-timedtext-no-subs":"No text tracks available","mwe-timedtext-request-subs-desc":"Add a request for this video file to be transcribed","mwe-timedtext-request-subs-done":"Transcription request added. [$1 See all transcribe requests]","mwe-timedtext-request-subs-fail":"Failed to add transcription request. Are you logged in?","mwe-timedtext-request-already-done":"A transcription of this video has already been requested. [$1 See all transcribe requests]","mwe-cvaa-options":"Options","mwe-cvaa-reset":"Reset","mwe-cvaa-fontFamily":"Font Family","mwe-cvaa-fontColor":"Font Color","mwe-cvaa-fontSize":"Font size","mwe-cvaa-fontOpacity":"Font Opacity","mwe-cvaa-backgroundColor":"Background Color","mwe-cvaa-backgroundOpacity":"Background Opacity","mwe-cvaa-windowColor":"Window Color","mwe-cvaa-windowOpacity":"Window Opacity","mwe-cvaa-edgeStyle":"Character Edge Style","mwe-cvaa-previewText":"Captions Preview"});mw.loader.implement("controlBarContainer",function($){(function(mw,$){"use strict";mw.PluginManager.add('controlBarContainer',mw.KBasePlugin.extend({defaultConfig:{'hover':false},keepOnScreen:false,screenOpen:false,setup:function(){if(this.embedPlayer.isMobileSkin()){this.setConfig("hover",true);}if(this.getPlayer().useNativePlayerControls()){this.getPlayer().enableNativeControls();return;}this.getPlayer().overlaycontrols=this.getConfig('hover');this.addBindings();},addBindings:function(){var _this=this;this.bind('addLayoutContainer',function(){_this.getPlayer().getInterface().append(_this.getComponent());});this.bind('showInlineDownloadLink',function(){_this.hide();});this.bind('ended',function(){_this.show();});this.bind('layoutBuildDone',function(){if(!_this.embedPlayer.isMobileSkin()){_this.show();}});if(this.getConfig('hover')){this.bind('showPlayerControls',function(e,data){_this.show();});this.bind('hidePlayerControls',function(){_this.hide();});this.bind('onComponentsHoverDisabled',function(){if(!_this.embedPlayer.layoutBuilder.displayOptionsMenuFlag){_this.keepOnScreen=true;_this.show();}});this.bind('hideScreen closeMenuOverlay',function(){_this.screenOpen=false;if(!_this.embedPlayer.paused){_this.keepOnScreen=false;_this.hide();}else{_this.show();}});this.bind('onComponentsHoverEnabled displayMenuOverlay',function(){_this.keepOnScreen=false;_this.hide();});this.bind('showScreen',function(){_this.screenOpen=true;_this.keepOnScreen=false;_this.forceOnScreen=false;_this.hide();});this.bind('onHideSideBar',function(){_this.forceOnScreen=false;});this.bind('onShowSideBar',function(){_this.forceOnScreen=true;});}else{this.getPlayer().isControlsVisible=true;}},onConfigChange:function(property,value){switch(property){case'visible':if(value){this.getComponent().show();}else{this.getComponent().hide();}break;}},show:function(){this.getPlayer().isControlsVisible=true;if(!this.screenOpen){this.getComponent().addClass('open');this.getPlayer().triggerHelper('onShowControlBar',{'bottom':this.getComponent().height()+15});}var $interface=this.embedPlayer.getInterface();$interface.removeClass('player-out');},hide:function(){if(this.keepOnScreen||this.forceOnScreen)return;this.getPlayer().isControlsVisible=false;this.getComponent().removeClass('open');var $interface=this.embedPlayer.getInterface();$interface.addClass('player-out');this.getPlayer().triggerHelper('onHideControlBar',{'bottom':15});},getComponent:function(){if(!this.$el){var _this=this;var $controlsContainer=$('<div />').addClass('controlsContainer');this.$el=$('<div />').addClass('controlBarContainer').append($controlsContainer);if(this.getConfig('hover')&&this.getPlayer().isOverlayControls()){this.$el.addClass('hover').on("mouseenter",function(){_this.forceOnScreen=true;}).on("mouseleave click",function(){_this.forceOnScreen=false;});this.embedPlayer.getVideoHolder().addClass('hover');}else{this.$el.addClass('block');}}return this.$el;}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("currentTimeLabel",function($){(function(mw,$){"use strict";mw.PluginManager.add('currentTimeLabel',mw.KBaseComponent.extend({defaultConfig:{"parent":"controlsContainer","order":21,"displayImportance":"high","countDownMode":false},updateEnabled:true,labelWidth:null,adDuration:null,setup:function(){var _this=this;if(this.embedPlayer.isMobileSkin()){this.setConfig("order",26);this.setConfig('parent','videoHolder');this.setConfig("countDownMode",true);this.bind('firstPlay preSequence',function(){if(_this.getConfig('parent')==='videoHolder'){_this.setConfig('parent','controlsContainer');var currentTimeLabel=$('.currentTimeLabel').detach();$('.controlsContainer .scrubber').after(currentTimeLabel);setTimeout(function(){_this.embedPlayer.triggerHelper("updateComponentsVisibilityDone");},mw.isChromeCast()?200:0);}});this.bind('doStop',function(){_this.updateUI(0);});this.bind('AdSupport_AdUpdateDuration',function(e,duration){_this.adDuration=duration;});this.bind('AdSupport_EndAdPlayback',function(){_this.adDuration=null;});}this.bindTimeUpdate();this.bind('externalTimeUpdate',function(e,newTime){if(newTime!=undefined){_this.updateUI(newTime);}});this.bind('onChangeMediaDone',function(){_this.updateUI(0);});this.bind('detachTimeUpdate',function(){_this.unbind('timeupdate');});this.bind('reattachTimeUpdate',function(){_this.bindTimeUpdate();});this.bind('AdSupport_AdUpdatePlayhead',function(e,currentTime){if(_this.getPlayer().isInSequence()){_this.updateUI(currentTime);}});this.bind('AdSupport_EndAdPlayback',function(){_this.updateUI(_this.getCurrentTime());});this.bind('seeked',function(){_this.updateUI(_this.getCurrentTime());});this.bind("freezeTimeIndicators",function(e,state){if(state===true){_this.updateEnabled=false;}else{_this.updateEnabled=true;}});},bindTimeUpdate:function(){var _this=this;this.bind('timeupdate',function(){if(!_this.getPlayer().isInSequence()){_this.updateUI(_this.getCurrentTime());}});},updateUI:function(time){if(this.updateEnabled){if(this.getConfig("countDownMode")){if(this.embedPlayer.isInSequence()&&this.adDuration){time=this.adDuration-time;}else{time=this.embedPlayer.getDuration()-time;}if(time<0){time=0;}}time=Math.floor(time);this.getComponent().text(mw.seconds2npt(time));var currentWidth=this.$el.width();if(currentWidth!==this.labelWidth){this.embedPlayer.layoutBuilder.updateComponentsVisibility();this.labelWidth=currentWidth;}}},getCurrentTime:function(){var ct=this.getPlayer().getPlayerElementTime()-this.getPlayer().startOffset;if(ct<0){ct=0;}return parseFloat(ct);},getComponent:function(){if(!this.$el){this.$el=$('<div />').addClass("timers"+this.getCssClass()).text('0:00');this.labelWidth=this.$el.width();if(this.getConfig("countDownMode")){this.$el.text(mw.seconds2npt(this.embedPlayer.getDuration()));}}return this.$el;},show:function(){this.getComponent().css('display','inline').removeData('forceHide');}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("durationLabel",function($){(function(mw,$){"use strict";mw.PluginManager.add('durationLabel',mw.KBaseComponent.extend({defaultConfig:{parent:"controlsContainer",order:31,displayImportance:'medium',prefix:' / '},contentDuration:0,isSafeEnviornment:function(){return!this.embedPlayer.isMobileSkin();},setup:function(){var _this=this;this.bind('durationChange',function(event,duration){if(!_this.getPlayer().isInSequence()){_this.contentDuration=duration;_this.updateUI(Math.floor(duration));}});this.bind('AdSupport_AdUpdateDuration',function(e,duration){_this.updateUI(duration);});this.bind('AdSupport_EndAdPlayback',function(){_this.updateUI(_this.contentDuration);});},updateUI:function(duration){var formatTime=mw.seconds2npt(parseFloat(duration))
var duration=this.getConfig('prefix')!==undefined?this.getConfig('prefix')+formatTime:formatTime;this.getComponent().text(duration);},getComponent:function(){if(!this.$el){var duration=this.getConfig('prefix')!==undefined?this.getConfig('prefix')+'0:00':'0:00';this.$el=$('<div />').addClass("timers"+this.getCssClass()).text(duration);}return this.$el;},show:function(){this.getComponent().css('display','inline').removeData('forceHide');}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("fullScreenBtn",function($){(function(mw,$){"use strict";mw.PluginManager.add('fullScreenBtn',mw.KBaseComponent.extend({defaultConfig:{"align":"right","parent":"controlsContainer","order":51,"showTooltip":true,"displayImportance":"high"},offIconClass:'icon-expand',onIconClass:'icon-contract',enterFullscreenTxt:gM('mwe-embedplayer-player_fullscreen'),exitFullscreenTxt:gM('mwe-embedplayer-player_closefullscreen'),setup:function(){if(this.getPlayer().isMobileSkin()){this.onIconClass='icon-arrow-left';}this.addBindings();},isSafeEnviornment:function(){if((mw.isIE9()||mw.isIE8())&&!mw.getConfig('EmbedPlayer.IsFriendlyIframe')){return false;}return mw.getConfig('EmbedPlayer.EnableFullscreen');},getComponent:function(){var _this=this;if(!this.$el){this.$el=$('<button />').attr('title',this.enterFullscreenTxt).addClass("btn "+this.offIconClass+this.getCssClass()).click(function(){_this.toggleFullscreen();});}this.setAccessibility(this.$el,this.enterFullscreenTxt);return this.$el;},addBindings:function(){var _this=this;this.bind('dblclick',function(){_this.toggleFullscreen();});this.bind('onOpenFullScreen',function(){_this.getComponent().removeClass(_this.offIconClass).addClass(_this.onIconClass);_this.updateTooltip(_this.exitFullscreenTxt);_this.setAccessibility(_this.$el,_this.exitFullscreenTxt);if(_this.getPlayer().isMobileSkin()){var fsBtn=$('.fullScreenBtn').detach();$('.topBarContainer').prepend(fsBtn);_this.getPlayer().triggerHelper("updateComponentsVisibilityDone");}});this.bind('onCloseFullScreen',function(){_this.getComponent().removeClass(_this.onIconClass).addClass(_this.offIconClass);_this.updateTooltip(_this.enterFullscreenTxt);_this.setAccessibility(_this.$el,_this.enterFullscreenTxt);if(_this.getPlayer().isMobileSkin()){var fsBtn=$('.fullScreenBtn').detach();$('.controlsContainer').append(fsBtn);_this.getPlayer().triggerHelper("updateComponentsVisibilityDone");}});},toggleFullscreen:function(){if(this.isDisabled)return;this.getPlayer().toggleFullscreen();}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("id3Tag",function($){(function(mw,$){"use strict";mw.PluginManager.add('id3Tag',mw.KBasePlugin.extend({defaultConfig:{updateTimeIntervalSec:1},timeIntervalSec:1,updatedTime:0,intervalCounter:4,counter:0,bindPostfix:'.id3Tag',isSafeEnviornment:function(){return true;},setup:function(){var _this=this;this.timeIntervalSec=this.getConfig('updateTimeIntervalSec');this.intervalCounter=this.timeIntervalSec/(this.embedPlayer.monitorRate/1000);this.bind('playerReady',function(){if(_this.getPlayer().isLive()&&!_this.getPlayer().isDVR()){_this.addBinding();}});this.bind('onChangeMedia',function(){_this.removeBindings();});},removeBindings:function(){this.unbind(this.bindPostfix);},addBinding:function(){var _this=this;this.bind('monitorEvent'+_this.bindPostfix,function(){if(_this.updatedTime>0){_this.updateTime();}});this.bind('onId3Tag'+_this.bindPostfix,function(e,tag){_this.parseTag(tag);});},updateTime:function(){this.counter++;if(this.counter===this.intervalCounter){this.counter=0;this.updatedTime=this.updatedTime+this.timeIntervalSec;this.getPlayer().setCurrentTime(this.updatedTime);this.sendTrackEventMonitor(mw.seconds2npt(this.updatedTime),false);}},parseTag:function(tag){var time;if(tag){time=tag.timestamp/1000;}else{mw.log("id3Tag plugin :: ERROR parsing tag.");}if(time){var d=new Date(0);d.setUTCSeconds(time);this.log("Update time from id3 tag: "+d.toUTCString());this.updatedTime=time;this.counter=0;this.getPlayer().setCurrentTime(time);this.sendTrackEventMonitor(mw.seconds2npt(time),true);}},sendTrackEventMonitor:function(time,isId3TagTime){var traceString="id3Tag plugin :: id3 tag time = ";if(isId3TagTime){mw.log(traceString+time);if(this.getConfig('trackEventMonitor')){try{window.parent[this.getConfig('trackEventMonitor')](traceString+time);}catch(e){}}}}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("kAnalony",function($){(function(mw,$){"use strict";mw.PluginManager.add('kAnalony',mw.KBasePlugin.extend({PlayerEvent:{"IMPRESSION":1,"PLAY_REQUEST":2,"PLAY":3,"RESUME":4,"PLAY_25PERCENT":11,"PLAY_50PERCENT":12,"PLAY_75PERCENT":13,"PLAY_100PERCENT":14,"SHARE_CLICKED":21,"SHARE_NETWORK":22,"DOWNLOAD":23,"REPORT_CLICKED":24,"REPORT_SUBMITED":25,"ENTER_FULLSCREEN":31,"EXIT_FULLSCREEN":32,"PAUSE":33,"REPLAY":34,"SEEK":35,"RELATED_CLICKED":36,"RELATED_SELECTED":37,"CAPTIONS":38,"SOURCE_SELECTED":39,"INFO":40,"SPEED":41,"VIEW":99},startTime:null,reportingInterval:10000,bufferTime:0,eventIndex:1,currentBitRate:-1,currentFlavourId:-1,eventType:1,firstPlay:true,viewEventInterval:null,savedPosition:null,monitorIntervalObj:{},_p25Once:false,_p50Once:false,_p75Once:false,_p100Once:false,hasSeeked:false,dvr:false,smartSetInterval:function(callback,time,monitorObj){var _this=this;var speed=time,counter=1,start=new Date().getTime();var instance=function(){if(monitorObj.cancel){return;}callback();var real=(counter*speed),ideal=(new Date().getTime()-start);counter++;var diff=(ideal-real);monitorObj.counter=counter;monitorObj.diff=diff;var nextSpeed=speed-diff;if(Math.abs(nextSpeed)>speed){nextSpeed=speed;}_this.viewEventInterval=window.setTimeout(function(){instance();},nextSpeed);};_this.viewEventInterval=window.setTimeout(function(){instance();},speed);},setup:function(){this.eventIndex=1;this.bufferTime=0;this.currentBitRate=-1;this.addBindings();},addBindings:function(){var _this=this;var playerEvent=this.PlayerEvent;this.embedPlayer.bindHelper('playerReady',function(){_this.resetPlayerflags();if(_this.kalturaContextData&&_this.kalturaContextData.flavorAssets&&_this.kalturaContextData.flavorAssets.length===1){_this.currentBitRate=_this.kalturaContextData.flavorAssets[0].bitrate;}_this.sendAnalytics(playerEvent.IMPRESSION);});this.embedPlayer.bindHelper('onChangeMedia',function(){_this.firstPlay=true;});this.embedPlayer.bindHelper('userInitiatedPlay',function(){_this.sendAnalytics(playerEvent.PLAY_REQUEST);});this.embedPlayer.bindHelper('onplay',function(){if(!this.isInSequence()){if(_this.firstPlay){_this.sendAnalytics(playerEvent.PLAY);}else{_this.sendAnalytics(playerEvent.RESUME);}}});this.embedPlayer.bindHelper('userInitiatedPause',function(){_this.sendAnalytics(playerEvent.PAUSE);});this.embedPlayer.bindHelper('monitorEvent',function(){_this.updateTimeStats();});this.embedPlayer.bindHelper('seeked',function(e,seekTarget){_this.hasSeeked=true;if(_this.embedPlayer.isDVR()){_this.dvr=true;}});this.embedPlayer.bindHelper('movingBackToLive',function(){_this.dvr=false;});this.embedPlayer.bindHelper('seeking onpause',function(){if(_this.embedPlayer.isDVR()){_this.dvr=true;}});this.embedPlayer.bindHelper('userInitiatedSeek',function(e,seekTarget){_this.sendAnalytics(playerEvent.SEEK,{"targetPosition":seekTarget});});this.embedPlayer.bindHelper('showShareEvent',function(){_this.sendAnalytics(playerEvent.SHARE_CLICKED);});this.embedPlayer.bindHelper('socialShareEvent',function(e,socialNetwork){_this.sendAnalytics(playerEvent.SHARE_NETWORK,{"socialNetwork":socialNetwork.name});});this.embedPlayer.bindHelper('downloadMedia',function(){_this.sendAnalytics(playerEvent.DOWNLOAD);});this.embedPlayer.bindHelper('onOpenFullScreen',function(){_this.sendAnalytics(playerEvent.ENTER_FULLSCREEN);});this.embedPlayer.bindHelper('onCloseFullScreen',function(){_this.sendAnalytics(playerEvent.EXIT_FULLSCREEN);});this.embedPlayer.bindHelper('onEndedDone',function(){_this.stopViewTracking();});this.embedPlayer.bindHelper('replayEvent',function(){_this.resetPlayerflags();_this.sendAnalytics(playerEvent.REPLAY);});this.embedPlayer.bindHelper('moderationOpen',function(){_this.sendAnalytics(playerEvent.REPORT_CLICKED);});this.embedPlayer.bindHelper('moderationSubmit',function(e,reportType){_this.sendAnalytics(playerEvent.REPORT_SUBMITED,{"reportType":reportType});});this.embedPlayer.bindHelper('relatedOpen',function(){_this.sendAnalytics(playerEvent.RELATED_CLICKED);});this.embedPlayer.bindHelper('relatedVideoSelect',function(e,data){if(!data.autoSelected){_this.sendAnalytics(playerEvent.RELATED_SELECTED,{"relatedEntryId":data.entryId});}});this.embedPlayer.bindHelper('selectClosedCaptions',function(e,language){_this.sendAnalytics(playerEvent.CAPTIONS,{"caption":language});});this.embedPlayer.bindHelper('newSourceSelected',function(e,flavourId){_this.sendAnalytics(playerEvent.SOURCE_SELECTED,{"flavourId":flavourId});});this.embedPlayer.bindHelper('infoScreenOpen',function(){_this.sendAnalytics(playerEvent.INFO);});this.embedPlayer.bindHelper('updatedPlaybackRate',function(e,speed){_this.sendAnalytics(playerEvent.SPEED,{"playbackSpeed":speed});});this.embedPlayer.bindHelper('bufferStartEvent',function(){_this.bufferStartTime=new Date();});this.embedPlayer.bindHelper('bufferEndEvent',function(){_this.calculateBuffer();_this.bufferStartTime=null;});this.embedPlayer.bindHelper('bitrateChange',function(event,newBitrate){_this.currentBitRate=newBitrate;});this.embedPlayer.bindHelper('onPlayerStateChange',function(e,newState,oldState){if(newState==="pause"){_this.stopViewTracking();}if(newState==="play"){if(oldState==="start"||oldState==="pause"){_this.startViewTracking();}}});this.embedPlayer.bindHelper('SourceSelected',function(e,source){if(source.getBitrate()){_this.currentBitRate=source.getBitrate();}if(source.getAssetId()){_this.currentFlavourId=source.getAssetId();}});this.embedPlayer.bindHelper('sourceSwitchingEnd',function(e,newSource){if(newSource.newBitrate){_this.currentBitRate=newSource.newBitrate;}});this.embedPlayer.bindHelper('AdSupport_midroll AdSupport_postroll',function(){_this.savedPosition=_this.embedPlayer.currentTime;});this.embedPlayer.bindHelper('AdSupport_EndAdPlayback',function(){setTimeout(function(){_this.savedPosition=null;},0);});},resetPlayerflags:function(){this._p25Once=false;this._p50Once=false;this._p75Once=false;this._p100Once=false;this.hasSeeked=false;this.savedPosition=null;},updateTimeStats:function(){var _this=this;var percent=this.embedPlayer.currentTime/this.embedPlayer.duration;var playerEvent=this.PlayerEvent;if(!this.embedPlayer.isLive()){if(!_this._p25Once&&percent>=.25){_this._p25Once=true;_this.sendAnalytics(playerEvent.PLAY_25PERCENT);}else if(!_this._p50Once&&percent>=.50){_this._p50Once=true;_this.sendAnalytics(playerEvent.PLAY_50PERCENT);}else if(!_this._p75Once&&percent>=.75){_this._p75Once=true;_this.sendAnalytics(playerEvent.PLAY_75PERCENT);}else if(!_this._p100Once&&percent>=.99){_this._p100Once=true;_this.sendAnalytics(playerEvent.PLAY_100PERCENT);}}},calculateBuffer:function(closeSession){var _this=this;if(closeSession&&!_this.bufferStartTime){return;}this.bufferTime+=(new Date()-_this.bufferStartTime)/1000;if(this.bufferTime>10){this.bufferTime=10;}if(closeSession){_this.bufferStartTime=new Date();}},stopViewTracking:function(){var _this=this;_this.monitorIntervalObj.cancel=true;clearTimeout(_this.viewEventInterval);_this.viewEventInterval=null;},startViewTracking:function(){if(this.viewEventInterval){this.stopViewTracking();}var _this=this;var playerEvent=this.PlayerEvent;_this.startTime=null;_this.kClient=mw.kApiGetPartnerClient(_this.embedPlayer.kwidgetid);_this.monitorIntervalObj.cancel=false;if(_this.firstPlay){_this.sendAnalytics(playerEvent.VIEW);_this.firstPlay=false;}_this.smartSetInterval(function(){if(!_this._p100Once){_this.sendAnalytics(playerEvent.VIEW);_this.bufferTime=0;}},_this.reportingInterval,_this.monitorIntervalObj);},sendAnalytics:function(eventType,additionalData){var _this=this;this.calculateBuffer(true);this.kClient=mw.kApiGetPartnerClient(this.embedPlayer.kwidgetid);if(this.embedPlayer.isMulticast&&$.isFunction(this.embedPlayer.getMulticastBitrate)){this.currentBitRate=this.embedPlayer.getMulticastBitrate();}var playbackType="vod";if(this.embedPlayer.isLive()){playbackType=this.dvr?"dvr":"live";}var position=this.embedPlayer.currentTime?this.embedPlayer.currentTime:0;if(this.savedPosition){position=this.savedPosition;}var statsEvent={'entryId':this.embedPlayer.kentryid,'partnerId':this.embedPlayer.kpartnerid,'eventType':eventType,'sessionId':this.embedPlayer.evaluate('{configProxy.sessionId}'),'eventIndex':this.eventIndex,'bufferTime':this.bufferTime,'actualBitrate':this.currentBitRate,'flavourId':this.currentFlavourId,'referrer':encodeURIComponent(mw.getConfig('EmbedPlayer.IframeParentUrl')),'deliveryType':this.embedPlayer.streamerType,'sessionStartTime':this.startTime,'uiConfId':this.embedPlayer.kuiconfid,'clientVer':mw.getConfig("version"),'position':position,'playbackType':playbackType};var ks=this.kClient.getKs();if(ks){statsEvent["ks"]=ks;}if(this.embedPlayer.getRawKalturaConfig('mediaProxy')&&this.embedPlayer.getRawKalturaConfig('mediaProxy').preferedFlavorBR){statsEvent["expectedQuality"]=this.embedPlayer.getRawKalturaConfig('mediaProxy').preferedFlavorBR;}if(additionalData){$.extend(statsEvent,additionalData);}var config=this.getConfig();for(var key in config){if(key.indexOf("customVar")!==-1){var customVarObj={};customVarObj[key]=config[key];$.extend(statsEvent,customVarObj);}}if(mw.getConfig("playbackContext")){statsEvent["playbackContext"]=mw.getConfig("playbackContext");}var eventRequest={'service':'analytics','action':'trackEvent'};$.each(statsEvent,function(event,value){eventRequest[event]=value;});this.eventIndex+=1;this.embedPlayer.triggerHelper('analyticsEvent',statsEvent);this.log("Trigger analyticsEvent type = "+statsEvent.eventType);this.kClient.doRequest(eventRequest,function(data){try{if(!_this.startTime){_this.startTime=data;}}catch(e){mw.log("Failed sync time from server");}},true);}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("kdark",function($){;},{"all":"body{letter-spacing:0.04em; -webkit-touch-callout:none ; -webkit-user-select:none ; -webkit-tap-highlight-color:rgba(255,255,255,0); }.topBarContainer{position:absolute;top:0;width:100%;z-index:100;box-sizing:border-box;-webkit-transition:top 0.3s ease-in;-moz-transition:top 0.3s ease-in;-o-transition:top 0.3s ease-in;-ms-transition:top 0.3s ease-in;transition:top 0.3s ease-in;background-color:#222222;background:rgba(0,0,0,0.7);   height:2.3em;padding-right:5px}.topBarContainer.hover{top:-3.6em}.topBarContainer.open{top:0}.topBarContainer .btn{color:#fff;width:2em;text-shadow:none}.topBarContainer.block{position:static}.mobileSkin .topBarContainer{height:4.8em;display:none;background:transparent}.mobileSkin .topBarContainer.open{display:block;height:4.8em}.mobileSkin.size-small.fullscreen .topBarContainer,.mobileSkin.size-tiny.fullscreen .topBarContainer{display:block}.mobileSkin.pluginsScreenOpened .topBarContainer{display:none !important}.mobileSkin.start-state .topBarContainer{display:none}.sideBarContainerReminder{padding:10px;position:absolute;cursor:pointer;text-shadow:0px 0px 4px rgba(0,0,0,0.6)}#sideBarContainerReminderContainer{font-size:32px;color:rgb(255,255,255)}@media all and (max-width:640px){#sideBarContainerReminderContainer{font-size:24px}}.sideBarContainerReminder:hover div{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;color:#fff;text-shadow:0px 0px 10px #fff}.sideBarContainerReminder.active div{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;color:#fff;text-shadow:0px 0px 10px #fff}.sideBarContainerReminder.left{left:-30%;-webkit-transition:left 0.3s ease-in;-moz-transition:left 0.3s ease-in;-o-transition:left 0.3s ease-in;-ms-transition:left 0.3s ease-in;transition:left 0.3s ease-in}.sideBarContainerReminder.left.open{left:0px}.sideBarContainerReminder.left.shifted{left:30%}.sideBarContainerReminder.right{right:-30%;-webkit-transition:right 0.3s ease-in;-moz-transition:right 0.3s ease-in;-o-transition:right 0.3s ease-in;-ms-transition:right 0.3s ease-in;transition:right 0.3s ease-in}.sideBarContainerReminder.right.open{right:0px}.sideBarContainerReminder.right.shifted{right:30%}.sideBarContainer{position:absolute;top:0;width:30%;z-index:100;box-sizing:border-box;height:100%; -webkit-transition:left 0.3s ease-in,right 0.3s ease-in;-moz-transition:left 0.3s ease-in,right 0.3s ease-in;-o-transition:left 0.3s ease-in,right 0.3s ease-in;-ms-transition:left 0.3s ease-in,right 0.3s ease-in;transition:left 0.3s ease-in,right 0.3s ease-in;background:rgb(0,0,0);-ms-filter:progid:DXImageTransform.Microsoft.Alpha(opacity=70);background:rgba(0,0,0,0.7);background:-moz-linear-gradient(top,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%);background:-webkit-gradient(left top,left bottom,color-stop(0%,rgba(0,0,0,0.7)),color-stop(100%,rgba(0,0,0,0.7)));background:-webkit-linear-gradient(top,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%);background:-o-linear-gradient(top,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%);background:-ms-linear-gradient(top,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%);background:linear-gradient(to bottom,rgba(0,0,0,0.7) 0%,rgba(0,0,0,0.7) 100%)}.sideBarContainer.left{left:-30%}.sideBarContainer.openBtn{z-index:1001}.sideBarContainer.left.openBtn{left:0}.sideBarContainer.right{right:-30%}.sideBarContainer.right.openBtn{right:0}.titleLabel{padding:8px 0 0 10px;color:white}.mobileSkin .titleLabel{position:absolute;overflow:hidden;text-overflow:ellipsis;top:4px;padding-left:1em;text-shadow:0px 0px 2.4px rgba(0,0,0,0.12);font-size:2em;font-family:\'Lato\',Helvetica,Arial;color:rgb(255,255,255);font-weight:bold;line-height:1.333em;max-height:2.666em;-webkit-line-clamp:2;-webkit-box-orient:vertical;text-shadow:0px 0px 1px rgba(0,0,0,0.40);display:none !important}.mobileSkin.size-small .titleLabel{font-size:1.5em}.ua-chromecast.pause-state .titleLabel{display:block !important;display:-webkit-box !important}.mobileSkin.start-state .titleLabel{display:block !important;display:-webkit-box !important}.fullscreen.mobileSkin .titleLabel{display:none !important}.playlistInterface .fullscreen.mobileSkin .titleLabel{display:block !important;display:-webkit-box !important;width:100% !important;text-align:center !important;top:calc(50% - 5em);padding-left:0px;font-size:1.7em}.playlistInterface .fullscreen.mobileSkin.player-out .titleLabel{display:none !important}.playlistInterface .fullscreen.mobileSkin.pluginsScreenOpened .titleLabel{display:none !important}.controlBarContainer{position:absolute;bottom:0;width:100%;-webkit-transition:bottom 0.3s ease-in;-moz-transition:bottom 0.3s ease-in;-o-transition:bottom 0.3s ease-in;-ms-transition:bottom 0.3s ease-in;transition:bottom 0.3s ease-in}.controlBarContainer a{text-decoration:none}.controlBarContainer.hover{bottom:-4.2em;z-index:100}.controlBarContainer.open{bottom:0}.mobileSkin.start-state .controlBarContainer{display:none;bottom:-4.2em}.btn{display:inline-block;height:100%;margin:0;padding:0;width:2.4em;cursor:pointer;border:0;font-size:1.1em}.mobileSkin .btn{font-size:2.4em;width:2em;color:white;outline:0;text-shadow:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mobileSkin .btn:focus{outline:0}.mobileSkin .topBarContainer .btn{margin-top:0em}.mobileMenuSelect{position:absolute;width:100%;height:100%;opacity:0;font-size:2em;-webkit-appearance:menulist-button}.btnFixed{display:inline-block;height:100%;margin:0;padding:0;width:2.4em;cursor:pointer;border:0;font-size:1.1em}.mobileSkin .btnFixed{width:100%}.mobileSkin.pluginsScreenOpened .playbackRateSelector .btn{font-family:\'Lato\',Helvetica,Arial;}.mobileSkin .videoHolder .playbackRateSelector .btn{font-family:\'icomoon\'}.btnNarrow{width:1.8em}.btn .accessibilityLabel{font-size:0;height:1px !important;overflow:hidden;display:block;position:absolute}.accessibilityLabel{font-size:0;height:1px !important;overflow:hidden;display:block}.dropup{position:relative;height:99%}.pull-right{float:right}.pull-left{float:left}.mobileSkin .videoHolder .smartContainer{width:100%;height:100%;text-align:center;display:-webkit-flex;display:flex;position:absolute;-webkit-justify-content:center;-webkit-align-items:center;-webkit-flex-flow:row wrap;justify-content:center;align-items:center;flex-flow:row wrap} .mobileSkin .smartContainer.comp4,.mobileSkin .smartContainer.comp5,.mobileSkin .smartContainer.comp6{height:80%;top:15%}.mobileSkin .smartContainer.comp2,.mobileSkin .smartContainer.comp4{width:80%;left:10%}.mobileSkin .smartContainer.comp5,.mobileSkin .smartContainer.comp6{width:90%;left:5%}.mobileSkin:not(.pluginsScreenOpened) .smartContainer .comp{display:none !important}@media screen and (orientation:portrait){.mobileSkin.fullscreen .smartContainer{height:50%;top:25%}}.mobileSkin .videoHolder .smartContainer .btn{width:100%;font-size:3.2em}.mobileSkin .videoHolder .smartContainer.comp2 .btn{font-size:3.6em}.mobileSkin.fullscreen.size-large .videoHolder .smartContainer .btn{font-size:4.6em}.mobileSkin .videoHolder .btn{font-size:2.6em;margin-top:0em}.mobileSkin .videoHolder .btn.comp{position:relative}.mobileSkin .videoHolder .comp{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0)}.btnLabel{font-weight:normal;font-size:0.3em;display:none}.mobileSkin .btnLabel{font-family:\'Lato\',Helvetica,Arial;display:block}.mobileSkin.size-medium .btnLabel,.mobileSkin.size-large .btnLabel{font-size:0.4em}.mobileSkin.fullscreen .btnLabel{font-size:0.3em}.largePlayBtn{cursor:pointer;position:absolute;top:50%;left:50%;font-size:3em;margin:-0.79em 0 0 -1em;text-decoration:none;padding:12px 20px 12px 25px;z-index:1}.largePlayBtnBorder{border-radius:0.1em}.scrubber{position:relative;height:0.6em;cursor:pointer;background-color:#686868;background:rgba(104,104,104,0.6)}.controlsContainer .scrubber{display:inline-block;margin-left:5px;top:-3px}.mobileSkin .controlsContainer .scrubber{height:2px;border-radius:2px;background:rgba(255,255,255,0.8); margin-left:20px; pointer-events:none}.sliderPreviewTime{position:absolute;font-family:Helvetica,Arial;font-size:12px;font-weight:bold;text-shadow:0 0 0.3em #000}.sliderPreview{position:absolute;width:100px;height:60px;z-index:9999999999;border:2px white solid;background-repeat:no-repeat;background-position:center;border-radius:4px}.scrubber .handle-wrapper{position:relative;margin:0 0.44em}.scrubber .watched{position:absolute;top:0;left:0;width:0%;height:100%;z-index:2}.scrubber .buffered{position:absolute;top:0;left:0;height:100%}.scrubber .arrow{position:absolute;left:48px;bottom:-6px;width:0;height:0;border-top:5px solid white;border-left:5px solid transparent;border-right:5px solid transparent}.scrubber .playHead{z-index:100;position:absolute;left:0;top:-3px;width:16px;height:16px;border-radius:50%;outline:0;margin-left:-0.38em; cursor:pointer; -webkit-transform:scale(1,1);-moz-transform:scale(1,1);-ms-transform:scale(1,1);-o-transform:scale(1,1);transform:scale(1,1); -webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-ms-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform-origin:50% 50%; -webkit-transition:-webkit-transform-origin 0.1s ease-out,-webkit-transform 0.1s ease-out;-moz-transition:-moz-transform-origin 0.1s ease-out,-moz-transform 0.1s ease-out;-o-transition:-o-transform-origin 0.1s ease-out,-o-transform 0.1s ease-out;transition:transform-origin 0.1s ease-out,transform 0.1s ease-out; -webkit-transition-property:-webkit-transform-origin,-webkit-transform;-moz-transition-property:-moz-transform-origin,-moz-transform;-o-transition-property:-o-transform-origin,-o-transform;transition-property:transform-origin,transform; -webkit-transition-duration:0.3s,0.3s;-moz-transition-duration:0.3s,0.3s;-o-transition-duration:0.3s,0.3s;transition-duration:0.3s,0.3s; -webkit-transition-timing-function:ease-out,ease-out;-moz-transition-timing-function:ease-out,ease-out;-o-transition-timing-function:ease-out,ease-out;transition-timing-function:ease-out,ease-out; -webkit-transition-delay:initial,initial;-moz-transition-delay:initial,initial;-o-transition-delay:initial,initial;transition-delay:initial,initial;background:rgb(255,255,255); background:-moz-linear-gradient(top,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(255,255,255,1)),color-stop(50%,rgba(204,204,204,1)),color-stop(100%,rgba(255,255,255,1))); background:-webkit-linear-gradient(top,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); background:-o-linear-gradient(top,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); background:-ms-linear-gradient(top,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); background:linear-gradient(to bottom,rgba(255,255,255,1) 0%,rgba(204,204,204,1) 50%,rgba(255,255,255,1) 100%); }.mobileSkin .scrubber .playHead{border-radius:14px;width:32px;height:32px;margin-top:-12px;margin-left:-0.7em;pointer-events:auto;background:-moz-radial-gradient(center,ellipse cover,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0) 31%,rgba(255,255,255,0) 100%); background:-webkit-radial-gradient(center,ellipse cover,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0) 31%,rgba(255,255,255,0) 100%); background:radial-gradient(ellipse at center,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0) 31%,rgba(255,255,255,0) 100%); filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#ffffff\',endColorstr=\'#00ffffff\',GradientType=1 ); }.mobileSkin .scrubber .playHead[aria-valuenow=\"100%\"]{margin-left:-0.4em}.mobileSkin .scrubber .playHead.ui-state-active{background:-moz-radial-gradient(center,ellipse cover,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0.3) 31%,rgba(255,255,255,0.3) 100%); background:-webkit-radial-gradient(center,ellipse cover,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0.3) 31%,rgba(255,255,255,0.3) 100%); background:radial-gradient(ellipse at center,rgba(255,255,255,1) 0%,rgba(255,255,255,1) 30%,rgba(255,255,255,0.3) 31%,rgba(255,255,255,0.3) 100%); filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#ffffff\',endColorstr=\'#00ffffff\',GradientType=1 ); }.player-out .hover .playHead{display:none}.accessibilityButtons{display:inline-block;height:1px}.accessibilityButton{width:1px;height:1px}.nextPrevBtn{display:inline-block;height:100%}.mobileSkin .nextPrevBtn{width:100%;text-align:left}.mobileSkin.pluginsScreenOpened .nextPrevBtn{display:none !important}.mobileSkin .nextPrevBtn\x3e.btn{position:relative;margin-top:-25px;height:50px;top:50%}.mobileSkin.fullscreen.size-large .nextPrevBtn\x3e.btn{font-size:2.6em !important}.mobileSkin .nextPrevBtn\x3e.btn.icon-prev{margin-left:20%}.mobileSkin .nextPrevBtn\x3e.btn.icon-next{float:right;margin-right:20%}.volumeControl{display:inline-block;height:100%}.volumeControl.vertical{width:36px}.volumeControl .ui-slider-horizontal.slider{display:inline-block;width:0;background:#7c7c7c;height:0.5em;top:-2px;-webkit-transition:width 0.3s ease-in-out;-moz-transition:width 0.3s ease-in-out;-o-transition:width 0.3s ease-in-out;-ms-transition:width 0.3s ease-in-out;transition:width 0.3s ease-in-out;cursor:pointer}.volumeControl.noTransition .ui-slider-horizontal.slider{-moz-transition:none ;-webkit-transition:none ;-o-transition:width 0 ease-in;transition:none}.volumeControl.open .ui-slider-horizontal.slider{width:5em;margin-right:10px}.volumeControl .ui-slider-horizontal .ui-slider-handle{display:none}.volumeControl .ui-slider-horizontal .ui-slider-range-min{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=85)\";filter:alpha(opacity=85);opacity:0.85;background-color:#fff;background-repeat:repeat-x;background:-webkit-gradient(linear,0% 0%,0% 100%,from(#ffffff),to(#dddddd));background:-webkit-linear-gradient(top,#ffffff,#dddddd);background:-moz-linear-gradient(top,#ffffff,#dddddd);background:-o-linear-gradient(top,#ffffff,#dddddd);background:-ms-linear-gradient(top,#ffffff,#dddddd);background:linear-gradient(top,#ffffff,#dddddd);-webkit-box-shadow:0px 1px 0px rgba(0,0,0,0.3);box-shadow:0px 1px 0px rgba(0,0,0,0.3)}.volumeControl .ui-slider-horizontal .ui-slider-range-min:hover{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;-webkit-box-shadow:0px 0px 10px #fff;box-shadow:0px 0px 10px #fff}.volumeControl .aria{width:0px;height:0px}.volumeControl .sliderContainer{margin-top:-147px;width:40px;display:none;background:rgb(27,27,27);background-color:rgba(27,27,27,.9);border-radius:3px;height:97px;position:absolute}.volumeControl.noTransition .ui-slider-vertical{-moz-transition:none ;-webkit-transition:none ;-o-transition:width 0 ease-in;transition:none}.volumeControl.open .sliderContainer{display:block;display:block}.volumeControl .ui-slider-vertical{height:69px;margin-left:17px;top:14px;width:6px;background-color:#7c7c7c}.volumeControl .sliderContainer .arrow{margin-top:97px;margin-left:11px;width:0;height:0;border-style:solid;border-width:10px 9px 0 9px;border-color:rgb(27,27,27) transparent transparent transparent;position:absolute}.volumeControl .ui-slider-vertical .ui-slider-handle{display:none}.volumeControl .ui-slider-vertical .ui-slider-range-min{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=85)\";filter:alpha(opacity=85);opacity:0.85;background-color:#fff;background-repeat:repeat-x;background:-webkit-gradient(linear,0% 0%,0% 100%,from(#ffffff),to(#dddddd));background:-webkit-linear-gradient(top,#ffffff,#dddddd);background:-moz-linear-gradient(top,#ffffff,#dddddd);background:-o-linear-gradient(top,#ffffff,#dddddd);background:-ms-linear-gradient(top,#ffffff,#dddddd);background:linear-gradient(top,#ffffff,#dddddd);-webkit-box-shadow:0px 1px 0px rgba(0,0,0,0.3);box-shadow:0px 1px 0px rgba(0,0,0,0.3)}.volumeControl .ui-slider-vertical .ui-slider-range-min:hover{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;-webkit-box-shadow:0px 0px 10px #fff;box-shadow:0px 0px 10px #fff}.smartContainerMenu{background-color:rgba(255,255,255,0.9);border-radius:4px;position:absolute;color:black;z-index:10}.mobile .smartContainerMenu{background-color:rgba(0,0,0,0.6);border-radius:0px;position:absolute;color:#ffffff;z-index:10;width:100%;height:100%;left:0px;right:0px;top:0px;bottom:0px;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-pack:center;-moz-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-box-align:center;-moz-box-align:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center}.smartContainerMenu p{margin-top:20px;margin-bottom:20px}.smartContainerMenu .pluginIcon{display:none}.mobile .smartContainerMenu .pluginIcon{display:block;font-size:64px;padding-left:30px;padding-right:30px}.mobile .smartContainerMenu .pluginPropertyLabel{display:none}.mobile .smartContainerMenu .fakeCombo{display:none}.mobile .smartContainerMenu .hidden{position:absolute;visibility:visible;width:130px;height:100px;margin-top:-80px;opacity:0;-webkit-appearance:menulist-button}.smartContainerMenu label{letter-spacing:0px}.smartContainerMenu .pluginPropertyLabel{color:#555555;margin-left:20px;margin-right:10px;font-size:12px}.smartContainerMenu label{color:#555555;font-size:12px}.smartContainerMenu .pluginProperty.checkbox{width:14px;margin-top:18px;margin-bottom:18px}.smartContainerMenu .hidden{visibility:hidden;width:0px;height:0px;position:absolute}.smartContainerMenu .fakeCombo{font-size:9px;font-weight:bold;letter-spacing:2px;text-transform:uppercase;padding-top:6px;padding-bottom:6px;padding-left:7px;padding-right:7px;color:#999999;border:1px solid #999999;border-radius:3px;width:90px;float:right;margin-right:20px;margin-top:-2px;cursor:pointer}.smartContainerMenu .fakeCombo\x3ei{font-size:8px;float:right;margin-top:2px}.smartContainerMenu .fakeCombo\x3espan{width:80px;display:inline-block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-top:2px}.smartContainerMenu ul{background-color:white;border:1px solid #999999;width:84px;float:right;right:20px;border-radius:3px;padding-right:10px;padding-left:10px;position:absolute;display:none}.smartContainerMenu li{list-style-type:none;color:#666666;font-size:12px;padding-top:6px;padding-bottom:6px;border-bottom:1px solid #cccccc;padding-left:0px;cursor:pointer;height:18px;overflow:hidden;text-overflow:ellipsis}.smartContainerMenu li:hover{font-weight:bold}.smartContainerMenu li.last{border-bottom:0px}.smartContainerMenu li.active{font-weight:bold}.smartContainerMenu li\x3ei{font-size:9px;float:right;margin-top:4px;display:none}.smartContainerMenu li.active\x3ei{display:block}.timers{position:relative;font-size:0.84em;display:inline;line-height:2.7em;top:-2px}.mobileSkin .timers{font-family:\'Lato\',Helvetica,Arial;top:0px;font-weight:bold;font-size:1.2em;text-shadow:0px 0px 2.4px rgba(0,0,0,0.12)}.mobileSkin.fullscreen .timers{font-size:1.1em}.mobileSkin .liveStatus{font-family:\'icomoon\'}.ua-chromecast .liveStatus{display:none}.ua-chromecast .topBarContainer .btn{display:none}.ua-chromecast .controlBarContainer .btn:not (.playHead){display:none}.currentTimeLabel{padding-left:1em;color:#e8e8e8}.mobileSkin .currentTimeLabel{margin-left:10px;margin-right:10px;color:#ffffff}.fullscreen.mobileSkin .currentTimeLabel{margin-right:10px}.mobileSkin.start-state .videoHolder .currentTimeLabel{position:absolute;font-size:1.5em;right:1em;bottom:1em;height:30px;top:inherit;text-shadow:0px 1px 2px rgba(0,0,0,0.20)}.mobileSkin.start-state.size-small .currentTimeLabel{font-size:1.2em}.durationLabel{padding-left:0.5em;color:#b1aeab}.overlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100}.overlay-win{z-index:1000 !important}.overlay-content{width:80%;margin-left:10%;padding-top:20px}.mobileSkin:not(.size-small) .overlay-content{padding-top:10%}.mobileSkin.size-small .overlay-content{padding-top:0px}.overlay-content select{color:#000000;-ms-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}.mobileSkin .overlay-content select{border:0;color:#fff;outline:1px solid #fff;background-color:transparent}.overlay-content textarea{border:0;outline:1px solid #fff;background-color:transparent;color:#fff;padding-left:8px;padding-top:5px;outline-offset:0px;-ms-box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}.overlay-content .icon-toggle{display:none}.mobileSkin .overlay-content .icon-toggle{display:block;position:absolute;margin-top:17px;right:10%;margin-right:6px}.mobileSkin .overlay-win,.mobileSkin .overlay-win button,.mobileSkin .overlay-win select,.mobileSkin .overlay-win textarea{font-family:\'Lato\',Helvetica,Arial !important;font-size:1em}.alert-container{z-index:101;position:absolute;top:0;height:100%;width:100%;vertical-align:middle;box-sizing:border-box}.mobileSkin .alert-container{font-family:\'Lato\',Helvetica,Arial;background-color:rgba(255,255,255,0.9);width:60%;padding-top:20px;max-height:40% !important;color:#484848;letter-spacing:0;border-radius:10px}.alert{display:table-cell;width:100%;height:100%;vertical-align:middle}.alert-title{padding-left:1.8em;padding-bottom:0.6em;text-align:center}.mobileSkin .alert-title{font-size:18px !important;font-weight:bold !important;background-color:transparent;border:0px solid black}.mobileSkin .alert-message{font-size:18px !important;font-weight:bold !important}.mobileSkin .alert-buttons-container{padding-bottom:0px !important;padding-top:20px;width:100% }.mobileSkin .alert-button{height:30px;font-family:\'Lato\',Helvetica,Arial;font-size:14px;border:none;background:transparent;border-top:1px solid #cacaca;border-left:1px solid #cacaca;border-radius:0px;color:#3984EF;width:100%}.alert-body{padding:1.5em 2.2em;font-size:1.5em}.alert-footer{text-align:right;padding-top:1.2em;padding-right:2em}.alert-footer .btn{min-width:100px;border:1px solid;border-radius:4px;padding:6px} .dropdown-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:75px;padding:0 0;margin:2px 0 0;list-style:none;-webkit-box-shadow:0 5px 10px rgba(0,0,0,0.2);box-shadow:0 5px 10px rgba(0,0,0,0.2);-webkit-background-clip:padding-box;-moz-background-clip:padding-box;background-clip:padding-box}.dropdown-menu .divider{*width:100%;height:1px;margin:0;*margin:-5px 0 5px;overflow:hidden;background-color:rgba(34,34,34,0.5);border-bottom:1px solid rgba(70,70,70,0.5)}.dropdown-menu \x3e li \x3e a{display:block;padding:3px 10px;clear:both;font-weight:normal;line-height:20px;font-size:0.9em;color:#999999;white-space:nowrap; }.dropdown-menu \x3e li \x3e a:hover,.dropdown-menu \x3e li \x3e a:focus,.dropdown-submenu:hover \x3e a,.dropdown-submenu:focus \x3e a{text-decoration:none;color:#ffffff;background-color:#000}.dropdown-menu \x3e .active \x3e a,.dropdown-menu \x3e .active \x3e a:hover,.dropdown-menu \x3e .active \x3e a:focus{color:#ffffff;text-decoration:none;outline:0}.dropdown-menu \x3e .disabled \x3e a,.dropdown-menu \x3e .disabled \x3e a:hover,.dropdown-menu \x3e .disabled \x3e a:focus{color:#999999}.dropdown-menu \x3e .disabled \x3e a:hover,.dropdown-menu \x3e .disabled \x3e a:focus{text-decoration:none;background-color:transparent;background-image:none;filter:progid:DXImageTransform.Microsoft.gradient(enabled = false);cursor:default}.open{z-index:1000}.open.dropdown-menu{display:block}.pull-right \x3e .dropdown-menu{right:-30px;left:auto}.dropup .dropdown-menu,.navbar-fixed-bottom .dropdown .dropdown-menu{top:auto;bottom:102%}.ua-chromecast .closedCaptions{display:none !important}.closedCaptions \x3e .dropdown-menu{overflow-y:auto;overflow-x:hidden;max-height:200px;width:auto;max-width:140px}.dropup .dropdown-submenu \x3e .dropdown-menu{top:auto;bottom:0;margin-top:0;margin-bottom:-2px;border-radius:5px 5px 5px 0} .PlayerContainer{background:#000;color:#fff}.controlsContainer{height:2.1em; background-color:#222222;background:rgba(34,34,34,0.8);background:-webkit-gradient(linear,0% 0%,0% 100%,from(rgba(34,34,34,0.8)),to(rgba(0,0,0,0.8)));background:-webkit-linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));background:-moz-linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));background:-o-linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));background:-ms-linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));background:linear-gradient(top,rgba(34,34,34,0.8),rgba(0,0,0,0.8));border-top:1px solid rgba(170,168,168,0.5);-webkit-box-shadow:0px -1px 0px rgba(0,0,0,0.8);box-shadow:0px -1px 0px rgba(0,0,0,0.8);width:100%;display:inline-block}.mobileSkin .controlsContainer{position:relative;background:transparent;border-top:0px;box-shadow:none;height:4.2em;width:100%}.ui-tooltip{background-color:#000000;background-repeat:repeat-x;background:-webkit-gradient(linear,0% 0%,0% 100%,from(#000000),to(#000000));background:-webkit-linear-gradient(top,#000000,#000000);background:-moz-linear-gradient(top,#000000,#000000);background:-o-linear-gradient(top,#000000,#000000);background:-ms-linear-gradient(top,#000000,#000000);background:linear-gradient(top,#000000,#000000);z-index:1000;font-weight:bold;font-size:0.85em;letter-spacing:0px;color:#aaaaaa;border-radius:2px;padding:2px 5px}.ui-tooltip .arrow{width:70px;height:16px;overflow:hidden;position:absolute;left:50%;margin-left:-35px;bottom:-16px}.ui-tooltip .arrowTop{width:70px;height:16px;overflow:hidden;position:absolute;left:50%;margin-left:-35px;top:-16px;bottom:auto}.ui-tooltip .arrow .top{top:-16px;bottom:auto}.ui-tooltip .arrow .left{left:20%}.ui-tooltip .arrow:after{content:\"\";position:absolute;left:25px;top:-20px;width:20px;height:22px;-webkit-box-shadow:6px 5px 9px -9px #fff;box-shadow:6px 5px 9px -9px #fff;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);tranform:rotate(45deg);background-color:#000000}.ui-tooltip .arrowTop:after{content:\"\";position:absolute;left:25px;bottom:-20px;top:auto;width:20px;height:22px;-webkit-box-shadow:6px 5px 9px -9px #fff;box-shadow:6px 5px 9px -9px #fff;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-o-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg);tranform:rotate(45deg);background-color:#000000}.ui-tooltip .arrow .top:after{bottom:-20px;top:auto}.btn{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;background-color:transparent;color:#ccc;text-shadow:1px 1px 1px rgba(0,0,0,0.8);outline-offset:-1px}.btn:hover{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;color:#fff;text-shadow:0px 0px 10px #fff}.btn.active{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1;color:#fff;text-shadow:0px 0px 10px #fff}.btn.disabled,.btn.disabled:hover,.disabled .btn,.disabled .btn:hover{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=30)\";filter:alpha(opacity=30);opacity:0.3;cursor:default;text-shadow:none;color:#fff}.btn:focus{outline:1px solid #66CCFF}.playHead.btn:focus{outline:none}.mobile .btn:focus{outline:none}.largePlayBtn{background-color:#222222;background:rgba(0,0,0,0.7);color:#efefef}.mobileSkin .largePlayBtn{display:-webkit-flex;display:flex;-webkit-align-items:center;align-items:center;-webkit-justify-content:center;justify-content:center;position:absolute;top:50%;left:50%;font-size:2.6em;text-decoration:none;width:76px;height:76px;border-radius:76px;padding:0px 0px 0px 0px;margin-top:-1.1em;margin-left:-1.05em;background-color:rgba(0,194,255,0.8);color:#ffffff;box-shadow:0px 0px 2px 0px rgba(0,0,0,0.20);outline:none}.mobileSkin.size-small .largePlayBtn{font-size:2.1em;width:60px;height:60px;border-radius:60px}.largePlayBtn:hover{background-color:rgba(0,0,0,1);color:#fff}.mobileSkin .largePlayBtn:hover{background-color:rgba(0,214,255,0.75);color:#fff}.mobileSkin.pluginsScreenOpened .largePlayBtn{display:none !important}.scrubber.disabled{height:0.3em}.scrubber.disabled .watched{background-image:-webkit-gradient(linear,0 100%,100% 0,color-stop(0.25,rgba(255,255,255,0.15)),color-stop(0.25,transparent),color-stop(0.5,transparent),color-stop(0.5,rgba(255,255,255,0.15)),color-stop(0.75,rgba(255,255,255,0.15)),color-stop(0.75,transparent),to(transparent));background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:-moz-linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:-ms-linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,0.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,0.15) 50%,rgba(255,255,255,0.15) 75%,transparent 75%,transparent);-webkit-background-size:10px 10px;-moz-background-size:10px 10px;background-size:10px 10px}.scrubber.disabled .buffered,.scrubber.disabled .playHead{display:none}.watched{background-color:#2ec7e1}.mobileSkin .watched{background-color:#00D6FF;border-bottom-left-radius:10px;border-top-left-radius:10px}.buffered{background-color:#AFAFAF;background:rgba( 102,102,102,0.5 );-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=40)\";filter:alpha(opacity=40);opacity:0.4;  }.scrubber .playHead:hover{border-color:#fff;-webkit-box-shadow:0 1px 30px rgba(255,255,255,1);box-shadow:0 1px 30px rgba(255,255,255,1);-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)\";filter:alpha(opacity=100);opacity:1}.sourceSelector{display:inline-block}.mobileSkin .controlBarContainer .sourceSelector,.mobileSkin .controlBarContainer .streamSelector{margin-top:-5px}.mobileSkin .controlBarContainer .closedCaptions{margin-top:-6px}.overlay{background:rgb(0,0,0);-ms-filter:progid:DXImageTransform.Microsoft.Alpha(opacity=70);filter:alpha(opacity=70);background:rgba(0,0,0,0.7)}.alert-footer .btn{background:#fbfbfb;color:#000;border-color:#999}.dropdown-menu{-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=85)\";filter:alpha(opacity=85);opacity:0.85;background:#222222}.logo{width:3em;height:100%;position:relative}.logo img{margin:auto;position:absolute;top:0;left:0;bottom:0;right:0;max-width:100%;max-height:100%;border:0px}.kaltura-logo{display:inline-block;height:100%;margin:0;padding:0;width:3em;cursor:pointer;border:0;background-position:12px 6px;background-repeat:no-repeat;background-image:url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50//skins/kdark/css/../images/kalturaLogo.png?2016-11-17T08:31:40Z)}.mobileSkin .logo{background-position:center center;top:-0.2em;display:none !important} .fullscreen.mobileSkin .fullScreenBtn{float:left}.playPauseBtn{width:3.3em}.chromecast{font-size:1.4em} .ad-component{position:absolute;color:#FFF;text-shadow:1px 1px 1px #000;font-size:90%}.ad-notice-label{bottom:14px;left:5px;z-index:102}.ad-skip-btn{cursor:pointer;font-size:110%}.ad-skip-label,.ad-skip-btn{right:5px;bottom:5px;padding:10px 20px;background:rgba(0,0,0,0.6);z-index:101}.overlayAd{width:100% !important;height:100% !important}.hover .ad-skip-label{bottom:30px}.hover .ad-skip-btn{bottom:30px}.hover .ad-notice-label{bottom:40px}#touchOverlay{position:absolute;top:0;width:100%;height:100%;z-index:1}.adplay-state #touchOverlay{top:3em !important}.clearfix:before,.clearfix:after{content:\" \";display:table}.clearfix:after{clear:both}.clearfix{*zoom:1}.watermark{position:absolute;padding:5px}.mobileSkin:not(.pluginsScreenOpened) .watermark{z-index:2}.mobileSkin .watermark{opacity:0.3}.mobileSkin.player-out .watermark{opacity:1}.mobileSkin.start-state .watermark{display:none}.watermark img{border:0px}.watermark.topRight{top:0;right:0}.watermark.topLeft{top:0;left:0}.watermark.bottomRight{bottom:0;right:0}.watermark.bottomLeft{bottom:0;left:0}.hide{display:none}.screen{display:none;position:absolute;width:100%;height:100%;top:0;left:0;z-index:3;box-sizing:border-box;padding-top:2.3em;background-color:#000;background-image:linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-o-linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-moz-linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-webkit-linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-ms-linear-gradient(top,#000000 10%,#3E3E3E 90%);background-image:-webkit-gradient(linear,left top,left bottom,color-stop(0.1,#000000),color-stop(0.9,#3E3E3E))}.mobileSkin .screen{padding-top:1em}.screen .icon-close{position:absolute;font-size:1.2em;font-weight:bold;right:2.4em;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);z-index:100}.mobileSkin .screen .icon-close{width:1em;height:1em;right:0.3em;top:0em;font-size:2.6em;font-weight:normal}.screen .icon-close:hover{text-shadow:0px 0px 10px #fff}.screen-content{box-sizing:border-box;padding:0 10px}.semiTransparentBkg{z-index:10; background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iIzAwMDAwMCIgc3RvcC1vcGFjaXR5PSIwLjUiLz4KICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzNlM2UzZSIgc3RvcC1vcGFjaXR5PSIwLjUiLz4KICA8L2xpbmVhckdyYWRpZW50PgogIDxyZWN0IHg9IjAiIHk9IjAiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9InVybCgjZ3JhZC11Y2dnLWdlbmVyYXRlZCkiIC8+Cjwvc3ZnPg==);background:-moz-linear-gradient(top,rgba(0,0,0,0.5) 0%,rgba(62,62,62,0.5) 100%); background:-webkit-gradient(linear,left top,left bottom,color-stop(0%,rgba(0,0,0,0.65)),color-stop(100%,rgba(62,62,62,0.65))); background:-webkit-linear-gradient(top,rgba(0,0,0,0.65) 0%,rgba(62,62,62,0.5) 100%); background:-o-linear-gradient(top,rgba(0,0,0,0.65) 0%,rgba(62,62,62,0.65) 100%); background:-ms-linear-gradient(top,rgba(0,0,0,0.65) 0%,rgba(62,62,62,0.65) 100%); background:linear-gradient(to bottom,rgba(0,0,0,0.65) 0%,rgba(62,62,62,0.65) 100%); filter:progid:DXImageTransform.Microsoft.gradient( startColorstr=\'#80000000\',endColorstr=\'#803e3e3e\',GradientType=0 ); }.screen .panel-left{margin-right:10px;position:absolute;width:40%;height:100%}.videoPreview{position:relative;width:230px;height:129px}.animateVideo{transition:top 1s,left 1s,width 1s,height 1s}.previewPlayer .videoDisplay{top:40px;left:6px;z-index:4;width:40%;height:40%;transition:top 1s,left 1s,width 1s,height 1s}.expandPlayerBtn{position:absolute;z-index:10;font-size:2em;top:0.3em;left:0.3em;opacity:0.7;cursor:pointer;border:1px solid grey;border-radius:25px;background-color:grey}.ie8 .expandPlayerBtn{border:0px solid grey;background:url(blank.gif)}.expandPlayerBtn,.previewPlayer + .size-tiny .expandPlayerBtn{display:none}.previewPlayer .expandPlayerBtn{display:inline-block}.share .screen-content,.airPlay .screen-content{padding:10px;position:relative;height:100%}.screen .panel-right{width:58%;position:absolute;right:0}.size-tiny .screen .panel-right,.size-tiny .screen .panel-left,.size-tiny .infoScreen .views{position:static;width:100%;height:auto}.in-progress-state{-webkit-animation:spin 3s linear infinite;-moz-animation:spin 3s linear infinite;animation:spin 3s linear infinite;outline:0 !important}.truncateText{overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.adCover{position:fixed;cursor:pointer;width:100%;height:100%;background-color:rgba(0,0,0,0);z-index:2}.adCoverIE8{background-color:black;-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)\"}.AlertMessageTransparent{background-color :transparent;padding :5px;font-weight :normal !important;font-size:1.5em;color:#a4a4a4;opacity:0.5;text-align:center}.AlertTitleTransparent{background-color :transparent;font-weight :normal !important;font-size:1.8em ;color:#a4a4a4;opacity:0.5;text-align:center}.AlertContainerTransparent{background-color :transparent;position:absolute;width:80%;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);color:white}.flashBlockAlertContainer{background-color :transparent;position:fixed;top:40%;text-align:center;width:100%;color:white}.blur{-webkit-filter:blur(5px);-moz-filter:blur(5px);-o-filter:blur(5px);-ms-filter:blur(5px);filter:blur(5px)}.vpaidContainer{position:absolute;top:0px;left:0px;z-index:2000;width:100%;height:100%}.blackBackground{background-color:#000000}@-moz-keyframes spin{100%{-moz-transform:rotate(360deg)}}@-webkit-keyframes spin{100%{-webkit-transform:rotate(360deg)}}@keyframes spin{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-webkit-keyframes rotating{from{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(359deg)}}@-moz-keyframes rotating{from{-moz-transform:rotate(0deg)}to{-moz-transform:rotate(359deg)}}@keyframes rotating{from{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(359deg);-moz-transform:rotate(359deg);-ms-transform:rotate(359deg);-o-transform:rotate(359deg);transform:rotate(359deg)}}.customSpinner{position:absolute;top:50%;left:50%;margin-top:-50px;margin-left:-50px;border-radius:50%;width:50px;height:50px;border:solid 4px rgba(255,255,255,0.7);background-color:transparent;border-right-color:#00d6ff;-webkit-animation:rotating 0.8s linear infinite;-moz-animation:rotating 0.8s linear infinite;animation:rotating 0.8s linear infinite}.mobileSkin .videoShadow{background:rgba(0,0,0,0.5);position:absolute;width:100%;height:100%;opacity:1;transition:opacity 0.3s linear;-webkit-transition:opacity 0.3s linear;-moz-transition:opacity 0.3s linear;-ms-transition:opacity 0.3s linear;-o-transition:opacity 0.3s linear}.mobileSkin.pluginsScreenOpened .videoShadow{background:rgba(0,0,0,0.75)}.mobileSkin.adplay-state .videoShadow{display:none}.closePluginsScreen{position:absolute;cursor :pointer;top :2px;right :2px;width:50px !important;height:50px !important}.closePluginsScreen:active{outline:0;border:0}.mobileSkin .overlay .closePluginsScreen{font-family:\'icomoon\' !important;font-size:2.6em;top:-0.5em;position:absolute;-webkit-tap-highlight-color:rgba(0,0,0,0)}.reportButton{width:100px;-webkit-border-radius:2px;-moz-border-radius:2px;border-radius:24px;background-color:#00d6ff;color:white;text-align:center;padding-top:8px;height:24px;position:absolute;margin-top:6px;cursor:pointer}.reportButton.right{right:10%;margin-right:-1px}.mobileSkin.player-out .videoShadow{opacity:0}.overlayAdContainer{-webkit-transition:top 0.3s ease-in-out;-moz-transition:top 0.3s ease-in-out;-o-transition:top 0.3s ease-in-out;transition:top 0.3s ease-in-out}.trackWindow{display:inline-block;padding:5px;margin:0 15px 0 15px} .cssChecker{display:none !important}@font-face{font-family:\'icomoon\';src:url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50//skins/kdark/css/../fonts/icomoon.eot?2016-11-17T08:31:40Z);src:url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50//skins/kdark/css/../fonts/icomoon.eot?2016-11-17T08:31:40Z\x26#iefix) format(\'embedded-opentype\'),url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50//skins/kdark/css/../fonts/icomoon.woff?2016-11-17T08:31:40Z) format(\'woff\'),url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50//skins/kdark/css/../fonts/icomoon.ttf?2016-11-17T08:31:40Z) format(\'truetype\'),url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50//skins/kdark/css/../fonts/icomoon.svg?2016-11-17T08:31:40Z\x26#icomoon) format(\'svg\');font-weight:normal;font-style:normal}[class^=\"icon-\"],[class*=\" icon-\"]{font-family:\'icomoon\';speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1; -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-volume-mute:before{content:\"\\e600\"}.icon-volume-low:before{content:\"\\e601\"}.icon-volume-high:before{content:\"\\e602\"}.icon-unlike:before{content:\"\\e603\"}.icon-share:before{content:\"\\e604\"}.icon-close:before{content:\"\\e605\"}.icon-checkmark:before{content:\"\\e606\"}.icon-check:before{content:\"\\e606\"}.icon-caret:before{content:\"\\e624\"}.icon-cc:before{content:\"\\e607\"}.icon-camera:before{content:\"\\e608\"}.icon-replay:before{content:\"\\e609\"}.icon-related:before{content:\"\\e60a\"}.icon-play:before{content:\"\\e60b\"}.icon-pause:before{content:\"\\e60c\"}.icon-like:before{content:\"\\e60d\"}.icon-info:before{content:\"\\e60e\"}.icon-fullscreen-exit-alt:before{content:\"\\e60f\"}.icon-fullscreen-alt:before{content:\"\\e610\"}.icon-flag:before{content:\"\\e611\"}.icon-expand2:before{content:\"\\e612\"}.icon-expand:before{content:\"\\e613\"}.icon-download:before{content:\"\\e614\"}.icon-contract:before{content:\"\\e615\"}.icon-cog:before{content:\"\\e616\"}.icon-ad:before{content:\"\\e617\"}.icon-list:before{content:\"\\e618\"}.icon-chromecast:before{content:\"\\e619\"}.icon-next:before{content:\"\\e61b\"}.icon-prev:before{content:\"\\e61a\"}.icon-duration:before{content:\"\\e61d\"}.icon-start_time:before{content:\"\\e61c\"}.icon-chapterMenu:before{content:\"\\e61e\"}.icon-clear:before{content:\"\\e61f\"}.icon-magnifyGlass:before{content:\"\\e620\"}.icon-switchSource:before{content:\"\\e621\"}.icon-off-air:before{content:\"\\e622\"}.icon-on-air:before{content:\"\\e623\"}.icon-toggle:before{content:\"\\e624\"}.icon-locator:before{content:\"\\e625\"}.icon-toggleAll:before{content:\"\\e626\"}.icon-audio:before{content:\"\\e627\"}.icon-new-tab:before{content:\"\\e628\"}.mobileSkin .icon-cog:before{content:\"\\e900\"}.mobileSkin .icon-share:before{content:\"\\e901\"}.mobileSkin .icon-more:before{content:\"\\e902\"}.mobileSkin .icon-chromecast:before{content:\"\\e903\"}.mobileSkin .icon-airplay:before{content:\"\\e904\"}.mobileSkin .icon-contract:before{content:\"\\e905\"}.mobileSkin .icon-expand:before{content:\"\\e906\"}.mobileSkin .icon-play:before{text-shadow:0px 0px 2px rgba(0,0,0,0.10);content:\"\\e907\"}.mobileSkin .icon-pause:before{text-shadow:0px 0px 2px rgba(0,0,0,0.10);content:\"\\e908\"}.mobileSkin .icon-prev:before{content:\"\\e909\"}.mobileSkin .icon-next:before{content:\"\\e90a\"}.mobileSkin .icon-richmedia:before{content:\"\\e90b\"}.mobileSkin .icon-info:before{content:\"\\e90c\"}.mobileSkin .icon-cc:before{content:\"\\e90d\"}.mobileSkin .icon-speedrate:before{content:\"\\e90e\"}.mobileSkin .icon-flag:before{content:\"\\e90f\"}.mobileSkin .icon-attachments:before{content:\"\\e910\"}.mobileSkin .icon-download:before{content:\"\\e911\"}.mobileSkin .icon-swap:before{content:\"\\e912\"}.mobileSkin .icon-mainslide:before{content:\"\\e913\"}.mobileSkin .icon-single:before{content:\"\\e914\"}.mobileSkin .icon-split:before{content:\"\\e915\"}.mobileSkin .icon-viewpoint:before{content:\"\\e916\"}.mobileSkin .icon-related:before{content:\"\\e91c\"}.mobileSkin .icon-ad:before{content:\"\\e91e\"}.mobileSkin .icon-arrow-left:before{content:\"\\e917\"}.mobileSkin .icon-close:before{content:\"\\e918\"}\n\n/* cache key: resourceloader:filter:minify-css:7:914f4cdfe00f349f7609179051f52ed8 */\n"},{});mw.loader.implement("keyboardShortcuts",function($){(function(mw,$){"use strict";mw.PluginManager.add('keyboardShortcuts',mw.KBasePlugin.extend({defaultConfig:{"volumePercentChange":0.1,"shortSeekTime":5,"longSeekTime":10,"arrowUpKey":38,"arrowDownKey":40,"togglePlaybackKey":32,"shortSeekBackKey":37,"longSeekBackKey":'ctrl+37',"shortSeekForwardKey":39,"longSeekForwardKey":'ctrl+39',"percentageSeekKeys":"49,50,51,52,53,54,55,56,57","openFullscreenKey":70,"escapeKey":27,"gotoBeginingKey":36,"gotoEndKey":35},configKeyNames:['arrowUpKey','arrowDownKey','togglePlaybackKey','shortSeekBackKey','longSeekBackKey','shortSeekForwardKey','longSeekForwardKey','openFullscreenKey','escapeKey','gotoBeginingKey','gotoEndKey'],SHIFT_KEY_CODE:16,CTRL_KEY_CODE:17,ALT_KEY_CODE:18,enableKeyBindings:true,enableSingleKeyBindings:true,enableComboKeyBindings:true,canSeek:false,singleKeys:{},combinationKeys:{'ctrl':{},'alt':{},'shift':{},'alt+ctrl':{},'alt+shift':{},'ctrl+shift':{}},setup:function(){var _this=this;$.each(this.configKeyNames,function(idx,configKey){var keyVal=_this.getConfig(configKey);_this.mapKeyByType(keyVal,configKey);});var percentageArr=this.getConfig('percentageSeekKeys').split(",");$.each(percentageArr,function(keyIdx,keyCode){_this.singleKeys[keyCode]='percentageSeekKeys';});var addKeyCallback=function(keyCode,callback){_this.mapKeyByType(keyCode,callback);};this.bind('pluginsReady',function(){_this.getPlayer().triggerHelper('addKeyBindCallback',addKeyCallback);});this.bind('onEnableKeyboardBinding',function(){_this.enableKeyBindings=true;_this.enableSingleKeyBindings=true;_this.enableComboKeyBindings=true;});this.bind('onDisableKeyboardBinding',function(e,options){if(options){_this.enableSingleKeyBindings=options.disableSingle?!(!!options.disableSingle):true;_this.enableComboKeyBindings=options.disableCombo?!(!!options.disableCombo):true;_this.enableKeyBindings=_this.enableSingleKeyBindings||_this.enableComboKeyBindings;}else{_this.enableKeyBindings=false;_this.enableSingleKeyBindings=false;_this.enableComboKeyBindings=false;}});this.bind('updateBufferPercent',function(){_this.canSeek=true;});$(document).keydown(function(e){if(_this.enableKeyBindings){return _this.onKeyDown(e);}});},mapKeyByType:function(key,callback){switch(typeof key){case"number":this.singleKeys[key]=callback;break;case"string":var parts=key.split("+");if(parts.length==1){this.singleKeys[key]=callback;break;}var validSpecialKeys=['ctrl','alt','shift'];if(parts.length===2){if($.inArray(parts[0],validSpecialKeys)!==-1){this.combinationKeys[parts[0]][parts[1]]=callback;}else{this.log('First key must be one of: '+validSpecialKeys.join(","));}}if(parts.length===3){if(($.inArray(parts[0],validSpecialKeys)!==-1)&&($.inArray(parts[1],validSpecialKeys)!==-1)){var comboKey=parts.slice(0,2).sort(function(a,b){if(a.toLowerCase().charAt(0)>b.toLowerCase().charAt(0)){return 1;}if(a.toLowerCase().charAt(0)<b.toLowerCase().charAt(0)){return-1;}return 0;});this.combinationKeys[comboKey[0]+"+"+comboKey[1]][parts[2]]=callback;}else{this.log('First and second keys must be one of: '+validSpecialKeys.join(","));}}break;}},onKeyDown:function(e){var ranCallback=false;var keyCode=e.keyCode||e.which;if($("*:focus").is("textarea, input")){return true;}if(this.enableComboKeyBindings){if(e.ctrlKey&&e.altKey&&keyCode!==this.CTRL_KEY_CODE&&keyCode!==this.ALT_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['alt+ctrl']);}else if(e.ctrlKey&&e.shiftKey&&keyCode!==this.CTRL_KEY_CODE&&keyCode!==this.SHIFT_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['ctrl+shift']);}else if(e.shiftKey&&e.altKey&&keyCode!==this.SHIFT_KEY_CODE&&keyCode!==this.ALT_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['alt+shift']);}else if(e.altKey&&keyCode!==this.ALT_KEY_CODE){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['alt']);}else if(e.ctrlKey&&keyCode!==this.CTRL_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['ctrl']);}else if(e.shiftKey&&keyCode!==this.SHIFT_KEY_CODE&&!ranCallback){ranCallback=this.runCallbackByKeysArr(keyCode,this.combinationKeys['shift']);}}if(!ranCallback&&this.enableSingleKeyBindings){ranCallback=this.runCallbackByKeysArr(keyCode,this.singleKeys);}if(ranCallback){e.preventDefault();return false;}},runCallbackByKeysArr:function(keyCode,keysArr){var keyName=keysArr[keyCode];if($.isFunction(keyName)){keyName(keyCode);this.log('ran callback for key: '+keyCode);return true;}var keyCallback=keyName+'Callback';if(keyName&&typeof this[keyCallback]==='function'){this[keyCallback](keyCode);this.log('ran callback: '+keyCallback+' for key: '+keyCode);return true;}return false;},arrowUpKeyCallback:function(){if(this.getOpenedMenu()!=null){this.getOpenedMenu().previousItem();}else{this.volumeUpKeyCallback();}},arrowDownKeyCallback:function(){if(this.getOpenedMenu()!=null){this.getOpenedMenu().nextItem();}else{this.volumeDownKeyCallback();}},escapeKeyCallback:function(){if(this.getOpenedMenu()!=null){this.getOpenedMenu().close();}else{this.closeFullscreenkeyCallback();}},volumeUpKeyCallback:function(){var currentVolume=parseFloat(this.getPlayer().getPlayerElementVolume());var volumePercentChange=parseFloat(this.getConfig('volumePercentChange'));var newVolumeVal=(currentVolume+volumePercentChange).toFixed(2);if(newVolumeVal>1){newVolumeVal=1;}this.getPlayer().setVolume(newVolumeVal,true);},volumeDownKeyCallback:function(){var currentVolume=parseFloat(this.getPlayer().getPlayerElementVolume());var volumePercentChange=parseFloat(this.getConfig('volumePercentChange'));var newVolumeVal=(currentVolume-volumePercentChange).toFixed(2);if(newVolumeVal<0){newVolumeVal=0;}this.getPlayer().setVolume(newVolumeVal,true);},togglePlaybackKeyCallback:function(){if($('.btn').is(":focus")){return false;}var notificationName=(this.getPlayer().isPlaying())?'doPause':'doPlay';this.getPlayer().sendNotification(notificationName,{'userInitiated':true});return false;},seek:function(seekType,direction){if(!this.canSeek){return false;}var seekTimeConfig=(seekType=='short')?'shortSeekTime':'longSeekTime';var seekTime=parseFloat(this.getConfig(seekTimeConfig));var currentTime=parseFloat(this.getPlayer().currentTime);var newCurrentTime=0;if(direction=='back'){newCurrentTime=currentTime-seekTime;if(newCurrentTime<0){newCurrentTime=0;}}else{newCurrentTime=currentTime+seekTime;if(newCurrentTime>parseFloat(this.getPlayer().getDuration())){newCurrentTime=parseFloat(this.getPlayer().getDuration());}}this.getPlayer().seek(newCurrentTime);},shortSeekBackKeyCallback:function(){this.seek('short','back');},longSeekBackKeyCallback:function(){this.seek('long','back');},shortSeekForwardKeyCallback:function(){this.seek('short','forward');},longSeekForwardKeyCallback:function(){this.seek('long','forward');},percentageSeekKeysCallback:function(keyCode){if(!this.canSeek){return false;}var _this=this;var getPercentage=function(){var percentArr=_this.getConfig('percentageSeekKeys').split(",");var idx=$.inArray(keyCode.toString(),percentArr);return((idx+1)*0.1).toFixed(2);};var seekTime=getPercentage()*this.getPlayer().getDuration();this.getPlayer().seek(seekTime);},openFullscreenKeyCallback:function(){if(!this.getPlayer().getInterface().hasClass('fullscreen')){this.getPlayer().toggleFullscreen();}},closeFullscreenkeyCallback:function(){if(this.getPlayer().getInterface().hasClass('fullscreen')&&this.getPlayer().layoutBuilder.fullScreenManager.inFullScreen){this.getPlayer().toggleFullscreen();}},gotoBeginingKeyCallback:function(){if(!this.canSeek){return false;}this.getPlayer().seek(0);},gotoEndKeyCallback:function(){if(!this.canSeek||this.getPlayer().currentState==='end'){return false;}this.getPlayer().seek(this.getPlayer().getDuration()-1);},getOpenedMenu:function(){var openedMenu=null;for(var pluginID in this.getPlayer().plugins){var plugin=this.getPlayer().plugins[pluginID];if($.isFunction(plugin.getMenu)&&plugin.getMenu().isOpen()){openedMenu=plugin.getMenu();break;}}return openedMenu;}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("largePlayBtn",function($){(function(mw,$){"use strict";mw.PluginManager.add('largePlayBtn',mw.KBaseComponent.extend({shouldShow:false,isDisabled:false,defaultConfig:{'parent':'videoHolder','togglePause':true,'order':1},setup:function(){this.addBindings();},isPersistantPlayBtn:function(){return(mw.isAndroid2()||this.getPlayer().isLinkPlayer()||(mw.isIphone()&&mw.getConfig('EmbedPlayer.iPhoneShowHTMLPlayScreen'))&&!mw.isWindowsPhone());},addBindings:function(){var _this=this;this.bind('showInlineDownloadLink',function(e,linkUrl){_this.getComponent().attr({'href':linkUrl.replace('playSessionId=','playSessionId=noev-'),'target':'_blank'});});this.bind('onChangeMediaDone playerReady onpause onEndedDone onRemovePlayerSpinner showPlayerControls showLargePlayBtn',function(e){if(!_this.embedPlayer.isPlaying()&&!_this.embedPlayer.isInSequence()&&!_this.embedPlayer.isPauseLoading){if(mw.isChromeCast()){_this.getComponent().removeClass("icon-play").addClass("icon-pause");if(e.type!=="onpause"&&e.type!=="playerReady"){return;}}else{_this.getComponent().removeClass("icon-pause").addClass("icon-play");}_this.show();}});this.bind('onShowControlBar',function(){if(!mw.isIE8()&&_this.getConfig("togglePause")&&(_this.embedPlayer.isPlaying()||mw.isChromeCast())&&!_this.embedPlayer.isInSequence()){_this.getComponent().removeClass("icon-play").addClass("icon-pause");_this.show();}});this.bind('playing AdSupport_StartAdPlayback onHideControlBar onChangeMedia',function(e){_this.hide();});this.bind('onAddPlayerSpinner showScreen',function(e){_this.hide(true);});this.bind('onPlayerStateChange',function(e,newState,oldState){if(newState=='load'||newState=='play'){_this.hide(true);}if(newState=='pause'&&_this.getPlayer().isPauseLoading&&!mw.isChromeCast()){_this.hide();}});this.bind('hideScreen closeMenuOverlay',function(){if(mw.isMobileDevice()&&_this.getPlayer().paused){_this.show();}});this.bind('liveOnline',function(){if(_this.getPlayer().isLive&&!_this.getPlayer().isDVR()){_this.hide();}});},show:function(){if(!this.isDisabled&&!this.embedPlayer.layoutBuilder.displayOptionsMenuFlag){if(this.embedPlayer.isMobileSkin()&&(this.embedPlayer.changeMediaStarted||this.embedPlayer.buffering||this.embedPlayer.isInSequence())){return;}if(this.embedPlayer.isMobileSkin()){if(mw.isIOS8()){this.getComponent().fadeIn('fast').css('display',"-webkit-flex");}else{this.getComponent().fadeIn('fast').css('display',"flex");}}else{this.getComponent().css('display',"block");}}this.shouldShow=true;},hide:function(force){this.hideComponent(force);this.shouldShow=false;},hideComponent:function(force){if(force||!this.isPersistantPlayBtn()){if(this.embedPlayer.isMobileSkin()){this.getComponent().stop();}this.getComponent().hide();}},clickButton:function(event){if(this.getPlayer().isLinkPlayer()){this.getPlayer().triggerHelper('firstPlay');this.getPlayer().triggerHelper('playing');return;}event.preventDefault();event.stopPropagation();if(this.getConfig("togglePause")&&this.getPlayer().isPlaying()){this.getPlayer().sendNotification('doPause',{'userInitiated':true});}else{this.getPlayer().triggerHelper('goingtoplay');this.getPlayer().sendNotification('doPlay',{'userInitiated':true});}},onEnable:function(){this.isDisabled=false;if(this.shouldShow){this.show();}},onDisable:function(){this.isDisabled=true;this.hideComponent();},getComponent:function(){if(!this.$el){var _this=this;var eventName='click';this.$el=$('<a />').attr({'tabindex':'-1','href':'#','title':gM('mwe-embedplayer-play_clip'),'class':"icon-play "+this.getCssClass()}).hide().on(eventName,function(e){_this.clickButton(e);});if(!mw.isWindowsPhone()){this.$el.addClass("largePlayBtnBorder");}}return this.$el;}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("liveAnalytics",function($){(function(mw,$){"use strict";mw.PluginManager.add('liveAnalytics',mw.KBasePlugin.extend({defaultConfig:{'forceLoad':false},startTime:null,reportingInterval:10000,bufferTime:0,eventIndex:1,currentBitRate:-1,eventType:1,playing:false,firstPlay:true,liveEventInterval:null,monitorIntervalObj:{},smartSetInterval:function(callback,time,monitorObj){var _this=this;var speed=time,counter=1,start=new Date().getTime();var instance=function(){if(monitorObj.cancel){return;}callback();var real=(counter*speed),ideal=(new Date().getTime()-start);counter++;var diff=(ideal-real);monitorObj.counter=counter;monitorObj.diff=diff;var nextSpeed=speed-diff;if(Math.abs(nextSpeed)>speed){nextSpeed=speed;}_this.liveEventInterval=window.setTimeout(function(){instance();},nextSpeed);};_this.liveEventInterval=window.setTimeout(function(){instance();},speed);},setup:function(){var _this=this;_this.removeBindings();this.embedPlayer.bindHelper('playerReady',function(){if(_this.embedPlayer.isLive()||_this.getConfig('forceLoad')){_this.eventIndex=1;_this.bufferTime=0;_this.currentBitRate=-1;_this.addBindings();if(_this.embedPlayer&&_this.embedPlayer.kalturaContextData&&_this.embedPlayer.kalturaContextData.flavorAssets&&_this.embedPlayer.kalturaContextData.flavorAssets.length===1){_this.currentBitRate=_this.embedPlayer.kalturaContextData.flavorAssets[0].bitrate;}}});},addBindings:function(){var _this=this;this.bind('onPlayerStateChange',function(e,newState,oldState){if(newState==="pause"){_this.stopLiveEvents();_this.playing=false;}if(newState==="play"){_this.startLiveEvents();_this.playing=true;}});this.bind('bufferStartEvent',function(){_this.bufferStartTime=new Date();});this.bind('bufferEndEvent',function(){_this.calculateBuffer();_this.bufferStartTime=null;});this.bind('bitrateChange',function(event,newBitrate){_this.currentBitRate=newBitrate;});this.bind('liveStreamStatusUpdate',function(event,status){if(!status){_this.stopLiveEvents();_this.bufferTime=0;_this.bufferStartTime=null;}else{if(_this.playing&&!_this.isLiveEventsOn){_this.startLiveEvents();}}});this.bind('movingBackToLive',function(){_this.eventType=1;});this.bind('seeked seeking onpause',function(){if(_this.getPlayer().isDVR()){_this.eventType=2;}});},calculateBuffer:function(closeSession){var _this=this;if(closeSession&&!_this.bufferStartTime){return;}this.bufferTime+=(new Date()-_this.bufferStartTime)/1000;if(this.bufferTime>10){this.bufferTime=10;}if(closeSession){_this.bufferStartTime=new Date();}},removeBindings:function(){this.unbind("");},stopLiveEvents:function(){var _this=this;_this.isLiveEventsOn=false;_this.monitorIntervalObj.cancel=true;clearTimeout(_this.liveEventInterval);_this.liveEventInterval=null;},startLiveEvents:function(){var _this=this;_this.startTime=null;if(_this.isLiveEventsOn){return;}_this.isLiveEventsOn=true;_this.kClient=mw.kApiGetPartnerClient(_this.embedPlayer.kwidgetid);_this.monitorIntervalObj.cancel=false;if(_this.firstPlay){_this.sendLiveAnalytics();_this.firstPlay=false;}_this.smartSetInterval(function(){_this.sendLiveAnalytics();},_this.reportingInterval,_this.monitorIntervalObj);},sendLiveAnalytics:function(){var _this=this;_this.calculateBuffer(true);_this.kClient=mw.kApiGetPartnerClient(_this.embedPlayer.kwidgetid);if(_this.embedPlayer.isMulticast&&$.isFunction(_this.embedPlayer.getMulticastBitrate)){_this.currentBitRate=_this.embedPlayer.getMulticastBitrate();}var liveStatsEvent={'entryId':_this.embedPlayer.kentryid,'partnerId':_this.embedPlayer.kpartnerid,'eventType':_this.eventType,'sessionId':_this.embedPlayer.evaluate('{configProxy.sessionId}'),'eventIndex':_this.eventIndex,'bufferTime':_this.bufferTime,'bitrate':_this.currentBitRate,'referrer':encodeURIComponent(mw.getConfig('EmbedPlayer.IframeParentUrl')),'isLive':1,'deliveryType':_this.embedPlayer.streamerType,'startTime':_this.startTime};var eventRequest={'service':'liveStats','action':'collect'};$.each(liveStatsEvent,function(index,value){eventRequest['event:'+index]=value;});_this.bufferTime=0;_this.eventIndex+=1;_this.embedPlayer.triggerHelper('liveAnalyticsEvent',liveStatsEvent);_this.kClient.doRequest(eventRequest,function(data){try{if(!_this.startTime){_this.startTime=data;}}catch(e){mw.log("Failed sync time from server");}},true);}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("liveStream",function($){(function(mw,$){"use strict";mw.PluginManager.add('liveCore',mw.KBasePlugin.extend({firstPlay:false,liveStreamStatusInterval:10,defaultDVRWindow:30*60,onAirStatus:true,defaultConfig:{offlineAlertOffest:1000,disableLiveCheck:false,hideOfflineIndicators:false,hideCurrentTimeLabel:true,showThumbnailWhenOffline:false},shouldReAttachTimeUpdate:false,playWhenOnline:false,maxCurrentTime:0,liveStreamStatusUpdated:false,setup:function(){this.addPlayerBindings();this.extendApi();},extendApi:function(){var _this=this;this.getPlayer().isOffline=function(){return!_this.onAirStatus;}},addPoster:function(){this.getPlayer().removePosterFlag=false;this.getPlayer().updatePosterHTML();},removePoster:function(){this.getPlayer().removePoster();this.getPlayer().removePosterFlag=true;},addPlayerBindings:function(){var _this=this;var embedPlayer=this.getPlayer();this.bind('checkIsLive',function(e,callback){_this.getLiveStreamStatusFromAPI(callback);});this.bind('playerReady',function(){_this.onAirStatus=true;_this.isLiveChanged();});this.bind('onpause',function(){if(embedPlayer.isLive()&&_this.isDVR()&&_this.switchDone){embedPlayer.addPlayerSpinner();_this.getLiveStreamStatusFromAPI(function(onAirStatus){if(onAirStatus){if(_this.shouldHandlePausedMonitor()){_this.addPausedMonitor();}}});}});this.bind('firstPlay',function(){_this.firstPlay=true;});this.bind('AdSupport_PreSequenceComplete',function(){_this.switchDone=true;});this.bind('liveStreamStatusUpdate',function(e,onAirObj){if(!_this.liveStreamStatusUpdated){_this.liveStreamStatusUpdated=true;if(onAirObj.onAirStatus){_this.addPoster();_this.getPlayer().enablePlayControls();}else{_this.getPlayer().disablePlayControls();}}if(_this.onAirStatus&&!onAirObj.onAirStatus){var firstOfflineAlertOffest=_this.calculateOfflineAlertOffest();_this.setOffAir(firstOfflineAlertOffest);}else if(!_this.onAirStatus&&onAirObj.onAirStatus){if(_this.offAirTimeout){clearTimeout(_this.offAirTimeout);_this.offAirTimeout=null;}if(_this.getPlayer().removePosterFlag&&!_this.playWhenOnline&&!embedPlayer.isPlaying()){_this.addPoster();}embedPlayer.layoutBuilder.closeAlert();if(!_this.getPlayer().getError()){_this.getPlayer().enablePlayControls();}embedPlayer.triggerHelper('liveOnline');if(_this.playWhenOnline){embedPlayer.play();_this.playWhenOnline=false;}if(!embedPlayer.firstPlay&&_this.isDVR()){embedPlayer.disablePlayControls();var shouldPause=!embedPlayer.isPlaying();var playingEvtName="seeked.backToLive playing.backToLive";embedPlayer.bindHelper(playingEvtName,function(){embedPlayer.unbindHelper(playingEvtName);setTimeout(function(){embedPlayer.enablePlayControls();if(shouldPause){embedPlayer.pause();}},1);});setTimeout(function(){_this.maxCurrentTime=0;embedPlayer.pauseInterfaceUpdate();embedPlayer.backToLive();},1000);}}if(onAirObj.onAirStatus&&embedPlayer.firstPlay&&embedPlayer.autoplay&&embedPlayer.canAutoPlay()&&!embedPlayer.isInSequence()&&!embedPlayer.isPlaying()){embedPlayer.play();}_this.onAirStatus=onAirObj.onAirStatus;if(_this.isDVR()){if(!onAirObj.onAirStatus){if(_this.shouldHandlePausedMonitor()){_this.removePausedMonitor();}}}});this.bind('durationChange',function(e,newDuration){if(_this.switchDone&&embedPlayer.isLive()&&_this.isDVR()&&embedPlayer.paused){embedPlayer.triggerHelper('timeupdate',[embedPlayer.getPlayerElementTime()]);embedPlayer.triggerHelper('updatePlayHeadPercent',[embedPlayer.getPlayerElementTime()/embedPlayer.duration]);}});this.bind('liveEventEnded',function(){if(embedPlayer.isLive()&&_this.isDVR()){embedPlayer.setLive(false);if(_this.getConfig('hideOfflineIndicators')){_this.isLiveChanged();}embedPlayer.bindHelper('liveOnline',function(){embedPlayer.setLive(true);});if(!_this.isNativeHLS()){embedPlayer.bindHelper('ended',function(){if(embedPlayer.getPlayerElement().seek){embedPlayer.getPlayerElement().seek(0);}});}}});this.bind('movingBackToLive',function(){if(_this.isDVR()&&_this.isNativeHLS()){_this.maxCurrentTime=0;}});},setOffAir:function(offlineAlertOffest){var _this=this;var embedPlayer=this.getPlayer();if(_this.offAirTimeout){clearTimeout(_this.offAirTimeout);_this.offAirTimeout=null;}_this.offAirTimeout=setTimeout(function(){if(!_this.onAirStatus){var secondOfflineAlertOffest=_this.calculateOfflineAlertOffest();if(secondOfflineAlertOffest>1000){_this.setOffAir(secondOfflineAlertOffest);}else{if(!embedPlayer.firstPlay&&_this.isDVR()){embedPlayer.triggerHelper('liveEventEnded');}else{_this.playWhenOnline=embedPlayer.isPlaying();if(_this.getConfig('showThumbnailWhenOffline')){_this.addPoster();}else{embedPlayer.layoutBuilder.displayAlert({title:embedPlayer.getKalturaMsg('ks-LIVE-STREAM-OFFLINE-TITLE'),message:embedPlayer.getKalturaMsg('ks-LIVE-STREAM-OFFLINE'),keepOverlay:true,noButtons:true,props:{customAlertTitleCssClass:"AlertTitleTransparent",customAlertMessageCssClass:"AlertMessageTransparent",customAlertContainerCssClass:"AlertContainerTransparent"}});}_this.getPlayer().disablePlayControls();}embedPlayer.triggerHelper('liveOffline');}}},offlineAlertOffest);},isLiveChanged:function(){var _this=this;var embedPlayer=this.getPlayer();var showComponentsArr=[];var hideComponentsArr=[];_this.maxCurrentTime=0;_this.liveStreamStatusUpdated=false;if(embedPlayer.isLive()){if(!this.getConfig("disableLiveCheck")){_this.removePoster();embedPlayer.disablePlayControls();}_this.addLiveStreamStatusMonitor();hideComponentsArr.push('sourceSelector');embedPlayer.addPlayerSpinner();_this.getLiveStreamStatusFromAPI(function(onAirStatus){if(!embedPlayer._checkHideSpinner){embedPlayer.hideSpinner();}});_this.switchDone=true;if(embedPlayer.sequenceProxy){_this.switchDone=false;}hideComponentsArr.push('durationLabel');if(_this.isDVR()&&!embedPlayer.casting){_this.dvrWindow=embedPlayer.evaluate('{mediaProxy.entry.dvrWindow}')*60;if(!_this.dvrWindow){_this.dvrWindow=_this.defaultDVRWindow;}showComponentsArr.push('scrubber');hideComponentsArr.push('currentTimeLabel');}else{showComponentsArr.push('liveStatus');hideComponentsArr.push('scrubber','currentTimeLabel');}if(_this.isNativeHLS()){_this.bind('timeupdate',function(){var curTime=embedPlayer.getPlayerElementTime();if(_this.isDVR()){if(curTime>_this.maxCurrentTime){_this.maxCurrentTime=curTime;embedPlayer.setDuration(_this.maxCurrentTime);}}});}if(_this.shouldHandlePausedMonitor()){_this.bind('playing',function(){if(_this.isDVR()&&_this.switchDone){_this.removePausedMonitor();}});}}else{embedPlayer.removePosterFlag=false;hideComponentsArr.push('liveStatus');showComponentsArr.push('scrubber','durationLabel','currentTimeLabel');if(!embedPlayer.isMobileSkin()){showComponentsArr.push('sourceSelector');}_this.removeLiveStreamStatusMonitor();_this.unbind('timeupdate');}embedPlayer.triggerHelper('onShowInterfaceComponents',[showComponentsArr]);embedPlayer.triggerHelper('onHideInterfaceComponents',[hideComponentsArr]);embedPlayer.doUpdateLayout();},isDVR:function(){return(this.getPlayer().isDVR()&&this.getPlayer().isTimeUpdateSupported());},getCurrentTime:function(){return this.getPlayer().getPlayerElement().currentTime;},removeMinDVRMonitor:function(){this.log("removeMinDVRMonitor");this.minDVRMonitor=clearInterval(this.minDVRMonitor);},addLiveStreamStatusMonitor:function(){if(this.embedPlayer.getError()){return;}this.log("addLiveStreamStatusMonitor");var _this=this;this.liveStreamStatusMonitor=setInterval(function(){_this.getLiveStreamStatusFromAPI();},_this.liveStreamStatusInterval*1000);},removeLiveStreamStatusMonitor:function(){this.log("removeLiveStreamStatusMonitor");this.liveStreamStatusMonitor=clearInterval(this.liveStreamStatusMonitor);},shouldHandlePausedMonitor:function(){if(this.isNativeHLS()){return true;}return false;},addPausedMonitor:function(){var _this=this;var embedPlayer=this.embedPlayer;var pauseTime=_this.maxCurrentTime;if(pauseTime==0){pauseTime=embedPlayer.getPlayerElementTime();}var pauseClockTime=Date.now();this.log("addPausedMonitor :   Monitor rate = "+mw.getConfig('EmbedPlayer.MonitorRate'));this.pausedMonitor=setInterval(function(){var timePassed=(Date.now()-pauseClockTime)/1000;embedPlayer.setDuration(pauseTime+timePassed);},1000);},removePausedMonitor:function(){this.log("removePausedMonitor");this.pausedMonitor=clearInterval(this.pausedMonitor);},getLiveStreamStatusFromAPI:function(callback){var _this=this;var embedPlayer=this.getPlayer();if(embedPlayer.getFlashvars('streamerType')=='rtmp'){if(callback){callback(_this.onAirStatus);}return;}if(this.getConfig("disableLiveCheck")){if(callback){callback(true);}embedPlayer.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':true});return;}var service='liveStream';if(embedPlayer.kalturaPlayerMetaData&&embedPlayer.kalturaPlayerMetaData.type==8){service='liveChannel';}var protocol='hls';if(embedPlayer.streamerType!='http'){protocol=embedPlayer.streamerType;}var requestObj={'service':service,'action':'islive','id':embedPlayer.kentryid,'protocol':protocol,'partnerId':embedPlayer.kpartnerid};if(mw.isIOSAbove7()){requestObj.rnd=Math.random();}_this.getKalturaClient().doRequest(requestObj,function(data){var onAirStatus=false;if(data===true){onAirStatus=true;}if(callback){callback(onAirStatus);}embedPlayer.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':onAirStatus});},mw.getConfig("SkipKSOnIsLiveRequest"),function(){mw.log("Error occur while trying to check onAir status");embedPlayer.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':false});});},getKalturaClient:function(){if(!this.kClient){this.kClient=mw.kApiGetPartnerClient(this.embedPlayer.kwidgetid);}return this.kClient;},log:function(msg){mw.log("LiveStream :: "+msg);},isNativeHLS:function(){if(mw.isIOS()||mw.isDesktopSafari()||mw.isAndroid()||mw.isEdge()){return true;}return false;},calculateOfflineAlertOffest:function(){var offlineAlertOffest=this.getConfig('offlineAlertOffest');var bufferLength=this.getPlayer().getCurrentBufferLength()*1000;if(bufferLength>0){offlineAlertOffest=bufferLength;}return offlineAlertOffest;}}));})(window.mw,window.jQuery);(function(mw,$){"use strict";mw.PluginManager.add('liveStatus',mw.KBaseComponent.extend({onAirStatus:false,defaultConfig:{'parent':'controlsContainer','order':22,'displayImportance':'high','showTooltip':true},offlineIconClass:'icon-off-air live-icon offline-icon not-clickable',onAirIconClass:'icon-on-air live-icon online-icon not-clickable',unsyncIConClass:'icon-off-air live-icon live-off-sync-icon',noThumbClass:'not-clickable',stringsReady:false,liveText:'',offlineText:'',tooltip:'',prevIconClass:undefined,bindPostfix:'.LiveStatus',setup:function(){this.prevIconClass=this.onAirIconClass;var _this=this;this.bind('playerReady',function(){if(!_this.stringsReady){_this.initStrings();_this.setLiveStreamStatus();}if(_this.getPlayer().isLive()){_this.addBindings();}});this.bind('onChangeMedia',function(){_this.removeBindings();});},initStrings:function(){this.liveText=gM('mwe-embedplayer-player-on-air');this.offlineText=gM('mwe-embedplayer-player-off-air');this.tooltip=gM('mwe-embedplayer-player-jump-to-live');this.stringsReady=true;},addBindings:function(){var _this=this;this.bind('liveStreamStatusUpdate'+_this.bindPostfix,function(e,onAirObj){if(onAirObj.onAirStatus!=_this.onAirStatus){_this.onAirStatus=onAirObj.onAirStatus;_this.setLiveStreamStatus();}});this.bind('movingBackToLive'+_this.bindPostfix,function(){if(_this.onAirStatus){_this.setLiveUI();_this.prevIconClass=_this.onAirIconClass;}});this.once('playing'+_this.bindPostfix,function(){_this.bind('seeked'+_this.bindPostfix+' seeking'+_this.bindPostfix+' onpause'+_this.bindPostfix+' onLiveOffSynchChanged'+_this.bindPostfix,function(e,param){if(!_this.getPlayer().goingBackToLive){if(e.type==='onLiveOffSynchChanged'&&param===false){_this.backToLive();}else{_this.getPlayer().setLiveOffSynch(true);if(_this.onAirStatus){_this.setOffSyncUI();}_this.prevIconClass=_this.unsyncIConClass;}}});});this.bind('onplay'+_this.bindPostfix,function(){if(!_this.getPlayer().isDVR()&&!_this.embedPlayer.changeMediaStarted){_this.getPlayer().setLiveOffSynch(false);}});},removeBindings:function(){this.unbind(this.bindPostfix);},getComponent:function(){var _this=this;if(!this.$el){var $btnText=$('<div />').addClass('back-to-live-text timers '+this.noThumbClass+this.getCssClass()).text(this.offlineText);var $icon=$('<div />').addClass('btn timers '+this.offlineIconClass+this.getCssClass()).click(function(){if(_this.onAirStatus&&_this.prevIconClass!==_this.onAirIconClass){_this.getPlayer().setLiveOffSynch(false);}else{_this.getPlayer().setLiveOffSynch(true);}});this.$el=$('<div />').addClass('back-to-live'+this.getCssClass()).append($icon,$btnText);}return this.$el;},backToLive:function(){if(this.getPlayer().firstPlay){this.getPlayer().play();}else{this.getPlayer().removePoster();this.getPlayer().backToLive();}},setOffSyncUI:function(){this.getComponent().find('.live-icon').removeClass(this.offlineIconClass+" "+this.onAirIconClass).addClass(this.unsyncIConClass);this.getComponent().find('.back-to-live-text').text(this.liveText);this.updateTooltip(this.tooltip);},setLiveUI:function(){this.getComponent().find('.live-icon').removeClass(this.offlineIconClass+" "+this.unsyncIConClass).addClass(this.onAirIconClass);this.getComponent().find('.back-to-live-text').text(this.liveText);this.updateTooltip("");},setLiveStreamStatus:function(){if(this.onAirStatus){if(this.prevIconClass==this.unsyncIConClass){this.setOffSyncUI();}else{this.setLiveUI();}}else{this.getComponent().find('.live-icon').removeClass(this.onAirIconClass+" "+this.unsyncIConClass).addClass(this.offlineIconClass);this.getComponent().find('.back-to-live-text').text(this.offlineText);this.updateTooltip("");}}}))})(window.mw,window.jQuery);;},{"all":".back-to-live{display:inline;border:none}.play_head_dvr .ui-slider-handle{width:10px;height:15px;margin-left:-5px;margin-top:-0px;z-index:2}.live-icon{font-size:0.7em !important;margin-left:10px !important;margin-right:2px !important}.online-icon{color:#FF0000 !important}.offline-icon{color:#A4A4A4 !important;background-color:transparent}.live-off-sync-icon{color:#FF0000 !important;background-color:transparent}.back-to-live-text{color:#FFFFFF !important;font-family:\"Arial Narrow\",Arial}.not-clickable{cursor:default !important}.not-clickable:hover{cursor:default !important;text-shadow:none !important}\n\n/* cache key: resourceloader:filter:minify-css:7:c191469df5135000b151d69f71208102 */\n"},{});mw.loader.implement("matchMedia",function($){window.matchMedia||(window.matchMedia=function(){"use strict";var styleMedia=(window.styleMedia||window.media);if(!styleMedia){var style=document.createElement('style'),script=document.getElementsByTagName('script')[0],info=null;style.type='text/css';style.id='matchmediajs-test';script.parentNode.insertBefore(style,script);info=('getComputedStyle'in window)&&window.getComputedStyle(style)||style.currentStyle;styleMedia={matchMedium:function(media){var text='@media '+media+'{ #matchmediajs-test { width: 1px; } }';if(style.styleSheet){style.styleSheet.cssText=text;}else{style.textContent=text;}return info.width==='1px';}};}return function(media){return{matches:styleMedia.matchMedium(media||'all'),media:media||'all'};};}());;},{},{});mw.loader.implement("morePlugins",function($){(function(mw,$){"use strict";mw.PluginManager.add('morePlugins',mw.KBaseSmartContainer.extend({defaultConfig:{'parent':'topBarContainer','order':1,'showTooltip':true,"displayImportance":"high","align":"right","cssClass":"icon-more"},title:gM('mwe-embedplayer-more')}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("nativeBridge",function($){(function(mw,$){"use strict";var NativeBridge={callbacksCount:1,callbacks:{},resultForCallback:function resultForCallback(callbackId,resultArray){try{var callback=NativeBridge.callbacks[callbackId];if(!callback){return;}callback.apply(null,resultArray);}catch(e){alert(e);}},call:function call(functionName,args,callback){var hasCallback=callback&&typeof callback=="function";var callbackId=hasCallback?NativeBridge.callbacksCount++:0;if(hasCallback){NativeBridge.callbacks[callbackId]=callback;}var iframe=document.createElement("IFRAME");iframe.setAttribute("src","js-frame:"+functionName+":"+callbackId+":"+encodeURIComponent(JSON.stringify(args)));document.documentElement.appendChild(iframe);iframe.parentNode.removeChild(iframe);iframe=null;}};NativeBridge.videoPlayer=NativeBridge.videoPlayer||{proxyElement:null,embedPlayer:null,isJsCallbackReady:false,bindPostfix:".nativeBridge",subscribed:[],playerMethods:['stop','play','pause','replay','setPlayerSource','bindPlayerEvents','showNativePlayer','hideNativePlayer','toggleFullscreen','notifyKPlayerEvent','notifyKPlayerEvaluated','notifyJsReady','showChromecastDeviceList','sendCCRecieverMessage','notifyLayoutReady','doneFSBtnPressed','addNativeAirPlayButton','showNativeAirPlayButton','hideNativeAirPlayButton','doNativeAction','textTracksReceived','loadEmbeddedCaptions','flavorsListChanged','switchFlavor','togglePictureInPicture'],registerPlayer:function(proxyElement){var _this=this;this.proxyElement=proxyElement;this.proxyElement.attr=function(attributeName,attributeValue){if(attributeName&&attributeValue===undefined){return _this.proxyElement[attributeName];}else if(attributeName&&attributeValue){_this.proxyElement[attributeName]=attributeValue;_this.execute('setAttribute',[attributeName,attributeValue]);_this.proxyElement['language']=mw.getConfig('localizationCode');_this.execute('setAttribute',['language',mw.getConfig('localizationCode')]);}}
for(var i=0;i<this.playerMethods.length;i++){(function(method){_this.proxyElement[method]=function(arg){_this.execute(method,arg);}})(this.playerMethods[i]);}this.proxyElement.subscribe=function(callback,eventName){_this.subscribed[eventName]=callback;}
this.proxyElement.unsubscribe=function(eventName){_this.subscribed[eventName]=undefined;}
this.bindNativeEvents();},notifyErrorOccurred:function(errObj){var errMsg=errObj!=null?errObj.title+", "+errObj.message:"error undefined";NativeBridge.videoPlayer.execute('setAttribute',["playerError",errMsg]);},notifyJsReadyFunc:function(){if(this.isJsCallbackReady&&this.proxyElement){this.proxyElement.notifyJsReady([]);}},registerEmbedPlayer:function(embedPlayer){var _this=this;this.embedPlayer=embedPlayer;$(this.embedPlayer).unbind("playerError").bind("playerError",function(e,errObj){_this.notifyErrorOccurred(errObj);});this.notifyJsReadyFunc();},sendNotification:function(eventName,eventValue){this.embedPlayer.sendNotification(eventName,eventValue);},getObjectString:function(object){var stringValue=object;if(typeof object==="object"){stringValue=JSON.stringify(object);}return stringValue;},addJsListener:function(eventName){var _this=this;this.embedPlayer.addJsListener(eventName+this.bindPostfix,function(val){_this.embedPlayer.getPlayerElement().notifyKPlayerEvent([eventName,_this.getObjectString(val)]);});},removeJsListener:function(eventName){this.embedPlayer.removeJsListener(eventName+this.bindPostfix);},setKDPAttribute:function(host,prop,value){this.embedPlayer.setKDPAttribute(host,prop,value);},asyncEvaluate:function(expression,callbackName){var result=this.embedPlayer.evaluate(expression);this.embedPlayer.getPlayerElement().notifyKPlayerEvaluated([callbackName,this.getObjectString(result)]);},trigger:function(eventName,eventValue){if(eventValue==="(null)"){eventValue=void(0);}var jsEventValue;if(eventValue!=undefined){jsEventValue=this.stringConvertion(eventValue);}if(eventName=='timeupdate'){this.proxyElement['currentTime']=jsEventValue;}else if(eventName=='progress'){this.proxyElement['progress']=jsEventValue;}else if(eventName=='visible'){this.proxyElement['visible']=jsEventValue;}else if(eventName=='durationchange'){this.proxyElement['duration']=jsEventValue;}else if(eventName=='nativeAction'){this.proxyElement['nativeAction']=jsEventValue;}else if(eventName=='play'){this.proxyElement['paused']=false;}else if(eventName=='pause'){this.proxyElement['paused']=true;}$(this.proxyElement).triggerHandler(eventName,[jsEventValue]);if(this.subscribed[eventName]){this.subscribed[eventName](jsEventValue);}},execute:function(command,args){args=args||[];console.log(command);console.log(args);NativeBridge.call(command,args);},bindNativeEvents:function(){console.log('bindNativeEvents');this.proxyElement.bindPlayerEvents([]);},log:function(message,arg){console.log(message,arg);},getVideoHolderHeight:function(){return this.embedPlayer.getVideoHolder().height();},getControlBarHeight:function(){return this.embedPlayer.getControlBarContainer().height();},stringConvertion:function(str){var value=parseFloat(str);if(isNaN(value)){if(value=='true'){return true;}else if(value=='false'){return false;}else{return str;}}return value;}};if(mw.getConfig('EmbedPlayer.ForceNativeComponent')===true){window["NativeBridge"]=NativeBridge;$(".mwPlayerContainer").one("playerError",function(e,errObj){NativeBridge.videoPlayer.notifyErrorOccurred(errObj);});kWidget.addReadyCallback(function(){NativeBridge.videoPlayer.isJsCallbackReady=true;NativeBridge.videoPlayer.notifyJsReadyFunc();});}})(window.mw,window.jQuery);;},{},{});mw.loader.implement("playPauseBtn",function($){(function(mw,$){"use strict";mw.PluginManager.add('playPauseBtn',mw.KBaseComponent.extend({defaultConfig:{'parent':'controlsContainer','order':1,'showTooltip':true,"displayImportance":"high"},isDisabled:false,playIconClass:'icon-play',pauseIconClass:'icon-pause',replayIconClass:'icon-replay',playTitle:gM('mwe-embedplayer-play_clip'),pauseTitle:gM('mwe-embedplayer-pause_clip'),replayTitle:gM('mwe-embedplayer-replay'),setup:function(embedPlayer){this.addBindings();},isSafeEnviornment:function(){return!this.embedPlayer.isMobileSkin();},getComponent:function(){var _this=this;if(!this.$el){this.$el=$('<button />').attr('title',this.playTitle).addClass("btn icon-play"+this.getCssClass()).click(function(){_this.togglePlayback();});}return this.$el;},addBindings:function(){var _this=this;this.bind('onPlayerStateChange',function(e,newState,oldState){_this.updateUI(newState,oldState);});this.bind('onOpenFullScreen',function(){try{_this.getComponent().focus();}catch(e){}});},updateUI:function(newState,oldState){var removeIconClasses=this.playIconClass+' '+this.pauseIconClass+' '+this.replayIconClass;var newIconClass=null;var title=null;var ignoreChange=false;switch(newState){case'play':title=this.pauseTitle;newIconClass=this.pauseIconClass;break;case'start':title=this.playTitle;newIconClass=this.playIconClass;break;case'pause':if(oldState&&oldState!='end'){title=this.playTitle;newIconClass=this.playIconClass;}else{ignoreChange=true;}break;case'end':title=this.replayTitle;newIconClass=this.replayIconClass;break;default:ignoreChange=true;break;}if(ignoreChange){return;}else{ignoreChange=false;this.updateTooltip(title);this.setAccessibility(this.$el,title);this.getComponent().removeClass(removeIconClasses).addClass(newIconClass);}},togglePlayback:function(){if(this.isDisabled)return;var notificationName=(this.getPlayer().isPlaying())?'doPause':'doPlay';this.getPlayer().sendNotification(notificationName,{'userInitiated':true});}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("playbackRateSelectorPlugin",function($){(function(mw,$){"use strict";mw.PluginManager.add('playbackRateSelector',mw.KBaseComponent.extend({defaultConfig:{"parent":"controlsContainer","order":61,"displayImportance":"medium","align":"right","showTooltip":true,'defaultSpeed':'1','speeds':".5,.75,1,1.5,2",'enableKeyboardShortcuts':true,'serverSpeedPlayback':false,'title':gM('mwe-embedplayer-speed'),'smartContainer':'qualitySettings','smartContainerCloseEvent':'updatedPlaybackRate'},isDisabled:false,currentSpeed:1,manifestSource:null,isSafeEnviornment:function(){var _this=this,deferred=$.Deferred();if(mw.isMobileDevice()&&!this.getConfig("serverSpeedPlayback")){return false;}this.bind('playerReady',function(){if(_this.getConfig("serverSpeedPlayback")===true&&_this.manifestSource){deferred.resolve(true);}if(_this.embedPlayer.isLive()){deferred.resolve(false);}if(_this.embedPlayer.mediaElement.getNativePlayableSources().length>0){deferred.resolve(document.createElement("video").playbackRate&&!mw.isMobileDevice());}});return deferred.promise();},setup:function(){this.currentSpeed=Math.abs(this.getConfig('defaultSpeed'))||1;this.speedSet=this.getConfig('speeds').split(',');var i;for(i=0;i<this.speedSet.length;i++){this.speedSet[i]=Math.abs(this.speedSet[i]);}this.addBindings();},addBindings:function(){var _this=this;this.bind('playerReady',function(){_this.buildMenu();});this.bind('onChangeMedia',function(){_this.currentSpeed=1;if(!_this.embedPlayer.isMobileSkin()){_this.getBtn().text('1x');}_this.buildMenu();_this.manifestSource=null;});this.bind('SourceSelected',function(e,source){if(source.src.indexOf("playManifest")!==-1&&(source.src.indexOf("/a.f4m")!==-1||source.src.indexOf("/a.m3u8")!==-1)){_this.manifestSource=source.src;}});this.bind('onRemovePlayerSpinner',function(){if(_this.getPlayer().getPlayerElement()&&!_this.getConfig("serverSpeedPlayback")){if(_this.getPlayer().instanceOf==='Native'){_this.getPlayer().getPlayerElement().playbackRate=_this.currentSpeed;}if(_this.getPlayer().instanceOf==='MultiDRM'){_this.getPlayer().getPlayerElement().setPlaybackRate(_this.currentSpeed);}}});this.bind('playbackRateChangeSpeed',function(e,arg){_this.setSpeedFromApi(arg);});this.bind('onDisableInterfaceComponents',function(e,arg){_this.getMenu().close();});if(this.getConfig('enableKeyboardShortcuts')){this.bind('addKeyBindCallback',function(e,addKeyCallback){_this.addKeyboardShortcuts(addKeyCallback);});}},setSpeedFromApi:function(arg){var newSpeed;switch(arg){case'faster':newSpeed=this.getFasterSpeed();break;case'fastest':newSpeed=this.speedSet[this.speedSet.length-1];break;case'slower':newSpeed=this.getSlowerSpeed();break;case'slowest':newSpeed=this.speedSet[0];break;default:newSpeed=arg;break}this.setSpeed(newSpeed);},addKeyboardShortcuts:function(addKeyCallback){var _this=this;addKeyCallback('shift+187',function(){_this.setSpeed(_this.getFasterSpeed());});addKeyCallback(189,function(){_this.setSpeed(_this.getSlowerSpeed());});addKeyCallback(187,function(){_this.setSpeed(_this.getConfig('defaultSpeed'));});},getFasterSpeed:function(){if(this.speedSet[this.getCurrentSpeedIndex()+1]){return this.speedSet[this.getCurrentSpeedIndex()+1];}return this.speedSet[this.getCurrentSpeedIndex()];},getSlowerSpeed:function(){if(this.speedSet[this.getCurrentSpeedIndex()-1]){return this.speedSet[this.getCurrentSpeedIndex()-1];}return this.speedSet[this.getCurrentSpeedIndex()];},buildMenu:function(){var _this=this;this.getMenu().destroy();$.each(this.speedSet,function(idx,speedFloat){var active=(_this.currentSpeed==speedFloat);_this.getMenu().addItem({'label':speedFloat+'x','callback':function(){_this.setSpeed(speedFloat);},'active':active});if(_this.embedPlayer.isMobileSkin()&&active){_this.getMenu().setActive(idx);}});},setSpeed:function(newSpeed){var _this=this;this.log('Set Speed to: '+newSpeed);var previousSpeed=this.currentSpeed;this.currentSpeed=newSpeed;if((this.getPlayer().instanceOf!='Native'&&this.getPlayer().instanceOf!='MultiDRM')||(mw.isMobileDevice()&&this.getConfig("serverSpeedPlayback")&&this.manifestSource)){this.handlePlayerInstanceUpdate(newSpeed,previousSpeed);return;}this.updatePlaybackRate(newSpeed);},handlePlayerInstanceUpdate:function(newSpeed,previousSpeed){var _this=this;var currentPlayTime=this.getPlayer().currentTime;this.currentSpeed=newSpeed;if(this.getConfig("serverSpeedPlayback")&&this.currentSpeed<=2&&(this.getPlayer().instanceOf==='Kplayer'||mw.isMobileDevice())){this.switchServerSideSpeed(newSpeed,previousSpeed,currentPlayTime);}else{this.switchClientSideSpeed(newSpeed,previousSpeed,currentPlayTime);}},switchServerSideSpeed:function(newSpeed,previousSpeed,currentPlayTime){this.log('Set Speed on the server side to: '+newSpeed);var _this=this;if(this.currentSpeed%1!==0){this.currentSpeed=this.currentSpeed.toFixed(1);}var source=this.manifestSource;if(this.manifestSource){currentPlayTime=currentPlayTime*previousSpeed/this.currentSpeed;}var fileName=source.substr(source.lastIndexOf("/"));var base=source.substr(0,source.lastIndexOf("/"));if(fileName.indexOf("/a.f4m")===0){base=base.substr(0,base.length-3);}if(source.indexOf("playbackRate")!==-1){base=base.substr(0,base.lastIndexOf("playbackRate")-1);}var newSrc=base+"/playbackRate/"+this.currentSpeed+fileName;this.updatePlaybackRate(newSpeed);if(mw.isMobileDevice()){this.getPlayer().getPlayerElement().src=newSrc;this.getPlayer().mediaElement.selectedSource.src=newSrc;if(mw.isIOS()){this.getPlayer().getPlayerElement().load();}}else{this.embedPlayer.playerObject.sendNotification("changeMedia",{"entryUrl":newSrc});this.embedPlayer.play();}if(currentPlayTime>0){this.embedPlayer.stopMonitor();$(this.embedPlayer).bind("playing",function(){$(_this.embedPlayer).unbind("playing");setTimeout(function(){if(mw.isIOS()){_this.getPlayer().getPlayerElement().currentTime=currentPlayTime;}else{_this.embedPlayer.seek(currentPlayTime);}_this.embedPlayer.startMonitor();},0);});}},switchClientSideSpeed:function(newSpeed,previousSpeed,currentPlayTime){this.log('Set Speed on the client side to: '+newSpeed);var _this=this;var nativeSources=[];var playableSources=this.getPlayer().mediaElement.getPlayableSources();$.each(playableSources,function(i,source){if(source.mimeType=='video/mp4'||source.mimeType=='video/h264'){nativeSources.push(source);}});var options=nativeSources.length?{'sources':nativeSources}:{};var source=this.getPlayer().mediaElement.autoSelectSource(options);var player=mw.EmbedTypes.getMediaPlayers().getNativePlayer(source.mimeType);this.getPlayer().selectPlayer(player);this.getPlayer().updatePlaybackInterface(function(){if(currentPlayTime==0){_this.updatePlaybackRate(newSpeed);}else{setTimeout(function(){_this.bind("seeked",function(){_this.updatePlaybackRate(newSpeed);_this.unbind("seeked");});_this.getPlayer().seek(currentPlayTime);},200);}});},updatePlaybackRate:function(newSpeed){if(this.getPlayer().mediaLoadedFlag){if(this.getPlayer().instanceOf==='Native'){this.getPlayer().getPlayerElement().playbackRate=newSpeed;}if(this.getPlayer().instanceOf==='MultiDRM'){this.getPlayer().getPlayerElement().setPlaybackRate(newSpeed);}}if(!this.embedPlayer.isMobileSkin()){this.getBtn().text(newSpeed+'x');}this.getPlayer().triggerHelper('updatedPlaybackRate',newSpeed);},getCurrentSpeedIndex:function(){var _this=this;var index=null;$.each(this.speedSet,function(idx,speed){if(_this.currentSpeed==speed){index=idx;return true;}});return index;},toggleMenu:function(){if(this.isDisabled){return;}this.getMenu().toggle();},getComponent:function(){var _this=this;if(!this.$el){var $menu=$('<ul />');var text=this.embedPlayer.isMobileSkin()?'':this.currentSpeed+'x';var classes=this.embedPlayer.isMobileSkin()?'btn icon-speedrate':'btn';var $button=$('<button />').addClass(classes).attr('title',this.getConfig('title')).text(text).click(function(e){_this.toggleMenu();});this.$el=$('<div />').addClass('dropup'+this.getCssClass()).append($button,$menu);}return this.$el;},getMenu:function(){if(!this.menu){this.menu=new mw.KMenu(this.getComponent().find('ul'),{tabIndex:this.getBtn().attr('tabindex')});}return this.menu;},getBtn:function(){return this.getComponent().find('button');},onEnable:function(){this.isDisabled=false;this.getBtn().removeClass('disabled');},onDisable:function(){this.isDisabled=true;this.getComponent().removeClass('open');this.getBtn().addClass('disabled');}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("polyfill_Array_filter",function($){if(!Array.prototype.filter){Array.prototype.filter=function(fun){'use strict';if(this===void 0||this===null){throw new TypeError();}var t=Object(this);var len=t.length>>>0;if(typeof fun!=='function'){throw new TypeError();}var res=[];var thisArg=arguments.length>=2?arguments[1]:void 0;for(var i=0;i<len;i++){if(i in t){var val=t[i];if(fun.call(thisArg,val,i,t)){res.push(val);}}}return res;};};},{},{});mw.loader.implement("polyfill_Array_forEach",function($){if(!Array.prototype.forEach){Array.prototype.forEach=function(callback,thisArg){var T,k;if(this==null){throw new TypeError(' this is null or not defined');}var O=Object(this);var len=O.length>>>0;if(typeof callback!=="function"){throw new TypeError(callback+' is not a function');}if(arguments.length>1){T=thisArg;}k=0;while(k<len){var kValue;if(k in O){kValue=O[k];callback.call(T,kValue,k,O);}k++;}};};},{},{});mw.loader.implement("qualitySettings",function($){(function(mw,$){"use strict";mw.PluginManager.add('qualitySettings',mw.KBaseSmartContainer.extend({defaultConfig:{'parent':'topBarContainer','order':2,'showTooltip':true,"displayImportance":"high","align":"right","cssClass":"icon-cog"},title:gM('mwe-embedplayer-quality_settings'),registeredPlugins:[],shouldResumePlay:false,pluginsScreenOpened:false,isDisabled:false}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("reportError",function($){(function(mw,$){"use strict";mw.PluginManager.add('reportError',mw.KBasePlugin.extend({kClient:null,didSeek:false,setup:function(){var _this=this;var embedPlayer=this.getPlayer();this.kClient=mw.kApiGetPartnerClient(embedPlayer.kwidgetid);this.bind('playerReady',function(){_this.didSeek=false;});this.bind('seeking',function(){_this.didSeek=true;});this.bind('embedPlayerError',function(e,data){var resourceUrl=undefined;if(embedPlayer.mediaElement&&embedPlayer.mediaElement.selectedSource){resourceUrl=embedPlayer.mediaElement.selectedSource.getSrc();}var currentTime=$.isFunction(embedPlayer.getPlayerElement().currentTime)?embedPlayer.getPlayerElement().currentTime():embedPlayer.getPlayerElement().currentTime;var msgParams=[];msgParams['pid']=embedPlayer.kpartnerid;msgParams['uiconfId']=embedPlayer.kuiconfid;msgParams['referrer']=window.kWidgetSupport.getHostPageUrl();msgParams['didSeek']=_this.didSeek;msgParams['resourceUrl']=resourceUrl;msgParams['userAgent']=navigator.userAgent;msgParams['playerCurrentTime']=currentTime;msgParams['playerLib']=embedPlayer.selectedPlayer.library;msgParams['streamerType']=embedPlayer.streamerType;if(data){for(var param in data){msgParams[param]=data[param];}}var errorMessage="";for(var i in msgParams){errorMessage+=i+' : '+msgParams[i]+" | ";}var eventRequest={'service':'stats','action':'reportError',errorCode:'mediaError'};eventRequest['errorMessage']=errorMessage;_this.kClient.doRequest(eventRequest);});}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("screenfull",function($){(function(window,document){'use strict';var keyboardAllowed=typeof Element!=='undefined'&&'ALLOW_KEYBOARD_INPUT'in Element,fn=(function(){var val,valLength;var fnMap=[['requestFullscreen','exitFullscreen','fullscreenElement','fullscreenEnabled','fullscreenchange','fullscreenerror'],['webkitRequestFullscreen','webkitExitFullscreen','webkitFullscreenElement','webkitFullscreenEnabled','webkitfullscreenchange','webkitfullscreenerror'],['webkitRequestFullScreen','webkitCancelFullScreen','webkitCurrentFullScreenElement','webkitCancelFullScreen','webkitfullscreenchange','webkitfullscreenerror'],['mozRequestFullScreen','mozCancelFullScreen','mozFullScreenElement','mozFullScreenEnabled','mozfullscreenchange','mozfullscreenerror'],['msRequestFullscreen','msExitFullscreen','msFullscreenElement','msFullscreenEnabled','MSFullscreenChange','MSFullscreenError']];var i=0;var l=fnMap.length;var ret={};for(;i<l;i++){val=fnMap[i];if(val&&val[1]in document){for(i=0,valLength=val.length;i<valLength;i++){ret[fnMap[0][i]]=val[i];}return ret;}}return false;})(),screenfull={request:function(elem,context){var request=fn.requestFullscreen;context=context||document;elem=elem||context.documentElement;if(/5\.1[\.\d]* Safari/.test(navigator.userAgent)){elem[request]();}else{elem[request](keyboardAllowed&&Element.ALLOW_KEYBOARD_INPUT);}},exit:function(context){context=context||document;context[fn.exitFullscreen]();},toggle:function(elem){if(this.isFullscreen){this.exit();}else{this.request(elem);}},isFullscreen:function(context){context=context||document;return!!context[fn.fullscreenElement];},element:function(context){context=context||document;return context[fn.fullscreenElement];},enabled:function(context){context=context||document;return!!context[fn.fullscreenEnabled];},onchange:function(){},onerror:function(){},raw:fn};if(!fn){window.screenfull=false;return;}document.addEventListener(fn.fullscreenchange,function(e){screenfull.onchange.call(screenfull,e);});document.addEventListener(fn.fullscreenerror,function(e){screenfull.onerror.call(screenfull,e);});window.screenfull=screenfull;})(window,document);;},{},{});mw.loader.implement("scrubber",function($){(function(mw,$,kWidget){"use strict";mw.PluginManager.add('scrubber',mw.KBaseComponent.extend({defaultConfig:{'parent':'controlBarContainer','insertMode':'firstChild','order':25,'sliderPreview':true,'thumbSlices':100,'thumbWidth':100,'minWidth':100,'displayImportance':"medium",'disableUntilFirstPlay':false,'showOnlyTime':false,'thumbSlicesUrl':null},waitForFirstPlay:false,updateEnabled:true,liveEdge:98,isSliderPreviewEnabled:function(){return this.getConfig("sliderPreview")&&!this.isDisabled;},setup:function(embedPlayer){if(this.embedPlayer.isMobileSkin()){this.setConfig('parent','controlsContainer');this.setConfig('showOnlyTime',true);}if(this.getConfig('parent')=='controlsContainer'){this.setConfig('insertMode','lastChild');}if(this.embedPlayer.isDVR()){this.setConfig('showOnlyTime',true);}this.addBindings();if(this.isSliderPreviewEnabled()){this.setupThumbPreview();}},addBindings:function(){var _this=this;this.bind('durationChange',function(event,duration){_this.duration=duration;});this.bind('seeked',function(){_this.justSeeked=true;});if(this.getConfig('parent')=='controlsContainer'){this.bind('updateComponentsVisibilityStart',function(){_this.getComponent().css('width',_this.getConfig('minWidth'));});this.bind('updateComponentsVisibilityDone',function(){var $container=_this.getComponent().parent();var compSize=_this.embedPlayer.layoutBuilder.getComponentsWidthForContainer($container)-_this.getComponent().width();var targetSize=$container.width()-compSize;if(targetSize<_this.getConfig('minWidth')){targetSize=_this.getConfig('minWidth');}_this.getComponent().css('width',(targetSize)+'px');});}this.bind('updateBufferPercent',function(e,bufferedPercent){_this.updateBufferUI(bufferedPercent);});this.bindUpdatePlayheadPercent();this.bind('externalUpdatePlayHeadPercent',function(e,perc){_this.updatePlayheadPercentUI(perc);});this.bind('detachTimeUpdate',function(){_this.unbind('updatePlayHeadPercent');});this.bind('reattachTimeUpdate',function(){_this.bindUpdatePlayheadPercent();});this.bind('onOpenFullScreen',function(){if(mw.isIE11()&&(mw.getConfig('EmbedPlayer.IsIframeServer')||mw.getConfig('EmbedPlayer.IsFriendlyIframe'))){window["resizeScrubberIE11"]=true;}});this.bind('onCloseFullScreen',function(){if(window["resizeScrubberIE11"]===true)window["resizeScrubberIE11"]=null;});this.bind('playerReady',function(event){if(_this.getConfig("sliderPreview")){_this.thumbnailsLoaded=_this.loadedThumb=false;setTimeout(function(){_this.loadThumbnails(function(){_this.thumbnailsLoaded=true;});},1000);}if(_this.getConfig('disableUntilFirstPlay')){_this.waitForFirstPlay=true;_this.onDisable();}});if(this.getConfig('disableUntilFirstPlay')){this.waitForFirstPlay=true;this.bind('firstPlay',function(){_this.waitForFirstPlay=false;_this.onEnable();});}this.bind("freezeTimeIndicators",function(e,state){if(state===true){_this.updateEnabled=false;}else{_this.updateEnabled=true;}});this.bind("onPlayerStateChange",function(e,newState,oldState){if(newState==='pause'){_this.paused=true;}});},bindUpdatePlayheadPercent:function(){var _this=this;this.bind('updatePlayHeadPercent',function(e,perc){_this.updatePlayheadPercentUI(perc);});},updatePlayheadPercentUI:function(perc){if(this.updateEnabled){var val=parseInt(perc*1000);this.updatePlayheadUI(val);}},updateBufferUI:function(percent){this.getComponent().find('.buffered').css({"width":(parseInt(percent*100))+'%'});},updatePlayheadUI:function(val){if(this.getPlayer().isPlaying()&&!this.paused&&this.embedPlayer.isDVR()){this.checkForLiveEdge();if(!this.getPlayer().isLiveOffSynch()){this.getComponent().slider('option','value',999);return;}}if(this.embedPlayer.isDVR()){if(this.duration<1800){var relativeEdge=this.calculateRelativeLiveEdge(val);if(!relativeEdge){this.getComponent().slider('option','value',val);}}}else{this.getComponent().slider('option','value',val);}if(this.paused&&this.getPlayer().isPlaying()){this.paused=false;}},checkForLiveEdge:function(){if(this.justSeeked){this.justSeeked=false;return;}var playHeadPercent=(this.getPlayHeadComponent().position().left+this.getPlayHeadComponent().width()/2)/this.getComponent().width();playHeadPercent=parseInt(playHeadPercent*100);if(this.getPlayer().isLiveOffSynch()&&playHeadPercent>=this.liveEdge){this.getPlayer().setLiveOffSynch(false);}},calculateRelativeLiveEdge:function(val){if(this.duration<50){return val>700;}if(this.duration<100){return val>800;}if(this.duration<200){return val>850;}if(this.duration<500){return val>900;}if(this.duration<900){return val>950;}if(this.duration<1200){return val>970;}if(this.duration<1400){return val>980;}if(this.duration<1650){return val>990;}},setupThumbPreview:function(){var _this=this;this.thumbnailsLoaded=false;this.getComponent().on({'mousemove touchmove touchstart':function(e){if(e.toElement&&e.toElement.className.indexOf("sliderPreview")>-1){_this.hideThumbnailPreview();return;}var $this=$(this);var width=$this.width();var offset=$this.offset();var options=$this.slider('option');var value=Math.round(((e.clientX-offset.left)/width)*(options.max-options.min))+options.min;_this.showThumbnailPreview({offset:offset,x:e.clientX-offset.left,val:value,width:width});},'mouseleave touchend':function(){_this.hideThumbnailPreview();}}).append($("<div/>").hide().addClass("sliderPreview").append($("<div/>").addClass("arrow")).append($("<span/>").addClass("sliderPreviewTime")));},onEnable:function(){if(this.waitForFirstPlay)return;this.isDisabled=false;this.getComponent().removeClass('disabled');this.getComponent().slider("option","disabled",false);},onDisable:function(){if(this.isDisabled)return;this.isDisabled=true;this.getComponent().slider("option","disabled",true);this.getComponent().addClass('disabled');},getSliceCount:function(duration){return this.getConfig("thumbSlices")||100;},loadThumbnails:function(callback){var _this=this;if(this.embedPlayer.isLive()||this.getConfig("showOnlyTime")){this.loadedThumb=true;}if(!this.loadedThumb){this.loadedThumb=true;var img=new Image();img.onload=function(){callback();};img.src=this.getThumbSlicesUrl();}else{callback();}},getThumbSlicesUrl:function(){if(this.getConfig('thumbSlicesUrl')){return this.getConfig('thumbSlicesUrl');}var thumbReq={'partner_id':this.embedPlayer.kpartnerid,'uiconf_id':this.embedPlayer.kuiconfid,'entry_id':this.embedPlayer.kentryid,'width':this.getConfig("thumbWidth"),'vid_slices':this.getSliceCount(this.duration)}
if(this.getPlayer().getFlashvars('loadThumbnailWithKs')){thumbReq['ks']=this.getPlayer().getFlashvars('ks');}return kWidget.getKalturaThumbUrl(thumbReq);},showThumbnailPreview:function(data){var showOnlyTime=this.getConfig("showOnlyTime");if(!this.isSliderPreviewEnabled()||!this.thumbnailsLoaded){return;}if(!(data.val>=0&&this.duration>=0)){return;}var $slider=$(".scrubber");if(!$slider.length){this.log('.scrubber class not in DOM');return;}var $sliderPreview=this.getComponent().find(".sliderPreview");var $sliderPreviewTime=this.getComponent().find(".sliderPreview .sliderPreviewTime");var sliderTop=0;var sliderLeft=0;var previewWidth=$sliderPreview.width();var previewHeight=$sliderPreview.height();var top=$(".scrubber").position().top-previewHeight-10;if(this.embedPlayer.isMobileSkin()){top-=25;}if(!showOnlyTime){sliderLeft=data.x-previewWidth/2;if((data.x+data.offset.left)<previewWidth/2){sliderLeft=0;}if(data.x>data.offset.left+data.width-previewWidth/2){sliderLeft=data.offset.left+data.width-previewWidth;}}else{sliderLeft=data.x-$sliderPreviewTime.width()/2;previewWidth=$sliderPreviewTime.width();if((data.x+data.offset.left)<$sliderPreviewTime.width()/2){sliderLeft=0;}if(data.x>data.offset.left+data.width-$sliderPreviewTime.width()/2){sliderLeft=data.offset.left+data.width-$sliderPreviewTime.width()-5;}$(".arrow").hide();}var perc=data.val/1000;perc=perc>1?1:perc;var currentTime=Math.floor(this.duration*perc);var thumbWidth=showOnlyTime?$sliderPreviewTime.width():this.getConfig("thumbWidth");$sliderPreview.css({top:top,left:sliderLeft});if(!showOnlyTime){$sliderPreview.css({'background-image':'url(\''+this.getThumbSlicesUrl()+'\')','background-position':kWidget.getThumbSpriteOffset(thumbWidth,currentTime,this.duration,this.getSliceCount(this.duration)),'background-size':(thumbWidth*this.getSliceCount(this.duration))+'px 100%'});}else{$sliderPreview.css("border","0px");}$(".scrubber .arrow").css("left",thumbWidth/2-4);var timeText;if(this.embedPlayer.isDVR()){if(this.getPlayer().isLiveOffSynch()&&parseInt(perc*100)>this.liveEdge){timeText='LIVE';}else{timeText="-"+kWidget.seconds2npt(this.duration-currentTime);}}else{timeText=kWidget.seconds2npt(currentTime);}$sliderPreviewTime.text(timeText);$sliderPreviewTime.css({bottom:2,left:thumbWidth/2-$sliderPreviewTime.width()/2+3});$sliderPreview.css("width",thumbWidth);if(kWidget.isIE8()){$sliderPreview.css("height",43);}if($sliderPreview.width()>0){$sliderPreview.css("visibility","visible");}else{$sliderPreview.css("visibility","hidden");}$sliderPreview.show();},hideThumbnailPreview:function(){this.getComponent().find(".sliderPreview").hide();},getSliderConfig:function(){var _this=this;var embedPlayer=this.getPlayer();var alreadyChanged=false;return{range:"min",value:0,min:0,max:1000,animate:mw.getConfig('EmbedPlayer.MonitorRate')-(mw.getConfig('EmbedPlayer.MonitorRate')/30),start:function(event,ui){embedPlayer.userSlide=true;$(_this.getPlayer()).one('hidePlayerControls onFocusOutOfIframe',function(){$(document).trigger('mouseup');});},slide:function(event,ui){_this.updateAttr(ui);},change:function(event,ui){alreadyChanged=true;var seekTime=(ui.value/1000)*embedPlayer.getDuration();_this.updateAttr(ui);if(embedPlayer.userSlide){embedPlayer.userSlide=false;embedPlayer.seeking=true;embedPlayer.triggerHelper("userInitiatedSeek",seekTime);embedPlayer.seek(seekTime);}}};},updateAttr:function(ui){var perc=ui.value/1000;var $slider=this.$el.find('.ui-slider-handle');var title=mw.seconds2npt(perc*this.embedPlayer.getDuration());var attributes={'data-title':title,'aria-valuetext':mw.seconds2npt(perc*this.embedPlayer.getDuration()),'aria-valuenow':parseInt(perc*100)+'%'};$slider.attr(attributes);if(this.getConfig('accessibilityLabels')){$slider.html('<span class="accessibilityLabel">'+title+'</span>');}},getPlayHeadComponent:function(){return this.getComponent().find('.playHead');},getComponent:function(){var _this=this;if(!this.$el){this.$el=$('<div />').attr({'role':'slider'}).addClass(this.getCssClass()+" scrubber").slider(this.getSliderConfig());this.$el.find('.ui-slider-handle').addClass('playHead PIE btn').wrap('<div class="handle-wrapper" />');this.updateAttr({'value':0});this.$el.find('.ui-slider-range-min').addClass('watched');this.$el.append($('<div />').addClass("buffered"));if(this.getConfig('parent')=='controlsContainer'){this.$el.css({'width':this.getConfig('minWidth')});}this.$el.on("mouseup",function(){_this.hideThumbnailPreview();});}return this.$el;}}));})(window.mw,window.jQuery,kWidget);;},{},{});mw.loader.implement("sideBarContainer",function($){(function(mw,$){"use strict";mw.PluginManager.add('sideBarContainer',mw.KBasePlugin.extend({defaultConfig:{'hover':true,'clickToClose':false,'closeTimeout':2000,'position':'left','fullScreenDisplayOnly':false,'minDisplayWidth':0,'minDisplayHeight':0,'toggleBtnLabel':null,enableKeyboardShortcuts:true,"keyboardShortcutsMap":{"open":"ctrl+79","close":"ctrl+alt+79"}},enabled:true,render:true,currentScreenNameShown:"",keepOnScreen:false,openAfterDisable:false,setup:function(){this.addBindings();},addBindings:function(){var _this=this;this.bind('addLayoutContainer',function(){_this.getPlayer().getVideoHolder().before(_this.getComponent());_this.getComponent().after(_this.$elHelper);});this.bind('layoutBuildDone ended',function(){var disableClosingTimeout=function(){if(_this.closeBarTimeout){clearTimeout(_this.closeBarTimeout);_this.closeBarTimeout=null;}};_this.getComponentReminder().off('click touchstart').on('click touchstart',function(e){e.stopPropagation();e.preventDefault();disableClosingTimeout();_this.toggleSideBar();return false;});if(!_this.getConfig('clickToClose')){_this.getComponent().on('mouseleave',function(){disableClosingTimeout();_this.closeBarTimeout=setTimeout(function(){_this.closeBarTimeout=null;if(_this.getConfig('isSideBarOpen')){_this.close();}},_this.getConfig("closeTimeout"));}).on('mouseenter',function(){disableClosingTimeout();});}});this.bind('onDisableInterfaceComponents',function(event,excludedComponents){if($.inArray(_this.pluginName,excludedComponents)==-1){_this.enabled=false;_this.hideReminder();}});this.bind('onEnableInterfaceComponents',function(event,excludedComponents){if($.inArray(_this.pluginName,excludedComponents)==-1){_this.enabled=true;_this.showReminder();}});this.bind('preShowScreen',function(event,screenName){_this.currentScreenNameShown=screenName;_this.enabled=false;_this.hideReminder();});this.bind('preHideScreen',function(event,screenName){if(_this.currentScreenNameShown===screenName){_this.currentScreenNameShown="";_this.enabled=true;_this.showReminder();}});this.bind('updateLayout',function(){if(_this.getPlayer().layoutBuilder.isInFullScreen()||(!_this.getConfig("fullScreenDisplayOnly")&&_this.getConfig("minDisplayWidth")<=_this.getPlayer().getWidth()&&_this.getConfig("minDisplayHeight")<=_this.getPlayer().getHeight())){_this.render=true;_this.setHeight();_this.showReminder();}else{_this.render=false;_this.hideReminder();}});this.bind('layoutBuildDone',function(){if(!_this.getComponent().children().length){_this.getComponent().hide();_this.getComponentReminder().hide();}});this.bind('onChangeMedia',function(){_this.close();});this.bind('onChangeMediaDone layoutChange',function(){var children=_this.getComponent().children();if(children.length&&(children.filter('*[data-visibility="visible"]').length>0)){_this.getComponent().show();_this.getComponentReminder().show();}else{_this.getComponent().hide();_this.getComponentReminder().hide();}});this.bind('layoutBuildDone ended',function(){_this.setHeight();_this.showReminder();});if(this.getConfig('hover')){this.bind('showPlayerControls',function(e,data){_this.showReminder();});this.bind('hidePlayerControls',function(){_this.hideReminder();});this.bind('onComponentsHoverDisabled',function(){_this.keepOnScreen=true;_this.showReminder();});this.bind('onComponentsHoverEnabled preHideScreen',function(){_this.keepOnScreen=false;});}if(this.getConfig('enableKeyboardShortcuts')){this.bind('addKeyBindCallback',function(e,addKeyCallback){_this.addKeyboardShortcuts(addKeyCallback);});}},addKeyboardShortcuts:function(addKeyCallback){var _this=this;addKeyCallback(this.getConfig("keyboardShortcutsMap").open,function(){_this.open();});addKeyCallback(this.getConfig("keyboardShortcutsMap").close,function(){_this.close();});},showReminder:function(){if(this.enabled&&this.render){this.getComponentReminder().addClass('open');if(this.openAfterDisable){this.openAfterDisable=false;this.getComponentReminder().trigger("click");}}},hideReminder:function(){if(this.enabled&&this.render&&(this.keepOnScreen||(this.getConfig('clickToClose')&&this.getConfig('isSideBarOpen'))))return;if(this.getConfig('isSideBarOpen')){this.openAfterDisable=true;}this.setConfig('isSideBarOpen','false');this.getComponentReminder().removeClass('open shifted');this.getComponent().removeClass('openBtn');},toggleSideBar:function(){if(this.getConfig('isSideBarOpen')){this.close();}else{this.open();}},open:function(){if(this.render){this.setConfig('isSideBarOpen','true');this.getComponentReminder().addClass('shifted');this.getComponent().addClass('openBtn');this.getPlayer().triggerHelper('onShowSideBar');this.getPlayer().triggerHelper('clearTooltip');this.getPlayer().triggerHelper('onComponentsHoverDisabled');}},close:function(){this.setConfig('isSideBarOpen','false');this.getComponent().removeClass('openBtn');this.getComponentReminder().removeClass('shifted');this.getPlayer().triggerHelper('onHideSideBar');this.getPlayer().triggerHelper('clearTooltip');this.getPlayer().triggerHelper('onComponentsHoverEnabled');},setHeight:function(){var height=this.getPlayer().getHeight()-this.getPlayer().getControlBarContainer().height();var noControls=this.getPlayer().isMobileSkin()?2:0;if(this.getPlayer().getTopBarContainer().length&&this.getPlayer().getTopBarContainer().children().length!==noControls){height-=this.getPlayer().getTopBarContainer().height();this.getComponent().css('top',this.getPlayer().getTopBarContainer().height());this.getComponentReminder().css('top',this.getPlayer().getTopBarContainer().height());}else{this.getComponent().css('top',0);this.getComponentReminder().css('top',0);}this.getComponent().css('height',height);},getComponent:function(){if(!this.$el){this.getComponentReminder();var _this=this;this.$el=$('<div />').addClass('sideBarContainer '+_this.getConfig('position'));if(this.getConfig('hover')){this.$el.addClass('hover');}else{this.$el.addClass('block');}}return this.$el;},getComponentReminder:function(){if(!this.$elHelper){var _this=this;var title=this.getConfig("toggleBtnLabel")||gM("ks-sidebar-toggleBtn");this.$elHelper=$('<div>').addClass('sideBarContainerReminder tooltipBelow '+_this.getConfig('position')).prop("title",title).attr("data-show-tooltip",true).append($('<div id="sideBarContainerReminderContainer">').addClass('icon-chapterMenu'));if(this.getConfig('hover')){this.$elHelper.addClass('hover');}else{this.$elHelper.addClass('block');}}return this.$elHelper;},destroy:function(){this._super();this.getComponent().remove();this.getComponentReminder().remove();}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("sourceSelector",function($){(function(mw,$){"use strict";mw.PluginManager.add('sourceSelector',mw.KBaseComponent.extend({defaultConfig:{"parent":"controlsContainer","order":61,"displayImportance":'low',"align":"right","showTooltip":true,"switchOnResize":false,"simpleFormat":true,"iconClass":"icon-cog","displayMode":"size","hideSource":false,"title":gM('mwe-embedplayer-select_source'),'smartContainer':'qualitySettings','smartContainerCloseEvent':'newSourceSelected'},isDisabled:false,inUpdateLayout:false,selectSourceTitle:gM('mwe-embedplayer-select_source'),switchSourceTitle:gM('mwe-embedplayer-switch_source'),AutoTitle:gM('mwe-embedplayer-auto_source'),saveBackgroundColor:null,sourcesList:[],setup:function(){var _this=this;this.bind('playerReady sourcesReplaced',function(){_this.buildMenu();});this.bind('SourceChange',function(){var selectedSrc=_this.getPlayer().mediaElement.selectedSource;var selectedId=selectedSrc.getAssetId();if(selectedSrc.skip){var sources=_this.getSources();for(var i=0;i<sources.length;i++){if(selectedSrc.getSrc()==sources[i].getSrc()){if(i==0&&sources.length>1){selectedId=sources[i+1].getAssetId();}else{selectedId=sources[i-1].getAssetId();}break;}}}_this.getMenu().setActive({'key':'id','val':selectedId});});this.bind('sourceSwitchingStarted',function(){_this.getComponent().find('button').addClass('in-progress-state');_this.onDisable();});this.bind('sourceSwitchingEnd',function(newIndex){_this.getComponent().find('button').removeClass('in-progress-state');_this.onEnable();});this.bind('onHideControlBar',function(){if(_this.getMenu().isOpen())_this.getMenu().close();});this.bind('onChangeMedia',function(){_this.sourcesList=[];});this.bind('onDisableInterfaceComponents',function(e,arg){_this.getMenu().close();});if(this.getConfig('switchOnResize')&&!_this.embedPlayer.isLive()){this.bind('resizeEvent',function(){if(!_this.inUpdateLayout&&!_this.embedPlayer.seeking){_this.inUpdateLayout=true;_this.updateLayoutTimout=setTimeout(function(){_this.inUpdateLayout=false;},1000);if(_this.embedPlayer.instanceOf==="Native"&&!_this.embedPlayer.isInSequence()){var selectedSource=_this.embedPlayer.mediaElement.autoSelectSource(_this.embedPlayer.supportsURLTimeEncoding(),_this.embedPlayer.startTime,_this.embedPlayer.pauseTime);if(selectedSource){_this.embedPlayer.switchSrc(selectedSource);}}else{mw.log("sourceSelector - switchOnResize is ignored - Can't switch source since not using native player or during ad playback");}}});}this.embedPlayer.bindHelper("propertyChangedEvent",function(event,data){if(data.plugin===_this.pluginName){if(data.property==="sources"){_this.getMenu().$el.find("li a")[data.value].click();}}});},getSources:function(){return this.getPlayer().getSources();},buildMenu:function(){var _this=this;this.getMenu().destroy();this.sourcesList=[];var sources=this.getSources().slice(0);if(!sources.length){_this.log("Error with getting sources");return;}if(!this.handleAdaptiveBitrateAndContinue())return;if(this.getConfig('hideSource')){this.getPlayer().mediaElement.removeSourceFlavor(sources);}if(sources.length==1){this.addSourceToMenu(sources[0],_this.getSourceTitle(sources[0]));return;}sources.sort(function(a,b){var hdiff=b.getHeight()-a.getHeight();if(hdiff!=0){return hdiff;}return b.getBitrate()-a.getBitrate();});if(_this.getConfig('simpleFormat')){var prevSource=null;var twice=false;$.each(sources,function(sourceIndex,source){if(!prevSource){prevSource=source;return true;}if(source.getHeight()!=0&&(_this.getSourceSizeName(prevSource)==_this.getSourceSizeName(source))){var selectedSrc=_this.getPlayer().mediaElement.selectedSource;if(selectedSrc&&!_this.isSourceSelected(source)&&!_this.isSourceSelected(prevSource)&&(_this.getSourceSizeName(source)==_this.getSourceSizeName(selectedSrc))){source.skip=true;}else if(twice){if(!_this.isSourceSelected(source)){source.skip=true;}else{source.skip=false;}prevSource=source;return true;}prevSource.hq=true;twice=true;}else{twice=false;}prevSource=source;});}var items=[];var itemLabels=[];var prevSource=null;$.each(sources,function(sourceIndex,source){if(source.skip){return true;}var supportingPlayers=mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers(source.getMIMEType());for(var i=0;i<supportingPlayers.length;i++){if((_this.getPlayer().selectedPlayer===undefined&&supportingPlayers[i].library=='Native')||(_this.getPlayer().selectedPlayer!==undefined&&supportingPlayers[i].library==_this.getPlayer().selectedPlayer.library)){_this.addSourceToMenu(source);var label=_this.getSourceTitle(source)
if($.inArray(label,itemLabels)===-1){itemLabels.push(label)
items.push({'label':label,'value':label});}if(_this.embedPlayer.isMobileSkin()&&_this.isSourceSelected(source)){_this.getMenu().setActive(sourceIndex);}}}});this.getPlayer().triggerHelper("updatePropertyEvent",{"plugin":this.pluginName,"property":"sources","items":items,"selectedItem":this.getMenu().$el.find('.active a').text()});},isSourceSelected:function(source){var _this=this;return(_this.getPlayer().mediaElement.selectedSource&&source.getSrc()==_this.getPlayer().mediaElement.selectedSource.getSrc());},handleAdaptiveBitrateAndContinue:function(){if((this.getPlayer().streamerType==="smoothStream")){this.addAutoToMenu();return true;}if((this.getPlayer().streamerType==="dash")){this.addAutoToMenu();return true;}if(mw.isNativeApp()){this.sourcesList=[];this.addAutoToMenu();return true;}if(this.getPlayer().streamerType!="http"&&!this.getPlayer().isPlaying()&&!this.getPlayer().isInSequence()){if(this.getPlayer().streamerType!=="hls"&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('kplayer')){return true;}this.addAutoToMenu();if(this.getPlayer().streamerType=="hls"){return true;}return false;}if(this.getPlayer().streamerType=="http"){this.addAutoToMenu();return false;}if(this.getPlayer().streamerType!="http"){this.addAutoToMenu();}return true;},addAutoToMenu:function(){var _this=this;this.getMenu().addItem({'label':_this.AutoTitle,'callback':function(){_this.getPlayer().switchSrc(-1);},'active':true});},addSourceToMenu:function(source){var _this=this;var sourceLabel=this.getSourceTitle(source);if($.inArray(sourceLabel,this.sourcesList)==-1){this.sourcesList.push(sourceLabel);this.getMenu().addItem({'label':sourceLabel,'attributes':{'id':source.getAssetId()},'callback':function(){_this.getPlayer().triggerHelper("newSourceSelected",source.getAssetId());_this.getPlayer().switchSrc(source);},'active':_this.isSourceSelected(source)});}},getSourceSizeName:function(source){if(source.getHeight()==0){return gM('mwe-embedplayer-audio_source')+(this.getConfig('displayMode')=='sizebitrate'?"":this.getSourceTitleBitrate(source));}else if(source.getHeight()<255){return'240P';}else if(source.getHeight()<370){return'360P';}else if(source.getHeight()<500){return'480P';}else if(source.getHeight()<800){return'720P';}else{return'1080P';}},getSourceTitle:function(source){if(source.getMIMEType()=='application/vnd.apple.mpegurl'){return this.AutoTitle;}var title='';switch(this.getConfig('displayMode')){case'size':title=this.getSourceTitleSize(source);break;case'bitrate':title=this.getSourceTitleBitrate(source);break;case'sizebitrate':title=this.getSourceTitleSizeBitrate(source);break;}return title;},getSourceTitleSize:function(source){var title='';if(source.getHeight()){title=this.getSourceSizeName(source);if(this.getConfig('displayMode')==='size'&&this.getConfig('simpleFormat')&&source.hq){title+=' HQ';}}else{title=this.getSourceTitleBitrate(source);}return title;},getSourceTitleBitrate:function(source){var title='';if(source.getBitrate()){var bits=(Math.round(source.getBitrate()/1024*10)/10)+'';if(bits[0]=='0'){bits=bits.substring(1);}title+=' '+bits+' Mbs ';}return title;},getSourceTitleSizeBitrate:function(source){var title='';if(source.getHeight()){title=this.getSourceSizeName(source)+' ';}title+=this.getSourceTitleBitrate(source);return title;},toggleMenu:function(){if(this.isDisabled){return;}this.getMenu().toggle();},getComponent:function(){var _this=this;if(!this.$el){var $menu=$('<ul />');var $button=$('<button />').addClass('btn icon-cog').attr('title',_this.selectSourceTitle).click(function(e){_this.toggleMenu();});this.setAccessibility($button,_this.selectSourceTitle);this.$el=$('<div />').addClass('dropup'+this.getCssClass()).append($button,$menu);}return this.$el;},getMenu:function(){if(!this.menu){this.menu=new mw.KMenu(this.getComponent().find('ul'),{tabIndex:this.getBtn().attr('tabindex')});}return this.menu;},getBtn:function(){return this.getComponent().find('button');},onEnable:function(){this.isDisabled=false;this.updateTooltip(this.selectSourceTitle);this.getBtn().removeClass('disabled');if(this.saveBackgroundColor){this.getComponent().find('button').attr('style','background-color: '+this.saveBackgroundColor+' !important');}},onDisable:function(){this.isDisabled=true;this.updateTooltip(this.switchSourceTitle);this.saveBackgroundColor=this.getComponent().find('button').css("background-color");this.getComponent().find('button').attr('style','background-color: null !important');this.getComponent().removeClass('open');this.getBtn().addClass('disabled');}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("statisticsPlugin",function($){(function(mw,$){"use strict";mw.addKalturaPlugin("statistics",function(embedPlayer,callback){mw.addKAnalytics(embedPlayer);callback();});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("titleLabel",function($){(function(mw,$){"use strict";mw.PluginManager.add('titleLabel',mw.KBaseComponent.extend({defaultConfig:{"parent":"topBarContainer","order":1,"align":"left","text":'{mediaProxy.entry.name}',"truncateLongTitles":true},setup:function(){var _this=this;if(this.embedPlayer.isMobileSkin()){this.setConfig('parent','videoHolder');this.setConfig('insertMode','lastChild');}this.bind('playerReady',function(){_this.getComponent().text(_this.getConfig('text')).attr('title',_this.getConfig('text'));var availableWidth=_this.getAvailableWidth();if(_this.getConfig('truncateLongTitles')&&_this.getComponent().width()>=availableWidth){_this.getComponent().width(availableWidth).addClass('truncateText');}});this.bind('layoutBuildDone',function(){var availableWidth=_this.getAvailableWidth();if(_this.getConfig('truncateLongTitles')&&_this.getComponent().width()>=availableWidth){_this.getComponent().attr('title',_this.getConfig('text')).width(availableWidth).css('text-align',_this.getConfig('align')).addClass('truncateText');}else{_this.getComponent().attr('title',_this.getConfig('text')).width(availableWidth).css('text-align',_this.getConfig('align')).removeClass('truncateText');}});},getAvailableWidth:function(){if(this.embedPlayer.isMobileSkin()){return"90%";}else{return this.embedPlayer.getWidth()-($('.'+this.getConfig('parent')+' .btn').length+1)*30;}},getComponent:function(){if(!this.$el){this.$el=$('<div />').addClass(this.getCssClass());}return this.$el;}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("topBarContainer",function($){(function(mw,$){"use strict";mw.PluginManager.add('topBarContainer',mw.KBasePlugin.extend({defaultConfig:{'hover':true},keepOnScreen:false,screenOpen:false,setup:function(){this.addBindings();},addBindings:function(){var _this=this;this.bind('addLayoutContainer',function(){_this.getPlayer().getVideoHolder().before(_this.getComponent());});this.bind('ended',function(){_this.show();});this.bind('layoutBuildDone',function(){if(!_this.embedPlayer.isMobileSkin()){_this.show();}});this.bind('layoutBuildDone',function(){if(!_this.getComponent().children().length&&!_this.embedPlayer.isMobileSkin()){_this.destroy();}});if(this.getConfig('hover')){this.bind('showPlayerControls',function(e,data){_this.show();});this.bind('hidePlayerControls',function(){_this.hide();});this.bind('onComponentsHoverDisabled',function(){_this.keepOnScreen=true;_this.show();});this.bind('hideScreen closeMenuOverlay',function(){_this.screenOpen=false;if(!_this.embedPlayer.paused){_this.keepOnScreen=false;_this.hide();}else{_this.show();}});this.bind('onComponentsHoverEnabled displayMenuOverlay',function(){_this.keepOnScreen=false;_this.hide();});this.bind('showScreen',function(){_this.screenOpen=true;_this.keepOnScreen=false;_this.forceOnScreen=false;_this.hide();});this.bind('onHideSideBar',function(){_this.forceOnScreen=false;});this.bind('onShowSideBar',function(){_this.forceOnScreen=true;});}},onConfigChange:function(property,value){switch(property){case'visible':if(value){this.getComponent().show();}else{this.getComponent().hide();}break;}},show:function(){if(this.embedPlayer.isMobileSkin()&&this.getPlayer().getPlayerPoster().length&&this.embedPlayer.getInterface().hasClass("start-state")){return;}if(!this.screenOpen){this.getComponent().addClass('open');this.getPlayer().triggerHelper('onShowToplBar',{'top':this.getComponent().height()+15});}},hide:function(){if(this.keepOnScreen||this.forceOnScreen)return;this.getComponent().removeClass('open');this.getPlayer().triggerHelper('onHideTopBar',{'top':15});},getComponent:function(){if(!this.$el){this.$el=$('<div />').addClass('topBarContainer');if(this.getConfig('hover')){this.$el.addClass('hover');}else{this.$el.addClass('block');}}return this.$el;},destroy:function(){this._super();this.getComponent().remove();}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("utf8_encode",function($){window['utf8_encode']=function(argString){if(argString===null||typeof argString==="undefined"){return"";}var string=(argString+'');var utftext="",start,end,stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++;}else if(c1>127&&c1<2048){enc=String.fromCharCode((c1>>6)|192)+String.fromCharCode((c1&63)|128);}else{enc=String.fromCharCode((c1>>12)|224)+String.fromCharCode(((c1>>6)&63)|128)+String.fromCharCode((c1&63)|128);}if(enc!==null){if(end>start){utftext+=string.slice(start,end);}utftext+=enc;start=end=n+1;}}if(end>start){utftext+=string.slice(start,stringl);}return utftext;};},{},{});mw.loader.implement("volumeControl",function($){(function(mw,$){"use strict";mw.PluginManager.add('volumeControl',mw.KBaseComponent.extend({defaultConfig:{parent:"controlsContainer",order:11,layout:"horizontal",showTooltip:true,displayImportance:"medium",accessibleControls:false,accessibleVolumeChange:0.1,showSlider:true,pinVolumeBar:false,useCookie:true,uniquePlayerCookie:false},icons:{'mute':'icon-volume-mute','low':'icon-volume-low','high':'icon-volume-high'},setup:function(embedPlayer){this.addBindings();var _this=this;this.cookieName=_this.getConfig('uniquePlayerCookie')?this.pluginName+'_volumeValue_'+this.embedPlayer.kuiconfid:this.pluginName+'_volumeValue';this.bind('playerReady ',function(){if((_this.getConfig('useCookie')&&$.cookie(_this.cookieName))){var volumeValue=parseInt($.cookie(_this.cookieName));if(!isNaN(volumeValue)&&volumeValue>=0&&volumeValue<=100){if(volumeValue===0){_this.getPlayer().preMuteVolume=1;_this.getPlayer().muted=true;_this.updateFirstMute=true;}_this.firstUpdate=true;_this.getPlayer().setVolume(volumeValue/100,true);}}});},saveVolume:function(){if(this.firstUpdate){this.firstUpdate=false;return;}if(this.getConfig('useCookie')){this.getPlayer().setCookie(this.cookieName,this.getPlayer().getPlayerElementVolume()*100,{path:'/'});}},isSafeEnviornment:function(){return!mw.isMobileDevice();},getSliderConfig:function(){var _this=this;return{orientation:this.getConfig("layout"),range:"min",value:(this.getPlayer().getPlayerElementVolume()*100),min:0,max:100,slide:function(event,ui){_this.getPlayer().setVolume((ui.value/100),true);_this.updateTooltipAndAccessibility(ui.value);},change:function(event,ui){_this.getPlayer().setVolume((ui.value/100),true);_this.updateTooltipAndAccessibility(ui.value);},start:function(event,ui){_this.getPlayer().preMuteVolume=(ui.value/100);}};},updateTooltipAndAccessibility:function(value){if(this.getPlayer().isMuted()||value===0){this.updateTooltip(gM('mwe-embedplayer-volume-unmute'));this.setAccessibility(this.getBtn(),gM('mwe-embedplayer-volume-unmute'));}else{this.updateTooltip(gM('mwe-embedplayer-volume-mute'));this.setAccessibility(this.getBtn(),gM('mwe-embedplayer-volume-mute'));}},addBindings:function(){var _this=this;var mouseOverSlider=false;if(this.getConfig('showSlider')){var openSlider=function(){_this.getComponent().removeClass('noTransition');_this.getComponent().addClass('open');if(_this.getConfig('layout')==="vertical"){_this.getPlayer().triggerHelper("onShowSideBar");}};var closeSlider=function(){if(_this.getConfig('layout')==="horizontal"&&!_this.getConfig('pinVolumeBar')){_this.getComponent().removeClass('open');}if(_this.getConfig('layout')==="vertical"){setTimeout(function(){if(!mouseOverSlider){_this.getComponent().removeClass('open');_this.getPlayer().triggerHelper("onHideSideBar");}},350);}};this.bind('layoutBuildDone',function(){if(_this.getConfig('layout')==="horizontal"){openSlider();_this.getComponent().addClass('noTransition');setTimeout(function(){_this.getComponent().data('width',_this.getComponent().width());closeSlider();},100);}});}this.getBtn().click(function(){_this.getPlayer().toggleMute();_this.updateTooltipAndAccessibility();if(_this.updateFirstMute){_this.updateFirstMute=false;_this.updateVolumeUI(1);}_this.saveVolume();});if(this.getConfig("accessibleControls")){this.getAccessibilityBtn('increaseVolBtn').click(function(){if(_this.getPlayer().volume<=(1-_this.getConfig("accessibleVolumeChange"))){_this.getPlayer().setVolume(_this.getPlayer().volume+_this.getConfig("accessibleVolumeChange"),true);}});this.getAccessibilityBtn('decreaseVolBtn').click(function(){if(_this.getPlayer().volume>=_this.getConfig("accessibleVolumeChange")){_this.getPlayer().setVolume(_this.getPlayer().volume-_this.getConfig("accessibleVolumeChange"),true);}});}this.getBtn().focusin(openSlider);this.getBtn().focusout(closeSlider);this.getComponent().hover(openSlider,closeSlider);this.getSliderContainer().hover(function(){mouseOverSlider=true},function(){mouseOverSlider=false});this.bind('volumeChanged',function(e,percent){_this.updateVolumeUI(percent);_this.saveVolume();});this.getSlider().slider(this.getSliderConfig());if(this.getConfig('accessibilityLabels')){var percent=this.getPlayer().getPlayerElementVolume()*100;var title=gM('mwe-embedplayer-volume-value',percent);var $slider=this.getSlider().find('a');$slider.html('<span class="accessibilityLabel">'+title+'</span>');$slider.attr("role","paragraph");}},updateVolumeUI:function(percent){var iconClasses='',newClass='';$.each(this.icons,function(){iconClasses+=this+' ';});if(percent==0){newClass=this.icons['mute'];}else if(percent<=0.50){newClass=this.icons['low'];}else if(percent<=1){newClass=this.icons['high'];}this.getBtn().removeClass(iconClasses).addClass(newClass);this.getSlider().slider('value',percent*100);if(this.getConfig('accessibilityLabels')){var title=gM('mwe-embedplayer-volume-value',percent*100);this.getSlider().find('a').html('<span class="accessibilityLabel">'+title+'</span>');}},getComponent:function(){if(!this.$el){var layoutClass=' '+this.getConfig('layout');var $btn=$('<button />').addClass("btn "+this.icons['high']).attr({'title':gM('mwe-embedplayer-volume-mute'),'id':'muteBtn'});this.setAccessibility($btn,gM('mwe-embedplayer-volume-mute'));var $sliderContainer=$('<div />').addClass('sliderContainer');if(this.getConfig("layout")=="vertical"){$sliderContainer.append($('<div />').addClass('arrow'));$sliderContainer.append($('<div />').addClass('slider'));}else{$sliderContainer=$('<div />').addClass('slider');}this.$el=$('<div />').addClass(this.getCssClass()+layoutClass).append($btn,$sliderContainer);if(this.getConfig("accessibleControls")){var $accessibilityIncreaseVol=$('<button/>').addClass("btn aria").attr({"id":"increaseVolBtn","title":gM("mwe-embedplayer-volume-increase")});var $accessibilityDecreaseVol=$('<button/>').addClass("btn aria").attr({"id":"decreaseVolBtn","title":gM("mwe-embedplayer-volume-decrease")});this.$el.append($accessibilityIncreaseVol).append($accessibilityDecreaseVol);}}return this.$el;},getBtn:function(){return this.getComponent().find('#muteBtn');},getSlider:function(){return this.getComponent().find('.slider');},getAccessibilityBtn:function(id){return this.getComponent().find('#'+id);},getSliderContainer:function(id){return this.getComponent().find('.sliderContainer');}}));})(window.mw,window.jQuery);;},{},{});mw.loader.implement("jquery.client",function($){(function($){var profileCache={};$.client={profile:function(nav){if(nav===undefined){nav=window.navigator;}if(profileCache[nav.userAgent]===undefined){var uk='unknown';var x='x';var wildUserAgents=['Opera','Navigator','Minefield','KHTML','Chrome','PLAYSTATION 3'];var userAgentTranslations=[[/(Firefox|MSIE|KHTML,\slike\sGecko|Konqueror)/,''],['Chrome Safari','Chrome'],['KHTML','Konqueror'],['Minefield','Firefox'],['Navigator','Netscape'],['PLAYSTATION 3','PS3']];var versionPrefixes=['camino','chrome','firefox','netscape','netscape6','opera','version','konqueror','lynx','msie','safari','ps3'];var versionSuffix='(\\/|\\;?\\s|)([a-z0-9\\.\\+]*?)(\\;|dev|rel|\\)|\\s|$)';var names=['camino','chrome','firefox','netscape','konqueror','lynx','msie','opera','safari','ipod','iphone','blackberry','ps3'];var nameTranslations=[];var layouts=['gecko','konqueror','msie','opera','webkit'];var layoutTranslations=[['konqueror','khtml'],['msie','trident'],['opera','presto']];var layoutVersions=['applewebkit','gecko'];var platforms=['win','mac','linux','sunos','solaris','iphone'];var platformTranslations=[['sunos','solaris']];var translate=function(source,translations){for(var i=0;i<translations.length;i++){source=source.replace(translations[i][0],translations[i][1]);}return source;};var ua=nav.userAgent,match,name=uk,layout=uk,layoutversion=uk,platform=uk,version=x;if(match=new RegExp('('+wildUserAgents.join('|')+')').exec(ua)){ua=translate(ua,userAgentTranslations);}ua=ua.toLowerCase();if(match=new RegExp('('+names.join('|')+')').exec(ua)){name=translate(match[1],nameTranslations);}if(match=new RegExp('('+layouts.join('|')+')').exec(ua)){layout=translate(match[1],layoutTranslations);}if(match=new RegExp('('+layoutVersions.join('|')+')\\\/(\\d+)').exec(ua)){layoutversion=parseInt(match[2],10);}if(match=new RegExp('('+platforms.join('|')+')').exec(nav.platform.toLowerCase())){platform=translate(match[1],platformTranslations);}if(match=new RegExp('('+versionPrefixes.join('|')+')'+versionSuffix).exec(ua)){version=match[3];}if(name.match(/safari/)&&version>400){version='2.0';}if(name==='opera'&&version>=9.8){version=ua.match(/version\/([0-9\.]*)/i)[1]||10;}var versionNumber=parseFloat(version,10)||0.0;profileCache[nav.userAgent]={'name':name,'layout':layout,'layoutVersion':layoutversion,'platform':platform,'version':version,'versionBase':(version!==x?Math.floor(versionNumber).toString():x),'versionNumber':versionNumber};}return profileCache[nav.userAgent];},test:function(map,profile){profile=$.isPlainObject(profile)?profile:$.client.profile();var dir=$('body').is('.rtl')?'rtl':'ltr';if(typeof map[dir]!=='object'||typeof map[dir][profile.name]==='undefined'){return true;}var conditions=map[dir][profile.name];for(var i=0;i<conditions.length;i++){var op=conditions[i][0];var val=conditions[i][1];if(val===false){return false;}else if(typeof val=='string'){if(!(eval('profile.version'+op+'"'+val+'"'))){return false;}}else if(typeof val=='number'){if(!(eval('profile.versionNumber'+op+val))){return false;}}}return true;}};})(jQuery);;},{},{});mw.loader.implement("jquery.color",function($){(function(jQuery,undefined){var stepHooks="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",rplusequals=/^([\-+])=\s*(\d+\.?\d*)/,stringParsers=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1],execResult[2],execResult[3],execResult[4]];}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(execResult){return[execResult[1]*2.55,execResult[2]*2.55,execResult[3]*2.55,execResult[4]];}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(execResult){return[parseInt(execResult[1],16),parseInt(execResult[2],16),parseInt(execResult[3],16)];}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(execResult){return[parseInt(execResult[1]+execResult[1],16),parseInt(execResult[2]+execResult[2],16),parseInt(execResult[3]+execResult[3],16)];}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(execResult){return[execResult[1],execResult[2]/100,execResult[3]/100,execResult[4]];}}],color=jQuery.Color=function(color,green,blue,alpha){return new jQuery.Color.fn.parse(color,green,blue,alpha);},spaces={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},propTypes={"byte":{floor:true,max:255},"percent":{max:1},"degrees":{mod:360,floor:true}},support=color.support={},supportElem=jQuery("<p>")[0],colors,each=jQuery.each;supportElem.style.cssText="background-color:rgba(1,1,1,.5)";support.rgba=supportElem.style.backgroundColor.indexOf("rgba")>-1;each(spaces,function(spaceName,space){space.cache="_"+spaceName;space.props.alpha={idx:3,type:"percent",def:1};});function clamp(value,prop,allowEmpty){var type=propTypes[prop.type]||{};if(value==null){return(allowEmpty||!prop.def)?null:prop.def;}value=type.floor?~~value:parseFloat(value);if(isNaN(value)){return prop.def;}if(type.mod){return(value+type.mod)%type.mod;}return 0>value?0:type.max<value?type.max:value;}function stringParse(string){var inst=color(),rgba=inst._rgba=[];string=string.toLowerCase();each(stringParsers,function(i,parser){var parsed,match=parser.re.exec(string),values=match&&parser.parse(match),spaceName=parser.space||"rgba";if(values){parsed=inst[spaceName](values);inst[spaces[spaceName].cache]=parsed[spaces[spaceName].cache];rgba=inst._rgba=parsed._rgba;return false;}});if(rgba.length){if(rgba.join()==="0,0,0,0"){jQuery.extend(rgba,colors.transparent);}return inst;}return colors[string];}color.fn=jQuery.extend(color.prototype,{parse:function(red,green,blue,alpha){if(red===undefined){this._rgba=[null,null,null,null];return this;}if(red.jquery||red.nodeType){red=jQuery(red).css(green);green=undefined;}var inst=this,type=jQuery.type(red),rgba=this._rgba=[];if(green!==undefined){red=[red,green,blue,alpha];type="array";}if(type==="string"){return this.parse(stringParse(red)||colors._default);}if(type==="array"){each(spaces.rgba.props,function(key,prop){rgba[prop.idx]=clamp(red[prop.idx],prop);});return this;}if(type==="object"){if(red instanceof color){each(spaces,function(spaceName,space){if(red[space.cache]){inst[space.cache]=red[space.cache].slice();}});}else{each(spaces,function(spaceName,space){var cache=space.cache;each(space.props,function(key,prop){if(!inst[cache]&&space.to){if(key==="alpha"||red[key]==null){return;}inst[cache]=space.to(inst._rgba);}inst[cache][prop.idx]=clamp(red[key],prop,true);});if(inst[cache]&&jQuery.inArray(null,inst[cache].slice(0,3))<0){inst[cache][3]=1;if(space.from){inst._rgba=space.from(inst[cache]);}}});}return this;}},is:function(compare){var is=color(compare),same=true,inst=this;each(spaces,function(_,space){var localCache,isCache=is[space.cache];if(isCache){localCache=inst[space.cache]||space.to&&space.to(inst._rgba)||[];each(space.props,function(_,prop){if(isCache[prop.idx]!=null){same=(isCache[prop.idx]===localCache[prop.idx]);return same;}});}return same;});return same;},_space:function(){var used=[],inst=this;each(spaces,function(spaceName,space){if(inst[space.cache]){used.push(spaceName);}});return used.pop();},transition:function(other,distance){var end=color(other),spaceName=end._space(),space=spaces[spaceName],startColor=this.alpha()===0?color("transparent"):this,start=startColor[space.cache]||space.to(startColor._rgba),result=start.slice();end=end[space.cache];each(space.props,function(key,prop){var index=prop.idx,startValue=start[index],endValue=end[index],type=propTypes[prop.type]||{};if(endValue===null){return;}if(startValue===null){result[index]=endValue;}else{if(type.mod){if(endValue-startValue>type.mod/2){startValue+=type.mod;}else if(startValue-endValue>type.mod/2){startValue-=type.mod;}}result[index]=clamp((endValue-startValue)*distance+startValue,prop);}});return this[spaceName](result);},blend:function(opaque){if(this._rgba[3]===1){return this;}var rgb=this._rgba.slice(),a=rgb.pop(),blend=color(opaque)._rgba;return color(jQuery.map(rgb,function(v,i){return(1-a)*blend[i]+a*v;}));},toRgbaString:function(){var prefix="rgba(",rgba=jQuery.map(this._rgba,function(v,i){return v==null?(i>2?1:0):v;});if(rgba[3]===1){rgba.pop();prefix="rgb(";}return prefix+rgba.join()+")";},toHslaString:function(){var prefix="hsla(",hsla=jQuery.map(this.hsla(),function(v,i){if(v==null){v=i>2?1:0;}if(i&&i<3){v=Math.round(v*100)+"%";}return v;});if(hsla[3]===1){hsla.pop();prefix="hsl(";}return prefix+hsla.join()+")";},toHexString:function(includeAlpha){var rgba=this._rgba.slice(),alpha=rgba.pop();if(includeAlpha){rgba.push(~~(alpha*255));}return"#"+jQuery.map(rgba,function(v){v=(v||0).toString(16);return v.length===1?"0"+v:v;}).join("");},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString();}});color.fn.parse.prototype=color.fn;function hue2rgb(p,q,h){h=(h+1)%1;if(h*6<1){return p+(q-p)*h*6;}if(h*2<1){return q;}if(h*3<2){return p+(q-p)*((2/3)-h)*6;}return p;}spaces.hsla.to=function(rgba){if(rgba[0]==null||rgba[1]==null||rgba[2]==null){return[null,null,null,rgba[3]];}var r=rgba[0]/255,g=rgba[1]/255,b=rgba[2]/255,a=rgba[3],max=Math.max(r,g,b),min=Math.min(r,g,b),diff=max-min,add=max+min,l=add*0.5,h,s;if(min===max){h=0;}else if(r===max){h=(60*(g-b)/diff)+360;}else if(g===max){h=(60*(b-r)/diff)+120;}else{h=(60*(r-g)/diff)+240;}if(diff===0){s=0;}else if(l<=0.5){s=diff/add;}else{s=diff/(2-add);}return[Math.round(h)%360,s,l,a==null?1:a];};spaces.hsla.from=function(hsla){if(hsla[0]==null||hsla[1]==null||hsla[2]==null){return[null,null,null,hsla[3]];}var h=hsla[0]/360,s=hsla[1],l=hsla[2],a=hsla[3],q=l<=0.5?l*(1+s):l+s-l*s,p=2*l-q;return[Math.round(hue2rgb(p,q,h+(1/3))*255),Math.round(hue2rgb(p,q,h)*255),Math.round(hue2rgb(p,q,h-(1/3))*255),a];};each(spaces,function(spaceName,space){var props=space.props,cache=space.cache,to=space.to,from=space.from;color.fn[spaceName]=function(value){if(to&&!this[cache]){this[cache]=to(this._rgba);}if(value===undefined){return this[cache].slice();}var ret,type=jQuery.type(value),arr=(type==="array"||type==="object")?value:arguments,local=this[cache].slice();each(props,function(key,prop){var val=arr[type==="object"?key:prop.idx];if(val==null){val=local[prop.idx];}local[prop.idx]=clamp(val,prop);});if(from){ret=color(from(local));ret[cache]=local;return ret;}else{return color(local);}};each(props,function(key,prop){if(color.fn[key]){return;}color.fn[key]=function(value){var vtype=jQuery.type(value),fn=(key==="alpha"?(this._hsla?"hsla":"rgba"):spaceName),local=this[fn](),cur=local[prop.idx],match;if(vtype==="undefined"){return cur;}if(vtype==="function"){value=value.call(this,cur);vtype=jQuery.type(value);}if(value==null&&prop.empty){return this;}if(vtype==="string"){match=rplusequals.exec(value);if(match){value=cur+parseFloat(match[2])*(match[1]==="+"?1:-1);}}local[prop.idx]=value;return this[fn](local);};});});color.hook=function(hook){var hooks=hook.split(" ");each(hooks,function(i,hook){jQuery.cssHooks[hook]={set:function(elem,value){var parsed,curElem,backgroundColor="";if(value!=="transparent"&&(jQuery.type(value)!=="string"||(parsed=stringParse(value)))){value=color(parsed||value);if(!support.rgba&&value._rgba[3]!==1){curElem=hook==="backgroundColor"?elem.parentNode:elem;while((backgroundColor===""||backgroundColor==="transparent")&&curElem&&curElem.style){try{backgroundColor=jQuery.css(curElem,"backgroundColor");curElem=curElem.parentNode;}catch(e){}}value=value.blend(backgroundColor&&backgroundColor!=="transparent"?backgroundColor:"_default");}value=value.toRgbaString();}try{elem.style[hook]=value;}catch(e){}}};jQuery.fx.step[hook]=function(fx){if(!fx.colorInit){fx.start=color(fx.elem,hook);fx.end=color(fx.end);fx.colorInit=true;}jQuery.cssHooks[hook].set(fx.elem,fx.start.transition(fx.end,fx.pos));};});};color.hook(stepHooks);jQuery.cssHooks.borderColor={expand:function(value){var expanded={};each(["Top","Right","Bottom","Left"],function(i,part){expanded["border"+part+"Color"]=value;});return expanded;}};colors=jQuery.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"};}(jQuery));;},{},{});mw.loader.implement("jquery.cookie",function($){jQuery.cookie=function(name,value,options){if(typeof value!='undefined'){options=options||{};if(value===null){value='';options.expires=-1;}var expires='';if(options.expires&&(typeof options.expires=='number'||options.expires.toUTCString)){var date;if(typeof options.expires=='number'){date=new Date();date.setTime(date.getTime()+(options.expires*24*60*60*1000));}else{date=options.expires;}expires='; expires='+date.toUTCString();}var path=options.path?'; path='+(options.path):'';var domain=options.domain?'; domain='+(options.domain):'';var secure=options.secure?'; secure':'';document.cookie=[name,'=',encodeURIComponent(value),expires,path,domain,secure].join('');}else{var cookieValue=null;if(document.cookie&&document.cookie!=''){var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==(name+'=')){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break;}}}return cookieValue;}};;},{},{});mw.loader.implement("jquery.debouncedresize",function($){(function($){var $event=$.event,$special,resizeTimeout;$special=$event.special.debouncedresize={setup:function(){$(this).on("resize",$special.handler);},teardown:function(){$(this).off("resize",$special.handler);},handler:function(event,execAsap){var context=this,args=arguments,dispatch=function(){event.type="debouncedresize";$event.dispatch.apply(context,args);};if(resizeTimeout){clearTimeout(resizeTimeout);}execAsap?dispatch():resizeTimeout=setTimeout(dispatch,$special.threshold);},threshold:150};})(jQuery);;},{},{});mw.loader.implement("jquery.hoverIntent",function($){(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY;};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};var handleHover=function(e){var p=(e.type=="mouseover"?e.fromElement:e.toElement)||e.relatedTarget;while(p&&p!=this){try{p=p.parentNode;}catch(e){p=this;}}if(p==this){return false;}var ev=$.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}if(e.type=="mouseover"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};return this.mouseover(handleHover).mouseout(handleHover);};})(jQuery);;},{},{});mw.loader.implement("jquery.messageBox",function($){(function($){$.messageBoxNew=function(options){options=$.extend({id:'js-messagebox',parent:'body',insert:'prepend'},options);var $curBox=$('#'+options.id);if($curBox.length>0){if($curBox.hasClass('js-messagebox')){return $curBox;}else{return $curBox.addClass('js-messagebox');}}else{var $newBox=$('<div>',{'id':options.id,'class':'js-messagebox','css':{'display':'none'}});if($(options.parent).length<1){options.parent='body';}if(options.insert==='append'){$newBox.appendTo(options.parent);return $newBox;}else{$newBox.prependTo(options.parent);return $newBox;}}};$.messageBox=function(options){options=$.extend({message:'',group:'default',replace:false,target:'js-messagebox'},options);var $target=$.messageBoxNew({id:options.target});var groupID=options.target+'-'+options.group;var $group=$('#'+groupID);if($group.length<1){$group=$('<div>',{'id':groupID,'class':'js-messagebox-group'});$target.prepend($group);}if(options.replace===true){$group.empty();}if(options.message===''||options.message===null){$group.hide();}else{$group.prepend($('<p>').append(options.message)).show();$target.slideDown();}if($target.find('> *:visible').length===0){$group.show();$target.slideUp();$group.hide();}else{$target.slideDown();}return $group;};}(jQuery));;},{"all":".js-messagebox{margin:1em 5%;padding:0.5em 2.5%;border:1px solid #ccc;background-color:#fcfcfc;font-size:0.8em}.js-messagebox .js-messagebox-group{margin:1px;padding:0.5em 2.5%;border-bottom:1px solid #ddd}.js-messagebox .js-messagebox-group:last-child{border-bottom:thin none transparent}\n\n/* cache key: resourceloader:filter:minify-css:7:2bb917065f5e11cbbe44ba45500bbed5 */\n"},{});mw.loader.implement("jquery.mwEmbedUtil",function($){(function($){var _oldUnique=$.unique;$.unique=function(arr){if(arr.length&&!!arr[0].nodeType){return _oldUnique.apply(this,arguments);}else{return $.grep(arr,function(v,k){return $.inArray(v,arr)===k;});}};$.btnHtml=function(msg,styleClass,iconId,opt){if(!opt)opt={};var href=(opt.href)?opt.href:'#';var target_attr=(opt.target)?' target="'+opt.target+'" ':'';var style_attr=(opt.style)?' style="'+opt.style+'" ':'';return'<a href="'+href+'" '+target_attr+style_attr+' class="ui-state-default ui-corner-all ui-icon_link '+styleClass+'"><span class="ui-icon ui-icon-'+iconId+'" ></span>'+'<span class="btnText">'+msg+'</span></a>';};var mw_default_button_options={'class':'','style':{},'text':'','icon':'carat-1-n'};$.button=function(options){var options=$j.extend({},mw_default_button_options,options);var $button=$('<a />').attr('href','#').addClass('ui-state-default ui-corner-all ui-icon_link');if(options.css){$button.css(options.css);}if(options['class']){$button.addClass(options['class']);}$button.append($('<span />').addClass('ui-icon ui-icon-'+options.icon),$('<span />').addClass('btnText').text(options.text)).buttonHover();if(!options.text){$button.css('padding','1em');}return $button;};$.fn.buttonHover=function(){$(this).hover(function(){$(this).addClass('ui-state-hover');},function(){$(this).removeClass('ui-state-hover');});return this;};})(jQuery);;},{},{});mw.loader.implement("jquery.mwExtension",function($){(function($){$.extend({trimLeft:function(str){return str===null?'':str.toString().replace(/^\s+/,'');},trimRight:function(str){return str===null?'':str.toString().replace(/\s+$/,'');},ucFirst:function(str){return str.charAt(0).toUpperCase()+str.substr(1);},escapeRE:function(str){return str.replace(/([\\{}()|.?*+\-^$\[\]])/g,"\\$1");},isDomElement:function(el){return!!el&&!!el.nodeType;},isEmpty:function(v){if(v===''||v===0||v==='0'||v===null||v===false||v===undefined){return true;}if(v.length===0){return true;}if(typeof v==='object'){for(var key in v){return false;}return true;}return false;},compareArray:function(arrThis,arrAgainst){if(arrThis.length!=arrAgainst.length){return false;}for(var i=0;i<arrThis.length;i++){if($.isArray(arrThis[i])){if(!$.compareArray(arrThis[i],arrAgainst[i])){return false;}}else if(arrThis[i]!==arrAgainst[i]){return false;}}return true;},compareObject:function(objectA,objectB){if(typeof objectA==typeof objectB){if(typeof objectA=='object'){if(objectA===objectB){return true;}else{var prop;for(prop in objectA){if(prop in objectB){var type=typeof objectA[prop];if(type==typeof objectB[prop]){switch(type){case'object':if(!$.compareObject(objectA[prop],objectB[prop])){return false;}break;case'function':if(objectA[prop].toString()!==objectB[prop].toString()){return false;}break;default:if(objectA[prop]!==objectB[prop]){return false;}break;}}else{return false;}}else{return false;}}for(prop in objectB){if(!(prop in objectA)){return false;}}}}}else{return false;}return true;}});})(jQuery);;},{},{});mw.loader.implement("jquery.naturalSize",function($){(function($){var props=['Width','Height'],prop;while(prop=props.pop()){(function(natural,prop){$.fn[natural]=(natural in new Image())?function(){return this[0][natural];}:function(){var node=this[0],img,value;if(node.tagName.toLowerCase()==='img'){img=new Image();img.src=node.src,value=img[prop];}return value;};}('natural'+prop,prop.toLowerCase()));}}(jQuery));;},{},{});mw.loader.implement("jquery.ui.core",function($){(function($,undefined){var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{};$.extend($.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});$.fn.extend({focus:(function(orig){return function(delay,fn){return typeof delay==="number"?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus();if(fn){fn.call(elem);}},delay);}):orig.apply(this,arguments);};})($.fn.focus),scrollParent:function(){var scrollParent;if(($.ui.ie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){scrollParent=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test($.css(this,"position"))&&(/(auto|scroll)/).test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"));}).eq(0);}else{scrollParent=this.parents().filter(function(){return(/(auto|scroll)/).test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"));}).eq(0);}return(/fixed/).test(this.css("position"))||!scrollParent.length?$(document):scrollParent;},zIndex:function(zIndex){if(zIndex!==undefined){return this.css("zIndex",zIndex);}if(this.length){var elem=$(this[0]),position,value;while(elem.length&&elem[0]!==document){position=elem.css("position");if(position==="absolute"||position==="relative"||position==="fixed"){value=parseInt(elem.css("zIndex"),10);if(!isNaN(value)&&value!==0){return value;}}elem=elem.parent();}}return 0;},uniqueId:function(){return this.each(function(){if(!this.id){this.id="ui-id-"+(++uuid);}});},removeUniqueId:function(){return this.each(function(){if(runiqueId.test(this.id)){$(this).removeAttr("id");}});}});function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();if("area"===nodeName){map=element.parentNode;mapName=map.name;if(!element.href||!mapName||map.nodeName.toLowerCase()!=="map"){return false;}img=$("img[usemap=#"+mapName+"]")[0];return!!img&&visible(img);}return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element);}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return $.css(this,"visibility")==="hidden";}).length;}$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName);};}):function(elem,i,match){return!!$.data(elem,match[3]);},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")));},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN);}});if(!$("<a>").outerWidth(1).jquery){$.each(["Width","Height"],function(i,name){var side=name==="Width"?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};function reduce(elem,size,border,margin){$.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0;if(border){size-=parseFloat($.css(elem,"border"+this+"Width"))||0;}if(margin){size-=parseFloat($.css(elem,"margin"+this))||0;}});return size;}$.fn["inner"+name]=function(size){if(size===undefined){return orig["inner"+name].call(this);}return this.each(function(){$(this).css(type,reduce(this,size)+"px");});};$.fn["outer"+name]=function(size,margin){if(typeof size!=="number"){return orig["outer"+name].call(this,size);}return this.each(function(){$(this).css(type,reduce(this,size,true,margin)+"px");});};});}if(!$.fn.addBack){$.fn.addBack=function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector));};}if($("<a>").data("a-b","a").removeData("a-b").data("a-b")){$.fn.removeData=(function(removeData){return function(key){if(arguments.length){return removeData.call(this,$.camelCase(key));}else{return removeData.call(this);}};})($.fn.removeData);}$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());$.support.selectstart="onselectstart"in document.createElement("div");$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault();});},enableSelection:function(){return this.unbind(".ui-disableSelection");}});$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set){proto.plugins[i]=proto.plugins[i]||[];proto.plugins[i].push([option,set[i]]);}},call:function(instance,name,args){var i,set=instance.plugins[name];if(!set||!instance.element[0].parentNode||instance.element[0].parentNode.nodeType===11){return;}for(i=0;i<set.length;i++){if(instance.options[set[i][0]]){set[i][1].apply(instance.element,args);}}}},hasScroll:function(el,a){if($(el).css("overflow")==="hidden"){return false;}var scroll=(a&&a==="left")?"scrollLeft":"scrollTop",has=false;if(el[scroll]>0){return true;}el[scroll]=1;has=(el[scroll]>0);el[scroll]=0;return has;}});})(jQuery);;},{"all":".ui-helper-hidden{display:none}.ui-helper-hidden-accessible{position:absolute;left:-99999999px}.ui-helper-reset{margin:0;padding:0;border:0;outline:0;line-height:1.3;text-decoration:none;font-size:100%;list-style:none}.ui-helper-clearfix:after{content:\".\";display:block;height:0;clear:both;visibility:hidden}.ui-helper-clearfix{display:inline-block} * html .ui-helper-clearfix{height:1%}.ui-helper-clearfix{display:block} .ui-helper-zfix{width:100%;height:100%;top:0;left:0;position:absolute;opacity:0;filter:Alpha(Opacity=0)} .ui-state-disabled{cursor:default !important}  .ui-icon{display:block;text-indent:-99999px;overflow:hidden;background-repeat:no-repeat}  .ui-widget-overlay{position:absolute;top:0;left:0;width:100%;height:100%}\n\n/* cache key: resourceloader:filter:minify-css:7:b80b11161e9a8e2d415a43fd6f09d170 */\n"},{});mw.loader.implement("jquery.ui.mouse",function($){(function($,undefined){var mouseHandled=false;$(document).mouseup(function(){mouseHandled=false;});$.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event);}).bind("click."+this.widgetName,function(event){if(true===$.data(event.target,that.widgetName+".preventClickEvent")){$.removeData(event.target,that.widgetName+".preventClickEvent");event.stopImmediatePropagation();return false;}});this.started=false;},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);if(this._mouseMoveDelegate){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);}},_mouseDown:function(event){if(mouseHandled){return;}(this._mouseStarted&&this._mouseUp(event));this._mouseDownEvent=event;var that=this,btnIsLeft=(event.which===1),elIsCancel=(typeof this.options.cancel==="string"&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:false);if(!btnIsLeft||elIsCancel||!this._mouseCapture(event)){return true;}this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet){this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=true;},this.options.delay);}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(event)!==false);if(!this._mouseStarted){event.preventDefault();return true;}}if(true===$.data(event.target,this.widgetName+".preventClickEvent")){$.removeData(event.target,this.widgetName+".preventClickEvent");}this._mouseMoveDelegate=function(event){return that._mouseMove(event);};this._mouseUpDelegate=function(event){return that._mouseUp(event);};$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);event.preventDefault();mouseHandled=true;return true;},_mouseMove:function(event){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button){return this._mouseUp(event);}if(this._mouseStarted){this._mouseDrag(event);return event.preventDefault();}if(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)){this._mouseStarted=(this._mouseStart(this._mouseDownEvent,event)!==false);(this._mouseStarted?this._mouseDrag(event):this._mouseUp(event));}return!this._mouseStarted;},_mouseUp:function(event){$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;if(event.target===this._mouseDownEvent.target){$.data(event.target,this.widgetName+".preventClickEvent",true);}this._mouseStop(event);}return false;},_mouseDistanceMet:function(event){return(Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance);},_mouseDelayMet:function(){return this.mouseDelayMet;},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true;}});})(jQuery);;},{},{});mw.loader.implement("jquery.ui.position",function($){(function($,undefined){$.ui=$.ui||{};var cachedScrollbarWidth,max=Math.max,abs=Math.abs,round=Math.round,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)];}function parseCss(element,property){return parseInt($.css(element,property),10)||0;}function getDimensions(elem){var raw=elem[0];if(raw.nodeType===9){return{width:elem.width(),height:elem.height(),offset:{top:0,left:0}};}if($.isWindow(raw)){return{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}};}if(raw.preventDefault){return{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}};}return{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()};}$.position={scrollbarWidth:function(){if(cachedScrollbarWidth!==undefined){return cachedScrollbarWidth;}var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];$("body").append(div);w1=innerDiv.offsetWidth;div.css("overflow","scroll");w2=innerDiv.offsetWidth;if(w1===w2){w2=div[0].clientWidth;}div.remove();return(cachedScrollbarWidth=w1-w2);},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX=overflowX==="scroll"||(overflowX==="auto"&&within.width<within.element[0].scrollWidth),hasOverflowY=overflowY==="scroll"||(overflowY==="auto"&&within.height<within.element[0].scrollHeight);return{width:hasOverflowY?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0};},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&withinElement[0].nodeType===9;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:withinElement.offset()||{left:0,top:0},scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:isWindow?withinElement.width():withinElement.outerWidth(),height:isWindow?withinElement.height():withinElement.outerHeight()};}};$.fn.position=function(options){if(!options||!options.of){return _position.apply(this,arguments);}options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};dimensions=getDimensions(target);if(target[0].preventDefault){options.at="left top";}targetWidth=dimensions.width;targetHeight=dimensions.height;targetOffset=dimensions.offset;basePosition=$.extend({},targetOffset);$.each(["my","at"],function(){var pos=(options[this]||"").split(" "),horizontalOffset,verticalOffset;if(pos.length===1){pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"];}pos[0]=rhorizontal.test(pos[0])?pos[0]:"center";pos[1]=rvertical.test(pos[1])?pos[1]:"center";horizontalOffset=roffset.exec(pos[0]);verticalOffset=roffset.exec(pos[1]);offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0];options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]];});if(collision.length===1){collision[1]=collision[0];}if(options.at[0]==="right"){basePosition.left+=targetWidth;}else if(options.at[0]==="center"){basePosition.left+=targetWidth/2;}if(options.at[1]==="bottom"){basePosition.top+=targetHeight;}else if(options.at[1]==="center"){basePosition.top+=targetHeight/2;}atOffset=getOffsets(offsets.at,targetWidth,targetHeight);basePosition.left+=atOffset[0];basePosition.top+=atOffset[1];return this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());if(options.my[0]==="right"){position.left-=elemWidth;}else if(options.my[0]==="center"){position.left-=elemWidth/2;}if(options.my[1]==="bottom"){position.top-=elemHeight;}else if(options.my[1]==="center"){position.top-=elemHeight/2;}position.left+=myOffset[0];position.top+=myOffset[1];if(!$.support.offsetFractions){position.left=round(position.left);position.top=round(position.top);}collisionPosition={marginLeft:marginLeft,marginTop:marginTop};$.each(["left","top"],function(i,dir){if($.ui.position[collision[i]]){$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem});}});if(options.using){using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};if(targetWidth<elemWidth&&abs(left+right)<targetWidth){feedback.horizontal="center";}if(targetHeight<elemHeight&&abs(top+bottom)<targetHeight){feedback.vertical="middle";}if(max(abs(left),abs(right))>max(abs(top),abs(bottom))){feedback.important="horizontal";}else{feedback.important="vertical";}options.using.call(this,props,feedback);};}elem.offset($.extend(position,{using:using}));});};$.ui.position={fit:{left:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset,newOverRight;if(data.collisionWidth>outerWidth){if(overLeft>0&&overRight<=0){newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset;position.left+=overLeft-newOverRight;}else if(overRight>0&&overLeft<=0){position.left=withinOffset;}else{if(overLeft>overRight){position.left=withinOffset+outerWidth-data.collisionWidth;}else{position.left=withinOffset;}}}else if(overLeft>0){position.left+=overLeft;}else if(overRight>0){position.left-=overRight;}else{position.left=max(position.left-collisionPosLeft,position.left);}},top:function(position,data){var within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset,newOverBottom;if(data.collisionHeight>outerHeight){if(overTop>0&&overBottom<=0){newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset;position.top+=overTop-newOverBottom;}else if(overBottom>0&&overTop<=0){position.top=withinOffset;}else{if(overTop>overBottom){position.top=withinOffset+outerHeight-data.collisionHeight;}else{position.top=withinOffset;}}}else if(overTop>0){position.top+=overTop;}else if(overBottom>0){position.top-=overBottom;}else{position.top=max(position.top-collisionPosTop,position.top);}}},flip:{left:function(position,data){var within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset=data.my[0]==="left"?-data.elemWidth:data.my[0]==="right"?data.elemWidth:0,atOffset=data.at[0]==="left"?data.targetWidth:data.at[0]==="right"?-data.targetWidth:0,offset=-2*data.offset[0],newOverRight,newOverLeft;if(overLeft<0){newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset;if(newOverRight<0||newOverRight<abs(overLeft)){position.left+=myOffset+atOffset+offset;}}else if(overRight>0){newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft;if(newOverLeft>0||abs(newOverLeft)<overRight){position.left+=myOffset+atOffset+offset;}}},top:function(position,data){var within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top=data.my[1]==="top",myOffset=top?-data.elemHeight:data.my[1]==="bottom"?data.elemHeight:0,atOffset=data.at[1]==="top"?data.targetHeight:data.at[1]==="bottom"?-data.targetHeight:0,offset=-2*data.offset[1],newOverTop,newOverBottom;if(overTop<0){newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset;if((position.top+myOffset+atOffset+offset)>overTop&&(newOverBottom<0||newOverBottom<abs(overTop))){position.top+=myOffset+atOffset+offset;}}else if(overBottom>0){newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop;if((position.top+myOffset+atOffset+offset)>overBottom&&(newOverTop>0||abs(newOverTop)<overBottom)){position.top+=myOffset+atOffset+offset;}}}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments);$.ui.position.fit.left.apply(this,arguments);},top:function(){$.ui.position.flip.top.apply(this,arguments);$.ui.position.fit.top.apply(this,arguments);}}};(function(){var testElement,testElementParent,testElementStyle,offsetLeft,i,body=document.getElementsByTagName("body")[0],div=document.createElement("div");testElement=document.createElement(body?"div":"body");testElementStyle={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};if(body){$.extend(testElementStyle,{position:"absolute",left:"-1000px",top:"-1000px"});}for(i in testElementStyle){testElement.style[i]=testElementStyle[i];}testElement.appendChild(div);testElementParent=body||document.documentElement;testElementParent.insertBefore(testElement,testElementParent.firstChild);div.style.cssText="position: absolute; left: 10.7432222px;";offsetLeft=$(div).offset().left;$.support.offsetFractions=offsetLeft>10&&offsetLeft<11;testElement.innerHTML="";testElementParent.removeChild(testElement);})();}(jQuery));;},{},{});mw.loader.implement("jquery.ui.slider",function($){(function($,undefined){var numPages=5;$.widget("ui.slider",$.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=false;this._mouseSliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider"+" ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._refresh();this._setOption("disabled",this.options.disabled);this._animateOff=false;},_refresh:function(){this._createRange();this._createHandles();this._setupEvents();this._refreshValue();},_createHandles:function(){var i,handleCount,options=this.options,existingHandles=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),handle="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",handles=[];handleCount=(options.values&&options.values.length)||1;if(existingHandles.length>handleCount){existingHandles.slice(handleCount).remove();existingHandles=existingHandles.slice(0,handleCount);}for(i=existingHandles.length;i<handleCount;i++){handles.push(handle);}this.handles=existingHandles.add($(handles.join("")).appendTo(this.element));this.handle=this.handles.eq(0);this.handles.each(function(i){$(this).data("ui-slider-handle-index",i);});},_createRange:function(){var options=this.options,classes="";if(options.range){if(options.range===true){if(!options.values){options.values=[this._valueMin(),this._valueMin()];}else if(options.values.length&&options.values.length!==2){options.values=[options.values[0],options.values[0]];}else if($.isArray(options.values)){options.values=options.values.slice(0);}}if(!this.range||!this.range.length){this.range=$("<div></div>").appendTo(this.element);classes="ui-slider-range"+" ui-widget-header ui-corner-all";}else{this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({"left":"","bottom":""});}this.range.addClass(classes+((options.range==="min"||options.range==="max")?" ui-slider-range-"+options.range:""));}else{this.range=$([]);}},_setupEvents:function(){var elements=this.handles.add(this.range).filter("a");this._off(elements);this._on(elements,this._handleEvents);this._hoverable(elements);this._focusable(elements);},_destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider"+" ui-slider-horizontal"+" ui-slider-vertical"+" ui-widget"+" ui-widget-content"+" ui-corner-all");this._mouseDestroy();},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,allowed,offset,mouseOverHandle,that=this,o=this.options;if(o.disabled){return false;}this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();position={x:event.pageX,y:event.pageY};normValue=this._normValueFromMouse(position);distance=this._valueMax()-this._valueMin()+1;this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));if((distance>thisDistance)||(distance===thisDistance&&(i===that._lastChangedValue||that.values(i)===o.min))){distance=thisDistance;closestHandle=$(this);index=i;}});allowed=this._start(event,index);if(allowed===false){return false;}this._mouseSliding=true;this._handleIndex=index;closestHandle.addClass("ui-state-active").focus();offset=closestHandle.offset();mouseOverHandle=!$(event.target).parents().addBack().is(".ui-slider-handle");this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-(closestHandle.width()/2),top:event.pageY-offset.top-(closestHandle.height()/2)-(parseInt(closestHandle.css("borderTopWidth"),10)||0)-(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+(parseInt(closestHandle.css("marginTop"),10)||0)};if(!this.handles.hasClass("ui-state-hover")){this._slide(event,index,normValue);}this._animateOff=true;return true;},_mouseStart:function(){return true;},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);this._slide(event,this._handleIndex,normValue);return false;},_mouseStop:function(event){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(event,this._handleIndex);this._change(event,this._handleIndex);this._handleIndex=null;this._clickOffset=null;this._animateOff=false;return false;},_detectOrientation:function(){this.orientation=(this.options.orientation==="vertical")?"vertical":"horizontal";},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;if(this.orientation==="horizontal"){pixelTotal=this.elementSize.width;pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0);}else{pixelTotal=this.elementSize.height;pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0);}percentMouse=(pixelMouse/pixelTotal);if(percentMouse>1){percentMouse=1;}if(percentMouse<0){percentMouse=0;}if(this.orientation==="vertical"){percentMouse=1-percentMouse;}valueTotal=this._valueMax()-this._valueMin();valueMouse=this._valueMin()+percentMouse*valueTotal;return this._trimAlignValue(valueMouse);},_start:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}return this._trigger("start",event,uiHash);},_slide:function(event,index,newVal){var otherVal,newValues,allowed;if(this.options.values&&this.options.values.length){otherVal=this.values(index?0:1);if((this.options.values.length===2&&this.options.range===true)&&((index===0&&newVal>otherVal)||(index===1&&newVal<otherVal))){newVal=otherVal;}if(newVal!==this.values(index)){newValues=this.values();newValues[index]=newVal;allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal,values:newValues});otherVal=this.values(index?0:1);if(allowed!==false){this.values(index,newVal,true);}}}else{if(newVal!==this.value()){allowed=this._trigger("slide",event,{handle:this.handles[index],value:newVal});if(allowed!==false){this.value(newVal);}}}},_stop:function(event,index){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}this._trigger("stop",event,uiHash);},_change:function(event,index){if(!this._keySliding&&!this._mouseSliding){var uiHash={handle:this.handles[index],value:this.value()};if(this.options.values&&this.options.values.length){uiHash.value=this.values(index);uiHash.values=this.values();}this._lastChangedValue=index;this._trigger("change",event,uiHash);}},value:function(newValue){if(arguments.length){this.options.value=this._trimAlignValue(newValue);this._refreshValue();this._change(null,0);return;}return this._value();},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1){this.options.values[index]=this._trimAlignValue(newValue);this._refreshValue();this._change(null,index);return;}if(arguments.length){if($.isArray(arguments[0])){vals=this.options.values;newValues=arguments[0];for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(newValues[i]);this._change(null,i);}this._refreshValue();}else{if(this.options.values&&this.options.values.length){return this._values(index);}else{return this.value();}}}else{return this._values();}},_setOption:function(key,value){var i,valsLength=0;if(key==="range"&&this.options.range===true){if(value==="min"){this.options.value=this._values(0);this.options.values=null;}else if(value==="max"){this.options.value=this._values(this.options.values.length-1);this.options.values=null;}}if($.isArray(this.options.values)){valsLength=this.options.values.length;}$.Widget.prototype._setOption.apply(this,arguments);switch(key){case"orientation":this._detectOrientation();this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case"value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case"values":this._animateOff=true;this._refreshValue();for(i=0;i<valsLength;i+=1){this._change(null,i);}this._animateOff=false;break;case"min":case"max":this._animateOff=true;this._refreshValue();this._animateOff=false;break;case"range":this._animateOff=true;this._refresh();this._animateOff=false;break;}},_value:function(){var val=this.options.value;val=this._trimAlignValue(val);return val;},_values:function(index){var val,vals,i;if(arguments.length){val=this.options.values[index];val=this._trimAlignValue(val);return val;}else if(this.options.values&&this.options.values.length){vals=this.options.values.slice();for(i=0;i<vals.length;i+=1){vals[i]=this._trimAlignValue(vals[i]);}return vals;}else{return[];}},_trimAlignValue:function(val){if(val<=this._valueMin()){return this._valueMin();}if(val>=this._valueMax()){return this._valueMax();}var step=(this.options.step>0)?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;if(Math.abs(valModStep)*2>=step){alignValue+=(valModStep>0)?step:(-step);}return parseFloat(alignValue.toFixed(5));},_valueMin:function(){return this.options.min;},_valueMax:function(){return this.options.max;},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=(!this._animateOff)?o.animate:false,_set={};if(this.options.values&&this.options.values.length){this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100;_set[that.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate);if(that.options.range===true){if(that.orientation==="horizontal"){if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate);}if(i===1){that.range[animate?"animate":"css"]({width:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}else{if(i===0){that.range.stop(1,1)[animate?"animate":"css"]({bottom:(valPercent)+"%"},o.animate);}if(i===1){that.range[animate?"animate":"css"]({height:(valPercent-lastValPercent)+"%"},{queue:false,duration:o.animate});}}}lastValPercent=valPercent;});}else{value=this.value();valueMin=this._valueMin();valueMax=this._valueMax();valPercent=(valueMax!==valueMin)?(value-valueMin)/(valueMax-valueMin)*100:0;_set[this.orientation==="horizontal"?"left":"bottom"]=valPercent+"%";this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate);if(oRange==="min"&&this.orientation==="horizontal"){this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate);}if(oRange==="max"&&this.orientation==="horizontal"){this.range[animate?"animate":"css"]({width:(100-valPercent)+"%"},{queue:false,duration:o.animate});}if(oRange==="min"&&this.orientation==="vertical"){this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate);}if(oRange==="max"&&this.orientation==="vertical"){this.range[animate?"animate":"css"]({height:(100-valPercent)+"%"},{queue:false,duration:o.animate});}}},_handleEvents:{keydown:function(event){var allowed,curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:event.preventDefault();if(!this._keySliding){this._keySliding=true;$(event.target).addClass("ui-state-active");allowed=this._start(event,index);if(allowed===false){return;}}break;}step=this.options.step;if(this.options.values&&this.options.values.length){curVal=newVal=this.values(index);}else{curVal=newVal=this.value();}switch(event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+((this._valueMax()-this._valueMin())/numPages));break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-((this._valueMax()-this._valueMin())/numPages));break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax()){return;}newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin()){return;}newVal=this._trimAlignValue(curVal-step);break;}this._slide(event,index,newVal);},click:function(event){event.preventDefault();},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");if(this._keySliding){this._keySliding=false;this._stop(event,index);this._change(event,index);$(event.target).removeClass("ui-state-active");}}}});}(jQuery));;},{"all":".ui-slider{position:relative;text-align:left}.ui-slider .ui-slider-handle{position:absolute;z-index:2;width:1.2em;height:1.2em;cursor:default}.ui-slider .ui-slider-range{position:absolute;z-index:1;font-size:.7em;display:block;border:0;background-position:0 0} .ui-slider.ui-state-disabled .ui-slider-handle,.ui-slider.ui-state-disabled .ui-slider-range{filter:inherit}.ui-slider-horizontal{height:.8em}.ui-slider-horizontal .ui-slider-handle{top:-.3em;margin-left:-.6em}.ui-slider-horizontal .ui-slider-range{top:0;height:100%}.ui-slider-horizontal .ui-slider-range-min{left:0}.ui-slider-horizontal .ui-slider-range-max{right:0}.ui-slider-vertical{width:.8em;height:100px}.ui-slider-vertical .ui-slider-handle{left:-.3em;margin-left:0;margin-bottom:-.6em}.ui-slider-vertical .ui-slider-range{left:0;width:100%}.ui-slider-vertical .ui-slider-range-min{bottom:0}.ui-slider-vertical .ui-slider-range-max{top:0}\n\n/* cache key: resourceloader:filter:minify-css:7:be3ff74589a1fede91194c0f8bbf34ed */\n"},{});mw.loader.implement("jquery.ui.tooltip",function($){(function($){var increments=0;function addDescribedBy(elem,id){var describedby=(elem.attr("aria-describedby")||"").split(/\s+/);describedby.push(id);elem.data("ui-tooltip-id",id);}function removeDescribedBy(elem){var id=elem.data("ui-tooltip-id"),describedby=(elem.attr("aria-describedby")||"").split(/\s+/),index=$.inArray(id,describedby);if(index!==-1){describedby.splice(index,1);}elem.removeData("ui-tooltip-id");describedby=$.trim(describedby.join(" "));if(describedby){elem.attr("aria-describedby",describedby);}else{elem.removeAttr("aria-describedby");}}$.widget("ui.tooltip",{version:"1.10.3",options:{content:function(){var title=$(this).attr("title")||"";return $("<a>").text(title).html();},hide:true,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:true,tooltipClass:null,track:false,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"});this.tooltips={};this.parents={};if(this.options.disabled){this._disable();}},_setOption:function(key,value){var that=this;if(key==="disabled"){this[value?"_disable":"_enable"]();this.options[key]=value;return;}this._super(key,value);if(key==="content"){$.each(this.tooltips,function(id,element){that._updateContent(element);});}},_disable:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);});this.element.find(this.options.items).addBack().each(function(){var element=$(this);if(element.is("[title]")){element.data("ui-tooltip-title",element.attr("title")).attr("title","");}});},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var element=$(this);if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));}});},open:function(event){var that=this,target=$(event?event.target:this.element).closest(this.options.items);if(!target.length||target.data("ui-tooltip-id")){return;}if(target.attr("title")){target.data("ui-tooltip-title",target.attr("title"));}target.data("ui-tooltip-open",true);if(event&&event.type==="mouseover"){target.parents().each(function(){var parent=$(this),blurEvent;if(parent.data("ui-tooltip-open")){blurEvent=$.Event("blur");blurEvent.target=blurEvent.currentTarget=this;that.close(blurEvent,true);}if(parent.attr("title")){parent.uniqueId();that.parents[this.id]={element:this,title:parent.attr("title")};parent.attr("title","");}});}this._updateContent(target,event);},_updateContent:function(target,event){var content,contentOption=this.options.content,that=this,eventType=event?event.type:null;if(typeof contentOption==="string"){return this._open(event,target,contentOption);}content=contentOption.call(target[0],function(response){if(!target.data("ui-tooltip-open")){return;}that._delay(function(){if(event){event.type=eventType;}this._open(event,target,response);});});if(content){this._open(event,target,content);}},_open:function(event,target,content){var tooltip,events,delayedShow,positionOption=$.extend({},this.options.position);if(!content){return;}tooltip=this._find(target);if(tooltip.length){tooltip.find(".ui-tooltip-content").html(content);return;}if(target.is("[title]")){if(event&&event.type==="mouseover"){target.attr("title","");}else{target.removeAttr("title");}}tooltip=this._tooltip(target);addDescribedBy(target,tooltip.attr("id"));tooltip.find(".ui-tooltip-content").html(content);function position(event){positionOption.of=event;if(tooltip.is(":hidden")){return;}tooltip.position(positionOption);}if(this.options.track&&event&&/^mouse/.test(event.type)){this._on(this.document,{mousemove:position});position(event);}else{tooltip.position($.extend({of:target},this.options.position));}tooltip.hide();this._show(tooltip,this.options.show);if(this.options.show&&this.options.show.delay){delayedShow=this.delayedShow=setInterval(function(){if(tooltip.is(":visible")){position(positionOption.of);clearInterval(delayedShow);}},$.fx.interval);}this._trigger("open",event,{tooltip:tooltip});events={keyup:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){var fakeEvent=$.Event(event);fakeEvent.currentTarget=target[0];this.close(fakeEvent,true);}},remove:function(){this._removeTooltip(tooltip);}};if(!event||event.type==="mouseover"){events.mouseleave="close";}if(!event||event.type==="focusin"){events.focusout="close";}this._on(true,target,events);},close:function(event){var that=this,target=$(event?event.currentTarget:this.element),tooltip=this._find(target);if(this.closing){return;}clearInterval(this.delayedShow);if(target.data("ui-tooltip-title")){target.attr("title",target.data("ui-tooltip-title"));}removeDescribedBy(target);tooltip.stop(true);this._hide(tooltip,this.options.hide,function(){that._removeTooltip($(this));});target.removeData("ui-tooltip-open");this._off(target,"mouseleave focusout keyup");if(target[0]!==this.element[0]){this._off(target,"remove");}this._off(this.document,"mousemove");if(event&&event.type==="mouseleave"){$.each(this.parents,function(id,parent){$(parent.element).attr("title",parent.title);delete that.parents[id];});}this.closing=true;this._trigger("close",event,{tooltip:tooltip});this.closing=false;},_tooltip:function(element){var id="ui-tooltip-"+increments++,tooltip=$("<div>").attr({id:id,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));$("<div>").addClass("ui-tooltip-content").appendTo(tooltip);tooltip.appendTo(this.document[0].body);this.tooltips[id]=element;return tooltip;},_find:function(target){var id=target.data("ui-tooltip-id");return id?$("#"+id):$();},_removeTooltip:function(tooltip){tooltip.remove();delete this.tooltips[tooltip.attr("id")];},_destroy:function(){var that=this;$.each(this.tooltips,function(id,element){var event=$.Event("blur");event.target=event.currentTarget=element[0];that.close(event,true);$("#"+id).remove();if(element.data("ui-tooltip-title")){element.attr("title",element.data("ui-tooltip-title"));element.removeData("ui-tooltip-title");}});}});}(jQuery));;},{"all":".ui-tooltip{padding:8px;position:absolute;z-index:9999;max-width:300px;-webkit-box-shadow:0 0 5px #aaa;box-shadow:0 0 5px #aaa}body .ui-tooltip{border-width:2px}\n\n/* cache key: resourceloader:filter:minify-css:7:74dc316b0056155feeb3090bf2253792 */\n"},{});mw.loader.implement("jquery.ui.touchPunch",function($){(function($){$.support.touch='ontouchend'in document;if(!$.support.touch){return;}var mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,touchHandled;function simulateMouseEvent(event,simulatedType){if(event.originalEvent.touches.length>1){return;}event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent('MouseEvents');simulatedEvent.initMouseEvent(simulatedType,true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);event.target.dispatchEvent(simulatedEvent);}mouseProto._touchStart=function(event){var self=this;if(touchHandled||!self._mouseCapture(event.originalEvent.changedTouches[0])){return;}touchHandled=true;self._touchMoved=false;simulateMouseEvent(event,'mouseover');simulateMouseEvent(event,'mousemove');simulateMouseEvent(event,'mousedown');};mouseProto._touchMove=function(event){if(!touchHandled){return;}this._touchMoved=true;simulateMouseEvent(event,'mousemove');};mouseProto._touchEnd=function(event){if(!touchHandled){return;}simulateMouseEvent(event,'mouseup');simulateMouseEvent(event,'mouseout');if(!this._touchMoved){simulateMouseEvent(event,'click');}touchHandled=false;};mouseProto._mouseInit=function(){var self=this;self.element.bind('touchstart',$.proxy(self,'_touchStart')).bind('touchmove',$.proxy(self,'_touchMove')).bind('touchend',$.proxy(self,'_touchEnd'));_mouseInit.call(self);};})(jQuery);;},{},{});mw.loader.implement("jquery.ui.widget",function($){(function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var i=0,elem;(elem=elems[i])!=null;i++){try{$(elem).triggerHandler("remove");}catch(e){}}_cleanData(elems);};$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];fullName=namespace+"-"+name;if(!prototype){prototype=base;base=$.Widget;}$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName);};$[namespace]=$[namespace]||{};existingConstructor=$[namespace][name];constructor=$[namespace][name]=function(options,element){if(!this._createWidget){return new constructor(options,element);}if(arguments.length){this._createWidget(options,element);}};$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]});basePrototype=new base();basePrototype.options=$.widget.extend({},basePrototype.options);$.each(prototype,function(prop,value){if(!$.isFunction(value)){proxiedPrototype[prop]=value;return;}proxiedPrototype[prop]=(function(){var _super=function(){return base.prototype[prop].apply(this,arguments);},_superApply=function(args){return base.prototype[prop].apply(this,args);};return function(){var __super=this._super,__superApply=this._superApply,returnValue;this._super=_super;this._superApply=_superApply;returnValue=value.apply(this,arguments);this._super=__super;this._superApply=__superApply;return returnValue;};})();});constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?(basePrototype.widgetEventPrefix||name):name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName});if(existingConstructor){$.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto);});delete existingConstructor._childConstructors;}else{base._childConstructors.push(constructor);}$.widget.bridge(name,constructor);};$.widget.extend=function(target){var input=slice.call(arguments,1),inputIndex=0,inputLength=input.length,key,value;for(;inputIndex<inputLength;inputIndex++){for(key in input[inputIndex]){value=input[inputIndex][key];if(input[inputIndex].hasOwnProperty(key)&&value!==undefined){if($.isPlainObject(value)){target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value);}else{target[key]=value;}}}}return target;};$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall=typeof options==="string",args=slice.call(arguments,1),returnValue=this;options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options;if(isMethodCall){this.each(function(){var methodValue,instance=$.data(this,fullName);if(!instance){return $.error("cannot call methods on "+name+" prior to initialization; "+"attempted to call method '"+options+"'");}if(!$.isFunction(instance[options])||options.charAt(0)==="_"){return $.error("no such method '"+options+"' for "+name+" widget instance");}methodValue=instance[options].apply(instance,args);if(methodValue!==instance&&methodValue!==undefined){returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue;return false;}});}else{this.each(function(){var instance=$.data(this,fullName);if(instance){instance.option(options||{})._init();}else{$.data(this,fullName,new object(options,this));}});}return returnValue;};};$.Widget=function(){};$.Widget._childConstructors=[];$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0];this.element=$(element);this.uuid=uuid++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=$.widget.extend({},this.options,this._getCreateOptions(),options);this.bindings=$();this.hoverable=$();this.focusable=$();if(element!==this){$.data(element,this.widgetFullName,this);this._on(true,this.element,{remove:function(event){if(event.target===element){this.destroy();}}});this.document=$(element.style?element.ownerDocument:element.document||element);this.window=$(this.document[0].defaultView||this.document[0].parentWindow);}this._create();this._trigger("create",null,this._getCreateEventData());this._init();},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");},_destroy:$.noop,widget:function(){return this.element;},option:function(key,value){var options=key,parts,curOption,i;if(arguments.length===0){return $.widget.extend({},this.options);}if(typeof key==="string"){options={};parts=key.split(".");key=parts.shift();if(parts.length){curOption=options[key]=$.widget.extend({},this.options[key]);for(i=0;i<parts.length-1;i++){curOption[parts[i]]=curOption[parts[i]]||{};curOption=curOption[parts[i]];}key=parts.pop();if(arguments.length===1){return curOption[key]===undefined?null:curOption[key];}curOption[key]=value;}else{if(arguments.length===1){return this.options[key]===undefined?null:this.options[key];}options[key]=value;}}this._setOptions(options);return this;},_setOptions:function(options){var key;for(key in options){this._setOption(key,options[key]);}return this;},_setOption:function(key,value){this.options[key]=value;if(key==="disabled"){this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus");}return this;},enable:function(){return this._setOption("disabled",false);},disable:function(){return this._setOption("disabled",true);},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;if(typeof suppressDisabledCheck!=="boolean"){handlers=element;element=suppressDisabledCheck;suppressDisabledCheck=false;}if(!handlers){handlers=element;element=this.element;delegateElement=this.widget();}else{element=delegateElement=$(element);this.bindings=this.bindings.add(element);}$.each(handlers,function(event,handler){function handlerProxy(){if(!suppressDisabledCheck&&(instance.options.disabled===true||$(this).hasClass("ui-state-disabled"))){return;}return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}if(typeof handler!=="string"){handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++;}var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];if(selector){delegateElement.delegate(selector,eventName,handlerProxy);}else{element.bind(eventName,handlerProxy);}});},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;element.unbind(eventName).undelegate(eventName);},_delay:function(handler,delay){function handlerProxy(){return(typeof handler==="string"?instance[handler]:handler).apply(instance,arguments);}var instance=this;return setTimeout(handlerProxy,delay||0);},_hoverable:function(element){this.hoverable=this.hoverable.add(element);this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover");},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover");}});},_focusable:function(element){this.focusable=this.focusable.add(element);this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus");},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus");}});},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];data=data||{};event=$.Event(event);event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase();event.target=this.element[0];orig=event.originalEvent;if(orig){for(prop in orig){if(!(prop in event)){event[prop]=orig[prop];}}}this.element.trigger(event,data);return!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===false||event.isDefaultPrevented());}};$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){if(typeof options==="string"){options={effect:options};}var hasOptions,effectName=!options?method:options===true||typeof options==="number"?defaultEffect:options.effect||defaultEffect;options=options||{};if(typeof options==="number"){options={duration:options};}hasOptions=!$.isEmptyObject(options);options.complete=callback;if(options.delay){element.delay(options.delay);}if(hasOptions&&$.effects&&$.effects.effect[effectName]){element[method](options);}else if(effectName!==method&&element[effectName]){element[effectName](options.duration,options.easing,callback);}else{element.queue(function(next){$(this)[method]();if(callback){callback.call(element[0]);}next();});}};});})(jQuery);;},{},{});mw.loader.implement("mediawiki.Uri",function($){(function($,mw){function cat(pre,val,post,raw){if(val===undefined||val===null||val===''){return'';}else{return pre+(raw?val:mw.Uri.encode(val))+post;}}var parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/(?:(?:([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)?((?:[^?#\/]*\/)*[^?#]*)(?:\?([^#]*))?(?:#(.*))?/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?(?:(?:([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?((?:\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?[^?#\/]*)(?:\?([^#]*))?(?:#(.*))?/},properties=['protocol','user','password','host','port','path','query','fragment'];mw.UriRelative=function(documentLocation){function Uri(uri,options){options=typeof options==='object'?options:{strictMode:!!options};options=$.extend({strictMode:false,overrideKeys:false},options);if(uri!==undefined&&uri!==null||uri!==''){if(typeof uri==='string'){this._parse(uri,options);}else if(typeof uri==='object'){var _this=this;$.each(properties,function(i,property){_this[property]=uri[property];});if(this.query===undefined){this.query={};}}}if(!this.protocol){this.protocol=defaultUri.protocol;}try{if(!this.host){this.host=defaultUri.host;if(!this.port){this.port=defaultUri.port;}}if(this.path&&this.path.charAt(0)!=='/'){throw new Error('Bad constructor arguments');}if(!(this.protocol&&this.host&&this.path)){throw new Error('Bad constructor arguments');}}catch(e){mw.log(e);}}Uri.encode=function(s){return encodeURIComponent(s).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A').replace(/%20/g,'+');};Uri.decode=function(s){return decodeURIComponent(s.replace(/\+/g,'%20'));};Uri.prototype={_parse:function(str,options){var matches=parser[options.strictMode?'strict':'loose'].exec(str);var uri=this;$.each(properties,function(i,property){uri[property]=matches[i+1];});var q={};if(uri.query){uri.query.replace(/(?:^|&)([^&=]*)(?:(=)([^&]*))?/g,function($0,$1,$2,$3){if($1){var k=Uri.decode($1);var v=($2===''||$2===undefined)?null:Uri.decode($3);if(options.overrideKeys||q[k]===undefined){q[k]=v;}else{if(typeof q[k]==='string'){q[k]=[q[k]];}if($.isArray(q[k])){q[k].push(v);}}}});}this.query=q;},getUserInfo:function(){return cat('',this.user,cat(':',this.password,''));},getHostPort:function(){return this.host+cat(':',this.port,'');},getAuthority:function(){return cat('',this.getUserInfo(),'@')+this.getHostPort();},getQueryString:function(){var args=[];$.each(this.query,function(key,val){var k=Uri.encode(key);var vals=val===null?[null]:$.makeArray(val);$.each(vals,function(i,v){args.push(k+(v===null?'':'='+Uri.encode(v)));});});return args.join('&');},getRelativePath:function(){return this.path+cat('?',this.getQueryString(),'',true)+cat('#',this.fragment,'');},toString:function(){return this.protocol+'://'+this.getAuthority()+this.getRelativePath();},clone:function(){return new Uri(this);},extend:function(parameters){$.extend(this.query,parameters);return this;}};var defaultUri=new Uri(documentLocation);return Uri;};if(document&&document.location&&document.location.href){if(typeof document.location=='undefined'||!document.location.href){mw.Uri=mw.UriRelative('http://webview.com/fixme');}else{mw.Uri=mw.UriRelative(document.location.href);}}})(jQuery,mediaWiki);;},{},{});mw.loader.implement("mediawiki.UtilitiesTime",function($){(function(mw){mw.seconds2npt=function(sec,show_ms,mm_format){var hoursStr;if(isNaN(sec)){mw.log("Warning: mediawiki.UtilitiesTime, trying to get npt time on NaN:"+sec);return'0:00:00';}var tm=mw.seconds2Measurements(sec);if(show_ms){tm.seconds=Math.round(tm.seconds*1000)/1000;}else{tm.seconds=Math.round(tm.seconds);}if(tm.seconds<10){tm.seconds='0'+tm.seconds;}if(tm.hours==0){hoursStr='';if(mm_format&&tm.minutes<10)tm.minutes='0'+tm.minutes;}else{if(tm.minutes<10)tm.minutes='0'+tm.minutes;hoursStr=tm.hours;}hoursStr+=tm.days*24||'';if(hoursStr){hoursStr+=':';}return hoursStr+tm.minutes+":"+tm.seconds;};mw.seconds2Measurements=function(sec){var tm={};tm.days=Math.floor(sec/(3600*24));tm.hours=Math.floor(Math.round(sec)/3600)%24;tm.minutes=Math.floor((Math.round(sec)/60)%60);tm.seconds=Math.round(sec)%60;return tm;};mw.measurements2seconds=function(timeMeasurements){var seconds=0;if(timeMeasurements.days){seconds+=parseInt(timeMeasurements.days,10)*24*3600;}if(timeMeasurements.hours){seconds+=parseInt(timeMeasurements.hours,10)*3600;}if(timeMeasurements.minutes){seconds+=parseInt(timeMeasurements.minutes,10)*60;}if(timeMeasurements.seconds){seconds+=parseInt(timeMeasurements.seconds,10);}if(timeMeasurements.milliseconds){seconds+=parseFloat(timeMeasurements.milliseconds);}return seconds;};mw.npt2seconds=function(npt_str){if(!npt_str){return 0;}npt_str=npt_str.replace(/npt:|s/g,'');var hour=0;var min=0;var sec=0;times=npt_str.split(':');if(times.length==4){sec=times[2]+'.'+times[3];min=times[1];hour=times[0];}else if(times.length==3){sec=times[2];min=times[1];hour=times[0];}else if(times.length==2){sec=times[1];min=times[0];}else{sec=times[0];}sec=sec.replace(/,\s?/,'.');return parseInt(hour*3600)+parseInt(min*60)+parseFloat(sec);};})(window.mediaWiki);;},{},{});mw.loader.implement("mediawiki.UtilitiesUrl",function($){(function(mw){mw.absoluteUrl=function(source,contextUrl){if(source.indexOf('http://')===0||source.indexOf('https://')===0){return source;}if(!contextUrl){contextUrl=document.URL;}var contextUrl=new mw.Uri(contextUrl);if(source.indexOf('//')===0){return contextUrl.protocol+':'+source;}if(contextUrl.directory==''&&contextUrl.protocol=='file'){var fileUrl=contextUrl.split('\\');fileUrl.pop();return fileUrl.join('\\')+'\\'+src;}if(source.indexOf('/')===0){return contextUrl.protocol+'://'+contextUrl.getAuthority()+source;}else{return contextUrl.protocol+'://'+contextUrl.getAuthority()+contextUrl.path+source;}};mw.isLocalDomain=function(url){if(!url){return false;}if((url.indexOf('http://')!=0&&url.indexOf('//')!=0&&url.indexOf('https://')!=0)||new mw.Uri(document.URL).host==new mw.Uri(url).host){return true;}return false;}})(window.mediaWiki);;},{},{});mw.loader.implement("mediawiki.client",function($){(function(mw){var userAgent=navigator.userAgent;mw.isMobileDevice=function(){return(mw.isIphone()||mw.isIpod()||mw.isIpad()||mw.isAndroid()||mw.isWindowsPhone()||mw.getConfig("EmbedPlayer.ForceNativeComponent")===true||mw.getConfig("EmbedPlayer.SimulateMobile")===true)};mw.isNativeApp=function(){return mw.getConfig("EmbedPlayer.ForceNativeComponent");};mw.isIphone=function(){return(mw.getConfig("EmbedPlayer.ForceNativeComponent")!==true&&userAgent.indexOf('iPhone')!=-1&&!mw.isIpad())||mw.isIpod();};mw.isIE=function(){return(/msie/.test(userAgent.toLowerCase())||/trident/.test(userAgent.toLowerCase()));};mw.isChromeCast=function(){return(/CrKey/.test(userAgent));};mw.isIE7=function(){return(/msie 7/.test(userAgent.toLowerCase()));};mw.isIE8=function(){return document.documentMode===8;};mw.isIE9=function(){return document.documentMode===9;};mw.isIE11=function(){return(/trident\/7.0/.test(userAgent.toLowerCase()));};mw.isEdge=function(){return(/edge/.test(userAgent.toLowerCase()));};mw.isDesktopSafari=function(){return mw.isSafari()&&!mw.isMobileDevice();};mw.isSafari=function(){return(/safari/).test(userAgent.toLowerCase())&&!mw.isChrome()&&!mw.isEdge();};mw.isIE9Comp=function(){return(/msie 7/.test(userAgent.toLowerCase())&&/trident\/5/.test(userAgent.toLowerCase()));};mw.isIE10Comp=function(){return(/msie 7/.test(userAgent.toLowerCase())&&/trident\/6/.test(userAgent.toLowerCase()));};mw.isIphone4=function(){return(mw.isIphone()&&(window.devicePixelRatio&&window.devicePixelRatio>=2));};mw.isIpod=function(){return(userAgent.indexOf('iPod')!=-1);};mw.isIpad=function(){return(userAgent.indexOf('iPad')!=-1);};mw.isIpad2=function(){return(mw.isIpad()&&window.devicePixelRatio&&window.devicePixelRatio<2);};mw.isIpad3=function(){return/OS 3_/.test(userAgent)&&mw.isIpad();};mw.isAndroid44=function(){return(userAgent.indexOf('Android 4.4')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid43=function(){return(userAgent.indexOf('Android 4.3')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid42=function(){return(userAgent.indexOf('Android 4.2')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid41=function(){return(userAgent.indexOf('Android 4.1')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid40=function(){return(userAgent.indexOf('Android 4.0')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid2=function(){return(userAgent.indexOf('Android 2.')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid=function(){return(userAgent.indexOf('Android')!=-1&&userAgent.indexOf('Windows')===-1);};mw.isAndroid4andUp=function(){return((userAgent.indexOf('Android 4.')!=-1)||(userAgent.indexOf('Android 5.')!=-1)||(userAgent.indexOf('Android 6.')!=-1))&&userAgent.indexOf('Windows')===-1;};mw.isFirefox=function(){return(userAgent.indexOf('Firefox')!=-1);};mw.isChrome=function(){return(userAgent.indexOf('Chrome')!=-1&&!mw.isEdge());};mw.isAndroidNativeBrowser=function(){return(mw.isAndroid()&&!mw.isFirefox()&&!mw.isChrome());};mw.isAndroidChromeNativeBrowser=function(){return(mw.isAndroid()&&mw.isChrome());};mw.isOldAndroidChromeNativeBrowser=function(){var regExpResult=userAgent.match(/Chrome\/([0-9][0-9])/);if(regExpResult instanceof Array&&regExpResult.length>1){return mw.isAndroidChromeNativeBrowser()&&parseInt(regExpResult[1])<30;}return false;};mw.isMobileChrome=function(){return(mw.isAndroid4andUp()&&userAgent.indexOf('Chrome')!=-1)};mw.isWindowsPhone=function(){return userAgent.indexOf('Windows Phone')!=-1;};mw.isIOS=function(){return(mw.isIphone()||mw.isIpod()||mw.isIpad());};mw.isIOS3=function(){return/OS 3_/.test(userAgent)&&mw.isIOS();};mw.isIOS4=function(){return/OS 4_/.test(userAgent)&&mw.isIOS();};mw.isIOS5=function(){return/OS 5_/.test(userAgent)&&mw.isIOS();};mw.isIOS6=function(){return/OS 6_/.test(userAgent)&&mw.isIOS();};mw.isIOS7=function(){return/OS 7_/.test(userAgent)&&mw.isIOS();};mw.isIOS71=function(){return/OS 7_1/.test(userAgent)&&mw.isIOS();};mw.isIOS8=function(){return(/OS 8_/.test(userAgent)||/Version\/8/.test(userAgent))&&mw.isIOS();};mw.isIOS9=function(){return(/OS 9_/.test(userAgent)||/Version\/9/.test(userAgent))&&mw.isIOS();};mw.isIOS10=function(){return(/OS 10_/.test(userAgent)||/Version\/10/.test(userAgent))&&mw.isIOS();};mw.isIOSBelow9=function(){return mw.isIOS()&&(mw.isIOS3()||mw.isIOS4()||mw.isIOS5()||mw.isIOS6()||mw.isIOS7()||mw.isIOS8());};mw.isIOSAbove7=function(){return mw.isIOS8()||mw.isIOS9()||mw.isIOS10();};mw.isSilk=function(){return/\bSilk\b/.test(userAgent);};mw.hasNativeTouchBindings=function(){return(mw.isAndroid41()||mw.isAndroid42()||(mw.isAndroid()&&mw.isFirefox()));};mw.isDeviceLessThan480P=function(){return matchMedia('only screen and (max-device-width: 480px)').matches;};mw.hasMouseEvents=function(){return!mw.isMobileDevice();};mw.isTouchDevice=function(){return!!('ontouchstart'in window)||(mw.getConfig("EmbedPlayer.EnableMobileSkin")===true&&mw.getConfig("EmbedPlayer.SimulateMobile")===true);};mw.isMacintosh=function(){return navigator.platform.indexOf('Mac')>-1};mw.isWindows=function(){return navigator.platform.indexOf('Win')>-1};mw.getUserOS=function(){var os="";var nAgt=navigator.userAgent;var clientStrings=[{s:'Windows 10',r:/(Windows 10.0|Windows NT 10.0)/},{s:'Windows 8.1',r:/(Windows 8.1|Windows NT 6.3)/},{s:'Windows 8',r:/(Windows 8|Windows NT 6.2)/},{s:'Windows 7',r:/(Windows 7|Windows NT 6.1)/},{s:'Android',r:/Android/},{s:'Linux',r:/(Linux|X11)/},{s:'iOS',r:/(iPhone|iPad|iPod)/},{s:'Mac OS X',r:/Mac OS X/},{s:'Mac OS',r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},];for(var id in clientStrings){var cs=clientStrings[id];if(cs.r.test(nAgt)){os=cs.s;break;}}return os;};mw.isHTML5FallForwardNative=function(){if(mw.isMobileHTML5()){return true;}if(document.URL.indexOf('forceMobileHTML5')!=-1){return true;}if(mw.supportsFlash()){return false;}if(mw.supportsHTML5()){return true;}return false;};mw.isMobileHTML5=function(){if(mw.isIphone()||mw.isIpod()||mw.isIpad()||mw.isAndroid2()){return true;}return false;};mw.supportsHTML5=function(){if(userAgent.indexOf('BlackBerry')!=-1){return false;}var dummyvid=document.createElement("video");if(dummyvid.canPlayType){return true;}return false;};mw.supportsFlash=function(){if(mw.getConfig('EmbedPlayer.DisableHTML5FlashFallback')){return false;}if((mw.isDesktopSafari()&&!mw.getConfig('ForceFlashOnDesktopSafari'))||mw.isEdge()){return false;}var majorVersion=this.getFlashVersion().split(',').shift();if(majorVersion<10){return false;}else{return true;}};mw.supportSilverlight=function(){return Silverlight.isInstalled("4.0");};mw.parseJSON=function(json,retValue){try{var parsedJson=JSON.parse(json);}catch(e){mw.log("JSON parse syntax error: "+e);return retValue?retValue:null;}return parsedJson;}
mw.getFlashVersion=function(){if(navigator.plugins&&navigator.plugins.length){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin){return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1];}}catch(e){}}try{try{if(typeof ActiveXObject!='undefined'){var axo=new ActiveXObject('ShockwaveFlash.ShockwaveFlash.6');try{axo.AllowScriptAccess='always';}catch(e){return'6,0,0';}}}catch(e){}return new ActiveXObject('ShockwaveFlash.ShockwaveFlash').GetVariable('$version').replace(/\D+/g,',').match(/^,?(.+),?$/)[1];}catch(e){}return'0,0,0';};})(window.mediaWiki);;},{},{});mw.loader.implement("mediawiki.jqueryMsg",function($){(function(mw,$,undefined){mw.jqueryMsg={};function getFailableParserFn(options){var parser=new mw.jqueryMsg.parser(options);return function(args){var key=args[0];var argsArray=$.isArray(args[1])?args[1]:$.makeArray(args).slice(1);try{return parser.parse(key,argsArray);}catch(e){return $('<span>').append(key+': '+e.message);}};}mw.jqueryMsg.getMessageFunction=function(options){var failableParserFn=getFailableParserFn(options);return function(){if(window.getStringByKey&&arguments.length>0&&window.getStringByKey(arguments[0])){return window.getStringByKey(arguments[0]);}return failableParserFn(arguments).html();};};mw.jqueryMsg.getPlugin=function(options){var failableParserFn=getFailableParserFn(options);return function(){var $target=this.empty();$.each(failableParserFn(arguments).contents(),function(i,node){$target.append(node);});return $target;};};var parserDefaults={'magic':{'SITENAME':mw.config.get('wgSiteName')},'messages':mw.messages,'language':mw.language};mw.jqueryMsg.parser=function(options){this.settings=$.extend({},parserDefaults,options);this.emitter=new mw.jqueryMsg.htmlEmitter(this.settings.language,this.settings.magic);};mw.jqueryMsg.parser.prototype={astCache:{},parse:function(key,replacements){return this.emitter.emit(this.getAst(key),replacements);},getAst:function(key){if(this.astCache[key]===undefined){var wikiText=this.settings.messages.get(key);if(typeof wikiText!=='string'){wikiText="\\["+key+"\\]";}this.astCache[key]=this.wikiTextToAst(wikiText);}return this.astCache[key];},wikiTextToAst:function(input){var pos=0;function choice(ps){return function(){for(var i=0;i<ps.length;i++){var result=ps[i]();if(result!==null){return result;}}return null;};}function sequence(ps){var originalPos=pos;var result=[];for(var i=0;i<ps.length;i++){var res=ps[i]();if(res===null){pos=originalPos;return null;}result.push(res);}return result;}function nOrMore(n,p){return function(){var originalPos=pos;var result=[];var parsed=p();while(parsed!==null){result.push(parsed);parsed=p();}if(result.length<n){pos=originalPos;return null;}return result;};}function transform(p,fn){return function(){var result=p();return result===null?null:fn(result);};}function makeStringParser(s){var len=s.length;return function(){var result=null;if(input.substr(pos,len)===s){result=s;pos+=len;}return result;};}function makeRegexParser(regex){return function(){var matches=input.substr(pos).match(regex);if(matches===null){return null;}pos+=matches[0].length;return matches[0];};}var regularLiteral=makeRegexParser(/^[^{}[\]$\\]/);var regularLiteralWithoutBar=makeRegexParser(/^[^{}[\]$\\|]/);var regularLiteralWithoutSpace=makeRegexParser(/^[^{}[\]$\s]/);var backslash=makeStringParser("\\");var anyCharacter=makeRegexParser(/^./);function escapedLiteral(){var result=sequence([backslash,anyCharacter]);return result===null?null:result[1];}var escapedOrLiteralWithoutSpace=choice([escapedLiteral,regularLiteralWithoutSpace]);var escapedOrLiteralWithoutBar=choice([escapedLiteral,regularLiteralWithoutBar]);var escapedOrRegularLiteral=choice([escapedLiteral,regularLiteral]);function literalWithoutSpace(){var result=nOrMore(1,escapedOrLiteralWithoutSpace)();return result===null?null:result.join('');}function literalWithoutBar(){var result=nOrMore(1,escapedOrLiteralWithoutBar)();return result===null?null:result.join('');}function literal(){var result=nOrMore(1,escapedOrRegularLiteral)();return result===null?null:result.join('');}var whitespace=makeRegexParser(/^\s+/);var dollar=makeStringParser('$');var digits=makeRegexParser(/^\d+/);function replacement(){var result=sequence([dollar,digits]);if(result===null){return null;}return['REPLACE',parseInt(result[1],10)-1];}var openExtlink=makeStringParser('[');var closeExtlink=makeStringParser(']');function extlink(){var result=null;var parsedResult=sequence([openExtlink,nonWhitespaceExpression,whitespace,expression,closeExtlink]);if(parsedResult!==null){result=['LINK',parsedResult[1],parsedResult[3]];}return result;}function extLinkParam(){var result=sequence([openExtlink,dollar,digits,whitespace,expression,closeExtlink]);if(result===null){return null;}return['LINKPARAM',parseInt(result[2],10)-1,result[4]];}var openLink=makeStringParser('[[');var closeLink=makeStringParser(']]');function link(){var result=null;var parsedResult=sequence([openLink,expression,closeLink]);if(parsedResult!==null){result=['WLINK',parsedResult[1]];}return result;}var templateName=transform(makeRegexParser(/^[ !"$&'()*,.\/0-9;=?@A-Z\^_`a-z~\x80-\xFF+-]+/),function(result){return result.toString();});function templateParam(){var result=sequence([pipe,nOrMore(0,paramExpression)]);if(result===null){return null;}var expr=result[1];return expr.length>1?["CONCAT"].concat(expr):expr[0];}var pipe=makeStringParser('|');function templateWithReplacement(){var result=sequence([templateName,colon,replacement]);return result===null?null:[result[0],result[2]];}function templateWithOutReplacement(){var result=sequence([templateName,colon,paramExpression]);return result===null?null:[result[0],result[2]];}var colon=makeStringParser(':');var templateContents=choice([function(){var res=sequence([choice([templateWithReplacement,templateWithOutReplacement]),nOrMore(0,templateParam)]);return res===null?null:res[0].concat(res[1]);},function(){var res=sequence([templateName,nOrMore(0,templateParam)]);if(res===null){return null;}return[res[0]].concat(res[1]);}]);var openTemplate=makeStringParser('{{');var closeTemplate=makeStringParser('}}');function template(){var result=sequence([openTemplate,templateContents,closeTemplate]);return result===null?null:result[1];}var nonWhitespaceExpression=choice([template,link,extLinkParam,extlink,replacement,literalWithoutSpace]);var paramExpression=choice([template,link,extLinkParam,extlink,replacement,literalWithoutBar]);var expression=choice([template,link,extLinkParam,extlink,replacement,literal]);function start(){var result=nOrMore(0,expression)();if(result===null){return null;}return["CONCAT"].concat(result);}var result=start();if(result===null||pos!==input.length){throw new Error("Parse error at position "+pos.toString()+" in input: "+input);}return result;}};mw.jqueryMsg.htmlEmitter=function(language,magic){this.language=language;var _this=this;$.each(magic,function(key,val){_this[key.toLowerCase()]=function(){return val;};});this.emit=function(node,replacements){var ret=null;var _this=this;switch(typeof node){case'string':case'number':ret=node;break;case'object':var subnodes=$.map(node.slice(1),function(n){return _this.emit(n,replacements);});var operation=node[0].toLowerCase();if(typeof _this[operation]==='function'){ret=_this[operation](subnodes,replacements);}else{throw new Error('unknown operation "'+operation+'"');}break;case'undefined':ret='';break;default:throw new Error('unexpected type in AST: '+typeof node);}return ret;};};mw.jqueryMsg.htmlEmitter.prototype={concat:function(nodes){var span=$('<span>').addClass('mediaWiki_htmlEmitter');$.each(nodes,function(i,node){if(node instanceof jQuery&&node.hasClass('mediaWiki_htmlEmitter')){$.each(node.contents(),function(j,childNode){span.append(childNode);});}else{span.append(node);}});return span;},replace:function(nodes,replacements){var index=parseInt(nodes[0],10);if(index<replacements.length){if(typeof arg==='string'){return mw.html.escape(replacements[index]);}else{return replacements[index];}}else{return'$'+(index+1);}},wlink:function(nodes){return"unimplemented";},link:function(nodes){var arg=nodes[0];var contents=nodes[1];var $el;if(arg instanceof jQuery){$el=arg;}else{$el=$('<a>');if(typeof arg==='function'){$el.click(arg).attr('href','#');}else{$el.attr('href',arg.toString());}}$el.append(contents);return $el;},linkparam:function(nodes,replacements){var replacement,index=parseInt(nodes[0],10);if(index<replacements.length){replacement=replacements[index];}else{replacement='$'+(index+1);}return this.link([replacement,nodes[1]]);},plural:function(nodes){var count=parseInt(this.language.convertNumber(nodes[0],true),10);var forms=nodes.slice(1);return forms.length?this.language.convertPlural(count,forms):'';},gender:function(nodes){var gender;if(nodes[0]&&nodes[0].options instanceof mw.Map){gender=nodes[0].options.get('gender');}else{gender=nodes[0];}var forms=nodes.slice(1);return this.language.gender(gender,forms);},grammar:function(nodes){var form=nodes[0];var word=nodes[1];return word&&form&&this.language.convertGrammar(word,form);}};window.gM=mw.jqueryMsg.getMessageFunction();$.fn.msg=mw.jqueryMsg.getPlugin();var oldParser=mw.Message.prototype.parser;mw.Message.prototype.parser=function(){if(this.map.get(this.key).indexOf('{{')<0){return oldParser.apply(this);}var messageFunction=mw.jqueryMsg.getMessageFunction({'messages':this.map});return messageFunction(this.key,this.parameters);};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mediawiki.kmenu",function($){(function(mw,$){"use strict";mw.KMenu=function($element,options){if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()){this.mobileMenu=$("<select class='mobileMenuSelect'></select>");$element.parent().prepend(this.mobileMenu);this.mobileMenu.change(function(){var title=this.value;$element.find("li>a").each(function(index,item){if($(item).attr("title")===title){$(item).trigger("click");}});});}var defaults={cssClass:"dropdown-menu",tabIndex:1,closeOnFocusOut:true,attributes:{'role':'menu','aria-labelledby':'dLabel'},dividerClass:'divider',onSelected:null};this.bindPostfix='.kMenu';this.$el=$element;this.options=$.extend({},defaults,options);this.itemIdx=0;this.selectedIndex=-1;this.init();return this;}
mw.KMenu.prototype={init:function(){var _this=this;if(this.options.cssClass){this.$el.addClass(this.options.cssClass);}if($.isPlainObject(this.options.attributes)){this.$el.attr(this.options.attributes);}this.$el.attr({'role':'menu'});this.$el.uniqueId();},getTabIndex:function(idx){var tabIndex=parseFloat(this.options.tabIndex+'.00');idx=(idx<10)?'0'+idx:idx;return tabIndex+=parseFloat('.'+idx);},addItem:function(item){if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()){this.mobileMenu.append($('<option>',{value:item.label}).text(item.label));}var _this=this;item.idx=this.itemIdx;var attrs=item.attributes||{};var $item=$('<li />').addClass(item.cssClass).attr(attrs).append($('<a />').attr({'href':'#','title':item.label,'role':'menuitemcheckbox','aria-checked':'false','tabindex':this.getTabIndex(this.itemIdx+1)}).text(item.label).click(function(e){e.preventDefault();_this.setActive(item.idx);_this.selectedIndex=item.idx;if($.isFunction(item.callback)){item.callback();}if($.isFunction(_this.options.onSelected)){_this.options.onSelected(item);}_this.close();}));if(this.itemIdx>0){this.addDivider();}this.$el.append($item);if(item.active){$item.addClass('active').attr('aria-checked','true');this.selectedIndex=this.itemIdx;}this.itemIdx++;},addDivider:function(){this.$el.append($('<li />').addClass(this.options.dividerClass));},isOpen:function(){return this.$el.hasClass('open');},open:function(){var _this=this;this.$el.addClass('open');$(".ui-tooltip").hide();if(this.options.closeOnFocusOut){setTimeout(function(){$(document).on('click'+_this.bindPostfix+_this.$el.attr('id'),function(){_this.close();});},0);}},close:function(){this.$el.removeClass('open');if(this.options.closeOnFocusOut){$(document).off('click'+this.bindPostfix+this.$el.attr('id'));}},toggle:function(){if(this.isOpen()){this.close();}else{this.open();}},previousItem:function(){this.selectedIndex--;if(this.selectedIndex<0){this.selectedIndex=this.itemIdx-1;}this.setActive(this.selectedIndex);},nextItem:function(){this.selectedIndex++;if(this.selectedIndex==this.itemIdx){this.selectedIndex=0;}this.setActive(this.selectedIndex);},disable:function(){this.$el.addClass('disabled');},setActive:function(idx){this.clearActive();var selector=null;if(typeof idx=='number'){selector='li:not(.'+this.options.dividerClass+',.label):eq('+idx+')';if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()){this.mobileMenu.get(0).selectedIndex=idx;}}else{selector='li['+idx.key+'='+idx.val+']';if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()){this.mobileMenu.val(this.$el.find(selector).text());}}this.$el.find(selector).addClass('active').attr('aria-checked','true');this.$el.find(selector+" a").focus();if(mw.isIE8()){this.$el.addClass('dummy').removeClass('dummy');}},clearActive:function(){this.$el.find('li').removeClass('active').attr('aria-checked','false');},destroy:function(){this.$el.empty();this.itemIdx=0;if(mw.getConfig("EmbedPlayer.EnableMobileSkin")&&mw.isMobileDevice()&&this.mobileMenu){this.mobileMenu.find('option').remove().end();}},numOfChildren:function(){return this.itemIdx;}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mediawiki.language",function($){window.originalVTTCue=window.VTTCue;mediaWiki.language={'pluralProcessor':function(template){if(template.arg&&template.parameters&&mediaWiki.language.convertPlural){if(template.parameters.length==0){return'';}var count=mediaWiki.language.convertNumber(template.arg,true);return mediaWiki.language.convertPlural(parseInt(count),template.parameters);}if(template.parameters[0]){return template.parameters[0];}return'';},'convertPlural':function(count,forms){if(!forms||forms.length==0){return'';}return(parseInt(count)==1)?forms[0]:forms[1];},'preConvertPlural':function(forms,count){while(forms.length<count){forms.push(forms[forms.length-1]);}return forms;},'convertNumber':function(number,integer){if(!mediaWiki.language.digitTransformTable){return number;}var transformTable=mediaWiki.language.digitTransformTable;if(integer){if(parseInt(number)==number){return number;}var tmp=[];for(var i in transformTable){tmp[transformTable[i]]=i;}transformTable=tmp;}var numberString=''+number;var convertedNumber='';for(var i=0;i<numberString.length;i++){if(transformTable[numberString[i]]){convertedNumber+=transformTable[numberString[i]];}else{convertedNumber+=numberString[i];}}return integer?parseInt(convertedNumber):convertedNumber;},'digitTransformTable':null};;},{},{});mw.loader.implement("mediawiki.util",function($){(function($,mw){"use strict";var formatersStorage={};var util={init:function(){var profile,$tocTitle,$tocToggleLink,hideTocCookie;$.messageBoxNew({id:'mw-js-message',parent:'#content'});profile=$.client.profile();if(profile.name==='opera'){util.tooltipAccessKeyPrefix='shift-esc-';}else if(profile.name==='chrome'){util.tooltipAccessKeyPrefix=(profile.platform==='mac'?'ctrl-option-':profile.platform==='win'?'alt-shift-':'alt-');}else if(profile.platform!=='win'&&profile.name==='safari'&&profile.layoutVersion>526){util.tooltipAccessKeyPrefix='ctrl-alt-';}else if(!(profile.platform==='win'&&profile.name==='safari')&&(profile.name==='safari'||profile.platform==='mac'||profile.name==='konqueror')){util.tooltipAccessKeyPrefix='ctrl-';}else if(profile.name==='firefox'&&profile.versionBase>'1'){util.tooltipAccessKeyPrefix='alt-shift-';}if($('#bodyContent').length){util.$content=$('#bodyContent');}else if($('#mw_contentholder').length){util.$content=$('#mw_contentholder');}else if($('#article').length){util.$content=$('#article');}else{util.$content=$('#content');}$tocTitle=$('#toctitle');$tocToggleLink=$('#togglelink');if($('#toc').length&&$tocTitle.length&&!$tocToggleLink.length){hideTocCookie=$.cookie('mw_hidetoc');$tocToggleLink=$('<a href="#" class="internal" id="togglelink"></a>').text(mw.msg('hidetoc')).click(function(e){e.preventDefault();util.toggleToc($(this));});$tocTitle.append($tocToggleLink.wrap('<span class="toctoggle"></span>').parent().prepend('&nbsp;[').append(']&nbsp;'));if(hideTocCookie==='1'){util.toggleToc($tocToggleLink);}}},rawurlencode:function(str){str=String(str);return encodeURIComponent(str).replace(/!/g,'%21').replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29').replace(/\*/g,'%2A').replace(/~/g,'%7E');},wikiUrlencode:function(str){return util.rawurlencode(str).replace(/%20/g,'_').replace(/%3A/g,':').replace(/%2F/g,'/');},wikiGetlink:function(str){return mw.config.get('wgArticlePath').replace('$1',util.wikiUrlencode(typeof str==='string'?str:mw.config.get('wgPageName')));},wikiScript:function(str){return mw.config.get('wgScriptPath')+'/'+(str||'index')+mw.config.get('wgScriptExtension');},addCSS:function(text){var s=mw.loader.addStyleTag(text);return s.sheet||s;},toggleToc:function($toggleLink,callback){var $tocList=$('#toc ul:first');if($tocList.length){if($tocList.is(':hidden')){$tocList.slideDown('fast',callback);$toggleLink.text(mw.msg('hidetoc'));$('#toc').removeClass('tochidden');$.cookie('mw_hidetoc',null,{expires:30,path:'/'});return true;}else{$tocList.slideUp('fast',callback);$toggleLink.text(mw.msg('showtoc'));$('#toc').addClass('tochidden');$.cookie('mw_hidetoc','1',{expires:30,path:'/'});return false;}}else{return null;}},getParamValue:function(param,url){url=url||document.location.href;var re=new RegExp('^[^#]*[&?]'+$.escapeRE(param)+'=([^&#]*)'),m=re.exec(url);if(m){return decodeURIComponent(m[1].replace(/\+/g,'%20'));}return null;},tooltipAccessKeyPrefix:'alt-',tooltipAccessKeyRegexp:/\[(ctrl-)?(alt-)?(shift-)?(esc-)?(.)\]$/,updateTooltipAccessKeys:function($nodes){if(!$nodes){$nodes=$('#column-one a, #mw-head a, #mw-panel a, #p-logo a, input, label');}else if(!($nodes instanceof $)){$nodes=$($nodes);}$nodes.attr('title',function(i,val){if(val&&util.tooltipAccessKeyRegexp.exec(val)){return val.replace(util.tooltipAccessKeyRegexp,'['+util.tooltipAccessKeyPrefix+'$5]');}return val;});},$content:null,addPortletLink:function(portlet,href,text,id,tooltip,accesskey,nextnode){var $item,$link,$portlet,$ul;if(arguments.length<3){return null;}$link=$('<a>').attr('href',href).text(text);if(tooltip){$link.attr('title',tooltip);}switch(mw.config.get('skin')){case'standard':case'cologneblue':$('#quickbar').append($link.after('<br/>'));return $link[0];case'nostalgia':$('#searchform').before($link).before(' &#124; ');return $link[0];default:$portlet=$('#'+portlet);if($portlet.length===0){return null;}$ul=$portlet.find('ul').eq(0);if($ul.length===0){$ul=$('<ul>');if($portlet.find('div:first').length===0){$portlet.append($ul);}else{$portlet.find('div').eq(-1).append($ul);}}if($ul.length===0){return null;}$portlet.removeClass('emptyPortlet');if($portlet.hasClass('vectorTabs')){$item=$link.wrap('<li><span></span></li>').parent().parent();}else{$item=$link.wrap('<li></li>').parent();}if(id){$item.attr('id',id);}if(accesskey){$link.attr('accesskey',accesskey);tooltip+=' ['+accesskey+']';$link.attr('title',tooltip);}if(accesskey&&tooltip){util.updateTooltipAccessKeys($link);}if(nextnode&&nextnode.parentNode===$ul[0]){$(nextnode).before($item);}else if(typeof nextnode==='string'&&$ul.find(nextnode).length!==0){$ul.find(nextnode).eq(0).before($item);}else{$ul.append($item);}return $item[0];}},jsMessage:function(message,className){if(!arguments.length||message===''||message===null){$('#mw-js-message').empty().hide();return true;}else{var $messageDiv=$('#mw-js-message');if(!$messageDiv.length){$messageDiv=$('<div id="mw-js-message"></div>');if(util.$content.parent().length){util.$content.parent().prepend($messageDiv);}else{return false;}}if(className){$messageDiv.prop('class','mw-js-message-'+className);}if(typeof message==='object'){$messageDiv.empty();$messageDiv.append(message);}else{$messageDiv.html(message);}$messageDiv.slideDown();return true;}},validateEmail:function(mailtxt){var rfc5322_atext,rfc1034_ldh_str,HTML5_email_regexp;if(mailtxt===''){return null;}rfc5322_atext="a-z0-9!#$%&'*+\\-/=?^_`{|}~";rfc1034_ldh_str="a-z0-9\\-";HTML5_email_regexp=new RegExp('^'+'['+rfc5322_atext+'\\.]+'+'@'+'['+rfc1034_ldh_str+']+'+'(?:\\.['+rfc1034_ldh_str+']+)*'+'$','i');return(null!==mailtxt.match(HTML5_email_regexp));},isIPv4Address:function(address,allowBlock){if(typeof address!=='string'){return false;}var block=allowBlock?'(?:\\/(?:3[0-2]|[12]?\\d))?':'',RE_IP_BYTE='(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|0?[0-9]?[0-9])',RE_IP_ADD='(?:'+RE_IP_BYTE+'\\.){3}'+RE_IP_BYTE;return address.search(new RegExp('^'+RE_IP_ADD+block+'$'))!==-1;},isIPv6Address:function(address,allowBlock){if(typeof address!=='string'){return false;}var block=allowBlock?'(?:\\/(?:12[0-8]|1[01][0-9]|[1-9]?\\d))?':'',RE_IPV6_ADD='(?:'+':(?::|(?::'+'[0-9A-Fa-f]{1,4}'+'){1,7})'+'|'+'[0-9A-Fa-f]{1,4}'+'(?::'+'[0-9A-Fa-f]{1,4}'+'){0,6}::'+'|'+'[0-9A-Fa-f]{1,4}'+'(?::'+'[0-9A-Fa-f]{1,4}'+'){7}'+')';if(address.search(new RegExp('^'+RE_IPV6_ADD+block+'$'))!==-1){return true;}RE_IPV6_ADD='[0-9A-Fa-f]{1,4}'+'(?:::?'+'[0-9A-Fa-f]{1,4}'+'){1,6}';return address.search(new RegExp('^'+RE_IPV6_ADD+block+'$'))!==-1&&address.search(/::/)!==-1&&address.search(/::.*::/)===-1;},formaters:function(){var registerOne=function(name,callback){if(typeof name!=='string'){mw.log('mw.util.formaters.registerOne: name parameter must be a string, '+typeof name+' given');return;}if(!$.isFunction(callback)){mw.log('mw.util.formaters.registerOne: callback parameter must be a function, '+typeof callback+' given');return;}if($.isFunction(formatersStorage[name])){mw.log('mw.util.formaters.registerOne: callback: "'+name+'" already exists.');return;}formatersStorage[name]=callback;};return{register:function(name,callback){if($.isPlainObject(name)){$.each(name,registerOne);}else{registerOne(name,callback);}},get:function(name){if(!$.isFunction(formatersStorage[name])){throw new Exception("Formater: "+name+" does not exists, make sure to register it first with mw.util.formaters().register(name,callback)");}return formatersStorage[name];},getAll:function(){return formatersStorage;},exists:function(name){return $.isFunction(formatersStorage[name]);}};}};mw.util=util;})(jQuery,mediaWiki);;},{},{"showtoc":"[showtoc]","hidetoc":"[hidetoc]"});mw.loader.implement("mediawiki.util.tmpl",function($){(function($,mw){"use strict";mw.util.registerTemplateHelper=function(name,callback){mw.log('[Deprecated] mw.util.registerTemplateHelper is deprecated. please use mw.util.formaters().register method');mw.util.formaters().register(name,callback);};var isObject=function(obj){var type=typeof obj;return type==='function'||type==='object'&&!!obj;};var defaults=function(obj){if(!isObject(obj))return obj;for(var i=1,length=arguments.length;i<length;i++){var source=arguments[i];for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop];}}return obj;};var templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'",'\\':'\\','\r':'r','\n':'n','\u2028':'u2028','\u2029':'u2029'};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return'\\'+escapes[match];};mw.util.tmpl=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=defaults({},settings,templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join('|')+'|$','g');var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'";}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'";}else if(evaluate){source+="';\n"+evaluate+"\n__p+='";}return match;});source+="';\n";if(!settings.variable)source='with(obj||{}){\n'+source+'}\n';source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+'return __p;\n';try{var render=new Function(settings.variable||'obj','_',source);}catch(e){e.source=source;throw e;}var template=function(data){return render.call(this,data);};var argument=settings.variable||'obj';template.source='function('+argument+'){\n'+source+'}';return template;};})(jQuery,mediaWiki);;},{},{});mw.loader.implement("mw.EmbedPlayer",function($){if(!window.Silverlight){window.Silverlight={};}Silverlight._silverlightCount=0;Silverlight.__onSilverlightInstalledCalled=false;Silverlight.fwlinkRoot='http://go2.microsoft.com/fwlink/?LinkID=';Silverlight.__installationEventFired=false;Silverlight.onGetSilverlight=null;Silverlight.onSilverlightInstalled=function(){window.location.reload(false);};Silverlight.isInstalled=function(version){if(version==undefined){version=null;}var isVersionSupported=false;try{var tryOlderIE=false;try{var plugin=navigator.plugins["Silverlight Plug-In"];if(plugin){if(version===null){isVersionSupported=true;}else{var actualVer=plugin.description;if(actualVer==="1.0.30226.2"){actualVer="2.0.30226.2";}var actualVerArray=actualVer.split(".");while(actualVerArray.length>3){actualVerArray.pop();}while(actualVerArray.length<4){actualVerArray.push(0);}var reqVerArray=version.split(".");while(reqVerArray.length>4){reqVerArray.pop();}var requiredVersionPart;var actualVersionPart;var index=0;do{requiredVersionPart=parseInt(reqVerArray[index]);actualVersionPart=parseInt(actualVerArray[index]);index++;}while(index<reqVerArray.length&&requiredVersionPart===actualVersionPart);if(requiredVersionPart<=actualVersionPart&&!isNaN(requiredVersionPart)){isVersionSupported=true;}}}else{tryOlderIE=true;}}catch(e){tryOlderIE=true;}if(tryOlderIE){var control=new ActiveXObject('AgControl.AgControl');if(version===null){isVersionSupported=true;}else if(control.IsVersionSupported(version)){isVersionSupported=true;}control=null;}}catch(e){isVersionSupported=false;}return isVersionSupported;};Silverlight.WaitForInstallCompletion=function(){if(!Silverlight.isBrowserRestartRequired&&Silverlight.onSilverlightInstalled){try{navigator.plugins.refresh();}catch(e){}if(Silverlight.isInstalled(null)&&!Silverlight.__onSilverlightInstalledCalled){Silverlight.onSilverlightInstalled();Silverlight.__onSilverlightInstalledCalled=true;}else{setTimeout(Silverlight.WaitForInstallCompletion,3000);}}};Silverlight.__startup=function(){navigator.plugins.refresh();Silverlight.isBrowserRestartRequired=Silverlight.isInstalled(null);if(!Silverlight.isBrowserRestartRequired){Silverlight.WaitForInstallCompletion();if(!Silverlight.__installationEventFired){Silverlight.onInstallRequired();Silverlight.__installationEventFired=true;}}else if(window.navigator.mimeTypes){var mimeSL2=navigator.mimeTypes["application/x-silverlight-2"];var mimeSL2b2=navigator.mimeTypes["application/x-silverlight-2-b2"];var mimeSL2b1=navigator.mimeTypes["application/x-silverlight-2-b1"];var mimeHighestBeta=mimeSL2b1;if(mimeSL2b2)mimeHighestBeta=mimeSL2b2;if(!mimeSL2&&(mimeSL2b1||mimeSL2b2)){if(!Silverlight.__installationEventFired){Silverlight.onUpgradeRequired();Silverlight.__installationEventFired=true;}}else if(mimeSL2&&mimeHighestBeta){if(mimeSL2.enabledPlugin&&mimeHighestBeta.enabledPlugin){if(mimeSL2.enabledPlugin.description!=mimeHighestBeta.enabledPlugin.description){if(!Silverlight.__installationEventFired){Silverlight.onRestartRequired();Silverlight.__installationEventFired=true;}}}}}if(!Silverlight.disableAutoStartup){if(window.removeEventListener){window.removeEventListener('load',Silverlight.__startup,false);}else{window.detachEvent('onload',Silverlight.__startup);}}};if(!Silverlight.disableAutoStartup){if(window.addEventListener){window.addEventListener('load',Silverlight.__startup,false);}else{window.attachEvent('onload',Silverlight.__startup);}}Silverlight.createObject=function(source,parentElement,id,properties,events,initParams,userContext){var slPluginHelper=new Object();var slProperties=properties;var slEvents=events;slPluginHelper.version=slProperties.version;slProperties.source=source;slPluginHelper.alt=slProperties.alt;if(initParams)slProperties.initParams=initParams;if(slProperties.isWindowless&&!slProperties.windowless)slProperties.windowless=slProperties.isWindowless;if(slProperties.framerate&&!slProperties.maxFramerate)slProperties.maxFramerate=slProperties.framerate;if(id&&!slProperties.id)slProperties.id=id;delete slProperties.ignoreBrowserVer;delete slProperties.inplaceInstallPrompt;delete slProperties.version;delete slProperties.isWindowless;delete slProperties.framerate;delete slProperties.data;delete slProperties.src;delete slProperties.alt;if(Silverlight.isInstalled(slPluginHelper.version)){for(var name in slEvents){if(slEvents[name]){if(name=="onLoad"&&typeof slEvents[name]=="function"&&slEvents[name].length!=1){var onLoadHandler=slEvents[name];slEvents[name]=function(sender){return onLoadHandler(document.getElementById(id),userContext,sender)};}var handlerName=Silverlight.__getHandlerName(slEvents[name]);if(handlerName!=null){slProperties[name]=handlerName;slEvents[name]=null;}else{throw"typeof events."+name+" must be 'function' or 'string'";}}}slPluginHTML=Silverlight.buildHTML(slProperties);}else{slPluginHTML=Silverlight.buildPromptHTML(slPluginHelper);}if(parentElement){parentElement.innerHTML=slPluginHTML;}else{return slPluginHTML;}};Silverlight.buildHTML=function(slProperties){var htmlBuilder=[];htmlBuilder.push('<object type=\"application/x-silverlight\" data="data:application/x-silverlight,"');if(slProperties.id!=null){htmlBuilder.push(' id="'+Silverlight.HtmlAttributeEncode(slProperties.id)+'"');}if(slProperties.width!=null){htmlBuilder.push(' width="'+slProperties.width+'"');}if(slProperties.height!=null){htmlBuilder.push(' height="'+slProperties.height+'"');}htmlBuilder.push(' >');delete slProperties.id;delete slProperties.width;delete slProperties.height;for(var name in slProperties){if(slProperties[name]){htmlBuilder.push('<param name="'+Silverlight.HtmlAttributeEncode(name)+'" value="'+Silverlight.HtmlAttributeEncode(slProperties[name])+'" />');}}htmlBuilder.push('<\/object>');return htmlBuilder.join('');};Silverlight.createObjectEx=function(params){var parameters=params;var html=Silverlight.createObject(parameters.source,parameters.parentElement,parameters.id,parameters.properties,parameters.events,parameters.initParams,parameters.context);if(parameters.parentElement==null){return html;}};Silverlight.buildPromptHTML=function(slPluginHelper){var slPluginHTML="";var urlRoot=Silverlight.fwlinkRoot;var version=slPluginHelper.version;if(slPluginHelper.alt){slPluginHTML=slPluginHelper.alt;}else{if(!version){version="";}slPluginHTML="<a href='javascript:Silverlight.getSilverlight(\"{1}\");' style='text-decoration: none;'><img src='{2}' alt='Get Microsoft Silverlight' style='border-style: none'/></a>";slPluginHTML=slPluginHTML.replace('{1}',version);slPluginHTML=slPluginHTML.replace('{2}',urlRoot+'161376');}return slPluginHTML;};Silverlight.getSilverlight=function(version){if(Silverlight.onGetSilverlight){Silverlight.onGetSilverlight();}var shortVer="";var reqVerArray=String(version).split(".");if(reqVerArray.length>1){var majorNum=parseInt(reqVerArray[0]);if(isNaN(majorNum)||majorNum<2){shortVer="1.0";}else{shortVer=reqVerArray[0]+'.'+reqVerArray[1];}}var verArg="";if(shortVer.match(/^\d+\056\d+$/)){verArg="&v="+shortVer;}Silverlight.followFWLink("149156"+verArg);};Silverlight.followFWLink=function(linkid){top.location=Silverlight.fwlinkRoot+String(linkid);};Silverlight.HtmlAttributeEncode=function(strInput){var c;var retVal='';if(strInput==null){return null;}for(var cnt=0;cnt<strInput.length;cnt++){c=strInput.charCodeAt(cnt);if(((c>96)&&(c<123))||((c>64)&&(c<91))||((c>43)&&(c<58)&&(c!=47))||(c==95)){retVal=retVal+String.fromCharCode(c);}else{retVal=retVal+'&#'+c+';';}}return retVal;};Silverlight.default_error_handler=function(sender,args){var iErrorCode;var errorType=args.ErrorType;iErrorCode=args.ErrorCode;var errMsg="\nSilverlight error message     \n";errMsg+="ErrorCode: "+iErrorCode+"\n";errMsg+="ErrorType: "+errorType+"       \n";errMsg+="Message: "+args.ErrorMessage+"     \n";if(errorType=="ParserError"){errMsg+="XamlFile: "+args.xamlFile+"     \n";errMsg+="Line: "+args.lineNumber+"     \n";errMsg+="Position: "+args.charPosition+"     \n";}else if(errorType=="RuntimeError"){if(args.lineNumber!=0){errMsg+="Line: "+args.lineNumber+"     \n";errMsg+="Position: "+args.charPosition+"     \n";}errMsg+="MethodName: "+args.methodName+"     \n";}alert(errMsg);};Silverlight.__cleanup=function(){for(var i=Silverlight._silverlightCount-1;i>=0;i--){window['__slEvent'+i]=null;}Silverlight._silverlightCount=0;if(window.removeEventListener){window.removeEventListener('unload',Silverlight.__cleanup,false);}else{window.detachEvent('onunload',Silverlight.__cleanup);}};Silverlight.__getHandlerName=function(handler){var handlerName="";if(typeof handler=="string"){handlerName=handler;}else if(typeof handler=="function"){if(Silverlight._silverlightCount==0){if(window.addEventListener){window.addEventListener('unload',Silverlight.__cleanup,false);}else{window.attachEvent('onunload',Silverlight.__cleanup);}}var count=Silverlight._silverlightCount++;handlerName="__slEvent"+count;window[handlerName]=handler;}else{handlerName=null;}return handlerName;};Silverlight.onRequiredVersionAvailable=function(){};Silverlight.onRestartRequired=function(){};Silverlight.onUpgradeRequired=function(){};Silverlight.onInstallRequired=function(){};Silverlight.IsVersionAvailableOnError=function(sender,args){var retVal=false;try{if(args.ErrorCode==8001&&!Silverlight.__installationEventFired){Silverlight.onUpgradeRequired();Silverlight.__installationEventFired=true;}else if(args.ErrorCode==8002&&!Silverlight.__installationEventFired){Silverlight.onRestartRequired();Silverlight.__installationEventFired=true;}else if(args.ErrorCode==5014||args.ErrorCode==2106){if(Silverlight.__verifySilverlight2UpgradeSuccess(args.getHost())){retVal=true;}}else{retVal=true;}}catch(e){}return retVal;};Silverlight.IsVersionAvailableOnLoad=function(sender){var retVal=false;try{if(Silverlight.__verifySilverlight2UpgradeSuccess(sender.getHost())){retVal=true;}}catch(e){}return retVal;};Silverlight.__verifySilverlight2UpgradeSuccess=function(host){var retVal=false;var version="5.1.20125";var installationEvent=null;try{if(host.IsVersionSupported(version+".99")){installationEvent=Silverlight.onRequiredVersionAvailable;retVal=true;}else if(host.IsVersionSupported(version+".0")){installationEvent=Silverlight.onRestartRequired;}else{installationEvent=Silverlight.onUpgradeRequired;}if(installationEvent&&!Silverlight.__installationEventFired){installationEvent();Silverlight.__installationEventFired=true;}}catch(e){}return retVal;};(function(mw,$){"use strict";mw.processEmbedPlayers=function(playerSelect,callback){mw.log('processEmbedPlayers:: playerSelector: '+playerSelect);$(mw).trigger('ProcessEmbedPlayers',[playerSelect]);var playerIdList=[];var areSelectedPlayersReady=function(){var playersLoaded=true;$.each(playerIdList,function(inx,playerId){if(!$('#'+playerId)[0].playerReadyFlag){playersLoaded=false;return false;}})
if(playersLoaded){if(callback){callback();}}}
var addPlayerElement=function(playerElement){var _this=this;mw.log('EmbedPlayer:: addElement:: '+playerElement.id);$(mw).trigger('EmbedPlayerWaitForMetaCheck',playerElement);var waitForMeta=false;if(playerElement.waitForMeta!==false){waitForMeta=waitForMetaCheck(playerElement);}var ranPlayerSwapFlag=false;var runPlayerSwap=function(){if(ranPlayerSwapFlag){return;}ranPlayerSwapFlag=true;mw.log("processEmbedPlayers::runPlayerSwap::"+$(playerElement).attr('id'));var playerInterface=new mw.EmbedPlayer(playerElement);var inDomPlayer=swapEmbedPlayerElement(playerElement,playerInterface);mw.log("processEmbedPlayers::trigger:: EmbedPlayerNewPlayer "+inDomPlayer.id);$(mw).trigger('EmbedPlayerNewPlayer',inDomPlayer);$(mw).trigger('newEmbedPlayerEvent',inDomPlayer);$(inDomPlayer).bind('playerReady',areSelectedPlayersReady);mw.log("EmbedPlayer::addPlayerElement :trigger startPlayerBuildOut:"+inDomPlayer.id);$('#'+inDomPlayer.id).triggerQueueCallback('startPlayerBuildOut',function(){inDomPlayer.checkPlayerSources();});};if(waitForMeta&&mw.getConfig('EmbedPlayer.WaitForMeta')){mw.log('processEmbedPlayers::WaitForMeta ( video missing height ('+$(playerElement).attr('height')+'), width ('+$(playerElement).attr('width')+') or duration: '+$(playerElement).attr('duration'));$(playerElement).bind("loadedmetadata",runPlayerSwap);setTimeout(runPlayerSwap,5000);return;}else{runPlayerSwap();return;}};var waitForMetaCheck=function(playerElement){var waitForMeta=false;if(!playerElement){return false;}if(!playerElement.tagName||(playerElement.tagName.toLowerCase()!='audio'&&playerElement.tagName.toLowerCase()!='video')){return false;}if(!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('oggNative')&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('webmNative')&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('h264Native')&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('appleVdnPlayer')){return false;}var width=$(playerElement).css('width');var height=$(playerElement).css('height');if($(playerElement).css('width')=='300px'&&$(playerElement).css('height')=='150px'){waitForMeta=true;}else{if($(playerElement).attr('duration')||$(playerElement).attr('durationHint')||$(playerElement).attr('data-durationhint')){return false;}else{waitForMeta=true;}}if($(playerElement).attr('width')==-1||$(playerElement).attr('height')==-1){waitForMeta=true;}if($(playerElement).attr('width')===0||$(playerElement).attr('height')===0){waitForMeta=true;}if(playerElement.height==150&&playerElement.width==300){waitForMeta=true;}if(waitForMeta&&($(playerElement).attr('src')||$(playerElement).find("source[src]").length!==0)){return true;}else{return false;}};var swapEmbedPlayerElement=function(targetElement,playerInterface){mw.log('processEmbedPlayers::swapEmbedPlayerElement: '+targetElement.id);var swapPlayerElement=document.createElement('div');$(swapPlayerElement).addClass('mwEmbedPlayer');for(var method in playerInterface){if(method!='readyState'){swapPlayerElement[method]=playerInterface[method];}}if($(targetElement).attr('width')){$(swapPlayerElement).css('width',$(targetElement).attr('width'));}if($(targetElement).attr('height')){$(swapPlayerElement).css('height',$(targetElement).attr('height'));}swapPlayerElement.style.cssText+=targetElement.style.cssText;swapPlayerElement.style.position='relative';var dataAttributes=mw.getConfig("EmbedPlayer.DataAttributes");if(dataAttributes){$.each(dataAttributes,function(attrName,na){if($(targetElement).data(attrName)){$(swapPlayerElement).data(attrName,$(targetElement).data(attrName));}});}if((playerInterface.isPersistentNativePlayer()&&!mw.getConfig('EmbedPlayer.DisableVideoTagSupport'))||(playerInterface.useNativePlayerControls()&&(targetElement.nodeName=='video'||targetElement.nodeName=='audio'))){$(targetElement).attr('id',playerInterface.pid).addClass('nativeEmbedPlayerPid').show().after($(swapPlayerElement).css('display','none'));}else{$(targetElement).replaceWith(swapPlayerElement);}if($('#loadingSpinner_'+playerInterface.id).length==0){if(playerInterface.useNativePlayerControls()||playerInterface.isPersistentNativePlayer()){var $spinner=$(targetElement).getAbsoluteOverlaySpinner();}else{var $spinner=$(swapPlayerElement).getAbsoluteOverlaySpinner();}$spinner.attr('id','loadingSpinner_'+playerInterface.id);}return swapPlayerElement;};$(playerSelect).each(function(index,playerElement){playerIdList.push($(playerElement).attr("id"));if(playerElement.nodeName.toLowerCase()=='div'&&$(playerElement).attr('poster')){var posterSrc=$(playerElement).attr('poster');var width=$(playerElement).width();var height=$(playerElement).height();if(!width){var width='100%';}if(!height){var height='100%';}mw.log('EmbedPlayer:: set loading background: '+posterSrc);$(playerElement).append($('<img />').attr('src',posterSrc).css({'position':'absolute','width':width,'height':height}));}});var addedPlayersFlag=false;$(playerSelect).each(function(index,playerElement){if($(playerElement).hasClass('nativeEmbedPlayerPid')){$('#loadingSpinner_'+$(playerElement).attr('id')).remove();mw.log('processEmbedPlayers::$.embedPlayer skip embedPlayer gennerated video: '+playerElement);}else{addedPlayersFlag=true;addPlayerElement(playerElement);}});if(!addedPlayersFlag){if(callback){callback();}}};})(window.mw,jQuery);(function(mw,$){"use strict";mw.mergeConfig('EmbedPlayer.Attributes',{"id":null,"width":null,"height":null,"src":null,"poster":null,"autoplay":false,"loop":false,"controls":true,"paused":true,"readyState":0,"networkState":0,"currentTime":0,"previousTime":0,"previousVolume":1,"volume":1,"preMuteVolume":1,"duration":null,'data-durationhint':null,'durationHint':null,"muted":false,"isFlavorSwitching":false,'videoAspect':'4:3',"start":0,"end":null,"overlaycontrols":true,"usenativecontrols":false,'attributionbutton':true,'playerError':{},'data-blockPlayerDisplay':null,"startOffset":0,"downloadLink":true,"type":null,"adsOnReplay":false,"live":false,"liveOffSynch":false,"isAudioPlayer":false,"enableTooltips":true,"sourcesReplaced":false,"streamerType":'http',"shouldEndClip":true,"buffering":false,"casting":false});mw.mergeConfig('EmbedPlayer.SourceAttributes',['id','src','title','label','URLTimeEncoding','startOffset','start','end','default','title','titleKey']);mw.EmbedPlayer=function(element){return this.init(element);};mw.EmbedPlayer.prototype={'plugins':{},'mediaElement':null,'supports':{},'playerReadyFlag':false,'loadError':false,'thumbnailUpdatingFlag':false,'stopped':true,'cmmlData':null,'seeking':false,'bufferedPercent':0,'monitorTimerId':null,'bufferStartFlag':false,'bufferEndFlag':false,'pauseTime':null,'donePlayingCount':0,'_propagateEvents':true,'onDoneInterfaceFlag':true,'_checkHideSpinner':false,'_playContorls':true,'displayPlayer':true,'widgetLoaded':false,currentState:null,playbackRate:false,shouldHandlePlayerError:true,"manifestAdaptiveFlavors":[],clipDoneTimeout:null,playerPrefix:'BasePlayer',currentBitrate:-1,drmRequired:false,liveEdgeOffset:0,init:function(element){var _this=this;var playerAttributes=mw.getConfig('EmbedPlayer.Attributes');this.rewriteElementTagName=element.tagName.toLowerCase();for(var attr in playerAttributes){if(element.getAttribute(attr)!=null){if(element.getAttribute(attr)==''){this[attr]=true;}else{this[attr]=element.getAttribute(attr);}}else{this[attr]=playerAttributes[attr];}if(this[attr]=="false")this[attr]=false;if(this[attr]=="true")this[attr]=true;}if(!this.width){this.width=$(element).width()
$(element).attr('width',this.width)}if(!this.height){this.height=$(element).height()
$(element).attr('height',this.height)}if(this.useNativePlayerControls()){_this.controls=true;}if(!this.skinName){this.skinName=mw.getConfig('EmbedPlayer.DefaultSkin');}if(!this.monitorRate){this.monitorRate=mw.getConfig('EmbedPlayer.MonitorRate');}this.startOffset=parseFloat(this.startOffset);if(element.duration){_this.duration=element.duration;}if(_this['data-durationhint']){_this.durationHint=_this['data-durationhint'];}if(_this.durationHint&&!_this.duration){_this.duration=mw.npt2seconds(_this.durationHint);}this.duration=parseFloat(this.duration);mw.log('EmbedPlayer::init:'+this.id+' duration is: '+this.duration+', size: '+$(element).width()+'x'+$(element).height());this.pid='pid_'+this.id;this.mediaElement=new mw.MediaElement(element);},bindHelper:function(name,callback){$(this).bind(name,callback);return this;},unbindHelper:function(bindName){if(bindName){$(this).unbind(bindName);}return this;},bindOnceHelper:function(name,callback){$(this).one(name,callback);return this;},triggerQueueCallback:function(name,callback){$(this).triggerQueueCallback(name,callback);},triggerHelper:function(name,obj){try{$(this).trigger(name,obj);}catch(e){mw.log("EmbedPlayer:: possible error in trigger: "+name+" "+e.toString());}},log:function(message){mw.log(this.playerPrefix+"::"+message);},addPlayerStateChangeBindings:function(){var _this=this;var bindPostfix='.stateManager';var getStatesCssClasses=function(){var classes='';var states=['start','load','play','pause','end'];$.each(states,function(idx,state){var space=(states.length-1==idx)?'':' ';classes+=state+'-state'+space;});return classes;};var eventStateMap={'playerReady':'start','onplay':function(){return _this.isPlaying()?'play':'load';},'playing':'play','onPauseInterfaceUpdate':'pause','onEndedDone':'end','preSeek':'load','seeked':function(){return _this.isPlaying()?'play':'pause';}};var doChangeState=function(newState){if(newState!==_this.currentState){var oldState=_this.currentState;_this.currentState=newState;_this.getInterface().removeClass(getStatesCssClasses()).addClass(newState+'-state');$(_this).trigger('onPlayerStateChange',[newState,oldState]);}};this.unbindHelper(bindPostfix);$.each(eventStateMap,function(eventName,state){_this.bindHelper(eventName+bindPostfix,function(){var stateString=(typeof state==='function')?state():state;doChangeState(stateString);});});this.bindOnceHelper("layoutBuildDone",function(){_this.doUpdateLayout();});if(!this.currentState){doChangeState('load');}},stopEventPropagation:function(){mw.log("EmbedPlayer:: stopEventPropagation");this.stopMonitor();this._propagateEvents=false;},restoreEventPropagation:function(){mw.log("EmbedPlayer:: restoreEventPropagation");this.startMonitor();this._propagateEvents=true;},getPluginInstance:function(pluginName){if(!this.plugins[pluginName]){mw.log('EmbedPlayer:: getPluginInstance: plugin "'+pluginName+'" not initialsed.');return;}return this.plugins[pluginName];},enableNativeControls:function(){mw.log('Error: function enableNativeControls should be implemented by embed player interface ');return;},enablePlayControls:function(excludedComponents){if(this._playContorls||this.getError()!==null){return;}mw.log("EmbedPlayer:: enablePlayControls");excludedComponents=excludedComponents||[];this._playContorls=true;$(this).trigger('onEnableInterfaceComponents',[excludedComponents]);},disablePlayControls:function(excludedComponents){if(!this._playContorls){return;}mw.log("EmbedPlayer:: disablePlayControls");if(!excludedComponents){excludedComponents=['fullScreenBtn','logo','volumeControl'];if(mw.getConfig('enableControlsDuringAd')){excludedComponents.push('playPauseBtn');}}this._playContorls=false;$(this).trigger('onDisableInterfaceComponents',[excludedComponents]);},updateFeatureSupport:function(){mw.log("EmbedPlayer::updateFeatureSupport trigger: updateFeatureSupportEvent");$(this).trigger('updateFeatureSupportEvent',this.supports);return;},applyIntrinsicAspect:function(){var $img=this.getInterface().find('.playerPoster');if($img.length){var pHeight=this.getVideoDisplay().height();var pWidth=parseInt($img.naturalWidth()/$img.naturalHeight()*pHeight);var pClass='fill-height';if(pWidth>this.getVideoDisplay().width()){pClass='fill-width';}$img.removeClass('fill-width fill-height').addClass(pClass);if(this.getFlashvars("stretchVideo")===true){$img.removeClass(pClass).addClass('fill-width fill-height');}}},loadPlayerSize:function(element){this.height=element.height>0?element.height+'':$(element).css('height');this.width=element.width>0?element.width+'':$(element).css('width');if(this.height=='32px'||this.height=='32px'){this.width='100%';this.height='100%';}mw.log('EmbedPlayer::loadPlayerSize: css size:'+this.width+' h: '+this.height);if(this.height.indexOf('100%')!=-1||this.width.indexOf('100%')!=-1){var $relativeParent=$(element).parents().filter(function(){return $(this).is('body')||$(this).css('position')=='relative';}).slice(0,1);this.width=$relativeParent.width();this.height=$relativeParent.height();}this.height=parseInt(this.height);this.width=parseInt(this.width);this.height=(this.height==0||isNaN(this.height)&&$(element).attr('height'))?parseInt($(element).attr('height')):this.height;this.width=(this.width==0||isNaN(this.width)&&$(element).attr('width'))?parseInt($(element).attr('width')):this.width;if(this.isAudio()&&this.height=='32'){this.height=20;}if(this.isAudio()&&this.videoAspect){var aspect=this.videoAspect.split(':');if(this.height&&!this.width){this.width=parseInt(this.height*(aspect[0]/aspect[1]));}if(this.width&&!this.height){var apectRatio=(aspect[1]/aspect[0]);this.height=parseInt(this.width*(aspect[1]/aspect[0]));}}if((isNaN(this.height)||isNaN(this.width))||(this.height==-1||this.width==-1)||((this.height==150||this.height==64)&&this.width==300)){var defaultSize=mw.getConfig('EmbedPlayer.DefaultSize').split('x');if(isNaN(this.width)){this.width=defaultSize[0];}if(this.isAudio()){this.height=20;}else{this.height=defaultSize[1];}}},getPlayerWidth:function(){if(mw.getConfig('EmbedPlayer.IsIframeServer')){return $(window).width();}return this.getVideoHolder().width();},getPlayerHeight:function(){return this.getVideoHolder().height();},checkPlayerSources:function(){mw.log('EmbedPlayer::checkPlayerSources: '+this.id);var _this=this;$(_this).trigger('preCheckPlayerSources');$(_this).triggerQueueCallback('checkPlayerSourcesEvent',function(){_this.setupSourcePlayer();});},getTextTracks:function(){if(!this.mediaElement){return[];}return this.mediaElement.getTextTracks();},emptySources:function(){if(this.mediaElement){this.mediaElement.sources=[];this.mediaElement.selectedSource=null;}if(this.manifestAdaptiveFlavors.length){this.manifestAdaptiveFlavors=[];}this.prevPlayer=this.selectedPlayer;},getPlayerByStreamerType:function(source){var targetPlayer;if(this.casting&&!mw.getConfig('EmbedPlayer.ForceNativeComponent')===true){return mw.EmbedTypes.getMediaPlayers().getPlayerById('chromecast');}if(!mw.getConfig('EmbedPlayer.IgnoreStreamerType')&&!this.isImageSource()&&this.streamerType!='http'&&source.mimeType!=="video/youtube"&&mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('kplayer')){targetPlayer=mw.EmbedTypes.getKplayer();}else{targetPlayer=mw.EmbedTypes.getMediaPlayers().getDefaultPlayer(source.mimeType);}return targetPlayer;},isImageSource:function(){return(this.mediaElement.selectedSource.getMIMEType().indexOf("image")==0)},switchPlaySource:function(source,switchCallback,doneCallback){var _this=this;var targetPlayer=this.getPlayerByStreamerType(source);if(targetPlayer.library!=this.selectedPlayer.library){this.selectPlayer(targetPlayer);this.updatePlaybackInterface(function(){_this.playerSwitchSource(source,switchCallback,doneCallback);});}else{_this.playerSwitchSource(source,switchCallback,doneCallback);}},playerSwitchSource:function(source,switchCallback,doneCallback){mw.log("Error player interface must support actual source switch");},replaceSources:function(sources){var _this=this;this.emptySources();$.each(sources,function(inx,source){_this.mediaElement.tryAddSource(source);});$(this).trigger('sourcesReplaced');},disablePlayer:function(){mw.log("Error player interface must support actual disablePlayer");},setupSourcePlayer:function(){var _this=this;mw.log("EmbedPlayer::setupSourcePlayer: "+this.id+' sources: '+this.mediaElement.sources.length);this.addPlayerStateChangeBindings();this.bindHelper('embedPlayerError',function(e,data){_this.handlePlayerError(data);});this.bindHelper('bitrateChange',function(e,data){_this.currentBitrate=data;});if(mw.getConfig('EmbedPlayer.ReplaceSources')){this.replaceSources(mw.getConfig('EmbedPlayer.ReplaceSources'));this.sourcesReplaced=true;mw.setConfig('EmbedPlayer.ReplaceSources',null);}else{this.sourcesReplaced=false;}var baseTimeOptions={'supportsURLTimeEncoding':this.supportsURLTimeEncoding(),'startTime':this.startTime,'endTime':this.pauseTime};this.mediaElement.autoSelectSource(baseTimeOptions);if(!this.mediaElement.selectedSource&&mw.getConfig("EmbedPlayer.PreloadNativeComponent")){this.selectPlayer(mw.EmbedTypes.getNativeComponentPlayerVideo());this.updatePlaybackInterface();return;}if(this.mediaElement.selectedSource){if(this.isImageSource()){mw.setConfig('EmbedPlayer.ForceNativeComponent',false);}var targetPlayer=this.getPlayerByStreamerType(this.mediaElement.selectedSource);this.selectPlayer(targetPlayer);if(this.selectedPlayer&&(!this.prevPlayer||this.prevPlayer.library!=this.selectedPlayer.library)){this.disablePlayer();this.updatePlaybackInterface();return;}}if(!this.selectedPlayer||!this.mediaElement.selectedSource){var errorObj;if(this.isDrmRequired()){if(!this.isPluginEnabled('multiDrm')){errorObj=this.getKalturaMsgObject('mwe-embedplayer-drm-error-not-enabled');}else{errorObj=this.getKalturaMsgObject('mwe-embedplayer-drm-error-not-supported');}}else{if(!mw.isMobileDevice()&&!mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('splayer')){$.each(this.mediaElement.sources,function(currentIndex,currentSource){if(currentSource.getFlavorId()=="ism"){errorObj=_this.getKalturaMsgObject('mwe-embedplayer-install-silverlight');return;}});}}if(!errorObj){this.showPlayerError();}else{this.setError(errorObj);if(!this.changeMediaStarted){this.showErrorMsg(errorObj);}}mw.log("EmbedPlayer:: setupSourcePlayer > player ready ( but with errors ) ");}else{$(this).trigger('layoutReady');}this.playerReadyFlag=true;$(this).trigger('playerReady');this.triggerWidgetLoaded();},autoSelectTemporalSource:function(options){var baseTimeOptions={'supportsURLTimeEncoding':this.supportsURLTimeEncoding(),'startTime':this.startTime,'endTime':this.pauseTime};this.mediaElement.autoSelectSource($.extend({},baseTimeOptions,options));},updatePlaybackInterface:function(callback){var _this=this;mw.log("EmbedPlayer::updatePlaybackInterface: duration is: "+this.getDuration()+' playerId: '+this.id);if(this.instanceOf){$(this).data('previousInstanceOf',this.instanceOf);var tmpObj=mw['EmbedPlayer'+this.instanceOf];var attributes=mw.getConfig('EmbedPlayer.Attributes');for(var i in tmpObj){if(i in attributes){continue;}if(typeof this['parent_'+i]!='undefined'){this[i]=this['parent_'+i];}else{this[i]=null;}}}this.selectedPlayer.load(function(){mw.log('EmbedPlayer::updatePlaybackInterface: loaded '+_this.selectedPlayer.library+' duration: '+_this.getDuration());_this.updateLoadedPlayerInterface(callback);$(_this).trigger('PlayerLoaded');});},updateLoadedPlayerInterface:function(callback){var _this=this;mw.log('EmbedPlayer::updateLoadedPlayerInterface '+_this.selectedPlayer.library+" player loaded for: "+_this.id);var playerInterface=mw['EmbedPlayer'+_this.selectedPlayer.library];if(playerInterface.init){playerInterface.init();}for(var method in playerInterface){if(typeof _this[method]!='undefined'&&!_this['parent_'+method]){_this['parent_'+method]=_this[method];}_this[method]=playerInterface[method];}if($.isFunction(_this.setup)){var failCallback=function(){_this.removePoster();_this.layoutBuilder.displayAlert({title:_this.getKalturaMsg('ks-PLUGIN-BLOCKED-TITLE'),message:_this.getKalturaMsg('ks-PLUGIN-BLOCKED'),keepOverlay:true,noButtons:true,props:{customAlertTitleCssClass:"AlertTitleTransparent",customAlertMessageCssClass:"AlertMessageTransparent",customAlertContainerCssClass:"AlertContainerTransparent flashBlockAlertContainer"}});};_this.setup(function(){_this.runPlayerStartupMethods(callback);},failCallback);return;}_this.runPlayerStartupMethods(callback);},runPlayerStartupMethods:function(callback){this.updateFeatureSupport();this.embedPlayerHTML();this.getDuration();this.showPlayer();if($.isFunction(callback)){callback();}},selectPlayer:function(player){mw.log("EmbedPlayer:: selectPlayer "+player.id);var _this=this;if(!this.selectedPlayer||this.selectedPlayer.id!=player.id){if(this.selectedPlayer){this.clean();}this.selectedPlayer=player;}},clean:function(){},getDuration:function(){if(isNaN(this.duration)&&this.mediaElement&&this.mediaElement.selectedSource&&typeof this.mediaElement.selectedSource.durationHint!='undefined'){this.duration=this.mediaElement.selectedSource.durationHint;}return this.duration;},getHeight:function(){return this.getInterface().height();},getWidth:function(){return this.getInterface().width();},isAudio:function(){return(this.rewriteElementTagName=='audio'||(this.mediaElement&&this.mediaElement.selectedSource&&this.mediaElement.selectedSource.mimeType.indexOf('audio/')!==-1)||this.isAudioPlayer);},embedPlayerHTML:function(){return'Error: function embedPlayerHTML should be implemented by embed player interface ';},seek:function(seekTime,stopAfterSeek){if(seekTime<0){seekTime=0;}if(this.getDuration()>0&&seekTime>this.getDuration()){seekTime=this.getDuration();}seekTime=parseFloat(parseFloat(seekTime).toFixed(2));this.stopAfterSeek=(stopAfterSeek!==undefined)?stopAfterSeek:!this.isPlaying();mw.log('EmbedPlayer:: seek: to:'+seekTime+" sec, stopAfterSeek="+this.stopAfterSeek);this.kPreSeekTime=this.currentTime;var stopSeek={value:false};this.triggerHelper('preSeek',[seekTime,stopAfterSeek,stopSeek]);if(stopSeek.value){return false;}this.seeking=true;this.currentTime=seekTime;mw.log('EmbedPlayer::seek:trigger');this.triggerHelper('seeking');this.layoutBuilder.onSeek();this.unbindHelper("seeked"+this.bindPostfix).bindOnceHelper("seeked"+this.bindPostfix,this.seekedHandler);$(this).data('currentSeekTarget',seekTime);this.currentSeekTargetTime=seekTime;var playerElementTime=parseFloat(this.getPlayerElementTime()).toFixed(2);if(Math.abs(playerElementTime-seekTime)<mw.getConfig("EmbedPlayer.SeekTargetThreshold",0.1)){mw.log("EmbedPlayer:: seek: current time matches seek target: "+playerElementTime+' ~== '+seekTime);$(this).trigger('seeked');}else{var _this=this;this.canSeek().then(function(){_this.doSeek(seekTime,stopAfterSeek);});}},seekedHandler:function(){var _this=this;this.seeking=false;this.previousTime=this.currentTime=this.getPlayerElementTime();this.kPreSeekTime=null;this.removePoster();this.startMonitor();if(this.stopAfterSeek){this.hideSpinner();setTimeout(function(){_this.pause();_this.stopMonitor();_this.updatePlayheadStatus();},0);}else{setTimeout(function(){if(!_this.stopPlayAfterSeek){mw.log("EmbedPlayer::Play after seek");_this.play();_this.stopPlayAfterSeek=false;}},0);}},canSeek:function(){return $.Deferred().resolve();},setCurrentTime:function(time,callback){mw.log('Error: EmbedPlayer, setCurrentTime not overriden');if($.isFunction(callback)){callback();}},setDuration:function(newDuration){this.duration=newDuration;$(this).trigger('durationChange',[newDuration]);},triggeredEndDone:false,postSequenceFlag:false,onClipDone:function(){var _this=this;this.cancelClipDoneGuard();if(!_this._propagateEvents){return;}mw.log('EmbedPlayer::onClipDone: propagate:'+_this._propagateEvents+' id:'+this.id+' doneCount:'+this.donePlayingCount+' stop state:'+this.isStopped());if(!this.isStopped()){this.stopped=true;this.isPauseLoading=false;if(!this.onDoneInterfaceFlag){this.stopEventPropagation();}mw.log("EmbedPlayer:: trigger: ended ( inteface continue pre-check: "+this.onDoneInterfaceFlag+' )');$(this).trigger('ended');mw.log("EmbedPlayer::onClipDone:Trigged ended, continue? "+this.onDoneInterfaceFlag);if(!this.onDoneInterfaceFlag||this.isInSequence()){this.restoreEventPropagation();return;}if(!this.stopAfterSeek){this.stopAfterSeek=true;}if(this.onDoneInterfaceFlag){mw.log("EmbedPlayer::onDoneInterfaceFlag=true do interface done");_this.donePlayingCount++;if(_this.loop){var startTime=0.01;if(this.startOffset){startTime=this.startOffset;}this.seek(startTime,false);}else{_this.stop();mw.log("EmbedPlayer:: trigger: onEndedDone");if(!_this.triggeredEndDone){_this.triggeredEndDone=true;_this.ignoreNextNativeEvent=true;$(_this).trigger('onEndedDone');}if(_this.buffering){_this.bufferEnd();}}}if(this.onDoneInterfaceFlag){mw.log("EmbedPlayer:: trigger: playbackComplete");$(this).trigger('playbackComplete');mw.log("EmbedPlayer:: trigger: postEnded");$(this).trigger('postEnded');}}if(this.getFlashvars("EmbedPlayer.ShowPosterOnStop")!==false&&!this.loop){this.updatePosterHTML();}},replay:function(){var _this=this;var startTime=0.01;setTimeout(function(){if(_this.startOffset){startTime=_this.startOffset;}_this.seek(startTime,false);},10);},showThumbnail:function(){var _this=this;mw.log('EmbedPlayer::showThumbnail::'+this.stopped);this.layoutBuilder.closeMenuOverlay();this.updatePosterHTML();this.paused=true;this.stopped=true;this.layoutBuilder.addControlBindings();if(!this.useNativePlayerControls()){mw.log("mediaLoaded");$(this).trigger('mediaLoaded');}},addControls:function(){if(this.controls){this.layoutBuilder.addControls();}},showPlayer:function(){mw.log('EmbedPlayer:: showPlayer: '+this.id+' interace: w:'+this.width+' h:'+this.height);var _this=this;if(mw.getConfig('preload')==='auto'){this.load();}this.hideSpinner();if(!this.useNativePlayerControls()&&this.isPersistentNativePlayer()){$(this).show();}this.addControls();this.updatePosterHTML();if(this.displayPlayer===false){_this.getVideoHolder().hide();_this.getInterface().height(_this.layoutBuilder.getComponentsHeight());}this.doUpdateLayout();this.playerReadyFlag=true;if(this.mediaElement&&this.mediaElement.selectedSource&&this.mediaElement.selectedSource.mimeType==="video/youtube"){mw.log("EmbedPlayer:: Loading Youtube player. playerReady event to be dispatched by Youtube player.");}else{mw.log("EmbedPlayer:: Trigger: playerReady");$(this).trigger('playerReady');}this.triggerWidgetLoaded();if(this['data-blockPlayerDisplay']){this.blockPlayerDisplay();return;}if(this.getError()){this.showErrorMsg(this.getError());return;}if(this.isStopped()&&this.autoplay&&!this.changeMediaStarted&&this.canAutoPlay()&&!this.isLive()){mw.log('EmbedPlayer::showPlayer::Do autoPlay');_this.play();}},canAutoPlay:function(){return false;},doUpdateLayout:function(skipTrigger){var containerHeight=this.layoutBuilder.getContainerHeight();var newHeight=containerHeight-this.layoutBuilder.getComponentsHeight();var currentHeight=this.getVideoHolder().height();var deltaHeight=Math.abs(currentHeight-newHeight);mw.log('EmbedPlayer: doUpdateLayout:: containerHeight: '+containerHeight+', components: '+this.layoutBuilder.getComponentsHeight()+', videoHolder old height: '+currentHeight+', new height: '+newHeight+' hight delta: '+deltaHeight);if(currentHeight!==newHeight&&deltaHeight>1){this.getVideoHolder().height(newHeight);}if(this.isStopped()&&!(this.sequenceProxy&&this.sequenceProxy.isInSequence)&&!this.removePosterFlag){this.updatePosterHTML();}if(!skipTrigger&&deltaHeight!=1){mw.log('EmbedPlayer: updateLayout: trigger "updateLayout" ');this.triggerHelper('updateLayout');}},getInterface:function(){if(!this.$interface){var _this=this;this.layoutBuilder=new mw.PlayerLayoutBuilder(this);this.$interface=this.layoutBuilder.getInterface();if(mw.getConfig('EmbedPlayer.IsIframeServer')){$(window).off("debouncedresize").on("debouncedresize",function(){mw.log('debouncedresize:: call doUpdateLayout');_this.triggerHelper('resizeEvent');_this.doUpdateLayout();});}}return this.$interface;},updateInterfaceSize:function(size){var oldH=this.getInterface().height();var oldW=this.getInterface().width();if(size.width!=oldW||size.height!=oldH){this.getInterface().css(size);this.doUpdateLayout(true);}},setError:function(errorObj){var _this=this;if(typeof errorObj=='string'){this.playerError={'title':_this.getKalturaMsg('ks-GENERIC_ERROR_TITLE'),'message':errorObj}
return;}this.playerError=errorObj;},getError:function(){if(!$.isEmptyObject(this.playerError)){return this.playerError;}return null;},showErrorMsg:function(errorObj){this.hideSpinner();this.triggerHelper('playerError',errorObj);this.changeMediaStarted=false;if(this.layoutBuilder){if(mw.getConfig("EmbedPlayer.ShowPlayerAlerts")){var alertObj=$.extend(errorObj,{'isModal':true,'keepOverlay':true,'noButtons':true,'isError':true});this.layoutBuilder.displayAlert(alertObj);}}return;},blockPlayerDisplay:function(){this.getInterface().find('.error').hide();},showPlayerError:function(){var _this=this;var $this=$(this);mw.log("EmbedPlayer::showPlayerError");this.hideSpinner();$this.trigger('mediaLoadError');$this.trigger('mediaError');if(this['data-blockPlayerDisplay']){this.blockPlayerDisplay();return;}if(this.getError()){this.showErrorMsg(this.getError());return;}this.showNoInlinePlabackSupport();},isLinkPlayerFlag:false,isLinkPlayer:function(){return this.isLinkPlayerFlag;},showNoInlinePlabackSupport:function(){var _this=this;var $this=$(this);if(this.mediaElement.sources.length==0||!mw.getConfig('EmbedPlayer.NotPlayableDownloadLink')){if(this.kentryid){this.showNoPlayableSources();}else if(this.getFlashvars().referenceId){this.showWrongReferenceIdMessege();}return;}this.isLinkPlayerFlag=true;this.updatePosterHTML();this.addControls();var downloadUrl=this.mediaElement.sources[0].getSrc();this.triggerHelper('directDownloadLink',function(dlUrl){if(dlUrl){downloadUrl=dlUrl;}});$(this).trigger('showInlineDownloadLink',[downloadUrl]);},showNoPlayableSources:function(){var $this=$(this);var errorObj=this.getKalturaMsgObject('mwe-embedplayer-missing-source');$this.trigger('NoSourcesCustomError',function(customErrorMsg){if(customErrorMsg){errorObj.message=customErrorMsg;}});this.setError(errorObj);this.showErrorMsg(errorObj);return;},showWrongReferenceIdMessege:function(){var $this=$(this);var errorObj=this.getKalturaMsgObject('mwe-embedplayer-wrong-reference-id');$this.trigger('WrongReferenceIdCustomError',function(customErrorMsg){if(customErrorMsg){errorObj.message=customErrorMsg;}});this.setError(errorObj);this.showErrorMsg(errorObj);return;},updateThumbTimeNPT:function(time){this.updateThumbTime(mw.npt2seconds(time)-parseInt(this.startOffset));},updateThumbTime:function(floatSeconds){var _this=this;if(typeof this.orgThumSrc=='undefined'){this.orgThumSrc=this.poster;}if(this.orgThumSrc.indexOf('t=')!==-1){this.lastThumbUrl=mw.replaceUrlParams(this.orgThumSrc,{'t':mw.seconds2npt(floatSeconds+parseInt(this.startOffset))});if(!this.thumbnailUpdatingFlag){this.updatePoster(this.lastThumbUrl,false);this.lastThumbUrl=null;}}},updateThumbPerc:function(percent){return this.updateThumbTime((this.getDuration()*percent));},updatePoster:function(posterSrc,alt){if(!posterSrc){posterSrc=mw.getConfig('EmbedPlayer.BlackPixel');}this.poster=posterSrc;this.posterAlt=alt||gM('mwe-embedplayer-video-thumbnail');this.updatePosterHTML();},changeMedia:function(callback,checkPlayerSourcesFunction,resetPlaybackValues){var _this=this;var $this=$(this);mw.log('EmbedPlayer:: changeMedia ');this.removePoster();$this.trigger('onChangeMedia');this.emptySources();this.firstPlay=true;if(resetPlaybackValues||resetPlaybackValues===undefined){this.donePlayingCount=0;this.triggeredEndDone=false;this.preSequenceFlag=false;this.postSequenceFlag=false;this.shouldEndClip=true;this.mediaLoadedFlag=false;}this.isPauseLoading=true;this.pause();this.addPlayerSpinner();this.stopMonitor();this.resetPlaybackValues();this.setError(null);this['data-blockPlayerDisplay']=null;$this.attr('data-blockPlayerDisplay','');this.getInterface().find('.error').remove();this.layoutBuilder.closeAlert();this.layoutBuilder.closeMenuOverlay();var bindName='playerReady.changeMedia';$this.one(bindName,function(){mw.log('EmbedPlayer::changeMedia playerReady callback');_this.hideSpinner();if(_this.getError()){_this.changeMediaStarted=false;_this.showErrorMsg(_this.getError());return;}var changeMediaDoneCallback=function(){_this.changeMediaStarted=false;$(".mwEmbedPlayer").removeClass("mwEmbedPlayerBlackBkg");if(_this.canAutoPlay()){if(!_this.isAudioPlayer){_this.removePoster();}}$this.trigger('onChangeMediaDone');if(callback){callback();}};if($.isFunction(_this.changeMediaCallback)){setTimeout(function(){_this.changeMediaCallback(changeMediaDoneCallback);},250);}else{changeMediaDoneCallback();}});if(checkPlayerSourcesFunction){checkPlayerSourcesFunction(function(){mw.log("EmbedPlayer::changeMedia:  Done with checkPlayerSourcesFunction");_this.setupSourcePlayer();});}else{$this.triggerQueueCallback('checkPlayerSourcesEvent',function(){mw.log("EmbedPlayer::changeMedia:  Done with checkPlayerSourcesEvent");_this.setupSourcePlayer();});}},isImagePlayScreen:function(){return(this.useNativePlayerControls()&&!this.isLinkPlayer()&&mw.isIphone()&&mw.getConfig('EmbedPlayer.iPhoneShowHTMLPlayScreen'));},isPlaylistScreen:function(){return!(typeof this.playlist=="undefined");},triggerWidgetLoaded:function(){if(!this.widgetLoaded){this.widgetLoaded=true;mw.log("EmbedPlayer:: Trigger: widgetLoaded");this.triggerHelper('widgetLoaded');}},addBlackScreen:function(){var posterSrc=mw.getConfig('EmbedPlayer.BlackPixel');var posterCss={'position':'absolute','height':'100%','width':'100%'};$(this).html($('<img />').css(posterCss).attr({'src':posterSrc}).addClass('blackPlayer')).show();},removeBlackScreen:function(){$(this).find('.blackPlayer').remove();},updatePosterHTML:function(){mw.log('EmbedPlayer:updatePosterHTML:'+this.id+' poster:'+this.poster);var _this=this;var posterSrc=this.poster;var posterCss={};if(!posterSrc){posterSrc=mw.getConfig('EmbedPlayer.BlackPixel');posterCss={'position':'absolute','height':'100%','width':'100%'};}$(this).find(".playerPoster").remove();if(this.currentState=="load"&&mw.getConfig('autoPlay')&&!mw.isMobileDevice()&&!this.isAudio()){return;}if(mw.getConfig('EmbedPlayer.HidePosterOnStart')===true&&!(this.currentState=="end"&&mw.getConfig('EmbedPlayer.ShowPosterOnStop'))){return;}if(mw.isIE9Comp()||mw.isIE10Comp()){$(this).addClass("mwEmbedPlayerTransparentComp");}else{if(mw.isIE8()||mw.isIE7()){$(this).addClass("mwEmbedPlayerTransparent");}}$(".mwEmbedPlayer").addClass("mwEmbedPlayerBlackBkg");$(this).html($('<img />').css(posterCss).attr({'src':this.poster}).addClass('playerPoster').load(function(){_this.applyIntrinsicAspect();$('.playerPoster').attr('alt',_this.posterAlt);})).show();},removePoster:function(){if(!mw.getConfig("EmbedPlayer.KeepPoster")===true&&!this.isAudio()){$(".mwEmbedPlayer").removeClass("mwEmbedPlayerBlackBkg");$(this).find('.playerPoster').remove();}},useNativePlayerControls:function(){if(this.usenativecontrols===true){return true;}if(mw.getConfig('EmbedPlayer.NativeControls')===true){return true;}if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){return false;}if((mw.isAndroidNativeBrowser()||mw.isIphone())&&!mw.isWindowsPhone()){return true;}if(mw.isIpad()){if(mw.getConfig('EmbedPlayer.EnableIpadNativeFullscreen')&&this.layoutBuilder&&this.layoutBuilder.isInFullScreen()){return true;}else if(this.isPersistentNativePlayer()&&mw.getConfig('EmbedPlayer.EnableIpadHTMLControls')===true){return false;}else{return true;}}return false;},isDvrSupported:function(){return(mw.isNativeApp()||!mw.isAndroid());},isPersistentNativePlayer:function(){if(this.isLinkPlayer()){return false;}if($('#'+this.pid).length==0){return $('#'+this.id).hasClass('persistentNativePlayer');}return $('#'+this.pid).hasClass('persistentNativePlayer');},isOverlayControls:function(){if(!this.supports['overlays']){return false;}if(this.overlaycontrols===false){return false;}if(this.isAudio()&&!this.isMobileSkin()){return false;}if(mw.getConfig('EmbedPlayer.OverlayControls')===false){return false;}if(this.controls===false){return false;}return true;},getVideoHolder:function(){return this.getInterface().find('.videoHolder');},getVideoDisplay:function(){return this.getInterface().find('.videoDisplay');},getControlBarContainer:function(){return this.getInterface().find('.controlBarContainer');},getTopBarContainer:function(){return this.getInterface().find('.topBarContainer');},getPlayerPoster:function(){return this.getInterface().find('.playerPoster');},getNativePlayerHtml:function(){return $('<div />').css('width',this.getWidth()).html('Error: Trying to get native html5 player without native support for codec');},applyMediaElementBindings:function(){mw.log("Warning applyMediaElementBindings should be implemented by player interface");return;},getSharingEmbedCode:function(){switch(mw.getConfig('EmbedPlayer.ShareEmbedMode')){case'iframe':return this.getShareIframeObject();break;case'videojs':return this.getShareEmbedVideoJs();break;}},getShareIframeObject:function(){var iframeUrl=this.getIframeSourceUrl();var embedCode='&lt;iframe src=&quot;'+mw.html.escape(iframeUrl)+'&quot; ';embedCode+='width=&quot;'+this.getPlayerWidth()+'&quot; ';embedCode+='height=&quot;'+this.getPlayerHeight()+'&quot; ';embedCode+='allowfullscreen webkitallowfullscreen mozAllowFullScreen ';embedCode+='frameborder=&quot;0&quot; ';embedCode+='&gt;&lt/iframe&gt;';return embedCode;},getIframeSourceUrl:function(){var iframeUrl=false;this.triggerHelper('getShareIframeSrc',function(localIframeSrc){if(iframeUrl){mw.log("Error multiple modules binding getShareIframeSrc");}iframeUrl=localIframeSrc;});if(iframeUrl){return iframeUrl;}var iframeUrl=mw.getMwEmbedPath()+'mwEmbedFrame.php?';var params={'src[]':[]};for(var i=0;i<this.mediaElement.sources.length;i++){var source=this.mediaElement.sources[i];if(source.src){params['src[]'].push(mw.absoluteUrl(source.src));}}if(this.poster){params.poster=this.poster;}if(this.skinName){params.skin=this.skinName;}if(this.duration){params.durationHint=parseFloat(this.duration);}iframeUrl+=$.param(params);return iframeUrl;},getShareEmbedVideoJs:function(){var embedtag=(this.isAudio())?'audio':'video';var embedCode='&lt;script type=&quot;text/javascript&quot; '+'src=&quot;'+mw.html.escape(mw.absoluteUrl(mw.getMwEmbedSrc()))+'&quot;&gt;&lt;/script&gt'+'&lt;'+embedtag+' ';if(this.poster){embedCode+='poster=&quot;'+mw.html.escape(mw.absoluteUrl(this.poster))+'&quot; ';}if(this.skinName){embedCode+='class=&quot;'+mw.html.escape(this.skinName)+'&quot; ';}if(this.duration){embedCode+='durationHint=&quot;'+parseFloat(this.duration)+'&quot; ';}if(this.width||this.height){embedCode+='style=&quot;';embedCode+=(this.width)?'width:'+this.width+'px;':'';embedCode+=(this.height)?'height:'+this.height+'px;':'';embedCode+='&quot; ';}embedCode+='&gt;';for(var i=0;i<this.mediaElement.sources.length;i++){var source=this.mediaElement.sources[i];if(source.src){embedCode+='&lt;source src=&quot;'+mw.absoluteUrl(source.src)+'&quot; &gt;&lt;/source&gt;';}}embedCode+='&lt;/video&gt;';return embedCode;},isInSequence:function(){return(this.sequenceProxy&&this.sequenceProxy.isInSequence);},isMobileSkin:function(){var skin=this.getRawKalturaConfig("layout")?this.getRawKalturaConfig("layout").skin:window["kalturaIframePackageData"].playerConfig.layout?window["kalturaIframePackageData"].playerConfig.layout.skin:"kdark";return(mw.isChromeCast()||(mw.getConfig("EmbedPlayer.EnableMobileSkin")===true&&skin==="kdark"&&mw.isMobileDevice()&&!mw.isWindowsPhone()));},triggerPreSequence:function(){mw.log("EmbedPlayer:: trigger preSequence ");this.triggerHelper('preSequence');this.playInterfaceUpdate();},isTimeUpdateSupported:function(){return true;},firstPlay:true,preSequenceFlag:false,inPreSequence:false,replayEventCount:0,play:function(){if(this.seeking){this.log("Play while seeking, will play after seek!");this.stopAfterSeek=false;return false;}var _this=this;var $this=$(this);if(this.currentState=="end"){this.stopPlayAfterSeek=false;this.seek(0.01,false);return false;}mw.log("EmbedPlayer:: play: "+this._propagateEvents+' isStopped: '+_this.isStopped());this.absoluteStartPlayTime=new Date().getTime();if(this.getError()){return false;}var prePlay={allowPlayback:true};this.triggerHelper('prePlayAction',[prePlay]);if(!prePlay.allowPlayback){return false;}if(_this.isStopped()&&(_this.preSequenceFlag==false||(_this.sequenceProxy&&_this.sequenceProxy.isInSequence==false))){if(!_this.selectedPlayer){_this.showPlayerError();return false;}else{_this.embedPlayerHTML();}}if(this.isTimeUpdateSupported()){this.addPlayerSpinner();this.hideSpinnerOncePlaying();}_this.stopped=false;if(!this.preSequenceFlag){this.preSequenceFlag=true;this.triggerPreSequence();if(_this.sequenceProxy&&_this.sequenceProxy.isInSequence){mw.log("EmbedPlayer:: isInSequence, do NOT play content");return false;}}if(!this.isAudioPlayer){this.removePoster();}if(this.firstPlay&&this._propagateEvents){this.firstPlay=false;this.triggerHelper('firstPlay');}if(this.paused===true){this.paused=false;}mw.log("EmbedPlayer:: trigger play event::"+!this.paused+' events:'+this._propagateEvents);if(this._propagateEvents){this.triggerHelper('onplay');}if(this.donePlayingCount>0&&!this.paused&&this._propagateEvents){this.triggeredEndDone=false;this.shouldEndClip=true;if(this.replayEventCount<this.donePlayingCount){mw.log("EmbedPlayer::play> trigger replayEvent");this.triggerHelper('replayEvent');this.replayEventCount++;}}if(!this.supportsURLTimeEncoding()){this.addStartTimeCheck();}this.playInterfaceUpdate();if(_this._playContorls){return true;}else{mw.log("EmbedPlayer::play: _playContorls is false");return false;}},addStartTimeCheck:function(){var _this=this;if(this.startTime){$(this).bind('playing.startTime',function(){$(_this).unbind('playing.startTime');if(_this.currentTime<_this.startTime){if(!mw.isIOS()){_this.seek(_this.startTime);_this.startTime=0;}else{setTimeout(function(){_this.seek(_this.startTime,false);_this.startTime=0;},500)}}});}},playInterfaceUpdate:function(){var _this=this;mw.log('EmbedPlayer:: playInterfaceUpdate');if(this.layoutBuilder){this.layoutBuilder.closeMenuOverlay();}this.getInterface().find('.error').remove();this.hideSpinnerOncePlaying();this.restoreComponentsHover();$(this).trigger('onPlayInterfaceUpdate');},pauseLoading:function(){this.isPauseLoading=true;this.pause();this.addPlayerSpinner();},addPlayerSpinner:function(){var sId='loadingSpinner_'+this.id;$(this).trigger('onAddPlayerSpinner');$('#'+sId).remove();var target=this;switch(mw.getConfig("EmbedPlayer.SpinnerTarget")){case"videoHolder":target=this.getVideoHolder();break;case"videoDisplay":target=this.getVideoDisplay();break;default:target=this;}$(target).getAbsoluteOverlaySpinner().attr('id',sId);},hideSpinner:function(){$(this).trigger('onRemovePlayerSpinner');var $spinner=$('#loadingSpinner_'+this.id+',.loadingSpinner');if($spinner.length>0){$spinner.remove();}},hideSpinnerAndPlayBtn:function(){this.isPauseLoading=false;this.hideSpinner();},hideSpinnerOncePlaying:function(){this._checkHideSpinner=true;},pause:function(){mw.log("EmbedPlayer::pause()");var _this=this;if(this.paused===false){this.stopMonitor();this.paused=true;if(this._propagateEvents){mw.log('EmbedPlayer:trigger pause:'+this.paused);$(this).trigger('onpause');}}_this.pauseInterfaceUpdate();},pauseInterfaceUpdate:function(){var _this=this;mw.log("EmbedPlayer::pauseInterfaceUpdate");this.hideSpinner();this.disableComponentsHover();this.clearClipDoneGuard();$(this).trigger('onPauseInterfaceUpdate');},load:function(){mw.log('Waring:: the load method should be overided by player interface');},stop:function(){var _this=this;mw.log('EmbedPlayer::stop:'+this.id);this.stopped=true;if(this.adsOnReplay){this.preSequenceFlag=false;}$(this).trigger('doStop');this.didSeekJump=false;this.stopMonitor();if(!this.paused){this.pause();}this.resetPlaybackValues();},resetPlaybackValues:function(){this.currentTime=this.previousTime=0;this.updateBufferStatus(0);this.updatePlayHead(0);},togglePlayback:function(){if(this.paused){this.triggerHelper('userInitiatedPlay');this.play();}else{this.triggerHelper('userInitiatedPause');this.pause();}},isMuted:function(){return this.muted;},toggleMute:function(forceMute){mw.log('EmbedPlayer::toggleMute> (old state:) '+this.muted);if(forceMute||!this.muted){this.muted=true;this.preMuteVolume=this.volume;var percent=0;}else{this.muted=false;var percent=this.preMuteVolume;}this.setVolume(percent,true);$(this).trigger('onToggleMute',[percent]);},setVolume:function(percent,triggerChange){var _this=this;if(isNaN(percent)){return;}this.previousVolume=this.volume;if(this.previousVolume==percent){triggerChange=false;}this.volume=percent;this.muted=(percent===0);this.setPlayerElementVolume(percent);if(triggerChange!==false){if(this.previousVolume===0&&this.volume>0){$(_this).trigger('unmute');}if(this.previousVolume>0&&this.volume===0){$(_this).trigger('mute');}$(_this).trigger('volumeChanged',percent);}},setPlayerElementVolume:function(percent){mw.log('Error player does not support volume adjustment');},getPlayerElementVolume:function(){return this.volume;},getPlayerElementMuted:function(){return this.muted;},toggleFullscreen:function(){this.layoutBuilder.fullScreenManager.toggleFullscreen();},postEmbedActions:function(){return;},isPlaying:function(){if(this.stopped||this.paused){return false;}return true;},isStopped:function(){return this.stopped;},stopMonitor:function(){clearInterval(this.monitorInterval);this.monitorInterval=0;},startMonitor:function(){this.monitor();},monitor:function(){var _this=this;_this.syncCurrentTime();_this.syncVolume();_this.syncMonitor();if(_this._propagateEvents){if(!_this.seeking&&!_this.isFlavorSwitching){this.updatePlayheadStatus();this.checkClipDoneCondition();}$(_this).trigger('monitorEvent');if(_this.progressEventData){$(_this).trigger('progress',_this.progressEventData);}}},syncMonitor:function(){var _this=this;if(!this.isStopped()){if(!this.monitorInterval){this.monitorInterval=setInterval(function(){if(_this.monitor)_this.monitor();},this.monitorRate);}}else{this.stopMonitor();}},syncVolume:function(){var _this=this;_this.previousVolume=_this.volume;_this.volume=this.getPlayerElementVolume();if(_this.muted!=_this.getPlayerElementMuted()&&!_this.isStopped()){mw.log("EmbedPlayer::syncVolume: muted does not mach embed player");_this.toggleMute();_this.muted=_this.getPlayerElementMuted();}},bufferHandling:function(){if(!this.isLive()&&this.instanceOf!='ImageOverlay'){if(this.isPlaying()&&this.currentTime==this.getPlayerElementTime()){this.bufferStart();}else if(this.buffering){this.bufferEnd();}}},syncCurrentTime:function(){var _this=this;if(_this._checkHideSpinner&&_this.getPlayerElementTime()&&_this.currentTime!=_this.getPlayerElementTime()&&!_this.seeking){_this._checkHideSpinner=false;_this.isPauseLoading=false;_this.hideSpinner();}if(parseInt(_this.previousTime)!=parseInt(_this.currentTime)&&!this.userSlide&&!this.seeking&&!this.isStopped()){if(_this.getDuration()&&_this.currentTime<=_this.getDuration()){var seekPercent=_this.currentTime/_this.getDuration();mw.log("EmbedPlayer::syncCurrentTime::"+_this.previousTime+' != '+_this.currentTime+" javascript based currentTime update to "+_this.currentTime);_this.previousTime=_this.currentTime;this.seek(_this.currentTime);}}this.bufferHandling();_this.currentTime=_this.getPlayerElementTime();_this.previousTime=_this.currentTime;if(_this.pauseTime&&_this.currentTime>_this.pauseTime&&!this.supportsURLTimeEncoding()){_this.pause();_this.pauseTime=null;}},updatePlayheadStatus:function(){if(this.currentTime>=0&&this.duration){if(!this.userSlide&&!this.seeking){var playHeadPercent=(this.currentTime-this.startOffset)/this.duration;this.updatePlayHead(playHeadPercent);if(this.isDVR()){var perc=parseInt(playHeadPercent*1000);if(perc>998){this.liveEdgeOffset=0;}else{this.liveEdgeOffset=this.duration-perc/1000*this.duration;}}}}},checkClipDoneCondition:function(){if(this.currentTime>=0&&this.duration){if(!this.isLive()){var endPresentationTime=this.duration;var dvrWindow=(this.currentTime-this.startOffset);var endTimeRatio=dvrWindow/endPresentationTime;if(dvrWindow>=endPresentationTime&&!this.isStopped()){this.log("updatePlayheadStatus > should run clip done :: "+this.currentTime+' > '+endPresentationTime);this.onClipDone();}else if(endTimeRatio>=.99&&!this.isInSequence()){this.setClipDoneGuard();}}}},setClipDoneGuard:function(){if(!this.clipDoneTimeout&&this.shouldEndClip){var _this=this;var timeoutVal=(Math.abs(this.duration-this.currentTime)*2);this.log("Setting clip done guard check in "+timeoutVal+" seconds");this.clipDoneTimeout=setTimeout(function(){if(_this.shouldEndClip&&!_this.isLive()){_this.log("clipDone guard > should run clip done :: "+_this.currentTime);_this.onClipDone();}_this.clipDoneTimeout=null;},(timeoutVal*1000));this.unbindHelper(".clipDoneGuard").bindOnceHelper("seeking.clipDoneGuard",function(){_this.cancelClipDoneGuard();})}},cancelClipDoneGuard:function(){this.log("Cancel clipDone guard");this.shouldEndClip=false;this.clearClipDoneGuard();},clearClipDoneGuard:function(){if(this.clipDoneTimeout){this.log("Clear clipDone guard timer");clearTimeout(this.clipDoneTimeout);this.clipDoneTimeout=null;}},getPlayerElementTime:function(){mw.log("Error: getPlayerElementTime should be implemented by embed library");},resolveSrcURL:function(srcURL){var deferred=$.Deferred();deferred.resolve(srcURL);return deferred;},getPlayerElement:function(){mw.log("Error: getPlayerElement should be implemented by embed library, or you may be calling this event too soon");},updateBufferStatus:function(percent){if(percent>1){this.bufferedPercent=1;}else{this.bufferedPercent=percent;}$(this).trigger('updateBufferPercent',this.bufferedPercent);},updatePlayHead:function(perc){$(this).trigger('updatePlayHeadPercent',perc);},getSrc:function(){if(!this.mediaElement){return false;}if(!this.mediaElement.selectedSource){this.autoSelectTemporalSource();};if(this.mediaElement.selectedSource){return this.mediaElement.selectedSource.getSrc();}return false;},getSource:function(){this.autoSelectTemporalSource();if(this.mediaElement.selectedSource&&this.mediaElement.selectedSource.mimeType==="application/vnd.apple.mpegurl"){this.streamerType="hls";}return this.mediaElement.selectedSource;},getSources:function(){if(this.manifestAdaptiveFlavors.length){return this.manifestAdaptiveFlavors;}return this.mediaElement.getPlayableSources();},getSourceIndex:function(source){var sourceIndex=null;var sourceAssetId=source.getAssetId();$.each(this.getSources(),function(currentIndex,currentSource){if(sourceAssetId==currentSource.getAssetId()){sourceIndex=currentIndex;return false;}});if(sourceIndex==null){mw.log("Error could not find source: "+source.getSrc());}return sourceIndex;},getCompatibleSource:function(videoFiles){var $media=$('<video />');$.each(videoFiles,function(inx,source){$media.append($('<source />').attr(source));mw.log("EmbedPlayer::getCompatibleSource: add "+source.src+' of type:'+source.type);});var myMediaElement=new mw.MediaElement($media[0]);if(this.getRawKalturaConfig('mediaProxy')&&this.getRawKalturaConfig('mediaProxy').preferedFlavorBR){myMediaElement.preferedFlavorBR=this.getRawKalturaConfig('mediaProxy').preferedFlavorBR*1000;}var baseTimeOptions={'supportsURLTimeEncoding':this.supportsURLTimeEncoding(),'startTime':this.startTime,'endTime':this.pauseTime};var source=myMediaElement.autoSelectSource(baseTimeOptions);if(source){mw.log("EmbedPlayer::getCompatibleSource: "+source.getSrc());return source;}mw.log("Error:: could not find compatible source");return false;},supportsURLTimeEncoding:function(){return(mw.getConfig('EmbedPlayer.EnableURLTimeEncoding'));},setCookie:function(name,value,options){var _this=this;if(!mw.getConfig('alertForCookies')){$.cookie(name,value,options);return;}if($.cookie('allowCookies')){$.cookie(name,value,options);return;}var alertObj={'title':"Cookies",'message':"Video player will save cookies on your computer",'isModal':true,'isExternal':false,'buttons':["Allow","Disallow"],'callbackFunction':function(eventObj){if(eventObj.target.textContent.toLowerCase()==="allow"){$.cookie('allowCookies',true);$.cookie(name,value,options);}else{$.cookie('allowCookies',null);_this.disabledCookies=true;}}};if(!this.disabledCookies){this.layoutBuilder.displayAlert(alertObj);}},setLive:function(isLive){this.live=isLive;},isLive:function(){return this.live;},setDrmRequired:function(isDrm){this.drmRequired=isDrm;},isDrmRequired:function(){return this.drmRequired&&!this.getRawKalturaConfig("embedPlayerChromecastReceiver","plugin")===true;},isDVR:function(){if(this.kalturaPlayerMetaData&&this.kalturaPlayerMetaData['dvrStatus']){return this.kalturaPlayerMetaData['dvrStatus'];}if(mw.getConfig("forceDVR")){return true;}return false;},isLiveOffSynch:function(){return this.liveOffSynch;},setLiveOffSynch:function(status){if(status!==this.liveOffSynch){this.liveOffSynch=status;$(this).trigger('onLiveOffSynchChanged',[status]);}},disableComponentsHover:function(){if(this.layoutBuilder){this.layoutBuilder.keepControlsOnScreen=true;this.layoutBuilder.removeTouchOverlay();}$(this).trigger('onComponentsHoverDisabled');},restoreComponentsHover:function(){if(this.layoutBuilder){this.layoutBuilder.keepControlsOnScreen=false;this.layoutBuilder.addTouchOverlay();}$(this).trigger('onComponentsHoverEnabled');},checkForTags:function(value,givenTags){if(typeof value==='undefined'){return false;}var valueTags=value.split(",");if(typeof valueTags==='undefined'||typeof givenTags==='undefined'){return false;}for(var i=0;i<valueTags.length;i++){for(var j=0;j<givenTags.length;j++){if(valueTags[i]==givenTags[j]){return true;}}}return false;},getSourcesByTags:function(flavorTags){var _this=this;var sources=this.mediaElement.getPlayableSources();var sourcesByTags=[];if(flavorTags===undefined){return sources;}else{var flavorTagsArr=flavorTags.split(',');for(var i=0;i<flavorTagsArr.length;i++){$.each(sources,function(sourceIndex,source){if(_this.checkForTags(source.getTags(),[flavorTagsArr[i]])){sourcesByTags.push(source);}});if(sourcesByTags.length>0){break;}}return sourcesByTags;}},switchSrc:function(source){if(source!==-1){var _this=this;var currentBR=0;if(this.mediaElement.selectedSource){currentBR=this.mediaElement.selectedSource.getBitrate();}$(this).trigger('sourceSwitchingStarted',[{currentBitrate:currentBR}]);this.mediaElement.setSource(source);$(this).trigger('sourceSwitchingEnd',[{newBitrate:source.getBitrate()}]);if(!this.isStopped()){this.isFlavorSwitching=true;var oldMediaTime=this.currentTime;var oldPaused=this.paused;this.playerSwitchSource(source,function(vid){setTimeout(function(){_this.addBlackScreen();_this.hidePlayerOffScreen();_this.unbindHelper("seeked.switchSrc").bindOnceHelper("seeked.switchSrc",function(){_this.isFlavorSwitching=false;_this.removeBlackScreen();_this.restorePlayerOnScreen();});_this.seek(oldMediaTime,oldPaused);},100);});}}},backToLive:function(){mw.log('Error player does not support back to live');},hidePlayerOffScreen:function(){mw.log('EmbedPlayer:: hidePlayerOffScreen: Notice player does not support hide player off screen');},restorePlayerOnScreen:function(){mw.log('EmbedPlayer:: restorePlayerOnScreen: Notice player does not support restore player on screen');},setStorageId:function(storageId){this.setFlashvars("storageId",storageId);if(this.mediaElement){$.each(this.mediaElement.sources,function(sourceIndex,source){if(source.src.indexOf("playManifest")!==-1){if(source.src.indexOf("storageId")!==-1){source.src=source.src.replace(/(.*storageId=)([0-9]+)/,"$1"+storageId);}else{source.src+=((source.src.indexOf('?')===-1)?'?':'&')+"storageId="+storageId;}}});}},bufferStart:function(){if(!this.isInSequence()&&!this.buffering){var _this=this;this.buffering=true;mw.log("EmbedPlayer::bufferStart");$(this).trigger('bufferStartEvent');this.bufferStartTime=new Date().getTime();if(!mw.getConfig('EmbedPlayer.DisableBufferingSpinner')){setTimeout(function(){if(!_this.isInSequence()&&_this.buffering&&!_this.paused){_this.addPlayerSpinner();}},_this.monitorRate);}}},bufferEnd:function(){if(!this.isInSequence()&&this.buffering){this.buffering=false;mw.log("EmbedPlayer::bufferEnd");this.bufferEndTime=new Date().getTime();this.lastBufferDuration=((this.bufferEndTime-this.bufferStartTime)/1000).toFixed(3);$(this).trigger('bufferEndEvent',{'bufferDuration':this.lastBufferDuration});if(!mw.getConfig('EmbedPlayer.DisableBufferingSpinner')){this.hideSpinner();}}},getKalturaAttributeConfig:function(attr){return this.getKalturaConfig(null,attr);},isVideoSiblingEnabled:function(){if(mw.getConfig("DisableVideoSibling")){return false;}else{return true;}},handlePlayerError:function(data,shouldHandlePlayerError){if(this.shouldHandlePlayerError||shouldHandlePlayerError){var message=this.getErrorMessage(data);this.showErrorMsg({title:this.getKalturaMsg('ks-GENERIC_ERROR_TITLE'),message:message});}},getErrorMessage:function(data){var message=data?data:this.getKalturaMsg('ks-CLIP_NOT_FOUND');message=message.errorMessage!==undefined?message.errorMessage:message;if(!message||message==undefined){message=this.getKalturaMsg('ks-CLIP_NOT_FOUND');}return message;},onFlavorsListChanged:function(newFlavors){this.setKDPAttribute('sourceSelector','simpleFormat',false);this.manifestAdaptiveFlavors=[];var _this=this;$.each(newFlavors,function(inx,flavor){_this.manifestAdaptiveFlavors.push(new mw.MediaSource(flavor))});$(this).trigger('sourcesReplaced');},getCurrentBitrate:function(){if(!this.isLive()&&this.mediaElement.selectedSource){return this.mediaElement.selectedSource.getBitrate();}return this.currentBitrate;},getLiveEdgeOffset:function(){return this.liveEdgeOffset;},setLiveEdgeOffset:function(offset,callback){mw.log('EmbedPlayer :: setLiveEdgeOffset -'+offset);this.seek(this.getDuration()-offset);if($.isFunction(callback)){callback();}},getCurrentBufferLength:function(){mw.log("Error: getPlayerElementTime should be implemented by embed library");}};})(window.mw,window.jQuery);(function(mw,$){"use strict";mw.FullScreenManager=function(embedPlayer){return this.init(embedPlayer);};mw.FullScreenManager.prototype={inFullScreen:false,parentsAbsoluteList:[],parentsRelativeList:[],parentsFixedList:[],bindPostfix:'.fullscreenManager',init:function(embedPlayer){this.embedPlayer=embedPlayer;return this;},isInFullScreen:function(){return this.inFullScreen;},toggleFullscreen:function(){this.embedPlayer.triggerHelper('onToggleFullscreen');if(mw.getConfig('EmbedPlayer.ExternalFullScreenControl')){return;}if(this.isInFullScreen()){this.restoreWindowPlayer();}else{this.doFullScreenPlayer();}},openNewWindow:function(){var embedPlayer=this.embedPlayer;var iframeMwConfig={'EmbedPlayer.IsFullscreenIframe':true,'EmbedPlayer.IframeCurrentTime':embedPlayer.currentTime,'EmbedPlayer.IframeIsPlaying':embedPlayer.isPlaying(),'EmbedPlayer.IframeParentUrl':document.URL};var url=embedPlayer.getIframeSourceUrl()+'#'+encodeURIComponent(JSON.stringify({'mwConfig':iframeMwConfig,'playerId':embedPlayer.id}));embedPlayer.pause();var newwin=window.open(url,'_blank','width='+screen.width+', height='+(screen.height-90)+', top=0, left=0'+', fullscreen=yes');if(window.focus){newwin.focus();}},doFullScreenPlayer:function(callback){mw.log("FullScreenManager:: doFullScreenPlayer");var vid=this.embedPlayer.getPlayerElement();if(mw.isMobileChrome()&&mw.getConfig('EmbedPlayer.EnableNativeChromeFullscreen')&&vid&&vid.webkitRequestFullscreen){vid.webkitRequestFullscreen();return;}if(mw.getConfig('EmbedPlayer.NewWindowFullscreen')&&!screenfull&&!(mw.getConfig('EmbedPlayer.EnableIpadNativeFullscreen')&&mw.isIpad())){this.openNewWindow();return;}var _this=this;var embedPlayer=this.embedPlayer;var $interface=embedPlayer.getInterface();if(this.isInFullScreen()==true){return;}this.inFullScreen=true;var isIframe=(mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IsFriendlyIframe')),doc=isIframe?window['parent'].document:window.document,context=isIframe?window['parent']:window;this.verticalScrollPosition=(doc.all?doc.scrollTop:context.pageYOffset);$interface.addClass('fullscreen');$(embedPlayer).trigger('onOpenFullScreen');if(mw.getConfig('EmbedPlayer.ExternalFullScreenControl')){return;}var callFullScreenAPI=function(){if(!(screenfull&&screenfull.enabled(doc))){return;};var fsTarget=_this.getFsTarget();var escapeFullscreen=function(event){var doc=(mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IsFriendlyIframe'))?window['parent'].document:window.document;if(!screenfull.isFullscreen(doc)){_this.restoreWindowPlayer();}}
_this.orginalParnetViewPortContent=$(doc).find('meta[name="viewport"]').attr('content');doc.removeEventListener(screenfull.raw.fullscreenchange,escapeFullscreen);doc.addEventListener(screenfull.raw.fullscreenchange,escapeFullscreen);screenfull.request(fsTarget,doc);};if(!this.fullScreenApiExcludes()&&screenfull&&screenfull.enabled(doc)&&!mw.isOldAndroidChromeNativeBrowser()){callFullScreenAPI();}else{if(!this.fullScreenApiExcludes()&&mw.isAndroidChromeNativeBrowser()){callFullScreenAPI();}if(mw.getConfig('EmbedPlayer.EnableIpadNativeFullscreen')&&vid&&vid.webkitSupportsFullscreen){this.doHybridNativeFullscreen();return;}else{this.doContextTargetFullscreen();}}$(window).keyup(function(event){if(event.keyCode==27){_this.restoreWindowPlayer();}});$(document).bind('touchmove'+this.bindPostfix,function(e){e.preventDefault();});},doContextTargetFullscreen:function(){var isIframe=mw.getConfig('EmbedPlayer.IsIframeServer');var _this=this,doc=isIframe?window['parent'].document:window.document,$doc=$(doc),$target=$(this.getFsTarget()),context=isIframe?window['parent']:window;this.parentsAbsoluteList=[];this.parentsRelativeList=[];this.parentsFixedList=[];this.orginalParnetViewPortContent=$doc.find('meta[name="viewport"]').attr('content');this.orginalTargetElementLayout={'style':$target[0].style.cssText,'width':$target.width(),'height':$target.height()};mw.log("PlayerControls:: doParentIframeFullscreen> verticalScrollPosition:"+this.verticalScrollPosition);this.doNativeScroll(context,0,0);if(!$doc.find('meta[name="viewport"]').length){$doc.find('head').append($('<meta />').attr('name','viewport'));}$doc.find('meta[name="viewport"]').attr('content','width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1');var playerCssPosition=(mw.isIOS())?'absolute':'fixed';$target.parents().each(function(){var $parent=$(this);if($parent.css('position')=='absolute'){_this.parentsAbsoluteList.push($parent);$parent.css('position','static');}if($parent.css('position')=='relative'){_this.parentsRelativeList.push($parent);$parent.css('position','static');}if($parent.css('position')=='fixed'){_this.parentsFixedList.push($parent);$parent.css('position','static');}});$target.css({'z-index':mw.getConfig('EmbedPlayer.FullScreenZIndex'),'position':playerCssPosition,'top':'0px','left':'0px','margin':0}).data('isFullscreen',true).after($('<div>').addClass('player-placeholder').css({'width':this.orginalTargetElementLayout.width,'height':this.orginalTargetElementLayout.height}));var updateTargetSize=function(){_this.doNativeScroll(context,0,0);var innerWidth=context.innerWidth||context.document.documentElement.clientWidth||context.document.body.clientWidth;var innerHeight=context.innerHeight||context.document.documentElement.clientHeight||context.document.body.clientHeight;if(mw.isMobileChrome()){innerHeight+=1;}if((mw.isAndroid41()||mw.isAndroid42()||(mw.isAndroid()&&mw.isFirefox()))&&!mw.isMobileChrome()&&context.devicePixelRatio){innerHeight=context.outerHeight/context.devicePixelRatio;}$target.css({'width':innerWidth,'height':innerHeight});if(mw.isAndroid()&&!mw.isMobileChrome()){$target.trigger('resize');}_this.embedPlayer.applyIntrinsicAspect();};var updateSizeByDevice=function(){if(mw.isAndroid()){setTimeout(updateTargetSize,10);}else if(mw.isIOSAbove7()){setTimeout(updateTargetSize,500);}else{updateTargetSize();}};updateSizeByDevice();var eventName=mw.isAndroid()?'resize':'orientationchange';eventName+=this.bindPostfix;$(context).bind(eventName,function(){if(_this.isInFullScreen()){updateSizeByDevice();}});document.ontouchmove=function(e){if(_this.isInFullScreen()){e.preventDefault();}};},restoreContextPlayer:function(){var isIframe=mw.getConfig('EmbedPlayer.IsIframeServer');var _this=this;var doc=window.document;if(isIframe){try{doc=window['parent'].document;}catch(e){mw.log("FullScreenManager:: Security error when accessing window parent document: "+e.message);}}var $doc=$(doc);var $target=$(this.getFsTarget());var context=isIframe?window['parent']:window;mw.log("FullScreenManager:: restoreContextPlayer> verticalScrollPosition:"+this.verticalScrollPosition);if(this.orginalParnetViewPortContent){$doc.find('meta[name="viewport"]').attr('content',this.orginalParnetViewPortContent);}else{$doc.find('meta[name="viewport"]').attr('content','initial-scale=1, maximum-scale=8, minimum-scale=1, user-scalable=yes');if(mw.isMobileChrome()){$doc.find('meta[name="viewport"]').attr('content','user-scalable=yes');}}if(this.orginalTargetElementLayout){$target[0].style.cssText=this.orginalTargetElementLayout.style;$target.attr({'width':this.orginalTargetElementLayout.width,'height':this.orginalTargetElementLayout.height}).trigger('resize');_this.embedPlayer.applyIntrinsicAspect();$target.siblings('.player-placeholder').remove();}$.each(_this.parentsAbsoluteList,function(inx,$elm){$elm.css('position','absolute');});$.each(_this.parentsRelativeList,function(inx,$elm){$elm.css('position','relative');});$.each(_this.parentsFixedList,function(inx,$elm){$elm.css('position','fixed');});setTimeout(function(){_this.doNativeScroll(context,0,_this.verticalScrollPosition);},100)},doNativeScroll:function(context,top,left){if(context){$.each(['scroll','scrollTo'],function(i,funcName){try{if($.isFunction(context[funcName])){context[funcName](top,left);return false;}}catch(e){mw.log("FullScreenManager:: Security error when accessing context: "+e.message);}});}},doHybridNativeFullscreen:function(){var vid=this.embedPlayer.getPlayerElement();var _this=this;vid.webkitEnterFullscreen();this.fsIntervalID=setInterval(function(){var currentFS=vid.webkitDisplayingFullscreen;if(_this.isInFullScreen()&&!currentFS){_this.inFullScreen=false;$(_this.embedPlayer).trigger('onCloseFullScreen');_this.embedPlayer.getInterface().removeClass('fullscreen');clearInterval(_this.fsIntervalID);}},250);},doDomFullscreen:function(){var _this=this;var embedPlayer=this.embedPlayer;var $interface=embedPlayer.getInterface();$('.mw-fullscreen-overlay').remove();$interface.after($('<div />').addClass('mw-fullscreen-overlay').css('z-index',mw.getConfig('EmbedPlayer.FullScreenZIndex')).hide().fadeIn("slow"));if(!this.windowPositionStyle){this.windowPositionStyle=$interface.css('position');}if(!this.windowZindex){this.windowZindex=$interface.css('z-index');}this.windowOffset=this.getWindowOffset();$interface.css({'position':'fixed','z-index':mw.getConfig('EmbedPlayer.FullScreenZIndex')+1,'top':this.windowOffset.top,'left':this.windowOffset.left});if(embedPlayer.isPersistentNativePlayer()){$(embedPlayer.getPlayerElement()).css({'z-index':mw.getConfig('EmbedPlayer.FullScreenZIndex')+1,'position':'absolute'});}_this.parentsAbsolute=[];$('body').css('overflow','hidden');var topOffset='0px';var leftOffset='0px';if($interface.offsetParent()[0].tagName&&$interface.offsetParent()[0].tagName.toLowerCase()!='body'){topOffset=-this.windowOffset.top+'px';leftOffset=-this.windowOffset.left+'px';}$interface.css('overlow','hidden');$interface.parents().each(function(){if($(this).css('position')=='absolute'){_this.parentsAbsolute.push($(this));$(this).css('position',null);mw.log('PlayerLayoutBuilder::  should update position: '+$(this).css('position'));}});$(window).keyup(function(event){if(event.keyCode==27){_this.restoreWindowPlayer();}});},getWindowOffset:function(){var windowOffset=this.embedPlayer.getInterface().offset();windowOffset.top=windowOffset.top-$(document).scrollTop();windowOffset.left=windowOffset.left-$(document).scrollLeft();this.windowOffset=windowOffset;return this.windowOffset;},getFsTarget:function(){if((mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IsFriendlyIframe'))||mw.isOldAndroidChromeNativeBrowser()){var targetId;if(screenfull&&screenfull.enabled()){targetId=this.embedPlayer.id+'_ifp';}else{targetId=this.embedPlayer.id;}return window['parent'].document.getElementById(targetId);}else{var $interface=this.embedPlayer.getInterface();return $interface[0];}},getDocTarget:function(){if(mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IsFriendlyIframe')){return window['parent'].document;}else{return document;}},restoreWindowPlayer:function(){var _this=this;mw.log("FullScreenManager :: restoreWindowPlayer");var embedPlayer=this.embedPlayer;if(this.isInFullScreen()===false){return;}this.inFullScreen=false;embedPlayer.getInterface().removeClass('fullscreen');$(embedPlayer).trigger('onCloseFullScreen');if(mw.getConfig('EmbedPlayer.ExternalFullScreenControl')){return;}var docTarget=this.getDocTarget();if(!this.fullScreenApiExcludes()&&screenfull&&screenfull.enabled(docTarget)){screenfull.exit(docTarget);}this.restoreContextPlayer();$(document).unbind(this.bindPostfix);},fullScreenApiExcludes:function(){if(mw.isSilk()){return true;}return false;}};})(window.mw,window.jQuery);(function(mw,$){"use strict";mw.PlayerLayoutBuilder=function(embedPlayer,options){return this.init(embedPlayer,options);};mw.PlayerLayoutBuilder.prototype={height:mw.getConfig('EmbedPlayer.ControlsHeight'),supportedComponents:{},addWarningFlag:false,displayOptionsMenuFlag:false,controlsDisabled:false,bindPostfix:'.layoutBuilder',layoutReady:false,keepControlsOnScreen:false,playingFlag:false,importanceSet:['low','medium','high'],init:function(embedPlayer){var _this=this;this.embedPlayer=embedPlayer;this.fullScreenManager=new mw.FullScreenManager(embedPlayer);var animationSupported=this.checkAnimationSupport();mw.setConfig('EmbedPlayer.AnimationSupported',animationSupported);this.addUserAgentCssClass();$(document.body).append($('<div style="display: block" class="cssChecker"></div>'));return this;},getInterface:function(){if(!this.$interface){var embedPlayer=this.embedPlayer,$embedPlayer=$(embedPlayer);if($embedPlayer.parent('.videoDisplay').length==0){$embedPlayer.wrap($('<div />').addClass('videoDisplay'));}var $videoDisplay=$embedPlayer.parent('.videoDisplay');if($videoDisplay.find('.videoShadow').length==0){$(".mwEmbedPlayer").before('<div class="videoShadow"></div>');}if($videoDisplay.parent('.videoHolder').length==0){$videoDisplay.parent('.videoDisplay').wrap($('<div />').addClass('videoHolder'));}var $videoHolder=$videoDisplay.parent('.videoHolder');if($videoHolder.parent('.mwPlayerContainer').length==0){this.$interface=$videoHolder.wrap($('<div />').addClass('mwPlayerContainer')).parent()
if(embedPlayer.style.cssText){this.$interface[0].style.cssText+=embedPlayer.style.cssText;}}else{this.$interface=$videoHolder.parent('.mwPlayerContainer')}if(mw.isMobileDevice()){this.$interface.addClass('mobile');}if(this.embedPlayer.isMobileSkin()){this.$interface.addClass('mobileSkin');}if(mw.isTouchDevice()){this.$interface.addClass('touch');}if(mw.isNativeApp()){this.$interface.addClass('nativeApp');}if(mw.isIE8()){this.$interface.addClass('ie8');}var skinName=embedPlayer.playerConfig.layout.skin;if(embedPlayer.getRawKalturaConfig("layout")&&embedPlayer.getRawKalturaConfig("layout").skin){skinName=embedPlayer.getRawKalturaConfig("layout").skin;}this.$interface.addClass(skinName);embedPlayer.style.cssText='';}return this.$interface;},isInFullScreen:function(){return this.fullScreenManager.isInFullScreen();},getHeight:function(){return this.embedPlayer.isMobileSkin()?mw.getConfig('EmbedPlayer.MobileControlsHeight'):this.height;},clearInterface:function(){this.getInterface().find('.overlay-win').remove();},addUserAgentCssClass:function(){if(mw.isTouchDevice())this.getInterface().addClass('ua-touch');if(mw.hasMouseEvents())this.getInterface().addClass('ua-mouse');if(mw.isIOS())this.getInterface().addClass('ua-ios');if(mw.isAndroid())this.getInterface().addClass('ua-android');if(mw.isMacintosh())this.getInterface().addClass('ua-osx');if(mw.isWindows())this.getInterface().addClass('ua-win');if(mw.isChrome())this.getInterface().addClass('ua-chrome');if(mw.isFirefox())this.getInterface().addClass('ua-firefox');if(mw.isIE())this.getInterface().addClass('ua-ie');if(mw.isSafari())this.getInterface().addClass('ua-safari');if(mw.isEdge())this.getInterface().addClass('ua-edge');if(mw.isChromeCast())this.getInterface().addClass('ua-chromecast');},addControls:function(){if(this.layoutReady)return;var embedPlayer=this.embedPlayer;var _this=this;this.clearInterface();_this.displayOptionsMenuFlag=false;if(mw.hasMouseEvents()){this.initToolTips();}if(mw.isIE8()||mw.isIE9()){this.embedPlayer.bindHelper('layoutBuildDone',function(){$('.PIE').each(function(){PIE.attach(this);});});}this.addContainers();this.mapComponents();if(this.layoutCssLoaded()){this.drawLayoutAndBind();}else{var _this=this;var counter=0;var cssCheckInterval=setInterval(function(){if(_this.layoutCssLoaded()){clearInterval(cssCheckInterval);_this.drawLayoutAndBind();}else{counter++;if(counter==40){clearInterval(cssCheckInterval);_this.drawLayoutAndBind();mw.log("failed to load layout.css");}}},25);}},layoutCssLoaded:function(){return($(".cssChecker").css("display")=="none");},drawLayoutAndBind:function(){this.drawLayout();this.addControlBindings();$(".cssChecker").remove();},layoutContainers:{'topBarContainer':[],'sideBarContainer':[],'videoHolder':[],'smartContainer':[],'controlBarContainer':[],'controlsContainer':[]},addContainers:function(){this.embedPlayer.triggerHelper('addLayoutContainer');},mapComponents:function(){var _this=this;this.embedPlayer.triggerHelper('addLayoutComponent',this);$.each(this.components,function(compId,compConfig){if(!compConfig.parent)return true;if(_this.layoutContainers[compConfig.parent]){_this.layoutContainers[compConfig.parent].push({'id':compId,'order':compConfig.order,'insertMode':(compConfig.insertMode)?compConfig.insertMode:'lastChild'});}});$.each(this.layoutContainers,function(idx,components){_this.layoutContainers[idx].sort(function(comp1,comp2){return((comp1.order<comp2.order)?-1:((comp1.order>comp2.order)?1:0));});});},drawLayout:function(){mw.log('PlayerLayoutBuilder:: drawLayout',this.layoutContainers);var _this=this;var $interface=this.getInterface();$.each(_this.layoutContainers,function(containerId,components){var $parent=$interface.find('.'+containerId);if($parent.length){_this.drawComponents($parent,components);}else{mw.log('PlayerLayoutBuilder:: drawLayout:: container "'+containerId+'" not found in DOM');}});var $buttons=$interface.find('.controlsContainer').find('.btn');var tabIndex=0;var rightBtnIndex=0;$buttons.each(function(i){if($(this).hasClass('pull-right')||$(this).parent().hasClass('pull-right')){rightBtnIndex++;$(this).attr('tabindex',($buttons.length-rightBtnIndex));}else{tabIndex++;$(this).attr('tabindex',tabIndex);}});this.layoutReady=true;this.embedPlayer.triggerHelper('layoutBuildDone');try{window.parent.postMessage('layoutBuildDone','*');}catch(e){}},drawComponents:function($parent,components){var _this=this;$.each(components,function(idx,component){var $component=_this.getDomComponent(component.id);if($component===false){mw.log('PlayerLayoutBuilder:: drawComponents: component "'+component.id+'" was not defined');}else{if(component.insertMode=='firstChild'){$parent.prepend($component);}else{$parent.append($component);}}});},updateComponentsVisibility:function(){var _this=this;$(this.embedPlayer).trigger('updateComponentsVisibilityStart')
$.each(this.layoutContainers,function(containerId,components){if(containerId=='videoHolder'||containerId=='controlBarContainer'||containerId=='smartContainer'){return true;}_this.updateContainerCompsByAvailableSpace(_this.getInterface().find('.'+containerId));});$(this.embedPlayer).trigger('updateComponentsVisibilityDone')},updateContainerCompsByAvailableSpace:function($container){if(!$container.length)return;var _this=this;var containerWidth=$container.width();var hideOneByImportance=function(){for(var i=0;i<_this.importanceSet.length;i++){var $s=$container.find('.display-'+_this.importanceSet[i]+':visible');if($s.length){var $first=$s.first();$first.hide();return _this.getComponentWidth($first);}}};var showOneByImportance=function(){var reversedImportanceSet=_this.importanceSet.slice(0).reverse();for(var i=0;i<reversedImportanceSet.length;i++){var $comp=getNextComponentToShow(reversedImportanceSet[i]);if($comp){$comp.show();return _this.getComponentWidth($comp);}}};var getNextComponentToShow=function(importanceLevel){var $s=$container.children('.display-'+importanceLevel+':hidden');while($s.length){var $first=$s.first();if($first.data('forceHide')){$s=$s.slice(1);}else{return $s.first();}}};var getNextShowWidth=function(){var nextWidth=0;var reversedImportanceSet=_this.importanceSet.slice(0).reverse();for(var i=0;i<reversedImportanceSet.length;i++){var $comp=getNextComponentToShow(reversedImportanceSet[i]);if($comp){$comp.show();nextWidth=_this.getComponentWidth($comp);if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){$comp.hide();}break;}}return nextWidth;};var i=0;var componentsWidthForContainer=this.getComponentsWidthForContainer($container);if(containerWidth<componentsWidthForContainer&&this.canHideShowContainerComponents($container,true)){while(i++<30&&containerWidth<componentsWidthForContainer&&this.canHideShowContainerComponents($container,true)){mw.log("hideOneByImportance: "+containerWidth+' < '+componentsWidthForContainer);var lengthHided=hideOneByImportance();if(!lengthHided){break;}componentsWidthForContainer=componentsWidthForContainer-lengthHided;}return;}while(i++<30&&$container.find('.comp:hidden').length&&this.canHideShowContainerComponents($container,false)&&containerWidth>(componentsWidthForContainer+getNextShowWidth())){mw.log("showOneByImportance: "+containerWidth+' > '+componentsWidthForContainer);var lengthShowed=showOneByImportance();if(!lengthShowed){break;}componentsWidthForContainer=componentsWidthForContainer+lengthShowed;}},canHideShowContainerComponents:function($container,visible){var state=(visible)?'visible':'hidden';var found=false;for(var i=0;i<this.importanceSet.length;i++){var $s=$container.find('.display-'+this.importanceSet[i]+':'+state);if($s.length){found=true;break;}}return found;},getComponentWidth:function($comp){return $comp.data('width')||$comp.outerWidth(true);},getComponentsWidthForContainer:function($container){var _this=this;var totalWidth=this.embedPlayer.isMobileSkin()?2:10;$container.find('.comp:visible').each(function(){totalWidth+=_this.getComponentWidth($(this));});return totalWidth;},getComponentsHeight:function(){var height=0;this.getInterface().find('.block').each(function(){height+=$(this).outerHeight(true);});return height;},getContainerHeight:function(){var height=0;if(mw.isIE11()){height=this.getInterface()[0].clientHeight;}else{height=this.getInterface().height();}return height;},initToolTips:function(){var _this=this;this.embedPlayer.bindHelper('layoutBuildDone mediaListLayoutReady',function(){_this.setupTooltip()
_this.setupTooltip(_this.getInterface().find(".tooltipBelow"),"arrowTop");});this.embedPlayer.bindHelper('hidePlayerControls clearTooltip',function(){_this.getInterface().siblings(".ui-tooltip").remove();});},setupTooltip:function(elm,arrowDirection){if(!this.embedPlayer.enableTooltips||kWidget.isIE8()){return;}var tooltips=elm?elm:this.getInterface();if(tooltips&&tooltips.length>0){var arrowType=arrowDirection?arrowDirection:"arrow";var myPosition=tooltips.offset().top>0?"center bottom+55":"center bottom-10";tooltips.tooltip({items:'[data-show-tooltip]',"show":{"delay":1000},"hide":{"duration":0},"content":function(){return $(this).attr('title');},position:{my:myPosition,at:"center top",using:function(position,feedback){$(this).css(position);$("<div>").addClass(arrowType).addClass(feedback.vertical).addClass(feedback.horizontal).appendTo(this);}}});}},getOverlayWidth:function(){return(this.embedPlayer.getPlayerWidth()<300)?300:this.embedPlayer.getPlayerWidth();},getOverlayHeight:function(){return(this.embedPlayer.getPlayerHeight()<200)?200:this.embedPlayer.getPlayerHeight();},addControlBindings:function(){var _this=this;var embedPlayer=this.embedPlayer;var $interface=this.getInterface();var adPlaybackState='adplay-state';var b=function(eventName,callback){embedPlayer.bindHelper(eventName+_this.bindPostfix,callback);};var addPlaybackBindings=function(){if(embedPlayer.getFlashvars('disableOnScreenClick')){return;}if(mw.isTouchDevice()){if(!(mw.isAndroid()&&mw.isMobileChrome())){_this.addPlayerTouchBindings();}}if(!(mw.isNativeApp()&&(mw.isAndroid43()||mw.isAndroid41()||mw.isAndroid42()))){_this.addPlayerClickBindings();}};var removePlaybackBindings=function(){if(embedPlayer.getFlashvars('disableOnScreenClick')){return;}if(mw.isTouchDevice()){_this.removePlayerTouchBindings();}_this.removePlayerClickBindings();};_this.onControlBar=false;embedPlayer.unbindHelper(this.bindPostfix);var bindFirstPlay=false;_this.addRightClickBinding();_this.updateComponentsVisibility();_this.updatePlayerSizeClass();b('updateLayout',function(){_this.updateComponentsVisibility();_this.updatePlayerSizeClass();});b('onplay',function(){_this.addRightClickBinding();});b('AdSupport_StartAdPlayback',function(){$interface.addClass(adPlaybackState);});b('AdSupport_EndAdPlayback',function(){$interface.removeClass(adPlaybackState);});b('seeking',function(){$interface.addClass("seeking-state");});b('seeked',function(){$interface.removeClass("seeking-state");});b('onEnableInterfaceComponents',function(){_this.controlsDisabled=false;addPlaybackBindings();});b('onDisableInterfaceComponents',function(){_this.controlsDisabled=true;removePlaybackBindings();});b('onOpenFullScreen',function(){setTimeout(function(){embedPlayer.doUpdateLayout();},100)});b('onCloseFullScreen',function(){setTimeout(function(){embedPlayer.doUpdateLayout();},100)});if((embedPlayer.adSiblingFlashPlayer||embedPlayer.instanceOf=='Kplayer')&&(mw.isIE8()||mw.isIE9())){embedPlayer.getVideoHolder().bind('mouseup',function(){if(embedPlayer.sequenceProxy&&embedPlayer.sequenceProxy.isInSequence){$(embedPlayer).trigger('click');}});}addPlaybackBindings();this.addControlsVisibilityBindings();if(embedPlayer.isOverlayControls()&&mw.hasMouseEvents()){this.addMouseMoveBinding(this.getInterface());this.addMouseMoveHandler();}mw.log('trigger::addControlBindingsEvent');embedPlayer.triggerHelper('addControlBindingsEvent');},addPlayerTouchBindings:function(){var embedPlayer=this.embedPlayer;var _this=this;this.removePlayerTouchBindings();var touchStartPos,touchEndPos=null;$(_this.embedPlayer).bind('touchstart'+this.bindPostfix,function(e){touchStartPos=e.originalEvent.touches[0].pageY;}).bind('touchend'+this.bindPostfix,function(e){e.preventDefault();e.stopPropagation();if(_this.embedPlayer.isControlsVisible||_this.embedPlayer.useNativePlayerControls()){touchEndPos=e.originalEvent.changedTouches[0].pageY;var distance=Math.abs(touchStartPos-touchEndPos);if(distance<10){mw.log('PlayerLayoutBuilder::addPlayerTouchBindings:: togglePlayback from touch event');_this.togglePlayback();}}});},removePlayerTouchBindings:function(){$(this.embedPlayer).unbind("touchstart"+this.bindPostfix);$(this.embedPlayer).unbind("touchend"+this.bindPostfix);},outPlayerClass:'player-out',hideControlsTimeout:null,showPlayerControls:function(){clearTimeout(this.hideControlsTimeout);this.getInterface().removeClass(this.outPlayerClass);this.removeTouchOverlay();if(this.$interface.find(".mwEmbedPlayer").hasClass("noCursor")){this.$interface.find(".mwEmbedPlayer").removeClass("noCursor");}this.embedPlayer.triggerHelper('showPlayerControls');},hidePlayerControls:function(){if(!this.embedPlayer.paused||this.embedPlayer.isInSequence()){this.getInterface().addClass(this.outPlayerClass);this.addTouchOverlay();if(this.isInFullScreen()){this.$interface.find(".mwEmbedPlayer").addClass("noCursor");}this.embedPlayer.triggerHelper('hidePlayerControls');}},addControlsVisibilityBindings:function(){var embedPlayer=this.embedPlayer;var _this=this;var $interface=this.getInterface();if(_this.checkNativeWarning()){_this.addWarningBinding('EmbedPlayer.ShowNativeWarning',gM('mwe-embedplayer-for_best_experience',$('<a />').attr({'href':'http://www.mediawiki.org/wiki/Extension:TimedMediaHandler/Client_download','target':'_new'})));}if(mw.hasMouseEvents()){var hoverIntentConfig={'sensitivity':100,'timeout':mw.getConfig('EmbedPlayer.HoverOutTimeout'),'over':function(){_this.showPlayerControls();},'out':function(){_this.hidePlayerControls();}};$interface.hoverIntent(hoverIntentConfig);}$(embedPlayer).bind('touchstart',function(){_this.showPlayerControls();_this.hideControlsTimeout=setTimeout(function(){_this.hidePlayerControls();},5000);return true;});},addMouseMoveBinding:function(elem){if(elem){var _this=this;_this.mouseMovedFlag=false;var oldX=0,oldY=0;$(elem).mousemove(function(event){if(Math.abs(oldX-event.pageX)>4||Math.abs(oldY-event.pageY)>4){_this.mouseMovedFlag=true;}oldX=event.pageX;oldY=event.pageY;}).mouseout(function(event){_this.mouseMovedFlag=false;});}else{mw.log("addMouseMoveBinding: no element supplied");}},addMouseMoveHandler:function(){var _this=this;var checkMovedMouse=function(){if(_this.mouseMovedFlag){_this.mouseMovedFlag=false;_this.showPlayerControls();_this.checkMovedMouseTimeout=setTimeout(checkMovedMouse,mw.getConfig('EmbedPlayer.MouseMoveTimeout'));}else{_this.hidePlayerControls();_this.checkMovedMouseTimeout=setTimeout(checkMovedMouse,250);}};checkMovedMouse();},removeMouseMoveHandler:function(){clearTimeout(this.checkMovedMouseTimeout);this.checkMovedMouseTimeout=null;},addTouchOverlay:function(){if(mw.isTouchDevice()&&!this.keepControlsOnScreen&&this.embedPlayer.getKalturaConfig("controlBarContainer","hover")){var _this=this;if(this.getInterface().find('#touchOverlay').length==0){var touchOverlay=this.getInterface().find('.controlBarContainer').before($('<div />').css({'position':'absolute','top':0,'width':'100%','height':'100%','z-index':1}).attr('id',"touchOverlay").bind('touchstart click',function(event){if(event.stopPropagation){event.stopPropagation();if(event.stopImmediatePropagation){event.stopImmediatePropagation();}}else{event.cancelBubble=true;}event.preventDefault();_this.removeMouseMoveHandler();_this.mouseMovedFlag=true;_this.showPlayerControls();_this.addMouseMoveHandler();_this.getInterface().find('#touchOverlay').remove();}));this.addMouseMoveBinding(touchOverlay);}}},removeTouchOverlay:function(){if(mw.isTouchDevice()&&this.getInterface().find('#touchOverlay').length!=0){this.getInterface().find('#touchOverlay').remove();}},playerSizeClass:null,updatePlayerSizeClass:function(){var width=this.embedPlayer.getVideoHolder().width();var playerSizeClass='';if(width<300){playerSizeClass='tiny';}else if(width<450){playerSizeClass='small';}else if(width<700){playerSizeClass='medium';}else{playerSizeClass='large';}if(this.playerSizeClass!==playerSizeClass){this.playerSizeClass=playerSizeClass;this.getInterface().removeClass('size-tiny size-small size-medium size-large').addClass('size-'+this.playerSizeClass);this.embedPlayer.triggerHelper('playerSizeClassUpdate',[this.playerSizeClass]);}},removePlayerClickBindings:function(){$(this.embedPlayer).unbind("click"+this.bindPostfix).unbind("dblclick"+this.bindPostfix);},addPlayerClickBindings:function(){var _this=this;var embedPlayer=this.embedPlayer;this.removePlayerClickBindings();var didDblClick=false;var dblClickTimeout=null;$(embedPlayer).bind("dblclick"+_this.bindPostfix,function(){didDblClick=true;});$(embedPlayer).bind("goingtoplay",function(){_this.playingFlag=true;setTimeout(function(){_this.playingFlag=false;},1000);});$(embedPlayer).bind("click"+_this.bindPostfix,function(){if(mw.isMobileDevice()){if(!_this.playingFlag){_this.togglePlayback();}}else{var playerStatus=embedPlayer.isPlaying();if(dblClickTimeout)return true;dblClickTimeout=setTimeout(function(){if(didDblClick){didDblClick=false;}else{mw.log('PlayerLayoutBuilder::addPlayerClickBindings:: togglePlayback from click event');if(embedPlayer.isPlaying()==playerStatus){if(!_this.playingFlag){_this.togglePlayback();}}}clearTimeout(dblClickTimeout);dblClickTimeout=null;},300);}return true;});},addRightClickBinding:function(){var embedPlayer=this.embedPlayer;if(mw.getConfig('EmbedPlayer.EnableRightClick')===false){document.oncontextmenu=function(e){return false;};$(embedPlayer).mousedown(function(e){if(e.button==2){return false;}});}},isControlsDisabled:function(){return this.controlsDisabled;},togglePlayback:function(){if(this.isControlsDisabled()){return;}this.embedPlayer.togglePlayback();},checkNativeWarning:function(){if(mw.getConfig('EmbedPlayer.ShowNativeWarning')===false){return false;}if(this.embedPlayer.instanceOf=='ImageOverlay'){return false;}if(this.embedPlayer.getPlayerHeight()<199){return false;}var supportingPlayers=mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/ogg');for(var i=0;i<supportingPlayers.length;i++){if(supportingPlayers[i].id=='oggNative'){return false;}}if(/chrome/.test(navigator.userAgent.toLowerCase())&&mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/webm').length){return false;}if((mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/mp4').length&&this.embedPlayer.mediaElement.getSources('video/mp4').length)||(mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('video/x-flv').length&&this.embedPlayer.mediaElement.getSources('video/x-flv').length)||(mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('application/vnd.apple.mpegurl').length&&this.embedPlayer.mediaElement.getSources('application/vnd.apple.mpegurl').length)||(mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('audio/mpeg').length&&this.embedPlayer.mediaElement.getSources('audio/mpeg').length)){return false;}return true;},addWarningBinding:function(preferenceId,warningMsg,hideDisableUi){mw.log('mw.PlayerLayoutBuilder: addWarningBinding: '+preferenceId+' wm: '+warningMsg);var embedPlayer=this.embedPlayer;var _this=this;if(embedPlayer.getWidth()<200){return false;}if(mw.getConfig(preferenceId)===true&&$.cookie(preferenceId)=='hidewarning'){return;}var warnId="warningOverlay_"+embedPlayer.id;$('#'+warnId).remove();var $targetWarning=$('<div />').attr({'id':warnId}).addClass('ui-state-highlight ui-corner-all').css({'position':'absolute','background':'#333','color':'#AAA','top':'10px','left':'10px','right':'10px','padding':'4px','z-index':2}).html(warningMsg);embedPlayer.getInterface().append($targetWarning);$targetWarning.append($('<br />'));if(!hideDisableUi){$targetWarning.append($('<input type="checkbox" />').attr({'id':'ffwarn_'+embedPlayer.id,'name':'ffwarn_'+embedPlayer.id}).click(function(){mw.log("WarningBindinng:: set "+preferenceId+' to hidewarning ');embedPlayer.setCookie(preferenceId,'hidewarning',{expires:30})
mw.setConfig(preferenceId,false);$('#warningOverlay_'+embedPlayer.id).fadeOut('slow');_this.addWarningFlag=false;}));$targetWarning.append($('<label />').text(gM('mwe-embedplayer-do_not_warn_again')).attr('for','ffwarn_'+embedPlayer.id));}return $targetWarning;},onSeek:function(){this.embedPlayer.addPlayerSpinner();this.embedPlayer.hideSpinnerOncePlaying();},setStatus:function(value){if(this.embedPlayer.getInterface()){}},closeMenuOverlay:function(){var _this=this;var embedPlayer=this.embedPlayer;var $overlay=embedPlayer.getInterface().find('.overlay-win,.overlay,.ui-widget-shadow');if($overlay.length&&!embedPlayer._playContorls&&!$overlay.find('.overlayCloseButton').length){embedPlayer.enablePlayControls();}this.displayOptionsMenuFlag=false;$overlay.fadeOut("slow",function(){$overlay.remove();});$overlay.remove();$(embedPlayer).trigger('closeMenuOverlay');return false;},displayMenuOverlay:function(overlayContent,closeCallback,hideCloseButton){var _this=this;var embedPlayer=this.embedPlayer;mw.log('PlayerLayoutBuilder:: displayMenuOverlay');this.displayOptionsMenuFlag=true;if(!this.supportedComponents['overlays']){embedPlayer.pause();}if(embedPlayer.getInterface().find('.overlay-win').length!=0){embedPlayer.getInterface().find('.overlay-content').html(overlayContent);return;}var $overlayContainer=embedPlayer.getInterface();if(hideCloseButton){$overlayContainer=embedPlayer.getVideoHolder();embedPlayer.disablePlayControls(['playlistPrevNext']);embedPlayer.getInterface().find('.play-btn').unbind('click').click(function(){if(embedPlayer._playContorls){embedPlayer.play();}})}$overlayContainer.append($('<div />').addClass('overlay').css({'height':'100%','width':'100%','z-index':mw.isMobileDevice()?1000:4}));var $closeButton=[];if(!hideCloseButton){$closeButton=$('<button></button>').addClass('btn icon-close closePluginsScreen').click(function(){_this.closeMenuOverlay();if(closeCallback){closeCallback();}});}var margin=$(".topBarContainer").length===0?'0 10px 10px 0':'22px 10px 10px 0';var overlayMenuCss={'height':'100%','width':'100%','position':'absolute','margin':margin,'overflow':'hidden','z-index':5};var $overlayMenu=$('<div />').addClass('overlay-win ui-state-default ui-widget-header ui-corner-all').css(overlayMenuCss).append($closeButton,$('<div />').addClass('overlay-content').append(overlayContent));$overlayContainer.find(".overlay").append($overlayMenu).find('.overlay-win').fadeIn("slow");$(embedPlayer).trigger('displayMenuOverlay');return false;},closeAlert:function(keepOverlay){var embedPlayer=this.embedPlayer;var $alert=embedPlayer.getInterface().find('.alert-container');mw.log('mw.PlayerLayoutBuilder::closeAlert');if(!keepOverlay||(mw.isIpad()&&this.inFullScreen)){this.closeMenuOverlay();}$alert.remove();return false;},displayAlert:function(alertObj){var _this=this;var embedPlayer=this.embedPlayer;var callback;mw.log('PlayerLayoutBuilder::displayAlert:: '+alertObj.title);if(embedPlayer.getInterface().find('.overlay-win').length!=0){return;}try{embedPlayer.getInterface().parent().find('#error').remove();}catch(e){}if(typeof alertObj.callbackFunction=='string'){if(alertObj.isExternal){try{callback=window.parent[alertObj.callbackFunction];}catch(e){}}else{callback=window[alertObj.callbackFunction];}}else if(typeof alertObj.callbackFunction=='function'){callback=alertObj.callbackFunction;}else{callback=function(){};}var $container=$('<div />').addClass('alert-container');var $title=$('<div />').text(alertObj.title).addClass('alert-title alert-text');var $buttonsContainer=$('<div />').addClass('alert-buttons-container');var $message=$('<div />').html(alertObj.message).addClass('alert-message alert-text');if(alertObj.isError){$message.addClass('error');}if(alertObj.props){if(alertObj.props.customAlertContainerCssClass){$container.removeClass('alert-container');$container.addClass(alertObj.props.customAlertContainerCssClass);}if(alertObj.props.customAlertTitleCssClass){$title.removeClass('alert-text alert-title');$title.addClass(alertObj.props.customAlertTitleCssClass);}if(alertObj.props.titleTextColor){$title.removeClass('alert-text');$title.css('color',mw.getHexColor(alertObj.props.titleTextColor));}if(alertObj.props.customAlertMessageCssClass){$message.removeClass('alert-text alert-message');$message.addClass(alertObj.props.customAlertMessageCssClass);}if(alertObj.props.textColor){$message.removeClass('alert-text');$message.css('color',mw.getHexColor(alertObj.props.textColor));}if(alertObj.props.buttonRowSpacing){$buttonsContainer.css('margin-top',alertObj.props.buttonRowSpacing);}}var $buttonSet=alertObj.buttons||[];var buttonsNum=$buttonSet.length;if(buttonsNum==0&&!alertObj.noButtons){$buttonSet=["OK"];buttonsNum++;}if(buttonsNum>0){$container.addClass('alert-container-with-buttons');}$.each($buttonSet,function(i){var label=this.toString();var $currentButton=$('<button />').addClass('alert-button').text(label).width(Math.floor(100/buttonsNum)+"%").click(function(eventObject){callback(eventObject);_this.closeAlert(alertObj.keepOverlay);});if(alertObj.props){if(alertObj.props.buttonHeight){$currentButton.css('height',alertObj.props.buttonHeight);}if(buttonsNum>1){if(i<buttonsNum-1){if(alertObj.props.buttonSpacing){$currentButton.css('margin-right',alertObj.props.buttonSpacing);}}}}$buttonsContainer.append($currentButton);});$container.append($title,$message,$buttonsContainer);return this.displayMenuOverlay($container,false,true);},getDomComponent:function(componentId){if(this.components[componentId]){return this.components[componentId].o(this);}else{return false;}},components:{},checkAnimationSupport:function(elm){elm=elm||document.body||document.documentElement;var animation=false,animationstring='animation',keyframeprefix='',domPrefixes='Webkit Moz O ms Khtml'.split(' '),pfx='';if(elm.style.animationName!==undefined){animation=true;}if(animation===false){for(var i=0;i<domPrefixes.length;i++){if(elm.style[domPrefixes[i]+'AnimationName']!==undefined){pfx=domPrefixes[i];animationstring=pfx+'Animation';keyframeprefix='-'+pfx.toLowerCase()+'-';animation=true;break;}}}return animation;}};})(window.mediaWiki,window.jQuery);;},{"all":".mwPlayerContainer video{width:100%;height:100%}.mwPlayerContainer.fullscreen{position:absolute !important;width:100% !important;height:100%! important;z-index:9999;min-height:100%;top:0;left:0;margin:0}.mwPlayerContainer{position:relative;width:100%;height:100%;overflow:hidden}.videoHolder{position:relative;overflow:hidden;width:100%;height:100%;background:#000}.videoDisplay{position:absolute;top:0;left:0;width:100%;height:100%}.maximize{width:100%;height:100%}.mwEmbedPlayer{cursor:pointer;width:100%;height:100%;overflow:hidden;position:absolute;top:0;left:0;background-color:transparent}.mobileSkin.start-state .mwEmbedPlayer img{opacity:0.6}.mwEmbedPlayerTransparent{background-color:black;-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)\"}.mwEmbedPlayerTransparentComp{background-color:rgba(0,0,0,0);-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)\"}.mwEmbedPlayerBlackBkg{background-color:rgba(0,0,0,1)}.mwEmbedPlayer object{position:absolute;top:0;left:0;width:100%;height:100% }.mwEmbedPlayer.noCursor{cursor:none}.playerPoster{position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;width:auto;height:auto;max-width:100%;max-height:100%}.mobileSkin.pluginsScreenOpened .playerPoster{opacity:0.3}.blackPlayer{position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;width:auto;height:auto;max-width:100%;max-height:100%}.playerPoster.fill-width{min-width:100%;height:auto}.playerPoster.fill-height{min-height:100%;width:auto}\n\n/* cache key: resourceloader:filter:minify-css:7:b76568f4cc258557eb5793c97bbdbf66 */\n"},{"mwe-embedplayer-play_clip":"Play clip","mwe-embedplayer-pause_clip":"Pause clip","mwe-embedplayer-next_clip":"Play next clip","mwe-embedplayer-prev_clip":"Play previous clip","mwe-embedplayer-replay":"Replay","mwe-embedplayer-speed":"Playback Speed","mwe-embedplayer-volume_control":"Volume control","mwe-embedplayer-volume-mute":"Mute","mwe-embedplayer-volume-unmute":"Unmute","mwe-embedplayer-volume-value":"Volume $1%","mwe-embedplayer-volume-increase":"Increase Volume","mwe-embedplayer-volume-decrease":"Decrease Volume","mwe-embedplayer-audio_source":"Audio","mwe-embedplayer-select_source":"Quality Settings","mwe-embedplayer-switch_source":"switch in progress","mwe-embedplayer-auto_source":"Auto","mwe-embedplayer-select_stream":"Select stream","mwe-embedplayer-select_audio":"Select audio","mwe-embedplayer-switch_stream":"switch in progress","mwe-embedplayer-timed_text":"Closed Captions","mwe-embedplayer-seek_forward":"Seek forward","mwe-embedplayer-current_time":"Current time $1","mwe-embedplayer-seek_backward":"Seek backward","mwe-embedplayer-player_fullscreen":"Full screen","mwe-embedplayer-player_closefullscreen":"Exit full screen","mwe-embedplayer-select_playlist":"Select playlist","mwe-embedplayer-empty_playlist":"No source video was found in the selected playlist","mwe-embedplayer-videos":"videos","mwe-embedplayer-pip":"Picture in Picture","mwe-embedplayer-download_clip":"Download video","mwe-embedplayer-share":"Share","mwe-embedplayer-info":"Info","mwe-share-startTimeLbl":"Start video at","mwe-share-secureEmbedLbl":"Secured embed","mwe-share-copyLbl":"Copy","mwe-share-errDuration":"Time offset cannot be longer than movie duration.","mwe-share-errFormat":"Please use the hh:mm:ss format.","mwe-embedplayer-quality_settings":"Quality settings","mwe-embedplayer-more":"More","mwe-embedplayer-player_expend":"Expand player","mwe-embedplayer-player_retract":"Shrink player","mwe-timedtext-no-subtitles":"No Subtitles","mwe-timedtext-no-audio":"No Tracks","mwe-embedplayer-for_best_experience":"For a better video playback experience we recommend a [$1 HTML5 video browser].","mwe-embedplayer-do_not_warn_again":"In the future, do not show this message","mwe-embedplayer-seeking":"seeking","mwe-embedplayer-buffering":"buffering","mwe-embedplayer-video-h264":"H.264 video","mwe-embedplayer-video-webm":"WebM video","mwe-embedplayer-video-flv":"Flash video","mwe-embedplayer-video-ogg":"Ogg video","mwe-embedplayer-video-audio":"Ogg audio","mwe-embedplayer-audio-mpeg":"MPEG audio","mwe-embedplayer-video-3gp":"3GP video","mwe-embedplayer-video-mpeg":"MPEG video","mwe-embedplayer-video-msvideo":"AVI video","mwe-embedplayer-missing-source":"No source video was found","mwe-embedplayer-wrong-reference-id":"Wrong reference id","mwe-embedplayer-video-thumbnail":"Video thumbnail","mwe-embedplayer-video-thumbnail-for":"Video thumbnail for $1","mwe-embedplayer-enable-audio-description":"Enable audio description","mwe-embedplayer-disable-audio-description":"Disable audio description","mwe-embedplayer-no-audio-description":"No audio description available","mwe-embedplayer-install-silverlight":"This video requires Microsoft Silverlight, which is currently not available on your browser. Please <a href=\"http:\/\/www.microsoft.com\/silverlight\/\" target=\"_blank\"> install Microsoft Silverlight <\/a> to view this video.","mwe-embedplayer-drm-error-not-enabled":"This content is DRM protected, it can only be played via DRM enabled players.","mwe-embedplayer-drm-error-not-supported":"This content is DRM protected, please use the latest browser that supports content protection\r\nor check that your browser has the <a href=\"http:\/\/www.microsoft.com\/silverlight\/\" target=\"_blank\">sliverlight plugin<\/a> installed and enabled.","mwe-embedplayer-player-on-air":"LIVE","mwe-embedplayer-player-off-air":"Off Air","mwe-embedplayer-player-jump-to-live":"Jump to live","mwe-embedplayer-related":"Related","mwe-embedplayer-related-errMsg":"No related<br>videos were<br>found.","mwe-embedplayer-no-source":"No sources"});mw.loader.implement("mw.EmbedPlayerImageOverlay",function($){(function(mw,$){"use strict";mw.EmbedPlayerImageOverlay={instanceOf:'ImageOverlay',playerReady:true,lastPauseTime:0,currentTime:0,startOffset:0,clockStartTime:0,imageLoaded:false,init:function(){if(this['native_instaceOf']=='Native'){return;}for(var i in mw.EmbedPlayerNative){if(typeof mw.EmbedPlayerImageOverlay[i]!='undefined'){this['native_'+i]=mw.EmbedPlayerNative[i];}else{this[i]=mw.EmbedPlayerNative[i];}}},updatePlaybackInterface:function(callback){mw.log('EmbedPlayerImageOverlay:: updatePlaybackInterface: '+$(this).siblings('.playerPoster').length);$(this.getPlayerElement()).css('left',0);this.parent_updatePlaybackInterface(callback);},updatePosterHTML:function(){var vid=this.getPlayerElement();$(vid).empty();this.embedPlayerHTML();},removePoster:function(){},play:function(){mw.log('EmbedPlayerImageOverlay::play> lastPauseTime:'+this.lastPauseTime+' ct: '+this.currentTime);this.captureUserGesture();this.applyIntrinsicAspect();if(this.currentTime>this.getDuration()){this.currentTime=this.pauseTime=0;}this.stopped=false;this.parent_play();this.playInterfaceUpdate();this.clockStartTime=new Date().getTime();this.bufferedPercent=0;this.monitor();this.hideSpinner();$(this).trigger('playing');},getDuration:function(){if(this.duration){return this.duration;}this.updateDuration();return this.duration;},updateDuration:function(){if($(this).data('imageDuration')){this.duration=parseFloat($(this).data('imageDuration'));}else{this.duration=parseFloat(mw.getConfig("EmbedPlayer.DefaultImageDuration"));}},stop:function(){this.currentTime=0;this.parent_stop();},_onpause:function(){},pause:function(){mw.log('EmbedPlayerImageOverlay::pause, lastPauseTime: '+this.lastPauseTime);this.lastPauseTime=this.currentTime;this.parent_pause();},monitor:function(){if(this.duration===0){return;}var oldCurrentTime=this.currentTime;if(this.currentTime>=this.duration){this.updatePlayHead(0);this.stopMonitor();$(this).trigger('ended');}else{this.parent_monitor();}if(oldCurrentTime!=this.currentTime){$(this).trigger('timeupdate');}},seek:function(seekTime){this.lastPauseTime=seekTime;this.seeking=false;$(this).trigger('seeking');$(this).trigger('seeked');this.play();},setCurrentTime:function(time,callback){this.lastPauseTime=time;$(this).trigger('seeking');$(this).trigger('seeked');if(callback){callback();}},playerSwitchSource:function(source,switchCallback,doneCallback){mw.log("EmbedPlayerImageOverlay:: playerSwitchSource");var _this=this;this.mediaElement.selectedSource=source;this.addPlayerSpinner();this.captureUserGesture();this.embedPlayerHTML(function(){mw.log("EmbedPlayerImageOverlay:: playerSwitchSource, embedPlayerHTML callback");_this.applyIntrinsicAspect();_this.play();$(_this).bind('ended.playerSwitchSource',function(){_this.stopMonitor();$(_this).unbind('ended.playerSwitchSource');if(doneCallback){doneCallback(_this);}});});if(switchCallback){switchCallback(this);}},captureUserGesture:function(){if(!$(this).data('previousInstanceOf')){$(this).data('previousInstanceOf',this.instanceOf);var vid=this.getPlayerElement();$(vid).attr('src',null);this.triggerHelper('AddEmptyBlackSources',[vid]);if(mw.isIOS()){vid.load();}}},updatePoster:function(posterSrc){var _this=this;if(!posterSrc){posterSrc=mw.getConfig('EmbedPlayer.BlackPixel');}this.poster=posterSrc;$(this).find('img.playerPoster').attr('src',this.poster).load(function(){_this.applyIntrinsicAspect();});},embedPlayerHTML:function(callback){var _this=this;mw.log('EmbedPlayerImageOverlay::embedPlayerHTML: '+this.id);this.updateDuration();var currentSoruceObj=this.mediaElement.selectedSource;_this.imageLoaded=false;if(!currentSoruceObj){mw.log("Error:: EmbedPlayerImageOverlay:embedPlayerHTML> missing source");return;}var loadedCallback=function(){_this.applyIntrinsicAspect();_this.clockStartTime=new Date().getTime();_this.imageLoaded=true;_this.monitor();if($.isFunction(callback)){callback();}};var $image=$('<img />').attr({'src':currentSoruceObj.getSrc()}).addClass('playerPoster').one('load',function(){if($.isFunction(loadedCallback)){loadedCallback();loadedCallback=null;}}).each(function(){if(this.complete){$(this).load();}});$(this.getPlayerElement()).css({'left':this.getWidth()+50,'position':'absolute'});$(this).html($image);},getPlayerElementTime:function(){if(!this.imageLoaded){mw.log('image not loaded: 0');this.currentTime=0;}else if(this.paused){this.currentTime=this.lastPauseTime;}else{this.currentTime=((new Date().getTime()-this.clockStartTime)/1000)+this.lastPauseTime;}return this.currentTime;}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.EmbedPlayerKplayer",function($){(function(mw,$){"use strict";mw.EmbedPlayerKplayer={instanceOf:'Kplayer',bindPostfix:'.kPlayer',playerPrefix:'EmbedPlayerKplayer',cancelLiveAutoPlay:false,supports:{'playHead':true,'pause':true,'stop':true,'sourceSwitch':true,'timeDisplay':true,'volumeControl':true,'overlays':true,'fullscreen':true},mediaLoadedFlag:false,seekStarted:false,flashCurrentTime:0,selectedFlavorIndex:0,b64Referrer:base64_encode(window.kWidgetSupport.getHostPageUrl()),playerObject:null,LIVE_OFFLINE_ALERT_TIMEOUT:8000,ignoreEnableGui:false,flashActivationRequired:false,unresolvedSrcURL:false,kPreload:{'preLoading':false,'playPending':false},setup:function(readyCallback){mw.log('EmbedPlayerKplayer:: Setup');var $container=this.getPlayerContainer();if($container.length){this.enablePlayerObject(true);$container.css('visibility','visible');readyCallback();return;}this.hideNativePoster();this.getVideoDisplay().prepend($('<div />').attr('id',this.kPlayerContainerId).addClass('maximize'));var _this=this;this.updateSources();var flashvars={};this.getEntryUrl().then(function(srcToPlay){flashvars.widgetId="_"+_this.kpartnerid;flashvars.partnerId=_this.kpartnerid;flashvars.autoMute=_this.muted||mw.getConfig('autoMute');flashvars.streamerType=_this.streamerType;flashvars.entryUrl=encodeURIComponent(srcToPlay);flashvars.entryDuration=_this.getDuration();flashvars.isMp4=_this.isMp4Src();flashvars.ks=_this.getFlashvars('ks');flashvars.serviceUrl=mw.getConfig('Kaltura.ServiceUrl');flashvars.b64Referrer=_this.b64Referrer;flashvars.forceDynamicStream=_this.getKalturaAttributeConfig('forceDynamicStream');flashvars.isLive=_this.isLive();flashvars.stretchVideo=_this.getKalturaAttributeConfig('stretchVideo')||false;flashvars.flavorId=_this.getKalturaAttributeConfig('flavorId');if(!flashvars.flavorId&&_this.mediaElement.selectedSource){flashvars.flavorId=_this.mediaElement.selectedSource.getAssetId();_this.setFlashvars('flavorId',flashvars.flavorId);}if(_this.streamerType!='http'&&_this.streamerType!='hls'&&_this.mediaElement.selectedSource){flashvars.selectedFlavorIndex=_this.getSourceIndex(_this.mediaElement.selectedSource);}if(mw.getConfig("ignoreAkamaiHD")){flashvars.ignoreAkamaiHD=mw.getConfig("ignoreAkamaiHD");}if(_this.isHlsSource(_this.mediaElement.selectedSource)){var hlsPluginConfiguration={plugin:'true',asyncInit:'true',loadingPolicy:'preInitialize'};if(mw.getConfig("hlsLiveSegmentBuffer")){hlsPluginConfiguration["liveSegmentBuffer"]=mw.getConfig("hlsLiveSegmentBuffer");}if(mw.getConfig("hlsInitialBufferTime")){hlsPluginConfiguration["initialBufferTime"]=mw.getConfig("hlsInitialBufferTime");}if(mw.getConfig("hlsExpandedBufferTime")){hlsPluginConfiguration["expandedBufferTime"]=mw.getConfig("hlsExpandedBufferTime");}if(mw.getConfig("hlsMaxBufferTime")){hlsPluginConfiguration["maxBufferTime"]=mw.getConfig("hlsMaxBufferTime");}var preferedBitRate=_this.evaluate('{mediaProxy.preferedFlavorBR}');if(preferedBitRate){hlsPluginConfiguration["prefBitrate"]=preferedBitRate;flashvars.disableAutoDynamicStreamSwitch=true;}if(mw.getConfig("maxBitrate")){hlsPluginConfiguration["maxBitrate"]=mw.getConfig("maxBitrate");}if(mw.getConfig("minBitrate")){hlsPluginConfiguration["minBitrate"]=mw.getConfig("minBitrate");}if(mw.getConfig("hlsLogs")){hlsPluginConfiguration["sendLogs"]=mw.getConfig("hlsLogs");var func=["onManifest","onNextRequest","onDownload","onCurrentTime","onTag"];for(var index=0;index<func.length;index++){(function(){var x=func[index];if(x){window[x]=function(a,b,c,d,e,f,g,h){parent.window[x](a,b,c,d,e,f,g,h);}}})();}}flashvars.KalturaHLS=hlsPluginConfiguration;flashvars.streamerType=_this.streamerType='hls';}if(_this.isLive()&&_this.streamerType=='rtmp'&&!_this.cancelLiveAutoPlay){flashvars.autoPlay=true;}if(_this.getKalturaAttributeConfig('maxAllowedRegularBitrate')){flashvars.maxAllowedRegularBitrate=_this.getKalturaAttributeConfig('maxAllowedRegularBitrate');}if(_this.getKalturaAttributeConfig('maxAllowedFSBitrate')){flashvars.maxAllowedFSBitrate=_this.getKalturaAttributeConfig('maxAllowedFSBitrate');}var kdpVars=_this.getKalturaConfig('kdpVars',null);$.extend(flashvars,kdpVars);var flashFailCallback=function(){_this.removePoster();_this.layoutBuilder.displayAlert({title:_this.getKalturaMsg('ks-FLASH-BLOCKED-TITLE'),message:_this.getKalturaMsg('ks-FLASH-BLOCKED'),keepOverlay:true,noButtons:true,props:{customAlertTitleCssClass:"AlertTitleTransparent",customAlertMessageCssClass:"AlertMessageTransparent",customAlertContainerCssClass:"AlertContainerTransparent flashBlockAlertContainer"}});};var playerElementFlash=new mw.PlayerElementFlash(_this.kPlayerContainerId,'kplayer_'+_this.pid,flashvars,_this,function(){var bindEventMap={'playerPaused':'onPause','playerPlayed':'onPlay','durationChange':'onDurationChange','playbackComplete':'onClipDone','playerUpdatePlayhead':'onUpdatePlayhead','bytesTotalChange':'onBytesTotalChange','bytesDownloadedChange':'onBytesDownloadedChange','playerSeekEnd':'onPlayerSeekEnd','alert':'onAlert','switchingChangeStarted':'onSwitchingChangeStarted','switchingChangeComplete':'onSwitchingChangeComplete','flavorsListChanged':'onFlavorsListChanged','liveStreamOffline':'onLiveEntryOffline','liveStreamReady':'onLiveStreamReady','loadEmbeddedCaptions':'onLoadEmbeddedCaptions','bufferChange':'onBufferChange','audioTracksReceived':'onAudioTracksReceived','audioTrackSelected':'onAudioTrackSelected','videoMetadataReceived':'onVideoMetadataReceived','mediaLoaded':'onMediaLoaded','hlsEndList':'onHlsEndList','mediaError':'onMediaError','bitrateChange':'onBitrateChange','textTracksReceived':'onTextTracksReceived','debugInfoReceived':'onDebugInfoReceived','readyToPlay':'onReadyToPlay','id3tag':'onId3tag'};_this.playerObject=this.getElement();$.each(bindEventMap,function(bindName,localMethod){_this.playerObject.addJsListener(bindName,localMethod);});if(_this.startTime!==undefined&&_this.startTime!=0&&!_this.supportsURLTimeEncoding()){_this.playerObject.setKDPAttribute('mediaProxy','mediaPlayFrom',_this.startTime);}readyCallback();if(mw.getConfig('autoMute')){_this.triggerHelper("volumeChanged",0);}},flashFailCallback);_this.bindHelper('switchAudioTrack'+_this.bindPostfix,function(e,data){if(_this.playerObject){_this.playerObject.sendNotification("doAudioSwitch",{audioIndex:data.index});}});_this.bindHelper('liveEventEnded'+_this.bindPostfix,function(){if(_this.playerObject){_this.playerObject.sendNotification("liveEventEnded");}});_this.bindHelper('changeEmbeddedTextTrack'+_this.bindPostfix,function(e,data){if(_this.playerObject){_this.playerObject.sendNotification("doTextTrackSwitch",{textIndex:data.index});}});_this.bindHelper('liveOnline'+_this.bindPostfix,function(){if(this.isLive()&&!this.isDVR()){_this.reset();}});});},load:function(){if(!this.isLive()&&(!this.autoplay||(this.autoplay&&this.isInSequence()))){this.kPreload.preLoading=true;this.playerObject.play();}},reset:function(){if(this.restarting){return;}this.restarting=true;var _this=this;this.clean();this.setup(function(){_this.restarting=false;_this.play();});},isHlsSource:function(source){if(source&&(source.getMIMEType()=='application/vnd.apple.mpegurl')){return true;}return false;},setCurrentTime:function(time,callback){this.flashCurrentTime=time;if(callback){callback();}},addStartTimeCheck:function(){},enablePlayerObject:function(enabled){if(this.playerObject){this.playerObject.disabled=enabled;}},disablePlayer:function(){this.getPlayerContainer().css('visibility','hidden');this.showNativePoster();this.enablePlayerObject(false);},showNativePoster:function(){var videoTagObj=$($('#'+this.pid).get(0));if(videoTagObj){videoTagObj.css('visibility','');}},hideNativePoster:function(){var videoTagObj=$($('#'+this.pid).get(0));if(videoTagObj){videoTagObj.css('visibility','hidden');}},onTextTracksReceived:function(data){this.triggerHelper('textTracksReceived',data);},getSources:function(){if(this.manifestAdaptiveFlavors.length){return this.manifestAdaptiveFlavors;}return this.getSourcesForKDP();},getSourcesForKDP:function(){var _this=this;var sourcesByTags=[];var flavorTags=_this.getKalturaAttributeConfig('flavorTags');if(flavorTags===undefined){var sources=_this.mediaElement.getPlayableSources();$.each(sources,function(sourceIndex,source){if(_this.checkForTags(source.getTags(),['web','mbr'])||(_this.isHlsSource(source))){sourcesByTags.push(source);}});}else{sourcesByTags=_this.getSourcesByTags(flavorTags);}return sourcesByTags;},restorePlayerOnScreen:function(){},updateSources:function(){if(!(this.isLive()||this.sourcesReplaced||this.isHlsSource(this.mediaElement.selectedSource))){this.autoSelectTemporalSource({'sources':this.getSourcesForKDP()});}else if(this.isLive()&&this.streamerType=='rtmp'){var _this=this;if(!this.autoplay){this.autoplay=true;this.cancelLiveAutoPlay=true;}else if(this.playerObject){this.playerObject.setKDPAttribute('configProxy.flashvars','autoPlay','true');}this.setKDPAttribute('liveCore','offlineAlertOffest',this.LIVE_OFFLINE_ALERT_TIMEOUT);$(this).bind('layoutBuildDone',function(){_this.disablePlayControls();});}},changeMediaCallback:function(callback){var _this=this;this.updateSources();this.seekStarted=false;this.mediaLoadedFlag=false;this.flashCurrentTime=0;this.playerObject.setKDPAttribute('mediaProxy','isLive',this.isLive());this.playerObject.setKDPAttribute('mediaProxy','isMp4',this.isMp4Src());this.playerObject.setKDPAttribute('mediaProxy','entryDuration',this.getDuration());this.getEntryUrl().then(function(srcToPlay){if(!_this.playlist||_this.autoplay){_this.bindHelper("onChangeMediaDone"+_this.bindPostfix,function(){_this.unbindHelper("onChangeMediaDone"+_this.bindPostfix);_this.play();});}_this.playerObject.sendNotification('changeMedia',{entryUrl:srcToPlay});callback();});},isMp4Src:function(){if(this.mediaElement.selectedSource&&(this.mediaElement.selectedSource.getMIMEType()=='video/mp4'||this.mediaElement.selectedSource.getMIMEType()=='video/h264')){return true;}return false;},embedPlayerHTML:function(){},onPause:function(){if(this.kPreload.preLoading){this.kPreload.preLoading=false;if(this.kPreload.playPending){this.kPreload.playPending=false;this.play();}return;}$(this).trigger("pause");},onPlay:function(){if(this.kPreload.preLoading){this.playerObject.pause();return;}if(mw.isChrome()&&!this.flashActivationRequired&&mw.getConfig("EmbedPlayer.EnableFlashActivation")!==false){this.flashActivationRequired=true;$(this).hide();}if(this._propagateEvents){$(this).trigger("playing");this.hideSpinner();if(this.isLive()){this.ignoreEnableGui=false;this.enablePlayControls(['sourceSelector']);}this.stopped=this.paused=false;}},onDurationChange:function(data,id){var dur=this.getDuration();if(this.startTime&&this.pauseTime){dur=this.pauseTime-this.startTime+2;}else{if(this.startTime){dur=dur-this.startTime+2;}}if(!this.isLive()&&data.newValue>dur&&mw.getConfig("EmbedPlayer.EnableURLTimeEncoding")===true){return;}this.setDuration(data.newValue);this.playerObject.duration=data.newValue;},onVideoMetadataReceived:function(data){if(data&&data.info){$(this).trigger('videoMetadataReceived',[data.info]);}if(!this.mediaLoadedFlag){$(this).trigger('mediaLoaded');this.mediaLoadedFlag=true;}},onMediaLoaded:function(){if(!this.mediaLoadedFlag){$(this).trigger('mediaLoaded');this.mediaLoadedFlag=true;}},onClipDone:function(){this.parent_onClipDone();this.flashCurrentTime=0;},onAlert:function(data,id){if(data.messageKey){data.message=gM(data.messageKey);}if(data.titleKey){data.title=gM(data.titleKey);}this.layoutBuilder.displayAlert(data);},onHlsEndList:function(){this.triggerHelper('liveEventEnded');},onMediaError:function(data){var error=null;if(data){error=data.errorId+" detail:"+data.errorDetail;}data.errorMessage=this.getKalturaMsg('ks-CLIP_NOT_FOUND');mw.log("EmbedPlayerKPlayer::MediaError error code: "+error);this.triggerHelper('embedPlayerError',[data]);},play:function(){if(this.kPreload.preLoading){this.kPreload.playPending=true;return;}if(this.restarting){return;}var _this=this;mw.log('EmbedPlayerKplayer::play');if(this.unresolvedSrcURL){this.getEntryUrl().then(function(srcToPlay){_this.unresolvedSrcURL=false;_this.playerObject.sendNotification('changeMedia',{entryUrl:srcToPlay});_this.play();});return;}var shouldDisable=false;if(this.isLive()&&this.paused){shouldDisable=true;}if(this.parent_play()){if(shouldDisable){this.ignoreEnableGui=true;this.disablePlayControls(['sourceSelector']);}this.playerObject.play();this.monitor();}else{mw.log("EmbedPlayerKPlayer:: parent play returned false, don't issue play on kplayer element");}},pause:function(){try{this.playerObject.pause();}catch(e){mw.log("EmbedPlayerKplayer:: doPause failed");}this.parent_pause();},playerSwitchSource:function(source,switchCallback,doneCallback){if(switchCallback){switchCallback(this.playerObject);}setTimeout(function(){if(doneCallback)doneCallback();},100);},doSeek:function(seekTime){this.seekStarted=true;if(this.firstPlay){this.stopEventPropagation();if(this.streamerType=='http'){this.playerObject.seek(seekTime);}else{this.playerObject.setKDPAttribute('mediaProxy','mediaPlayFrom',seekTime);this.playerObject.play();}}else{this.playerObject.seek(seekTime);}},setPlayerElementVolume:function(percentage){if(this.playerObject){this.playerObject.changeVolume(percentage);}},onUpdatePlayhead:function(playheadValue){if(this.flashActivationRequired){this.flashActivationRequired=false;$(this).show();}if(this.isLive()&&!this.isDVR()){$(this).trigger('timeupdate');return;}if(this.seeking){this.seeking=false;this.flashCurrentTime=playheadValue;}else{if(this.flashCurrentTime<playheadValue){this.flashCurrentTime=playheadValue;}}$(this).trigger('timeupdate');},onBytesTotalChange:function(data,id){this.bytesTotal=data.newValue;},onBytesDownloadedChange:function(data,id){this.bytesLoaded=data.newValue;this.bufferedPercent=this.bytesLoaded/this.bytesTotal;$(this).trigger('updateBufferPercent',this.bufferedPercent);},onPlayerSeekEnd:function(){if(this.firstPlay){this.restoreEventPropagation();}if(this.seekStarted){this.seekStarted=false;this.triggerHelper('seeked',[this.playerObject.getCurrentTime()]);}},onSwitchingChangeStarted:function(data,id){$(this).trigger('sourceSwitchingStarted',[data]);},onSwitchingChangeComplete:function(data,id){this.onBitrateChange(data);$(this).trigger('sourceSwitchingEnd',[data.newIndex]);},onBitrateChange:function(data){if(data&&data.newBitrate){this.triggerHelper('bitrateChange',data.newBitrate);}},onFlavorsListChanged:function(data,id){var flavors=data.flavors;var currentSources=[];if(this.mediaElement){currentSources=this.mediaElement.getPlayableSources();}if(flavors&&flavors.length>1){if(currentSources.length>0){$.each(flavors,function(index,flavor){for(var i=0;i<currentSources.length;i++){if(currentSources[i].bandwidth==flavor.bandwidth){flavor.height=currentSources[i].height;break;}}});}this.setKDPAttribute('sourceSelector','visible',true);this.parent_onFlavorsListChanged(flavors);}},onLiveEntryOffline:function(){if(this.streamerType=='rtmp'){this.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':false});}},onLiveStreamReady:function(){if(this.streamerType=='rtmp'){this.hideSpinner();this.playerObject.setKDPAttribute('configProxy.flashvars','autoPlay','false');this.triggerHelper('liveStreamStatusUpdate',{'onAirStatus':true});if(this.cancelLiveAutoPlay){this.cancelLiveAutoPlay=false;this.autoplay=false;this.pause();}}},onLoadEmbeddedCaptions:function(data){this.triggerHelper('onTextData',data);var caption={source:{srclang:data.language},capId:data.trackid,caption:{content:data.text}};this.triggerHelper('onEmbeddedData',caption);},onEnableGui:function(data,id){if(this.ignoreEnableGui){return;}if(data.guiEnabled===false){this.disablePlayControls();}else{this.enablePlayControls();}},onBufferChange:function(buffering){if(buffering){this.bufferStart();}else{this.bufferEnd();}},onAudioTracksReceived:function(data){this.triggerHelper('audioTracksReceived',data);},onAudioTrackSelected:function(data){this.triggerHelper('audioTrackIndexChanged',data);},onDebugInfoReceived:function(data){var msg='';for(var prop in data){msg+=prop+': '+data[prop]+' | ';}this.triggerHelper('debugInfoReceived',data);mw.log("EmbedPlayerKplayer:: onDebugInfoReceived | "+msg);},onReadyToPlay:function(){this.triggerHelper('readyToPlay');},onId3tag:function(data){var id3TagData=base64_decode(data.data);var id3TagString=id3TagData.substring(id3TagData.indexOf("{"),id3TagData.lastIndexOf("}")+1);var id3Tag=JSON.parse(id3TagString);this.triggerHelper('onId3Tag',id3Tag);},getPlayerElementTime:function(){return this.flashCurrentTime;},getPlayerElement:function(){return this.playerObject;},getPlayerContainer:function(){if(!this.kPlayerContainerId){this.kPlayerContainerId='kplayer_'+this.id;}return $('#'+this.kPlayerContainerId);},getEntryUrl:function(){var _this=this;var deferred=$.Deferred();var originalSrc=this.mediaElement.selectedSource.getSrc();if(this.isHlsSource(this.mediaElement.selectedSource)){this.streamerType='hls';this.resolveSrcURL(originalSrc).then(function(srcToPlay){_this.unresolvedSrcURL=false;deferred.resolve(srcToPlay);},function(){_this.unresolvedSrcURL=true;deferred.resolve(originalSrc);});return deferred;}else if(this.isLive()||this.sourcesReplaced){return deferred.resolve(originalSrc);}var flavorIdParam='';var mediaProtocol=this.getKalturaAttributeConfig('mediaProtocol')||mw.getConfig('Kaltura.Protocol')||"http";var format;var fileExt='f4m';if(this.streamerType==='hdnetwork'){format='hdnetworksmil';fileExt='smil';}else if(this.streamerType==='live'){format='rtmp';}else{format=this.streamerType;if(format=='http'){flavorIdParam=this.mediaElement.selectedSource?"/flavorId/"+this.mediaElement.selectedSource.getAssetId():"";}}var ksString=this.getFlashvars('ks')?"/ks/"+this.getFlashvars('ks'):"";var srcUrl=window.kWidgetSupport.getBaseFlavorUrl(this.kpartnerid)+"/entryId/"+this.kentryid+flavorIdParam+this.getPlaymanifestArg("deliveryCode","deliveryCode")+"/format/"+format+"/protocol/"+mediaProtocol+this.getPlaymanifestArg("cdnHost","cdnHost")+this.getPlaymanifestArg("storageId","storageId")+ksString+"/uiConfId/"+this.kuiconfid+this.getPlaymanifestArg("referrerSig","referrerSig")+this.getPlaymanifestArg("tags","flavorTags")+"/a/a."+fileExt+"?referrer="+this.b64Referrer;if(this.supportsURLTimeEncoding()&&this.pauseTime){if(srcUrl.indexOf("&clipTo=")!==-1){srcUrl=srcUrl.substr(0,this.selectedSource.src.indexOf("&clipTo="));}srcUrl=srcUrl+"&clipTo="+parseInt(this.pauseTime)*1000;}if(this.supportsURLTimeEncoding()&&this.startTime){if(srcUrl.indexOf("&seekFrom=")!==-1){srcUrl=srcUrl.substr(0,srcUrl.indexOf("&seekFrom="));}srcUrl=srcUrl+"&seekFrom="+parseInt(this.startTime)*1000;}srcUrl=srcUrl+"&playSessionId="+this.evaluate('{configProxy.sessionId}');if(originalSrc.indexOf("&clientTag=")!==-1){var clientTag=originalSrc.slice(originalSrc.indexOf("clientTag"));clientTag=clientTag.slice(0,clientTag.indexOf("&"))
srcUrl=srcUrl+"&"+clientTag;}var sourceElm=$('<source />').attr({src:srcUrl}).get(0);var refObj=new mw.MediaSource(sourceElm);this.triggerHelper('SourceSelected',refObj);deferred.resolve(refObj.src);return deferred;},getPlaymanifestArg:function(argName,argKey){var argString="";var argVal=this.getKalturaAttributeConfig(argKey);if(argVal!==undefined){argString="/"+argName+"/"+argVal;}return argString;},switchSrc:function(source){var _this=this;if(this.streamerType=='http'&&!this.getKalturaAttributeConfig('forceDynamicStream')){this.mediaElement.setSource(source);this.getEntryUrl().then(function(srcToPlay){_this.playerObject.setKDPAttribute('mediaProxy','entryUrl',srcToPlay);_this.playerObject.sendNotification('doSwitch',{flavorIndex:_this.getSourceIndex(source)});});return;}var sourceIndex=-1;if(source!==-1){sourceIndex=this.getSourceIndex(source);}this.playerObject.sendNotification('doSwitch',{flavorIndex:sourceIndex});},canAutoPlay:function(){return(!this.isLive()||(this.isLive()&&!this.isOffline()));},backToLive:function(){this.triggerHelper('movingBackToLive');var _this=this;if(this.isDVR()){this.playerObject.sendNotification('goLive');if(this.buffering){this.bindHelper('bufferEndEvent'+this.bindPostfix,function(){_this.unbindHelper('bufferEndEvent'+_this.bindPostfix);_this.playerObject.seek(_this.getDuration());_this.syncMonitor();});}}else{this.bindHelper('playing'+this.bindPostfix,function(){_this.unbindHelper('playing'+_this.bindPostfix);_this.playerObject.sendNotification('goLive');});}},setKPlayerAttribute:function(host,prop,val){this.playerObject.setKDPAttribute(host,prop,val);},clean:function(){this.unbindHelper(this.bindPostfix);$(this.getPlayerContainer()).remove();this.playerObject=null;},setStorageId:function(storageId){var _this=this;this.parent_setStorageId(storageId);if(this.playerObject){this.getEntryUrl().then(function(srcToPlay){_this.playerObject.setKDPAttribute('mediaProxy','entryUrl',srcToPlay);});}},toggleFullscreen:function(){var _this=this;this.parent_toggleFullscreen();this.playerObject.redrawObject();if(_this.layoutBuilder.fullScreenManager.isInFullScreen()){_this.playerObject.sendNotification("hasOpenedFullScreen");}else{_this.playerObject.sendNotification("hasCloseFullScreen");}},playSegment:function(startTime,endTime){var _this=this;if(this.supportsURLTimeEncoding()){this.getEntryUrl().then(function(srcToPlay){var shouldSeek=!_this.paused;_this.stop();_this.playerObject.sendNotification('changeMedia',{entryUrl:srcToPlay});if(shouldSeek){_this.seek(0);}else{_this.playerObject.sendNotification("doStop");}});}else{this.playerObject.setKDPAttribute('mediaProxy','mediaPlayFrom',this.startTime);if(endTime){this.pauseTime=endTime;}if(startTime){this.seek(startTime);}}},getCurrentBufferLength:function(){return parseInt(this.playerObject.getCurrentBufferLength());},bufferHandling:function(){}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.EmbedPlayerNative",function($){(function(mw,$){"use strict";mw.EmbedPlayerNative={instanceOf:'Native',bindPostfix:'.nativePlayer',playerPrefix:'EmbedPlayerNative',onlyLoadFlag:false,onLoadedCallback:null,prevCurrentTime:-1,progressEventData:null,mediaLoadedFlag:null,triggerNetworkErrorsFlag:true,keepPlayerOffScreenFlag:null,ignoreNextNativeEvent:null,currentSeekTargetTime:null,ignoreNextError:false,keepNativeFullScreen:false,playing:false,disableSwitchSourceCallback:false,mobilePlayed:false,nativeEvents:['loadstart','progress','suspend','abort','error','emptied','stalled','play','pause','loadedmetadata','loadeddata','waiting','playing','canplay','canplaythrough','seeking','seeked','timeupdate','ended','ratechange','durationchange','volumechange'],supports:{'playHead':true,'pause':true,'fullscreen':true,'SourceSelector':true,'timeDisplay':true,'volumeControl':true,'overlays':true},setup:function(readyCallback){var _this=this;this._propagateEvents=true;if(mw.isIpad()){this.getPlayerElement().removeAttribute("poster");}$(this.getPlayerElement()).css('position','absolute');if(this.inline){$(this.getPlayerElement()).attr('webkit-playsinline','');}readyCallback();$(window).unload(function(){_this.triggerNetworkErrorsFlag=false;if(_this.layoutBuilder){_this.layoutBuilder.closeAlert();}});this.addBindings();},addBindings:function(){var _this=this;this.bindHelper('firstPlay'+this.bindPostfix,function(){_this.parseTracks();});this.bindHelper('switchAudioTrack'+this.bindPostfix,function(e,data){_this.switchAudioTrack(data.index);});this.bindHelper('liveOnline'+this.bindPostfix,function(){if(_this.isLive()&&!_this.isDVR()){_this.resetSrc=true;}});},removeBindings:function(){this.unbindHelper('firstPlay'+this.bindPostfix);this.unbindHelper('switchAudioTrack'+this.bindPostfix);this.unbindHelper('liveOnline'+this.bindPostfix);},updateFeatureSupport:function(){if(this.useNativePlayerControls()){this.supports.overlays=false;}if(!this.supportsVolumeControl()){this.supports.volumeControl=false;}if(this.getPlayerElement()&&this.getSrc()&&!mw.isIE()&&!mw.isEdge()){$(this.getPlayerElement()).attr('src',this.getSrc());}if(this.getPlayerElement()){this.applyMediaElementBindings();this.playbackRate=this.getPlayerElement().playbackRate;}this.parent_updateFeatureSupport();},supportsVolumeControl:function(){return!(mw.isIpad()||mw.isAndroid()||mw.isMobileChrome()||this.useNativePlayerControls());},changeMediaCallback:function(callback){if(!this.getSource()){callback();return;}var _this=this;_this.switchPlaySource(this.getSource(),function(){if(!_this.autoplay||(_this.autoplay&&mw.isMobileDevice())){_this.ignoreNextNativeEvent=true;if(!_this.isPlaying()){_this.updatePosterHTML();}}callback();});},disablePlayer:function(){$(this.getPlayerElement()).css('position','static');},embedPlayerHTML:function(){var _this=this;var vid=_this.getPlayerElement();this.ignoreNextNativeEvent=true;if(vid&&!mw.isIphone()){$(vid).empty();}if(vid&&$(vid).attr('src')==this.getSrc(this.currentTime)){_this.postEmbedActions();return;}this.log("embedPlayerHTML > play url:"+this.getSrc(this.currentTime)+' startOffset: '+this.start_ntp+' end: '+this.end_ntp);if(this.isPersistentNativePlayer()&&vid){_this.postEmbedActions();return;}_this.bufferStartFlag=false;_this.bufferEndFlag=false;$(this.getVideoDisplay()).append(_this.getNativePlayerHtml());_this.postEmbedActions();},getNativePlayerHtml:function(playerAttribtues,cssSet){if(!playerAttribtues){playerAttribtues={};}if(!playerAttribtues['id']){playerAttribtues['id']=this.pid;}if(!playerAttribtues['src']){playerAttribtues['src']=this.getSrc(this.currentTime);}if(this.autoplay){playerAttribtues['autoplay']='true';}if(!cssSet){cssSet={};}if(!cssSet['width'])cssSet['width']='100%';if(!cssSet['height'])cssSet['height']='100%';if(this.loop){playerAttribtues['loop']='true';}var tagName=this.isAudio()?'audio':'video';return $('<'+tagName+' />').addClass('persistentNativePlayer nativeEmbedPlayerPid').attr(playerAttribtues).css(cssSet);},canAutoPlay:function(){return(!mw.isAndroid()&&!mw.isMobileChrome()&&!mw.isIOS())||this.mobilePlayed;},postEmbedActions:function(){var _this=this;var vid=this.getPlayerElement();if(!vid){return;}if(!this.skipUpdateSource){if($(vid).attr('src')!=this.getSrc(this.currentTime)&&!mw.isIE()&&!mw.isEdge()){$(vid).attr('src',this.getSrc(this.currentTime));}}if(this.muted){vid.muted=true;}if(mw.getConfig('EmbedPlayer.WebKitAllowAirplay')){$(vid).attr('x-webkit-airplay',"allow");}if(this.useNativePlayerControls()){$(vid).attr('controls',"true");}$(vid).show().css('visibility','');_this.applyMediaElementBindings();if(this.currentTime!=vid.currentTime){var waitReadyStateCount=0;var checkReadyState=function(){if(vid.readyState>0){vid.currentTime=this.currentTime;return;}if(waitReadyStateCount>1000){_this.log("Error: could not run native seek");return;}waitReadyStateCount++;setTimeout(function(){checkReadyState();},10);};}},applyMediaElementBindings:function(){var _this=this;this.log("MediaElementBindings");var vid=this.getPlayerElement();if(!vid){this.log(" Error: applyMediaElementBindings without player elemnet");return;}$.each(_this.nativeEvents,function(inx,eventName){if(mw.isIOSAbove7()&&mw.isIphone()&&eventName==="seeking"){return;}$(vid).unbind(eventName+'.embedPlayerNative').bind(eventName+'.embedPlayerNative',function(){if(_this._propagateEvents&&_this.instanceOf=='Native'){var argArray=$.makeArray(arguments);if(_this['_on'+eventName]){_this['_on'+eventName].apply(_this,argArray);}else{$(_this).trigger(eventName,argArray);}}});});},monitor:function(){var _this=this;var vid=_this.getPlayerElement();if(vid&&vid.buffered&&vid.buffered.end&&vid.duration){try{this.updateBufferStatus(vid.buffered.end(vid.buffered.length-1)/vid.duration);}catch(e){}}_this.parent_monitor();},doSeek:function(seekTime){var _this=this;if(mw.isIOS()){this.hidePlayerOffScreen();}if(seekTime===0&&this.isLive()&&mw.isIpad()&&!mw.isIOSAbove7()){seekTime=0.01;this.log("doSeek: fix seekTime to 0.01");}this.unbindHelper("seeked.doSeek").bindOnceHelper("seeked.doSeek",function(){_this.restorePlayerOnScreen();});this.setCurrentTime(seekTime);},canSeek:function(deferred,callbackCount){var vid=this.getPlayerElement();var checkVideoStateDeferred=deferred||$.Deferred();var _this=this;if(!callbackCount){callbackCount=0;}if(this.currentState==="end"&&mw.isIphone()){vid.play();this.playing=true;}if((vid.currentTime===0&&callbackCount===0)&&vid.readyState===0){if(mw.isIpad()){$(vid).attr('preload','auto')[0].load();}else{$(vid).attr('preload','auto');}}var videoReadyState=mw.isIOSAbove7()?2:1;if((vid.readyState<videoReadyState)||(this.getDuration()===0)){if(callbackCount==0&&vid.paused){this.stopEventPropagation();this.isWaitingForSeekReady=true;var vidObj=$(vid);var eventName=mw.isIOS()?"canplaythrough.seekPrePlay":"canplay.seekPrePlay";vidObj.off(eventName).one(eventName,function(){_this.isWaitingForSeekReady=false;_this.restoreEventPropagation();if(vid.duration>0){_this.log("player can seek");clearTimeout(_this.canSeekTimeout);this.canSeekTimeout=null;setTimeout(function(){return checkVideoStateDeferred.resolve();},10);}else{_this.log("player can't seek - video duration not available, wait for video duration update");}});vidObj.off('loadedmetadata.seekPrePlay').one('loadedmetadata.seekPrePlay',function(){_this._onloadedmetadata();});this.log("player can't seek - try to init video element ready state");if(!_this.skipUpdateSource){if($(vid).attr('src')!=_this.getSrc()){$(vid).attr('src',_this.getSrc());vid.load();vid.play();_this.parseTracks();}}}if(callbackCount>=15){this.log("Error:: with seek request, media never in ready state");return checkVideoStateDeferred.resolve();}this.log("player can't seek - wait video element ready state");this.canSeekTimeout=setTimeout(function(){this.canSeekTimeout=null;_this.canSeek(checkVideoStateDeferred,callbackCount+1);},1000);}else{setTimeout(function(){_this.log("player can seek");if(_this.isWaitingForSeekReady){_this.restoreEventPropagation();_this.isWaitingForSeekReady=false;}return checkVideoStateDeferred.resolve();},10);}return checkVideoStateDeferred;},setCurrentTime:function(time){if(this.isLive()&&!this.isDVR()){this.LiveCurrentTime=time;}else{this.log("setCurrentTime seekTime:"+time);try{var vid=this.getPlayerElement();vid.currentTime=this.currentSeekTargetTime;}catch(e){this.log("Error: Could not set video tag seekTime");this.triggerHelper("seeked");}}},getPlayerElementTime:function(){var _this=this;this.getPlayerElement();if(!this.playerElement){this.log('getPlayerElementTime: '+this.id+' not in dom ( stop monitor)');this.stop();return false;}if(this.isLive()&&!this.isDVR()){return this.LiveCurrentTime?this.LiveCurrentTime:0;}var ct=this.playerElement.currentTime;if(!ct||isNaN(ct)||ct<0||!isFinite(ct)){return 0;}return this.playerElement.currentTime;},updatePoster:function(src){this.parent_updatePoster(src);if(mw.getConfig('EmbedPlayer.HidePosterOnStart')===true){return;}if(this.getPlayerElement()){$(this.getPlayerElement()).attr('poster',src);}},emptySources:function(){var _this=this;this.ignoreNextError=true;setTimeout(function(){_this.ignoreNextError=false;},5000);$(this.getPlayerElement()).attr('src',null).attr('poster',null);this.parent_emptySources();},isTimeUpdateSupported:function(){if(this.isLive()&&mw.isAndroid()){return false;}else{return true;}},playerSwitchSource:function(source,switchCallback,doneCallback){var _this=this;var src=source.getSrc();var vid=this.getPlayerElement();var switchBindPostfix='.playerSwitchSource';this.isPauseLoading=false;if(!src||src==vid.src){if($.isFunction(switchCallback)){switchCallback(vid);}if($.isFunction(doneCallback)){_this.ignoreNextError=false;doneCallback();}return;}$(vid).attr('preload','auto');this.log('playerSwitchSource: '+src+' native time: '+vid.currentTime);this.ignoreNextNativeEvent=true;this.currentTime=0;this.previousTime=0;if(vid){try{$(vid).unbind(switchBindPostfix);vid.pause();var originalControlsState=vid.controls;vid.removeAttribute('controls');if(_this.isFlavorSwitching){_this.seeking=true;}else{_this.seeking=false;}if(!_this.firstPlay){_this.addPlayerSpinner();_this.addBlackScreen();}$(vid).empty();if(mw.isIOS7()&&mw.isIphone()){vid.src=null;var sourceTag=document.createElement('source');sourceTag.setAttribute('src',src);vid.appendChild(sourceTag);}else{vid.src=src;}if(mw.isDesktopSafari()){vid.load();}_this.hidePlayerOffScreen();$(vid).bind('loadedmetadata'+switchBindPostfix,function(){$(vid).unbind('loadedmetadata'+switchBindPostfix);_this.log(" playerSwitchSource> loadedmetadata callback for:"+src);if(!mw.isIOS71()&&$.isFunction(switchCallback)&&!_this.isVideoSiblingEnabled()){vid.play();}else{_this.removeBlackScreen();}});var handleSwitchCallback=function(){$(vid).unbind('pause'+switchBindPostfix);_this.restorePlayerOnScreen();_this.hideSpinner();vid.controls=originalControlsState;_this.ignoreNextError=false;_this.ignoreNextNativeEvent=false;if($.isFunction(switchCallback)){_this.log(" playerSwitchSource> call switchCallback");switchCallback(vid);switchCallback=null;}};$(vid).bind('playing'+switchBindPostfix,function(){$(vid).unbind('playing'+switchBindPostfix);_this.log(" playerSwitchSource> playing callback: "+vid.currentTime);handleSwitchCallback();setTimeout(function(){_this.removeBlackScreen();},100);});if($.isFunction(doneCallback)){var sentDoneCallback=false;$(vid).bind('ended'+switchBindPostfix,function(event){if(_this.disableSwitchSourceCallback){return;}if(_this.mobileChromeTimeoutID){clearTimeout(_this.mobileChromeTimeoutID);_this.mobileChromeTimeoutID=null;}sentDoneCallback=true;$(vid).unbind(switchBindPostfix);doneCallback();return false;});if(mw.isMobileChrome()){$(vid).bind('timeupdate'+switchBindPostfix,function(e){var _this=this;var timeDiff=this.duration-this.currentTime;if(timeDiff<0.5&&this.duration!=0){_this.mobileChromeTimeoutID=setTimeout(function(){_this.mobileChromeTimeoutID=null;if(timeDiff<=(_this.duration-_this.currentTime)){_this.log('playerSwitchSource> error in getting ended event, issue doneCallback directly.');if(!sentDoneCallback){$(vid).unbind(switchBindPostfix);sentDoneCallback=true;doneCallback();}}},2000);}});}}if(_this.isInSequence()){vid.play();}else{if(!(_this.playlist&&mw.isAndroid())){_this.play();}}if(mw.isMobileDevice()){setTimeout(function(){handleSwitchCallback();},100);}setTimeout(function(){if(vid.readyState===0&&$.isFunction(switchCallback)&&!_this.canAutoPlay()){_this.log(" Error: possible play without user click gesture, issue callback");handleSwitchCallback();_this.pause();}},10000);}catch(e){this.log("Error: switching source playback failed");}}},hidePlayerOffScreen:function(vid){var vid=this.getPlayerElement();$(vid).css({'position':'absolute','left':'-4048px'});},restorePlayerOnScreen:function(vid){var vid=this.getPlayerElement();if(this.keepPlayerOffScreenFlag||this.instanceOf!='Native'){return;}if(!this.isAudioPlayer&&!mw.getConfig("EmbedPlayer.KeepPoster")===true){this.removePoster();}$(vid).css({'left':'0px','top':'0px'});},pause:function(){this.getPlayerElement();this.parent_pause();if(this.playerElement){this.playerElement.pause();}},play:function(){var vid=this.getPlayerElement();var _this=this;if(this.isStopped()&&this._playContorls){this.restorePlayerOnScreen();}var doPlay=function(){if(_this.parent_play()){if(_this.getPlayerElement()&&_this.getPlayerElement().play){_this.log(" issue native play call:");if(!_this.skipUpdateSource){if($(vid).attr('src')!=_this.getSrc()||_this.resetSrc){$(vid).attr('src',_this.getSrc());setTimeout(function(){if(!_this.playing){vid.play();_this.parseTracks();}},300);_this.resetSrc=false;}}_this.hideSpinnerOncePlaying();$(_this.getPlayerElement()).show();if(!_this.isAudio()){_this.removePoster();}if(_this.useNativePlayerControls()&&$(_this).find('video ').length==0){$(_this).hide();}if(!_this.mediaLoadedFlag){_this.load();}if(!_this.playing){vid.play();}_this.mobilePlayed=true;_this.monitor();}}else{_this.log(" parent play returned false, don't issue play on native element");}};if(this.firstPlay&&mw.isAndroid4andUp()&&mw.getConfig('EmbedPlayer.twoPhaseManifestHlsAndroid')&&this.mediaElement.selectedSource.getMIMEType()=='application/vnd.apple.mpegurl'&&!this.isLive()){this.resolveSrcURL(this.mediaElement.selectedSource.src).then(function(resolvedSrc){_this.mediaElement.selectedSource.setSrc(resolvedSrc);var firstTimePostfix=".firstTime";$(vid).bind('timeupdate'+firstTimePostfix,function(){if(_this.currentTime>=1){$(vid).unbind('timeupdate'+firstTimePostfix);vid.pause();vid.play();}});doPlay();});}else{doPlay();}},stop:function(){var _this=this;if(this.playerElement&&this.playerElement.currentTime){this.playerElement.pause();}this.parent_stop();},toggleMute:function(forceMute){this.parent_toggleMute(forceMute);this.getPlayerElement();if(this.playerElement)this.playerElement.muted=this.muted;},setPlayerElementVolume:function(percent){if(this.getPlayerElement()){this.playerElement.muted=(percent===0);this.playerElement.volume=percent;}},getPlayerElementVolume:function(){if(this.getPlayerElement()){return this.playerElement.volume;}},getPlayerElementMuted:function(){if(this.getPlayerElement()){return this.playerElement.muted;}},getNativeDuration:function(){if(this.playerElement){return this.playerElement.duration;}},load:function(callback){this.getPlayerElement();if(!this.playerElement){this.log('load() ... doEmbed');this.onlyLoadFlag=true;this.embedPlayerHTML();this.onLoadedCallback=callback;}else{this.playerElement.load();if(callback){callback();}}},getPlayerElement:function(){this.playerElement=$('#'+this.pid).get(0);return this.playerElement;},_onseeking:function(){var nua=navigator.userAgent;var is_native_android_browser=((nua.indexOf('Mozilla/5.0')>-1&&nua.indexOf('Android ')>-1&&nua.indexOf('AppleWebKit')>-1)&&!(nua.indexOf('Chrome')>-1));if(is_native_android_browser){return;}this.log("onSeeking "+this.seeking+' new time: '+this.getPlayerElement().currentTime);if(this.seeking&&Math.round(this.getPlayerElement().currentTime-this.currentSeekTargetTime)>2){this.log("Error: Seek time mismatch: target:"+this.getPlayerElement().currentTime+' actual '+this.currentSeekTargetTime+', note apple HLS can only seek to 10 second targets');}if(!this.seeking){this.currentSeekTargetTime=this.getPlayerElement().currentTime;this.seeking=true;this.layoutBuilder.onSeek();if(!this.isLive()||(this.isLive()&&this.isDVR())){this.log("seeking:trigger:: "+this.seeking);if(this._propagateEvents){this.triggerHelper('seeking');}}}else if(this.useNativePlayerControls()){this.currentSeekTargetTime=this.getPlayerElement().currentTime;}},_onseeked:function(){this.log("onSeeked "+this.seeking+' ct:'+this.playerElement.currentTime);if(this.seeking){var _this=this;this.waitForSeekTarget().then(function(){_this.seeking=false;_this.isFlavorSwitching=false;if(_this._propagateEvents){if(!_this.isLive()||(_this.isLive()&&_this.isDVR())){_this.log(" trigger: seeked");_this.triggerHelper('seeked',[_this.currentTime]);}}_this.hideSpinner();});}},waitForSeekTarget:function(deferred,callbackCount){this.log("wait for seek target verification");var _this=this;var vid=this.getPlayerElement();var waitForSeekTargetDeferred=deferred||$.Deferred();if((this.mediaElement.selectedSource.getMIMEType()==='application/vnd.apple.mpegurl')&&((Math.abs(this.currentSeekTargetTime-this.getPlayerElement().currentTime)>2)||(this.currentSeekTargetTime>0.01&&(mw.isIpad()&&!mw.isIOSAbove7())))){this.log("Error: seeked triggred with time mismatch: target:"+this.currentSeekTargetTime+' actual:'+this.getPlayerElement().currentTime);if(!callbackCount){callbackCount=0;}var canPlayBind='canplaythrough.nativePlayBind';$(vid).unbind(canPlayBind).one(canPlayBind,function(){if(vid.paused){_this.log("seek target verified");return waitForSeekTargetDeferred.resolve();}else{var timeupdateCallback=function(callbackCount){if((Math.abs(_this.currentSeekTargetTime-_this.getPlayerElement().currentTime)>2)&&callbackCount<=15){setTimeout(function(){timeupdateCallback(++callbackCount);},100);}else{if(callbackCount>15){_this.log("Error: seek target failed");}else{_this.log("seek target verified");}return waitForSeekTargetDeferred.resolve();}};var timeupdateBind='timeupdate.nativePlayBind';$(vid).unbind(timeupdateBind).one(timeupdateBind,function(){timeupdateCallback(0);});}});return waitForSeekTargetDeferred;}else{this.log("seek target verified");return waitForSeekTargetDeferred.resolve();}},_ondurationchange:function(event,data){if(this.playerElement&&!isNaN(this.playerElement.duration)&&isFinite(this.playerElement.duration)){this.setDuration(this.getPlayerElement().duration);return;}if(this.playerElement&&!isFinite(this.playerElement.duration)&&this.isLive()&&!this.isDVR()){this.setDuration(this.getPlayerElement().duration);}},_onpause:function(){var _this=this;this.playing=false;if(this.ignoreNextNativeEvent){this.ignoreNextNativeEvent=false;return;}var timeSincePlay=Math.abs(this.absoluteStartPlayTime-new Date().getTime());this.log(" OnPaused:: propagate:"+this._propagateEvents+' time since play: '+timeSincePlay+' duringSeek:'+this.seeking);if(!this.seeking&&!this.userSlide&&timeSincePlay>mw.getConfig('EmbedPlayer.MonitorRate')){_this.parent_pause();}else{this.getPlayerElement().play();}},_onplay:function(){this.log(" OnPlay:: propogate:"+this._propagateEvents+' paused: '+this.paused);if(this.useNativePlayerControls()&&$(this).find('video ').length==0){$(this).hide();}if(!this.ignoreNextNativeEvent&&this._propagateEvents&&this.paused&&(mw.getConfig('EmbedPlayer.EnableIpadHTMLControls')===true)){this.parent_play();}else{this.playInterfaceUpdate();this.absoluteStartPlayTime=new Date().getTime();}this.ignoreNextNativeEvent=false;if(mw.isIphone()){this.getInterface().removeClass("player-out");}this.monitor();},_onloadedmetadata:function(){this.getPlayerElement();if(!this.duration&&this.playerElement&&!isNaN(this.playerElement.duration)&&isFinite(this.playerElement.duration)){this.log('onloadedmetadata metadata ready Update duration:'+this.playerElement.duration+' old dur: '+this.getDuration());this.setDuration(this.playerElement.duration);}if(!this.paused&&!this.isInSequence()&&this._propagateEvents){this.getPlayerElement().play();}if(typeof this.onLoadedCallback=='function'){this.onLoadedCallback();}if(!this.mediaLoadedFlag){$(this).trigger('mediaLoaded');this.mediaLoadedFlag=true;}},_onprogress:function(event){var e=event.originalEvent;if(e&&e.loaded&&e.total){this.updateBufferStatus(e.loaded/e.total);this.progressEventData=e.loaded;}if(this.isLive()&&this.buffering){this.bufferEnd();}},_onended:function(event){var _this=this;if(this.getPlayerElement()){this.log('onended:'+this.playerElement.currentTime+' real dur:'+this.getDuration()+' ended '+this._propagateEvents);if(this._propagateEvents&&!this.isLive()){this.onClipDone();}}},_onerror:function(event){if(this.ignoreNextError){return;}var _this=this;setTimeout(function(){if(_this.triggerNetworkErrorsFlag){var data=[];if(event&&event.currentTarget&&event.currentTarget.error){data['errorCode']=event.currentTarget.error.code;_this.log('_onerror: MediaError code: '+data.errorCode);}}},100);},_onwaiting:function(){if(this.isLive()){this.bufferStart();}},_oncanplay:function(event){if(this.isLive()&&this.buffering){this.bufferEnd();}},onClipDone:function(){this.parent_onClipDone();if(mw.isIphone()&&!this.loop){$(this).trigger('onEndedDone');}if(!this._propagateEvents){return;}var _this=this;if(_this.isImagePlayScreen()&&!_this.isPlaylistScreen()){this.closeNativeFullScreen();}$(this).unbind('onEndedDone.onClipDone').bind('onEndedDone.onClipDone',function(){if(!_this.isImagePlayScreen()){_this.keepPlayerOffScreenFlag=false;}else{this.closeNativeFullScreen();}});},closeNativeFullScreen:function(){if(!mw.getConfig("EmbedPlayer.ForceNativeFullscreenOnClipDone")&&!this.keepNativeFullScreen){this.log('onClipDone: Exit full screen');this.getPlayerElement().webkitExitFullScreen();}},enableNativeControls:function(){$(this.getPlayerElement()).attr('controls',"true");},backToLive:function(){var _this=this;var vid=this.getPlayerElement();vid.load();vid.play();setTimeout(function(){_this.triggerHelper('movingBackToLive');},1000);},isVideoSiblingEnabled:function(){if(mw.isIphone()||mw.isAndroid2()||mw.isWindowsPhone()||mw.isAndroid40()||mw.isMobileChrome()||(mw.isIpad()&&!mw.isIpad3())){return false;}else{return this.parent_isVideoSiblingEnabled();}},playSegment:function(startTime,endTime){if(this.supportsURLTimeEncoding()){this.stop();var baseTimeOptions={'supportsURLTimeEncoding':true,'startTime':this.startTime,'endTime':this.pauseTime};var newSource=this.mediaElement.autoSelectSource(baseTimeOptions);if(newSource){this.switchSrc(newSource);}if(mw.isIOSAbove7()){this.play();}}else{this.pause();this.currentTime=0;this.addStartTimeCheck();if(this.canAutoPlay()){this.play();}}},setInline:function(state){this.getPlayerElement().attr('webkit-playsinline','');},parseTracks:function(){var vid=this.getPlayerElement();this.parseAudioTracks(vid,0);if(this.isLive()&&!this.isDVR()){this.parseTextTracks(vid,0);}},parseTextTracks:function(vid,counter){var _this=this;this.parseTextTracksTimeout=setTimeout(function(){if(vid.textTracks.length>0){for(var i=0;i<vid.textTracks.length;i++){if(vid.textTracks[i].kind==="metadata"){_this.id3Tag(vid.textTracks[i]);vid.textTracks[i].mode="hidden";}}}else{if(counter<10){_this.parseTextTracks(vid,++counter);}}},1000);},id3Tag:function(metadataTrack){var _this=this;metadataTrack.addEventListener("cuechange",function(evt){try{var id3Tag;if(mw.isEdge()){var id3TagData=String.fromCharCode.apply(null,new Uint8Array(evt.currentTarget.cues[evt.currentTarget.cues.length-1].data));var id3TagString=id3TagData.substring(id3TagData.indexOf("{"),id3TagData.lastIndexOf("}")+1);id3Tag=JSON.parse(id3TagString);}else{id3Tag=JSON.parse(evt.currentTarget.cues[evt.currentTarget.cues.length-1].value.data);}_this.triggerHelper('onId3Tag',id3Tag);}catch(e){mw.log("Native player :: id3Tag :: ERROR :: "+e);}},false);},parseAudioTracks:function(vid,counter){var _this=this;this.parseAudioTracksTimeout=setTimeout(function(){if(vid.audioTracks&&vid.audioTracks.length>0){var data={'languages':[]};for(var i=0;i<vid.audioTracks.length;i++){var audioTrack=vid.audioTracks[i];var label=audioTrack.label||audioTrack.language;if(label!==""){var lang={};lang.index=i;lang.label=label;data.languages.push(lang);}}if(data.languages.length>0){_this.triggerHelper('audioTracksReceived',data);}}else{if(counter<5){_this.parseAudioTracks(vid,++counter);}}},1000);},switchAudioTrack:function(audioTrackIndex){var vid=this.getPlayerElement();var audioTracks=vid.audioTracks;if(audioTracks&&audioTracks[audioTrackIndex]&&!audioTracks[audioTrackIndex].enabled){if(mw.isEdge()){var _this=this;var currentValue=this._propagateEvents;this._propagateEvents=false;vid.pause();this.addPlayerSpinner();audioTracks[audioTrackIndex].enabled=true;setTimeout(function(){vid.play();_this.hideSpinner();_this._propagateEvents=currentValue;},200);}else{audioTracks[audioTrackIndex].enabled=true;}}},getCurrentBufferLength:function(){if(this.playerElement.buffered.length>0){return parseInt(this.playerElement.buffered.end(this.playerElement.buffered.length-1)-this.playerElement.currentTime);}return 0;},clean:function(){this.removeBindings();clearTimeout(this.parseAudioTracksTimeout);clearTimeout(this.parseTextTracksTimeout);}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.EmbedPlayerNativeComponent",function($){(function(mw,$){"use strict";if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){$('body,.videoHolder').css('background-color','transparent');}mw.EmbedPlayerNativeComponent={instanceOf:'NativeComponent',bindPostfix:'.EmbedPlayerNativeComponent',onlyLoadFlag:false,onLoadedCallback:null,prevCurrentTime:-1,progressEventData:null,mediaLoadedFlag:null,keepPlayerOffScreenFlag:null,ignoreNextNativeEvent:null,currentSeekTargetTime:null,disableSwitchSourceCallback:false,playbackDone:false,playingSource:undefined,lastPlayPauseTime:0,nativeEvents:['stop','play','pause','canplay','seeking','seeked','ended','error','stalled','loadedmetadata','durationchange','timeupdate','progress','bufferchange','enterfullscreen','exitfullscreen','chromecastDeviceConnected','hideConnectingMessage','chromecastDeviceDisConnected','textTracksReceived','loadEmbeddedCaptions','flavorsListChanged','sourceSwitchingStarted','sourceSwitchingEnd','audioTracksReceived'],supports:{'playHead':true,'pause':true,'fullscreen':true,'SourceSelector':true,'timeDisplay':true,'volumeControl':false,'overlays':true},canPlay:function(callback){var deferred=$.Deferred();this.bindOnceHelper("canplay",function(){if(callback){callback();}deferred.resolve();});return deferred;},setup:function(readyCallback){var _this=this;mw.log("NativeComponent:: setup");$('#'+this.pid).remove();var divElement=document.createElement("div");divElement.setAttribute('id','proxy');divElement['paused']=true;document.body.appendChild(divElement);this.proxyElement=divElement;try{if(NativeBridge.videoPlayer){NativeBridge.videoPlayer.registerPlayer(this.getPlayerElement());NativeBridge.videoPlayer.registerEmbedPlayer(this);}}catch(e){alert(e);}this.canPlayPromise=this.canPlay(readyCallback);this.applyMediaElementBindings();this.bindHelper("layoutBuildDone ended",function(){_this.getPlayerElement().notifyLayoutReady();});this.bindHelper("showChromecastDeviceList",function(){mw.log("EmbedPlayerNativeComponent:: showChromecastDeviceList::");_this.getPlayerElement().showChromecastDeviceList();});this.bindHelper("sendCCRecieverMessage",function(e,msg){mw.log("EmbedPlayerNativeComponent:: sendCCRecieverMessage::");_this.getPlayerElement().sendCCRecieverMessage(msg);});this.bindHelper("onEndedDone",function(){_this.playbackDone=true;});if(this.startTime&&!this.supportsURLTimeEncoding()){this.setStartTimeAttribute(this.startTime);}var selectedSource=this.getSrc();if(!selectedSource&&mw.getConfig("EmbedPlayer.PreloadNativeComponent")){readyCallback();}else{this.resolveSrcURL(selectedSource).then(function(resolvedSrc){mw.log("EmbedPlayerNativeComponent::resolveSrcURL get succeeded");_this.setSrcAttribute(resolvedSrc);},function(){mw.log("EmbedPlayerNativeComponent::resolveSrcURL get failed");_this.setSrcAttribute(selectedSource);});}},embedPlayerHTML:function(){},buildUdrmLicenseUri:function(mimeType){var licenseServer=mw.getConfig('Kaltura.UdrmServerURL');var licenseParams=this.mediaElement.getLicenseUriComponent();var licenseUri=null;if(licenseServer&&licenseParams){switch(mimeType){case"video/wvm":licenseUri=licenseServer+"/widevine/license?"+licenseParams;break;case"application/dash+xml":licenseUri=licenseServer+"/cenc/widevine/license?"+licenseParams;break;case"application/vnd.apple.mpegurl":licenseUri=licenseServer+"/fps/license?"+licenseParams;break;default:break;}}return licenseUri;},pushLicenseUri:function(){var selectedSource=this.mediaElement.selectedSource;if(!selectedSource){return;}var mimeType=selectedSource.mimeType;var overrideDrmServerURL=mw.getConfig('Kaltura.overrideDrmServerURL');var licenseUri=overrideDrmServerURL?overrideDrmServerURL:this.buildUdrmLicenseUri(mimeType);if(licenseUri){var playerElement=this.getPlayerElement();playerElement.attr('licenseUri',licenseUri);if(selectedSource.fpsCertificate){playerElement.attr('fpsCertificate',selectedSource.fpsCertificate);}}},addStartTimeCheck:function(){},setSrcAttribute:function(source){this.getPlayerElement().attr('src',source);this.playingSource=source;this.pushLicenseUri();},setStartTimeAttribute:function(startTime){this.getPlayerElement().attr('startTime',startTime);this.pushLicenseUri();},playerSwitchSource:function(source,switchCallback,doneCallback){mw.log("NativeComponent:: playerSwitchSource");var _this=this;var vid=this.getPlayerElement();var src=source.getSrc();var switchBindPostfix='.playerSwitchSource';if(!src||src==this.playingSource){if($.isFunction(switchCallback)){switchCallback(vid);}if($.isFunction(doneCallback)){doneCallback();}return;}var switchCallbackCalled=false;var switchCallbackWrapper=function(){if(!switchCallbackCalled){switchCallbackCalled=true;switchCallback();}};this.canPlayPromise=this.canPlay(switchCallbackWrapper);$(vid).unbind(switchBindPostfix);_this.addPlayerSpinner();$(vid).empty();this.setSrcAttribute(src);this.isPauseLoading=false;this.currentTime=0;this.previousTime=0;if($.isFunction(switchCallback)){$(vid).bind('durationchange'+switchBindPostfix,function(){$(vid).unbind('durationchange'+switchBindPostfix);switchCallbackWrapper();});}if($.isFunction(doneCallback)){$(vid).bind('ended'+switchBindPostfix,function(event){_this.currentTime=0;_this.previousTime=0;if(_this.disableSwitchSourceCallback){return;}$(vid).unbind(switchBindPostfix);doneCallback();return false;});}},changeMediaCallback:function(callback){var _this=this;_this.switchPlaySource(this.getSource(),function(){if(!_this.autoplay){mw.log("AutoPlay = false in Mobile");_this.ignoreNextNativeEvent=true;if(!_this.playlist){_this.pause();}_this.updatePosterHTML();}if(_this.autoplay&&mw.isMobileDevice()&&!_this.casting){mw.log("Autoplay = true in Mobile");_this.play();_this.updatePosterHTML();}callback();});},applyMediaElementBindings:function(){var _this=this;mw.log("EmbedPlayerNative::MediaElementBindings");var bindPostfix='.embedPlayerNativeComponent';$.each(_this.nativeEvents,function(inx,eventName){$(_this.getPlayerElement()).unbind(eventName+bindPostfix).bind(eventName+bindPostfix,function(){if(_this._propagateEvents&&_this.instanceOf=='NativeComponent'){var argArray=$.makeArray(arguments);if(_this['_on'+eventName]){_this['_on'+eventName].apply(_this,argArray);}else{$(_this).trigger(eventName,argArray);}}});});},getPlayerElementTime:function(){var _this=this;if(!this.getPlayerElement()){mw.log('EmbedPlayerNative::getPlayerElementTime: '+this.id+' not in dom ( stop monitor)');this.stop();return false;}var ct=this.getPlayerElement().attr('currentTime');if(!ct||isNaN(ct)||ct<0||!isFinite(ct)){return 0;}return ct;},getPlayerElement:function(){return this.proxyElement;},stop:function(){var _this=this;if(this.playerElement&&this.playerElement.currentTime){this.playerElement.pause();}this.parent_stop();},play:function(){var _this=this;mw.log("EmbedPlayerNativeComponent:: play::");this.playbackDone=false;this.unbindHelper('replayEvent').bindHelper('replayEvent',function(){this.getPlayerElement().replay();});var doPlay=function(){if(_this.parent_play()||_this.casting){if(_this.getPlayerElement()){_this.getPlayerElement().play();}_this.monitor();}_this.removePoster();}
this.canPlayPromise.then(function(){doPlay();});},pause:function(){mw.log("EmbedPlayerNativeComponent:: pause::");if(this.paused===false){this.stopPlayAfterSeek=true;this.stopAfterSeek=true;}this.parent_pause();if(this.getPlayerElement()){this.getPlayerElement().pause();}},doSeek:function(seekTime){mw.log("EmbedPlayerNativeComponent:: seek::");this.getPlayerElement().attr('currentTime',seekTime);},seek:function(seekTime,stopAfterSeek){if(seekTime===0){seekTime=0.01;}this.parent_seek(seekTime,stopAfterSeek);},setCurrentTime:function(seekTime,callback){seekTime=parseFloat(seekTime);mw.log("EmbedPlayerNativeComponent:: setCurrentTime to "+seekTime);if(seekTime===0){seekTime=0.01;}this.getPlayerElement().attr('currentTime',seekTime);if($.isFunction(callback)){callback();}},backToLive:function(){this.triggerHelper('movingBackToLive');this.getPlayerElement().attr('goLive','true');},doNativeAction:function(actionParams){mw.log("EmbedPlayerNativeComponent:: doNativeAction::");this.getPlayerElement().attr('nativeAction',actionParams);this.getPlayerElement().doNativeAction();},isNativeApp:function(){return mw.getConfig("EmbedPlayer.ForceNativeComponent");},canAutoPlay:function(){return true;},_onflavorsListChanged:function(event,data){var _this=this;var flavorsList=[];$.each(data.tracks,function(idx,obj){var flavor={assetid:obj.assetid,originalIndex:obj.originalIndex,bandwidth:obj.bandwidth,height:obj.height,width:obj.width,type:"video/mp4"};flavorsList.push(flavor);});setTimeout(function(){_this.setKDPAttribute('sourceSelector','visible',true);},100);this.onFlavorsListChanged(flavorsList);},_onsourceSwitchingStarted:function(event,data){$(this).trigger('sourceSwitchingStarted',data);},_onsourceSwitchingEnd:function(event,data){$(this).trigger('sourceSwitchingEnd',data);},_onloadEmbeddedCaptions:function(event,data){this.triggerHelper('onTextData',data);var caption={source:{srclang:data.language},capId:data.trackid,caption:{content:data.text}};this.triggerHelper('onEmbeddedData',caption);},_ondurationchange:function(){mw.log("EmbedPlayerNativeComponent:: onDurationChange::"+this.getPlayerElement().duration)
this.playerElement=this.getPlayerElement();if(this.playerElement&&!isNaN(this.playerElement.duration)&&isFinite(this.playerElement.duration)){this.setDuration(this.getPlayerElement().duration);}},_onplay:function(){mw.log("EmbedPlayerNativeComponent:: OnPlay::");this.removePoster();this.hideSpinner();$(this).trigger("playing");if(this.paused&&this.parent_play()){this.monitor();}else{this.playInterfaceUpdate();}},_onpause:function(){mw.log("EmbedPlayerNativeComponent:: OnPause::");this.parent_pause();},_onseeking:function(){mw.log("EmbedPlayerNative::onSeeking ");if(!this.seeking){this.seeking=true;this.layoutBuilder.onSeek();if(this._propagateEvents){mw.log("EmbedPlayerNative::seeking:trigger:: ");this.triggerHelper('seeking');}}},_onseeked:function(){if(this.seeking){if(this._propagateEvents){mw.log("EmbedPlayerNativeComponent:: trigger: seeked");this.triggerHelper('seeked');}}},_onloadedmetadata:function(){if(typeof this.onLoadedCallback=='function'){this.onLoadedCallback();}if(!this.mediaLoadedFlag){$(this).trigger('mediaLoaded');this.mediaLoadedFlag=true;}},_onended:function(event){if(this.getPlayerElement()){mw.log('EmbedPlayer:nativeComponent: onended:');if(this._propagateEvents&&!this.isLive()){this.onClipDone();}}},onClipDone:function(){mw.log('EmbedPlayer:native: oneClipDone:');this.parent_onClipDone();},_onerror:function(event,data){this.triggerHelper('embedPlayerError',data);},_onbufferchange:function(event,isBuffering){if(isBuffering==="true"){this.bufferStart();}else{this.bufferEnd();}},_onprogress:function(event,progress){if(typeof progress!=='undefined'){this.updateBufferStatus(progress);if(!this.seeking){this.updatePlayHead(progress);}if(progress<0.9){if(!this.showProgressSpinner){this.addPlayerSpinner();this.showProgressSpinner=true;}}else{this.showProgressSpinner=false;this.hideSpinner();}}},_onaudioTracksReceived:function(event,data){var _this=this;this.unbindHelper('switchAudioTrack').bindHelper('switchAudioTrack',function(event,selection){_this.getPlayerElement().attr('audioTrackSelected',selection.index.toString());});this.triggerHelper("audioTracksReceived",data);},_ontextTracksReceived:function(event,data){var _this=this;this.unbindHelper('selectClosedCaptions').bindHelper('selectClosedCaptions',function(event,selection){_this.getPlayerElement().attr('textTrackSelected',selection);});this.triggerHelper('textTracksReceived',data);},getVideoElementPosition:function(){var videoElementDiv=parent.document.getElementById(this.id);var videoElementRect=videoElementDiv.getBoundingClientRect();return videoElementRect;},showNativePlayer:function(){this.getPlayerElement().showNativePlayer();},hideNativePlayer:function(){this.getPlayerElement().hideNativePlayer();},useNativePlayerControls:function(){return false;},toggleFullscreen:function(){this.parent_toggleFullscreen();this.getPlayerElement().toggleFullscreen();},doneFSBtnPressed:function(){this.getPlayerElement().doneFSBtnPressed();},addNativeAirPlayButton:function(){this.getPlayerElement().addNativeAirPlayButton();},showNativeAirPlayButton:function(airPlayBtnPosition){var x=airPlayBtnPosition.left;var y=airPlayBtnPosition.top;var w=airPlayBtnPosition.right-airPlayBtnPosition.left;var h=airPlayBtnPosition.bottom-airPlayBtnPosition.top;this.getPlayerElement().showNativeAirPlayButton([x,y,w,h]);},togglePictureInPicture:function(){this.getPlayerElement().togglePictureInPicture();},hideNativeAirPlayButton:function(){this.getPlayerElement().hideNativeAirPlayButton();},isVideoSiblingEnabled:function(){return true;},isPlaying:function(){if(this.stopped||this.paused||this.getPlayerElement().paused){return false;}return true;},switchSrc:function(source){var sourceIndex=(source===-1)?-1:source.assetid;this.getPlayerElement().switchFlavor(sourceIndex);},checkClipDoneCondition:function(){if(mw.isAndroid()){this.parent_checkClipDoneCondition();}}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.EmbedTypes",function($){(function(mw,$){"use strict";var nativeComponentPlayerVideo=new mw.MediaPlayer('nativeComponentPlayer',window.kNativeSdk&&window.kNativeSdk.allFormats,'NativeComponent');var kplayer=new mw.MediaPlayer('kplayer',['video/live','video/kontiki','video/x-flv','video/h264','video/mp4','audio/mpeg','application/x-shockwave-flash','application/vnd.apple.mpegurl'],'Kplayer');var splayer=new mw.MediaPlayer('splayer',['video/playreadySmooth','video/ism','video/multicast','video/h264','video/mp4'],'Silverlight');var oggNativePlayer=new mw.MediaPlayer('oggNative',['video/ogg','audio/ogg','application/ogg'],'Native');var h264NativePlayer=new mw.MediaPlayer('h264Native',['video/h264','video/mp4'],'Native');var appleVdnPlayer=new mw.MediaPlayer('appleVdn',['application/vnd.apple.mpegurl'],'Native');var wvmPlayer=new mw.MediaPlayer('wvmNative',['video/wvm'],'Native');var mp3NativePlayer=new mw.MediaPlayer('mp3Native',['audio/mpeg','audio/mp3'],'Native');var webmNativePlayer=new mw.MediaPlayer('webmNative',['video/webm'],'Native');var imageOverlayPlayer=new mw.MediaPlayer('imageOverlay',['image/jpeg','image/png'],'ImageOverlay');mw.EmbedTypes={mediaPlayers:null,detect_done:false,init:function(){this.detect();this.detect_done=true;},getMediaPlayers:function(){if(this.mediaPlayers){return this.mediaPlayers;}this.mediaPlayers=new mw.MediaPlayers();this.detectPlayers();return this.mediaPlayers;},getNativeComponentPlayerVideo:function(){return nativeComponentPlayerVideo;},getNativeImageOverlayPlayer:function(){return imageOverlayPlayer;},supportedMimeType:function(mimeType){for(var i=0;i<navigator.plugins.length;i++){var plugin=navigator.plugins[i];if(typeof plugin[mimeType]!="undefined"){return true;}}return false;},addFlashPlayer:function(){if(!mw.getConfig('EmbedPlayer.DisableHTML5FlashFallback')){this.mediaPlayers.addPlayer(kplayer);}},addSilverlightPlayer:function(){this.mediaPlayers.addPlayer(splayer);},addNativeComponentPlayer:function(){this.mediaPlayers.addPlayer(nativeComponentPlayerVideo);},detectPlayers:function(){mw.log("EmbedTypes::detectPlayers running detect");this.mediaPlayers.addPlayer(imageOverlayPlayer);try{var javaEnabled=navigator.javaEnabled();}catch(e){}if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){this.addNativeComponentPlayer();}if(mw.supportsFlash()){this.addFlashPlayer();}if(mw.supportSilverlight()){this.addSilverlightPlayer();}if(!mw.getConfig('EmbedPlayer.DisableVideoTagSupport')&&(typeof HTMLVideoElement=='object'||typeof HTMLVideoElement=='function')){try{var dummyvid=document.createElement("video");if(dummyvid.canPlayType){if(dummyvid.canPlayType('video/webm; codecs="vp8, vorbis"')&&!mw.isAndroid40()){this.mediaPlayers.addPlayer(webmNativePlayer);}if(this.supportedMimeType('audio/mpeg')||dummyvid.canPlayType('audio/mpeg; codecs="mp3"')){this.mediaPlayers.addPlayer(mp3NativePlayer);}if(dummyvid.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')){this.mediaPlayers.addPlayer(h264NativePlayer);if(dummyvid.canPlayType('application/vnd.apple.mpegurl; codecs="avc1.42E01E"')||mw.isAndroid4andUp()){if(navigator.userAgent.indexOf('Android 3.')==-1){this.mediaPlayers.addPlayer(appleVdnPlayer);}}}if(mw.isAndroid2()){this.mediaPlayers.addPlayer(h264NativePlayer);}if(dummyvid.canPlayType('video/ogg; codecs="theora,vorbis"')){this.mediaPlayers.addPlayer(oggNativePlayer);}else if(this.supportedMimeType('video/ogg')){this.mediaPlayers.addPlayer(oggNativePlayer);}if(mw.isIOS()||mw.isAndroid4andUp()){this.mediaPlayers.addPlayer(wvmPlayer);}}}catch(e){mw.log('could not run canPlayType '+e);}}if(navigator.mimeTypes&&navigator.mimeTypes.length>0){for(var i=0;i<navigator.mimeTypes.length;i++){var type=navigator.mimeTypes[i].type;var semicolonPos=type.indexOf(';');if(semicolonPos>-1){type=type.substr(0,semicolonPos);}var pluginName=navigator.mimeTypes[i].enabledPlugin?navigator.mimeTypes[i].enabledPlugin.name:'';if(!pluginName){pluginName='';}if((type=='video/mpeg'||type=='video/x-msvideo')){}if(type=='application/ogg'){continue;}}}mw.log("EmbedPlayer::trigger:EmbedPlayerUpdateMediaPlayers");$(mw).trigger('EmbedPlayerUpdateMediaPlayers',this.mediaPlayers);},testActiveX:function(name){mw.log("EmbedPlayer::detect: test testActiveX: "+name);var hasObj=true;try{var obj=new ActiveXObject(''+name);}catch(e){hasObj=false;}return hasObj;},getKplayer:function(){return kplayer;},getSilverlightPlayer:function(){return splayer;}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.KAnalytics",function($){(function(mw,$){"use strict";window['Kaltura']=true;mw.KAnalytics=function(embedPlayer){this.init(embedPlayer);};mw.addKAnalytics=function(embedPlayer){embedPlayer.kAnalytics=new mw.KAnalytics(embedPlayer);}
mw.KAnalytics.prototype={embedPlayer:null,reportSet:null,lastSeekEventTime:0,bindPostFix:'.kAnalytics',startReportTime:0,delay:0,histroyEvent:{},histroyEventCount:{},kEventTypes:{'WIDGET_LOADED':1,'MEDIA_LOADED':2,'PLAY':3,'PLAY_REACHED_25':4,'PLAY_REACHED_50':5,'PLAY_REACHED_75':6,'PLAY_REACHED_100':7,'OPEN_EDIT':8,'OPEN_VIRAL':9,'OPEN_DOWNLOAD':10,'OPEN_REPORT':11,'BUFFER_START':12,'BUFFER_END':13,'OPEN_FULL_SCREEN':14,'CLOSE_FULL_SCREEN':15,'REPLAY':16,'SEEK':17,'OPEN_UPLOAD':18,'SAVE_PUBLISH':19,'CLOSE_EDITOR':20,'PRE_BUMPER_PLAYED':21,'POST_BUMPER_PLAYED':22,'BUMPER_CLICKED':23,'FUTURE_USE_1':24,'FUTURE_USE_2':25,'FUTURE_USE_3':26},init:function(embedPlayer){var _this=this;this.version=mw.getConfig('version');if(!mw.KAnalytics.totalEventCount){mw.KAnalytics.totalEventCount=0;}this.embedPlayer=embedPlayer;if(!this.kClient){this.kClient=mw.kApiGetPartnerClient(embedPlayer.kwidgetid);this.delay=this.embedPlayer.getKalturaConfig('statistics','delay')?this.embedPlayer.getKalturaConfig('statistics','delay')*1000:0;}$(embedPlayer).unbind(this.bindPostFix);$(embedPlayer).bind('playerReady'+this.bindPostFix,function(){_this.resetPlayerflags();});$(embedPlayer).bind('changeMedia'+this.bindPostFix,function(){_this.histroyEvent={};_this.histroyEventCount={};});this.bindPlayerEvents();},resetPlayerflags:function(){this._p25Once=false;this._p50Once=false;this._p75Once=false;this._p100Once=false;this.hasSeeked=false;this.lastSeek=0;},sendAnalyticsEvent:function(KalturaStatsEventKey){var _this=this;mw.log("KAnalytics :: doSendAnalyticsEvent > "+KalturaStatsEventKey);if(this.embedPlayer.evaluate('{sequenceProxy.isInSequence}')){return;}var eventKeyId=this.kEventTypes[KalturaStatsEventKey];var eventSet={'eventType':eventKeyId,'clientVer':this.version,'currentPoint':parseInt(this.embedPlayer.currentTime*1000),'duration':this.embedPlayer.getDuration(),'eventTimestamp':new Date().getTime(),'isFirstInSession':'false','objectType':'KalturaStatsEvent','partnerId':this.embedPlayer.kpartnerid,'sessionId':this.embedPlayer.evaluate('{configProxy.sessionId}'),'uiconfId':0};if(isNaN(eventSet.duration)){eventSet.duration=0;}eventSet['seek']=(this.hasSeeked)?'true':'false';if(this.embedPlayer.kentryid){eventSet['entryId']=this.embedPlayer.kentryid;}else{eventSet['entryId']=this.embedPlayer.getSrc();}if(this.histroyEvent[eventSet['entryId']]==null){this.histroyEvent[eventSet['entryId']]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];}if(this.histroyEventCount[eventSet['entryId']]==null){this.histroyEventCount[eventSet['entryId']]=0;}this.histroyEvent[eventSet['entryId']][eventKeyId-1]=1;this.histroyEventCount[eventSet['entryId']]++;mw.KAnalytics.totalEventCount++;eventSet['historyEvents']=this.histroyEvent[eventSet['entryId']].join('')+'-'+this.histroyEventCount[eventSet['entryId']]+'-'+mw.KAnalytics.totalEventCount;if(this.embedPlayer.kuiconfid){eventSet['uiconfId']=this.embedPlayer.kuiconfid;}if(this.embedPlayer.kwidgetid){eventSet['widgetId']=this.embedPlayer.kwidgetid;}var flashVarEvents={'playbackContext':'contextId','originFeature':'featureType','applicationName':'applicationId','userId':'userId'}
for(var fvKey in flashVarEvents){if(this.embedPlayer.getKalturaConfig('',fvKey)){eventSet[flashVarEvents[fvKey]]=encodeURIComponent(this.embedPlayer.getKalturaConfig('',fvKey));}}for(var fvKey in flashVarEvents){if(this.embedPlayer.getKalturaConfig('statistics',fvKey)){eventSet[flashVarEvents[fvKey]]=encodeURIComponent(this.embedPlayer.getKalturaConfig('statistics',fvKey));}}if(this.embedPlayer.getKalturaConfig('statistics','hideUserId')&&eventSet.userId){delete(eventSet.userId);}var pageReferrer=mw.getConfig('EmbedPlayer.IsFriendlyIframe')?mw.getConfig('EmbedPlayer.IframeParentUrl'):document.referrer;eventSet['referrer']=encodeURIComponent(pageReferrer);var eventRequest={'service':'stats','action':'collect'};for(var i in eventSet){eventRequest['event:'+i]=eventSet[i];}$(this.embedPlayer).trigger('KalturaSendAnalyticEvent',[KalturaStatsEventKey,eventSet]);var parentTrackName=this.embedPlayer.getKalturaConfig('statistics','trackEventMonitor');if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){try{if(window.parent[parentTrackName]){window.parent[parentTrackName](KalturaStatsEventKey,eventSet);}}catch(e){}}if(this.embedPlayer.getFlashvars('ks')&&!this.embedPlayer.getKalturaConfig('statistics','hideKs')){eventRequest['ks']=this.embedPlayer.getFlashvars('ks');}if(this.delay){setTimeout(function(){_this.kClient.doRequest(eventRequest,null,true);},this.delay);}else{this.kClient.doRequest(eventRequest,null,true);}},bindPlayerEvents:function(){var embedPlayer=this.embedPlayer;var _this=this;var b=function(hookName,eventType){$(_this.embedPlayer).bind(hookName+_this.bindPostFix,function(){_this.sendAnalyticsEvent(eventType);});};b('widgetLoaded','WIDGET_LOADED');b('KalturaSupport_EntryDataReady','MEDIA_LOADED');b('firstPlay','PLAY');b('showShareEvent','OPEN_VIRAL');b('downloadMedia','OPEN_DOWNLOAD');b('bufferStartEvent','BUFFER_START');b('bufferEndEvent','BUFFER_END');b('onOpenFullScreen','OPEN_FULL_SCREEN');b('onCloseFullScreen','CLOSE_FULL_SCREEN');b('replayEvent','REPLAY');$(embedPlayer).bind('seeked'+this.bindPostFix,function(seekTarget){if(_this.lastSeekEventTime==0||_this.lastSeekEventTime+2000<new Date().getTime()){_this.sendAnalyticsEvent('SEEK');}_this.lastSeekEventTime=new Date().getTime();this.hasSeeked=true;this.lastSeek=seekTarget;});$(embedPlayer).bind('monitorEvent'+this.bindPostFix,function(){_this.updateTimeStats();});},updateTimeStats:function(){var embedPlayer=this.embedPlayer;var _this=this;var percent=embedPlayer.currentTime/embedPlayer.duration;var seekPercent=this.lastSeek/embedPlayer.duration;if(!embedPlayer.isLive()){if(!_this._p25Once&&percent>=.25&&seekPercent<=.25){_this._p25Once=true;_this.sendAnalyticsEvent('PLAY_REACHED_25');$(embedPlayer).trigger("firstQuartile");}else if(!_this._p50Once&&percent>=.50&&seekPercent<.50){_this._p50Once=true;_this.sendAnalyticsEvent('PLAY_REACHED_50');$(embedPlayer).trigger("secondQuartile");}else if(!_this._p75Once&&percent>=.75&&seekPercent<.75){_this._p75Once=true;_this.sendAnalyticsEvent('PLAY_REACHED_75');$(embedPlayer).trigger("thirdQuartile");}else if(!_this._p100Once&&percent>=.98&&seekPercent<1){_this._p100Once=true;_this.sendAnalyticsEvent('PLAY_REACHED_100');}}}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KBaseComponent",function($){(function(mw,$){"use strict";mw.KBaseComponent=mw.KBasePlugin.extend({getBaseConfig:function(){return{'visible':true,'disableable':true,'showTooltip':false,'accessibilityLabels':true,'hideWhenEmpty':false};},setDefaults:function(){if($.isPlainObject(this.defaultConfig)){var obj=$.extend({},this.getBaseConfig(),this.defaultConfig);this._super(obj);}else{this._super(this.getBaseConfig());}},init:function(embedPlayer,callback,pluginName){if(this._super(embedPlayer,callback,pluginName)===false){return;}if(!this.componentType){this.componentType=pluginName;}this._addBindings();if(this.getConfig('hideWhenEmpty')==true){this.setConfig('visible',false)}},_addBindings:function(){var _this=this;if($.isFunction(this.getComponent)){this.addComponent();}if($.isFunction(this.onEnable)){this.bindEnableComponent();}if($.isFunction(this.onDisable)){this.bindDisableComponent();}if($.isFunction(this.getMenu)){this.bindFocusOutPlayer();}this.bind('layoutBuildDone',function(){if(!_this.getConfig('visible')){_this.hide();}});this.bindShowComponent();this.bindHideComponent();},addComponent:function(){var _this=this;this.bind('addLayoutComponent',function(e,layoutBuilder){layoutBuilder.components[_this.pluginName]={'parent':_this.getConfig('parent'),'order':_this.getConfig('order'),'insertMode':_this.getConfig('insertMode'),'o':function(){_this.enableTooltip();return _this.getComponent().attr({'data-order':_this.getConfig('order'),'data-plugin-name':_this.pluginName});}};});},onEnable:function(){this.isDisabled=false;this.getComponent().removeClass('disabled');},onDisable:function(){this.isDisabled=true;this.getComponent().addClass('disabled');},bindShowComponent:function(){var _this=this;this.bind('onShowInterfaceComponents',function(event,includedComponents){if($.inArray(_this.componentType,includedComponents)!=-1){_this.show();}});},bindHideComponent:function(){var _this=this;this.bind('onHideInterfaceComponents',function(event,includedComponents){if($.inArray(_this.componentType,includedComponents)!=-1){_this.hide();}});},bindEnableComponent:function(){var _this=this;this.bind('onEnableInterfaceComponents',function(event,excludedComponents){if($.inArray(_this.componentType,excludedComponents)==-1&&_this.getConfig('disableable')){_this.onEnable();}});},bindDisableComponent:function(){var _this=this;this.bind('onDisableInterfaceComponents',function(event,excludedComponents){if($.inArray(_this.componentType,excludedComponents)==-1&&_this.getConfig('disableable')){_this.onDisable();}});},bindFocusOutPlayer:function(){var _this=this;this.bind('onFocusOutOfIframe',function(){_this.getMenu().close();});},onConfigChange:function(property,value){switch(property){case'visible':if(value){this.show();}else{this.hide();}break;}},show:function(){this.getComponent().removeData('forceHide').show();},hide:function(){this.getComponent().data('forceHide',true).hide();},getCssClass:function(){var cssClass=' comp '+this.pluginName+' ';switch(this.getConfig('align')){case'right':cssClass+=" pull-right";break;case'left':cssClass+=" pull-left";break;}if(this.getConfig('cssClass')){cssClass+=' '+this.getConfig('cssClass');}if(this.getConfig('displayImportance')){var importance=this.getConfig('displayImportance').toLowerCase();if($.inArray(importance,['low','medium','high'])!==-1){cssClass+=' display-'+importance;}}return cssClass;},getBtn:function(){return this.getComponent();},enableTooltip:function(){if(this.getConfig('showTooltip')&&this.getBtn().length){var parentContainer=this.getConfig('parent');this.getBtn().each(function(){$(this).attr('data-show-tooltip',true);if(parentContainer=="topBarContainer"){$(this).addClass('tooltipBelow');}});}else{this.getBtn().each(function(){$(this).removeAttr("title");});}},updateTooltip:function(text){if(this.getConfig('showTooltip')&&this.getBtn().length){var tooltipId=this.getBtn().attr("aria-describedby");if(tooltipId){$('#'+tooltipId+' .ui-tooltip-content').html(text);}this.getBtn().data('ui-tooltip-title',text);this.getBtn().attr('title',text);}},setAccessibility:function(btn,label){if(this.getConfig('accessibilityLabels')){btn.html('<span class="accessibilityLabel">'+label+'</span>');}},destroy:function(){this._super();this.getComponent().remove();},getComponent:function(){mw.log("Error - you must implement getComponent in your plugin:"+this.componentType)
return $('<div></div>');}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KBasePlugin",function($){(function(mw,$){"use strict";mw.KBasePlugin=Class.extend({asyncInit:false,init:function(embedPlayer,callback,pluginName){this.embedPlayer=embedPlayer;this.initCompleteCallback=callback;this.pluginName=pluginName;this.safe=true;this.bindPostFix='.'+pluginName;this.setDefaults();var safeEnviornment=this.isSafeEnviornment();var _this=this;if(typeof safeEnviornment=='object'&&safeEnviornment.promise){safeEnviornment.done(function(isSafe){if(!isSafe){_this.safe=false;_this.destroy();}});}else if(typeof safeEnviornment=='boolean'&&!safeEnviornment){this.safe=false;this.initCompleteCallback();return false;}this.bindConfigChangeEvent();this.setup();if(this.asyncInit===false){this.initCompleteCallback();}return this;},setDefaults:function(obj){obj=obj||this.defaultConfig;var _this=this;if($.isPlainObject(obj)){$.each(obj,function(key,value){if(_this.getConfig(key)===undefined){_this.setConfig(key,value,true);}});}},isSafeEnviornment:function(){return true;},setup:function(){},getPlayer:function(){return this.embedPlayer;},getConfig:function(attr,raw){if(raw){return this.embedPlayer.getRawKalturaConfig(this.pluginName,attr);}return this.embedPlayer.getKalturaConfig(this.pluginName,attr);},setConfig:function(attr,value,quiet){this.embedPlayer.setKalturaConfig(this.pluginName,attr,value,quiet);},getTemplateHTML:function(data){var _this=this;data=data||{};data.self=this;data.player=this.embedPlayer;data.entry=this.embedPlayer.kalturaPlayerMetaData;data.entryMetadata=this.embedPlayer.kalturaEntryMetaData;data.formaters=mw.util.formaters().getAll();var defer=$.Deferred();var parseTemplate=function(rawHTML){var transformedHTML=mw.util.tmpl(rawHTML);transformedHTML=transformedHTML(data);var evaluatedHTML=$.trim(_this.embedPlayer.evaluate(transformedHTML));var $templateHtml=$('<span class="tmpl">'+evaluatedHTML+'</span>');$templateHtml.find('[data-click],[data-notification]').click(function(e){var data=$(this).data();return _this.handleClick(e,data);});$templateHtml.find('[data-submit]').submit(function(e){var cb=$(this).data('submit');if($.isFunction(_this[cb])){_this[cb](e);}return false;});defer.resolve($templateHtml);}
var rawHTML=this.getConfig('template',true);if(!rawHTML){var templatePath=this.getConfig('templatePath');if(!window.kalturaIframePackageData.templates[templatePath]){this.log('getTemplateHTML:: Template not found in payload - trying async loading');if(templatePath&&templatePath.indexOf("http")===0){$.ajax({url:templatePath}).done(function(data){window.kalturaIframePackageData.templates[templatePath]=rawHTML=data;parseTemplate(rawHTML);}).fail(function(data){defer.reject("mw.KBasePlugin::Error occur when trying to load external template from: "+templatePath);});}else{defer.reject("mw.KBasePlugin::Could not load external template: "+templatePath+". Must be a full url starting with http.");}}else{rawHTML=window.kalturaIframePackageData.templates[templatePath];parseTemplate(rawHTML);}}else{parseTemplate(rawHTML);}return defer;},getTemplatePartialHTML:function(partialName,settings){var rawHTML=this.getConfig('template',true);if(!rawHTML){if(!partialName||!window.kalturaIframePackageData.templates[partialName]){this.log('getTemplateHTML:: Template not found');return'';}rawHTML=window.kalturaIframePackageData.templates[partialName];}var transformedHTML=mw.util.tmpl(rawHTML,settings);return transformedHTML;},handleClick:function(e,data){e.preventDefault();if(data.click&&$.isFunction(this[data.click])){this[data.click](e,data);}if(data.notification){this.getPlayer().sendNotification(data.notification,data);}return false;},once:function(eventName,callback){return this.bind(eventName,callback,true);},bind:function(eventName,callback,once){var bindEventsString='',events=eventName.split(" "),totalEvents=events.length,i=0,space=' ';for(i;i<totalEvents;i++){if(i==(totalEvents-1)){space='';}bindEventsString+=events[i]+this.bindPostFix+space;}if(once){return this.embedPlayer.bindOnceHelper(bindEventsString,callback);}return this.embedPlayer.bindHelper(bindEventsString,callback);},unbind:function(eventName){var fullEventName=eventName+this.bindPostFix;if(eventName===null||eventName===undefined){fullEventName=this.bindPostFix;}return this.embedPlayer.unbindHelper(fullEventName);},log:function(msg){mw.log(this.pluginName+'::'+msg);},bindConfigChangeEvent:function(){var _this=this;if(typeof this.onConfigChange!=='function'){return;}this.bind('Kaltura_ConfigChanged',function(event,pluginName,property,value){if(pluginName===_this.pluginName){_this.onConfigChange(property,value);}});},getKalturaClient:function(){if(!this.kClient){this.kClient=mw.kApiGetPartnerClient(this.embedPlayer.kwidgetid);}return this.kClient;},destroy:function(){this.unbind();}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KBaseScreen",function($){(function(mw,$){"use strict";mw.KBaseScreen=mw.KBaseComponent.extend({$screen:null,templateData:null,iconBtnClass:'',error:false,enablePlayDuringScreen:false,getBaseConfig:function(){var parentConfig=this._super();return $.extend({},parentConfig,{usePreviewPlayer:false,previewPlayerEnabled:false});},_addBindings:function(){var _this=this;this._super();this.bindCleanScreen();this.bind('onplay preSequence',$.proxy(function(){if(this.isScreenVisible()){if(this.hasPreviewPlayer()){this.resizePlayer();}else{this.hideScreen();}}},this));this.bind('playerReady',$.proxy(function(e,size){_this.error=false;},this));this.bind('playerSizeClassUpdate',$.proxy(function(e,size){if(size=='tiny'){this.setConfig('previewPlayerEnabled',false);}else{this.setConfig('previewPlayerEnabled',true);}},this));this.bind('closeOpenScreens',$.proxy(function(e,opener){if(this.pluginName!==opener)this.hideScreen();},this));this.bind('toggleScreen',$.proxy(function(e,screenName){if(this.pluginName===screenName){this.toggleScreen();}},this));},bindCleanScreen:function(){this.bind('playerReady',$.proxy(function(){this.removeScreen();},this));this.bind('onChangeMedia',$.proxy(function(){this.enablePlayDuringScreen=false;this.hideScreen();},this));},removeScreen:function(){if(this.$screen){this.log('Remove Screen');this.$screen.remove();this.$screen=null;}},hideScreen:function(){var _this=this;if(!this.error){this.getPlayer().triggerHelper('preHideScreen',[this.pluginName]);if(this.hasPreviewPlayer()){this.restorePlayer();}else{this.restorePlayback();}if(this.getPlayer().isPlaying()){this.getPlayer().restoreComponentsHover();}if(!this.enablePlayDuringScreen&&this.isScreenVisible()){this.getScreen().then(function(screen){screen.fadeOut(400,$.proxy(function(){_this.getPlayer().triggerHelper('hideScreen',[_this.pluginName]);},this));});}}},showScreen:function(){var _this=this;if(!this.error){this._hideAllScreens(this.pluginName);this.getPlayer().triggerHelper('preShowScreen',[this.pluginName]);if(this.hasPreviewPlayer()){this.resizePlayer();}else{this.pausePlayback();}this.getPlayer().disableComponentsHover();this.getScreen().then(function(screen){screen.fadeIn(400,$.proxy(function(){_this.getPlayer().triggerHelper('showScreen',[_this.pluginName]);},this));});}},toggleScreen:function(){if(this.isDisabled)return;if(this.isScreenVisible()){this.hideScreen();}else{this.showScreen();}},isScreenVisible:function(){return(!this.$screen)?false:this.$screen.is(':visible');},hasPreviewPlayer:function(){return this.getConfig('usePreviewPlayer')&&this.getConfig('previewPlayerEnabled');},pausePlayback:function(){var player=this.getPlayer();this.wasPlaying=player.isPlaying();if(this.wasPlaying){player.pause();}},restorePlayback:function(){if(this.wasPlaying){this.wasPlaying=false;this.getPlayer().play();}},resizePlayer:function(){this.getPlayer().getVideoDisplay().addClass('animateVideo');this.getPlayer().getInterface().addClass('previewPlayer');},restorePlayer:function(){this.getPlayer().getVideoDisplay().removeClass('animateVideo');this.getPlayer().getInterface().removeClass('previewPlayer');},getTemplateData:function(){return this.templateData;},_hideAllScreens:function(exclude){exclude=[exclude]||[];this.getPlayer().triggerHelper('closeOpenScreens',exclude);},onConfigChange:function(property,value){this._super(property,value);if(property=='previewPlayerEnabled'&&this.isScreenVisible()&&this.getConfig('usePreviewPlayer')){if(value==false){this.restorePlayer();}else{this.resizePlayer();}}},getScreen:function(){var _this=this;var defer=$.Deferred();if(!this.$screen){this.getTemplateHTML(this.getTemplateData()).then(function(data){var closeBtn=$('<span class="icon-close"/>').on('click',function(){_this.hideScreen();});_this.$screen=$('<div />').addClass('screen '+_this.pluginName).append($('<div class="screen-content" /> ').append(closeBtn).append(data));var hasExpandBtn=_this.getPlayer().getVideoDisplay().find('.expandPlayerBtn').length;if(_this.getConfig('usePreviewPlayer')&&!hasExpandBtn){_this.getPlayer().getVideoDisplay().append($('<i />').addClass('expandPlayerBtn icon-expand2').click($.proxy(function(){_this._hideAllScreens();},_this)));}_this.getPlayer().getVideoHolder().append(_this.$screen);_this.addScreenBindings();defer.resolve(_this.$screen);},function(msg){mw.log(msg);defer.reject(msg);});}else{defer.resolve(this.$screen);}return defer;},addScreenBindings:function(){},getComponent:function(){if(!this.$el){var _this=this;this.$el=$('<button />').attr('title',this.getConfig('tooltip')).addClass("btn "+this.iconBtnClass+this.getCssClass()).click(function(){_this.toggleScreen();});this.setAccessibility(this.$el,this.getConfig('tooltip'));}return this.$el;}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KBaseSmartContainer",function($){(function(mw,$){"use strict";mw.KBaseSmartContainer=mw.KBaseComponent.extend({title:"settings",closingEvents:'onplay',registeredPlugins:[],shouldResumePlay:false,pluginsScreenOpened:false,overlayOpen:false,isDisabled:false,setup:function(embedPlayer){this.addBindings();},isSafeEnviornment:function(){return this.embedPlayer.isMobileSkin()&&mw.getConfig("EmbedPlayer.UseSmartContainers")!==false;},getComponent:function(){var _this=this;if(!this.$el){this.$el=$('<button />').attr('title',this.title).addClass("btn"+this.getCssClass()).on('click',function(e){if(_this.isDisabled){return;}if(!_this.pluginsScreenOpened&&!_this.overlayOpen){_this.showRegisteredPlugins();}else{_this.hideRegisteredPlugins();}});}return this.$el;},addBindings:function(){var _this=this;this.bind('pluginsReady',function(e,plugins){for(var plugin in plugins){if(plugins[plugin].getConfig("smartContainer")&&plugins[plugin].getConfig("smartContainer")===_this.pluginName&&plugins[plugin].safe){_this.registeredPlugins.push(plugins[plugin]);if(plugins[plugin].getConfig("smartContainerCloseEvent")){var closeEvent=plugins[plugin].getConfig("smartContainerCloseEvent");if(_this.closingEvents.indexOf(closeEvent)===-1){_this.closingEvents+=" "+closeEvent;}}}}if(_this.registeredPlugins.length>1){if(!_this.embedPlayer.getVideoHolder().find(".smartContainer").length){_this.embedPlayer.getVideoHolder().append("<div class='smartContainer'></div>");}for(var i=0;i<_this.registeredPlugins.length;i++){_this.registeredPlugins[i].setConfig("parent","smartContainer");_this.registeredPlugins[i].setConfig("align","center");}_this.bind(_this.closingEvents,function(){if(_this.pluginsScreenOpened){_this.hideRegisteredPlugins();_this.checkResumePlayback();}});_this.bind("preShowScreen displayMenuOverlay",function(){if(_this.pluginsScreenOpened){_this.hideRegisteredPlugins();}});_this.bind("displayMenuOverlay",function(){_this.overlayOpen=true;});_this.bind("closeMenuOverlay",function(){_this.overlayOpen=false;});_this.bind("onShowInterfaceComponents",function(){setTimeout(function(){_this.hideRegisteredPlugins();},0);});setTimeout(function(){_this.hideRegisteredPlugins();},0);}else{_this.hide();}});this.bind('playerReady',function(){if(_this.registeredPlugins.length<2){_this.hide();}});},hideRegisteredPlugins:function(){this.pluginsScreenOpened=false;this.embedPlayer.getInterface().removeClass("pluginsScreenOpened");$(this.embedPlayer.getPlayerElement()).removeClass("blur");this.embedPlayer.getVideoHolder().find(".closePluginsScreen").remove();for(var i=0;i<this.registeredPlugins.length;i++){this.registeredPlugins[i].hide();}this.embedPlayer.getControlBarContainer().show();this.embedPlayer.triggerHelper("hideMobileComponents");this.embedPlayer.triggerHelper("updateComponentsVisibilityDone");},showRegisteredPlugins:function(){var _this=this;for(var i=this.registeredPlugins.length-1;i>=0;i--){if(!this.registeredPlugins[i].safe){this.registeredPlugins.splice(i,1);}}this.pluginsScreenOpened=true;var $sc=this.embedPlayer.getVideoHolder().find(".smartContainer");$sc.children().hide();this.embedPlayer.getInterface().addClass("pluginsScreenOpened");$(this.embedPlayer.getPlayerElement()).addClass("blur");var numPlugins=this.registeredPlugins.length;var pluginWidth=33;if(numPlugins===4||numPlugins===2){pluginWidth=50;}var pluginHeight=this.embedPlayer.getVideoHolder().width()/(numPlugins+1);$sc.find(".comp").not(".closePluginsScreen, .icon-next, .icon-prev, .largePlayBtn").width(pluginWidth+"%").height(pluginHeight);$sc.removeClass("comp1 comp2 comp3 comp4 comp5 comp6").addClass("comp"+this.registeredPlugins.length);for(var i=0;i<this.registeredPlugins.length;i++){var plugin=this.registeredPlugins[i].getComponent();if(!plugin.find(".btnLabel").length){var pluginBtn=plugin.find(".btn");if(pluginBtn.length===0&&plugin.hasClass("btn")){pluginBtn=plugin;}pluginBtn.removeClass("pull-right");pluginBtn.append("<p class='btnLabel'>"+this.registeredPlugins[i].getConfig('title')+"</p>");pluginBtn.find(".accessibilityLabel").remove();}plugin.fadeIn(400,function(){$(this).css("display","inline-block");});}this.shouldResumePlay=!this.embedPlayer.paused;this.embedPlayer.ignoreNextNativeEvent=true;this.embedPlayer.pause();this.embedPlayer.getControlBarContainer().fadeOut();this.embedPlayer.triggerHelper("showMobileComponents");var closeBtn=$("<button class='btn icon-close closePluginsScreen'></button>").on('click',function(e){if(_this.pluginsScreenOpened){_this.hideRegisteredPlugins();_this.checkResumePlayback();}});_this.embedPlayer.getVideoHolder().append(closeBtn);},checkResumePlayback:function(){if(this.shouldResumePlay){this.shouldResumePlay=false;this.embedPlayer.play();}else{this.embedPlayer.triggerHelper("showLargePlayBtn");}}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KCuePoints",function($){(function(mw,$){"use strict";mw.KCuePoints=function(embedPlayer){return this.init(embedPlayer);};mw.KCuePoints.TYPE={AD:"adCuePoint.Ad",ANNOTATION:"annotation.Annotation",CODE:"codeCuePoint.Code",EVENT:"eventCuePoint.Event",THUMB:"thumbCuePoint.Thumb",QUIZ_QUESTION:"quiz.QUIZ_QUESTION"};mw.KCuePoints.THUMB_SUB_TYPE={SLIDE:1,CHAPTER:2};mw.KCuePoints.prototype={bindPostfix:'.kCuePoints',midCuePointsArray:[],codeCuePointsArray:[],liveCuePointsIntervalId:null,supportedCuePoints:[mw.KCuePoints.TYPE.CODE,mw.KCuePoints.TYPE.THUMB,mw.KCuePoints.TYPE.QUIZ_QUESTION],init:function(embedPlayer){var _this=this;this.destroy();this.embedPlayer=embedPlayer;embedPlayer.bindHelper('KalturaSupport_CuePointsReady'+this.bindPostfix,function(){_this.initSupportedCuepointTypes();_this.processCuePoints();_this.addPlayerBindings();if(_this.embedPlayer.isLive()&&mw.getConfig("EmbedPlayer.LiveCuepoints")){_this.setLiveCuepointsWatchDog();}});},destroy:function(){if(this.liveCuePointsIntervalId){clearInterval(this.liveCuePointsIntervalId);this.liveCuePointsIntervalId=null;}$(this.embedPlayer).unbind(this.bindPostfix);},processCuePoints:function(){var _this=this;var cuePoints=this.getCuePoints();this.requestThumbAsset(cuePoints,function(){_this.embedPlayer.triggerHelper('KalturaSupport_ThumbCuePointsReady');});var newCuePointsArray=[];var newCodeCuePointsArray=[];$.each(cuePoints,function(idx,cuePoint){if((_this.getVideoAdType(cuePoint)=='pre'||_this.getVideoAdType(cuePoint)=='post')&&cuePoint.cuePointType=='adCuePoint.Ad'){_this.triggerCuePoint(cuePoint);}else{if(cuePoint.cuePointType==='codeCuePoint.Code'){newCodeCuePointsArray.push(cuePoint);}else if(cuePoint.cuePointType!="eventCuePoint.Event"){newCuePointsArray.push(cuePoint);}}});this.midCuePointsArray=newCuePointsArray;this.codeCuePointsArray=newCodeCuePointsArray;},initSupportedCuepointTypes:function(){var supportedCuePoints=mw.getConfig("EmbedPlayer.SupportedCuepointTypes",this.supportedCuePoints);if($.type(supportedCuePoints)==="string"){supportedCuePoints=supportedCuePoints.split(",")}mw.setConfig("EmbedPlayer.SupportedCuepointTypes",supportedCuePoints);},requestThumbAsset:function(cuePoints,callback){var _this=this;var requestArray=[];var responseArray=[];var requestCuePoints=cuePoints||this.getCuePoints();var thumbCuePoint=$.grep(requestCuePoints,function(cuePoint){return(cuePoint.cuePointType=='thumbCuePoint.Thumb');});var loadThumbnailWithReferrer=this.embedPlayer.getFlashvars('loadThumbnailWithReferrer');var referrer=window.kWidgetSupport.getHostPageUrl();$.each(thumbCuePoint,function(index,item){if(typeof item.assetId!=='undefined'){requestArray.push({'service':'thumbAsset','action':'getUrl','id':item.assetId});}responseArray[index]=item;});if(requestArray.length){this.getKalturaClient().doRequest(requestArray,function(data){if(requestArray.length===1){data=[data];}$.each(data,function(index,res){if(!_this.isValidResult(res)){data[index]=null;}});$.each(thumbCuePoint,function(index,item){item.thumbnailUrl=loadThumbnailWithReferrer?data[index]+'?options:referrer='+referrer:data[index];});if(callback){callback();}});}else{if(callback){callback();}}},fixLiveCuePointArray:function(arr){$.each(arr,function(index,cuePoint){cuePoint.startTime=cuePoint.createdAt*1000;});arr.sort(function(a,b){return a.createdAt-b.createdAt;});},setLiveCuepointsWatchDog:function(){var _this=this;var cuePoints=this.getCuePoints();this.fixLiveCuePointArray(this.midCuePointsArray);this.fixLiveCuePointArray(this.codeCuePointsArray);this.fixLiveCuePointArray(cuePoints);this.associativeCuePoints={};$.each(cuePoints,function(index,cuePoint){_this.associativeCuePoints[cuePoint.id]=cuePoint;});var liveCuepointsRequestInterval=mw.getConfig("EmbedPlayer.LiveCuepointsRequestInterval",10000);mw.log("mw.KCuePoints::start live cue points watchdog, polling rate: "+liveCuepointsRequestInterval+"ms");this.liveCuePointsIntervalId=setInterval(function(){_this.requestLiveCuepoints();},liveCuepointsRequestInterval);this.embedPlayer.bindHelper("liveOffline",function(){if(_this.liveCuePointsIntervalId){mw.log("mw.KCuePoints::lifeOffline event received, stop live cue points watchdog");clearInterval(_this.liveCuePointsIntervalId);_this.liveCuePointsIntervalId=null;}});this.embedPlayer.bindHelper("liveOnline",function(){if(!_this.liveCuePointsIntervalId){mw.log("mw.KCuePoints::liveOnline event received, start live cue points watchdog");_this.requestLiveCuepoints();_this.liveCuePointsIntervalId=setInterval(function(){_this.requestLiveCuepoints();},liveCuepointsRequestInterval);}});},requestLiveCuepoints:function(){var _this=this;var entryId=_this.embedPlayer.kentryid;var request={'service':'cuepoint_cuepoint','action':'list','filter:entryIdEqual':entryId,'filter:objectType':'KalturaCuePointFilter','filter:statusIn':'1,3','filter:cuePointTypeIn':'thumbCuePoint.Thumb,codeCuePoint.Code','filter:orderBy':"+createdAt"};var lastCreationTime=_this.getLastCreationTime()+1;if(lastCreationTime>0){request['filter:createdAtGreaterThanOrEqual']=lastCreationTime;}this.getKalturaClient().doRequest(request,function(data){if(!data||data.code){mw.log("Error:: KCuePoints could not retrieve live cuepoints");return;}_this.fixLiveCuePointArray(data.objects);_this.updateCuePoints(data.objects);_this.embedPlayer.triggerHelper('KalturaSupport_CuePointsUpdated',[data.totalCount]);});},updateCuePoints:function(rawCuePoints){if(rawCuePoints.length>0){var _this=this;var thumbNewCuePoints=[];var codeNewCuePoints=[];var playerNewCuePoints=[];$.each(rawCuePoints,function(id,rawCuePoint){if(!_this.associativeCuePoints[rawCuePoint.id]){_this.associativeCuePoints[rawCuePoint.id]=rawCuePoint;playerNewCuePoints.push(rawCuePoint);if(rawCuePoint.cuePointType==='codeCuePoint.Code'){codeNewCuePoints.push(rawCuePoint);}else{thumbNewCuePoints.push(rawCuePoint);}}});if(playerNewCuePoints.length>0){var playerCuePoints=this.getCuePoints();$.merge(playerCuePoints,playerNewCuePoints);}if(thumbNewCuePoints.length>0){$.merge(this.midCuePointsArray,thumbNewCuePoints);this.requestThumbAsset(thumbNewCuePoints,function(){_this.embedPlayer.triggerHelper('KalturaSupport_ThumbCuePointsUpdated',[thumbNewCuePoints]);});}if(codeNewCuePoints.length>0){$.merge(this.codeCuePointsArray,codeNewCuePoints);}}},getLastUpdateTime:function(){var cuePoints=this.getCuePoints();var lastUpdateTime=-1;$.each(cuePoints,function(key,cuePoint){if(lastUpdateTime<cuePoint.updatedAt){lastUpdateTime=cuePoint.updatedAt;}});return lastUpdateTime;},getLastCreationTime:function(){var cuePoints=this.getCuePoints();var lastCreationTime=-1;$.each(cuePoints,function(key,cuePoint){if(lastCreationTime<cuePoint.createdAt){lastCreationTime=cuePoint.createdAt;}});return lastCreationTime;},getKalturaClient:function(){if(!this.kClient){this.kClient=mw.kApiGetPartnerClient(this.embedPlayer.kwidgetid);}return this.kClient;},isValidResult:function(data){if(!data){mw.log("mw.KCuePoints :: error retrieving data");return false;}else if(data.code&&data.message){mw.log("mw.KCuePoints :: error code: "+data.code+", error message: "+data.message);return false;}return true;},addPlayerBindings:function(){var _this=this;var currentCuePoint=this.getNextCuePoint(0);var embedPlayer=this.embedPlayer;if(!((embedPlayer.isLive()&&mw.getConfig("EmbedPlayer.LiveCuepoints"))||currentCuePoint)){return;}$(embedPlayer).bind('onChangeMedia'+this.bindPostfix,function(){_this.destroy();});$(embedPlayer).bind("monitorEvent"+this.bindPostfix+" seeked"+this.bindPostfix+" onplay"+this.bindPostfix+" KalturaSupport_ThumbCuePointsUpdated"+this.bindPostfix,function(e){var currentTime=embedPlayer.getPlayerElementTime()*1000;if(e.type=="seeked"){currentCuePoint=_this.getPreviousCuePoint(currentTime);}if(currentCuePoint&&currentTime>currentCuePoint.startTime&&embedPlayer._propagateEvents){var cuePointToBeTriggered=$.extend({},currentCuePoint);_this.triggerCuePoint(cuePointToBeTriggered);}currentCuePoint=_this.getNextCuePoint(currentTime);});},getEndTime:function(){return this.embedPlayer.evaluate('{mediaProxy.entry.msDuration}');},getCuePoints:function(){if(!this.embedPlayer.rawCuePoints||!this.embedPlayer.rawCuePoints.length){this.embedPlayer.rawCuePoints=[];}return this.embedPlayer.rawCuePoints;},getCodeCuePoints:function(){return this.codeCuePointsArray||[];},getCuePointsByType:function(type,subType){var filteredCuePoints=this.getCuePoints();if(filteredCuePoints&&(type||subType)){var _this=this;filteredCuePoints=$.grep(filteredCuePoints,function(cuePoint){var foundCuePointType=_this.validateCuePointAttribute(cuePoint,"cuePointType",type);var foundCuePointSubType=_this.validateCuePointAttribute(cuePoint,"subType",subType);return foundCuePointType&&foundCuePointSubType;});}return filteredCuePoints;},validateCuePointAttribute:function(cuePoint,attrName,attrValues){var foundAttr=false;if(attrName&&attrValues){if(!$.isArray(attrValues)){attrValues=[attrValues];}$.each(attrValues,function(i,attrValue){if(attrValue==cuePoint[attrName]){foundAttr=true;return false;}});}else{foundAttr=true;}return foundAttr;},getNextCuePoint:function(time){if(!isNaN(time)&&time>=0){var cuePoints=this.midCuePointsArray;for(var i=0;i<cuePoints.length;i++){if(cuePoints[i].startTime>=time){return cuePoints[i];}}}return false;},getPreviousCuePoint:function(time){if(!isNaN(time)&&time>=0){var cuePoints=this.midCuePointsArray;for(var i=0;i<cuePoints.length;i++){if(cuePoints[i].startTime>=time){var index=(i-1>0)?(i-1):0;return cuePoints[index];}}}return cuePoints[cuePoints.length-1];},triggerCuePoint:function(rawCuePoint){var eventName;rawCuePoint.sourceUrl=this.embedPlayer.evaluate(rawCuePoint.sourceUrl);var cuePointWrapper={'cuePoint':rawCuePoint};if(rawCuePoint.cuePointType=='adCuePoint.Ad'){eventName='KalturaSupport_AdOpportunity';cuePointWrapper.context=this.getVideoAdType(rawCuePoint);}else if($.inArray(rawCuePoint.cuePointType,mw.getConfig("EmbedPlayer.SupportedCuepointTypes"))!==-1){eventName='KalturaSupport_CuePointReached';}else{return;}mw.log('mw.KCuePoints :: Trigger event: '+eventName+' - '+rawCuePoint.cuePointType+' at: '+rawCuePoint.startTime);$(this.embedPlayer).trigger(eventName,cuePointWrapper);},getVideoAdType:function(rawCuePoint){if(rawCuePoint.startTime===0){return'pre';}else if(rawCuePoint.startTime==this.getEndTime()){return'post';}else{return'mid';}mw.log("Error:: KCuePoints could not determine adType");},getAdSlotType:function(cuePointWrapper){if(cuePointWrapper.cuePoint.adType==1){return this.getVideoAdType(cuePointWrapper.cuePoint)+'roll';}else{return'overlay';}},getRawAdSlotType:function(rawCuePoint){if(rawCuePoint.adType==1){return this.getVideoAdType(rawCuePoint)+'roll';}else{return'overlay';}},getCuePointsCount:function(filter){var _this=this;var cuePoints=this.getCuePoints();if(!cuePoints)return 0;if(!filter)return cuePoints.length;var totalResults={'preroll':0,'midroll':0,'postroll':0,'overlay':0};$.each(cuePoints,function(idx,rawCuePoint){totalResults[_this.getRawAdSlotType(rawCuePoint)]++;});if(filter&&totalResults[filter]){return totalResults[filter];}return 0;}};})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.KDPMapping",function($){(function(mw,$){"use strict";mw.KDPMapping=function(embedPlayer){return this.init(embedPlayer);};mw.KDPMapping.prototype={listenerList:{},init:function(embedPlayer){var _this=this;this.registerDefaultFormaters();var kdpApiMethods=['addJsListener','removeJsListener','sendNotification','setKDPAttribute','evaluate'];var parentProxyDiv=null;if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){try{parentProxyDiv=window['parent'].document.getElementById(embedPlayer.id);}catch(e){}}$.each(kdpApiMethods,function(inx,methodName){embedPlayer[methodName]=function(){var args=$.makeArray(arguments);args.splice(0,0,embedPlayer);return _this[methodName].apply(_this,args);}
if(parentProxyDiv){parentProxyDiv[methodName]=function(){var args=arguments;var ret=[];if(args!=null){var i=args.length;if(i==null||typeof args==="string"||jQuery.isFunction(args)||args.setInterval)ret[0]=args;else while(i)ret[--i]=args[i];}ret.splice(0,0,embedPlayer);return _this[methodName].apply(_this,ret);}}});var runCallbackOnParent=false;if(mw.getConfig('EmbedPlayer.IsFriendlyIframe')){try{if(window['parent']&&window['parent']['kWidget']&&parentProxyDiv){runCallbackOnParent=true;window['parent']['kWidget'].jsCallbackReady(embedPlayer.id);}}catch(e){runCallbackOnParent=false;}}if(!runCallbackOnParent){window.kWidget.jsCallbackReady(embedPlayer.id);}},registerDefaultFormaters:function(){mw.util.formaters().register({timeFormat:function(value){return mw.seconds2npt(parseFloat(value));},dateFormat:function(value){var date=new Date(value*1000);return date.toDateString();},numberWithCommas:function(value){return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");}});},setKDPAttribute:function(embedPlayer,componentName,property,value){mw.log("KDPMapping::setKDPAttribute "+componentName+" p:"+property+" v:"+value+' for: '+embedPlayer.id);var pluginNameToSet=componentName;var propertyNameToSet=property;var valueToSet=value;switch(property){case'autoPlay':embedPlayer.autoplay=value;break;case'disableAlerts':mw.setConfig('EmbedPlayer.ShowPlayerAlerts',!value);break;default:if(componentName.indexOf('.')!=-1){var cparts=componentName.split('.');pluginNameToSet=cparts[0];propertyNameToSet=cparts[1];valueToSet={};valueToSet[property]=value;}embedPlayer.setKalturaConfig(pluginNameToSet,propertyNameToSet,valueToSet);break;}if(pluginNameToSet=='servicesProxy'&&propertyNameToSet&&propertyNameToSet=='kalturaClient'&&property=='ks'){this.updateKS(embedPlayer,value);}$(embedPlayer).trigger('Kaltura_SetKDPAttribute',[componentName,property,value]);},updateKS:function(embedPlayer,ks){var client=mw.kApiGetPartnerClient(embedPlayer.kwidgetid);client.setKs(ks);embedPlayer.setFlashvars('ks',ks);embedPlayer.sendNotification('changeMedia',{'entryId':embedPlayer.kentryid});},evaluate:function(embedPlayer,objectString,limit){var _this=this;var result;var isCurlyBracketsExpresion=function(str){if(typeof str=='string'){return(str.charAt(0)=='{'&&str.charAt(str.length-1)=='}');}return false;};limit=limit||0;if(limit>4){mw.log('KDPMapping::evaluate: recursive calls are limited to 5');return objectString;}if(typeof objectString!=='string'){return objectString;}if(isCurlyBracketsExpresion(objectString)&&objectString.split('{').length==2){result=_this.evaluateExpression(embedPlayer,objectString.substring(1,objectString.length-1));}else if(objectString.split('{').length>1){result=objectString.replace(/\{([^\}]*)\}/g,function(match,contents,offset,s){return _this.evaluateExpression(embedPlayer,contents);});}else{result=objectString;}if(result===0){return result;}if(result==="undefined"||result==="null"||result==="")result=undefined;if(result==="false"){result=false;}if(result==="true"){result=true;}if(isCurlyBracketsExpresion(result)){result=this.evaluate(embedPlayer,result,limit++);}return result;},getEvaluateExpression:function(embedPlayer,expression){var _this=this;if(expression.indexOf('(')!==-1){var fparts=expression.split('(');return _this.evaluateStringFunction(fparts[0],_this.getEvaluateExpression(embedPlayer,fparts[1].slice(0,-1)));}var objectPath=expression.split('.');if(embedPlayer.playerConfig&&embedPlayer.playerConfig.plugins&&embedPlayer.playerConfig.plugins[objectPath[0]]){var kObj=embedPlayer.playerConfig.plugins[objectPath[0]];if(!objectPath[1]){return kObj;}if(!objectPath[2]&&(objectPath[1]in kObj)){return kObj[objectPath[1]];}if(objectPath[2]&&kObj[objectPath[1]]&&typeof kObj[objectPath[1]][objectPath[2]]!='undefined'){return kObj[objectPath[1]][objectPath[2]];}}var getReffererURL=function(fv,objectPath){if(fv&&fv[objectPath[2]]){return fv[objectPath[2]];}return mw.getConfig('EmbedPlayer.IframeParentUrl');}
switch(objectPath[0]){case'isHTML5':return true;break;case'flashVersion':return kWidget.getFlashVersion();break;case'playerVersion':return window['MWEMBED_VERSION'];break;case'sequenceProxy':if(!embedPlayer.sequenceProxy){return null;}if(objectPath[1]){switch(objectPath[1]){case'timeRemaining':case'isInSequence':case'skipOffsetRemaining':return embedPlayer.sequenceProxy[objectPath[1]];break;case'activePluginMetadata':if(objectPath[2]){if(!embedPlayer.sequenceProxy.activePluginMetadata){return null;}return embedPlayer.sequenceProxy.activePluginMetadata[objectPath[2]]}return embedPlayer.sequenceProxy.activePluginMetadata;break;}return null;}return embedPlayer.sequenceProxy;break;case'video':switch(objectPath[1]){case'volume':return embedPlayer.volume;break;case'buffer':switch(objectPath[2]){case'lastBufferDuration':return embedPlayer.lastBufferDuration||0;break;case'lastBufferDurationMs':return(embedPlayer.lastBufferDuration)?embedPlayer.lastBufferDuration*1000:0;break;case'bufferEndTime':return embedPlayer.bufferEndTime;break;case'bufferStartTime':return embedPlayer.bufferStartTime;break;case'percent':return(embedPlayer.bufferedPercent);break;}break;case'player':switch(objectPath[2]){case'currentTime':if(embedPlayer.seeking&&embedPlayer.kPreSeekTime!==null){return embedPlayer.kPreSeekTime;}return embedPlayer.currentTime;break;case'height':return embedPlayer.getHeight();break;case'width':return embedPlayer.getWidth();break;case'position':try{var pos=$("#"+embedPlayer.id,parent.document.body).position();return pos.left+','+pos.top;}catch(e){return'0,0';}break;}break;}break;case'duration':return embedPlayer.getDuration();break;case'mediaProxy':switch(objectPath[1]){case'entryCuePoints':if(!embedPlayer.rawCuePoints){return null;}var kdpCuePointFormat={};$.each(embedPlayer.rawCuePoints,function(inx,cuePoint){var startTime=parseInt(cuePoint.startTime);if(kdpCuePointFormat[startTime]){kdpCuePointFormat[startTime].push(cuePoint)}else{kdpCuePointFormat[startTime]=[cuePoint];}});return kdpCuePointFormat;break;case'entryMetadata':if(!embedPlayer.kalturaEntryMetaData){return null;}if(objectPath[2]){return embedPlayer.kalturaEntryMetaData[objectPath[2]];}else{return embedPlayer.kalturaEntryMetaData;}break;case'entry':if(!embedPlayer.kalturaPlayerMetaData){return null;}if(objectPath[2]){return embedPlayer.kalturaPlayerMetaData[objectPath[2]];}else{return embedPlayer.kalturaPlayerMetaData;}break;case'sources':return embedPlayer.mediaElement.getSources();break;case'isLive':return embedPlayer.isLive();break;case'mediaPlayTo':var mediaPlayTo=embedPlayer.getFlashvars('mediaProxy.mediaPlayTo');return mediaPlayTo?mediaPlayTo:null;break;case'mediaPlayFrom':var mediaPlayFrom=embedPlayer.getFlashvars('mediaProxy.mediaPlayFrom');return mediaPlayFrom?mediaPlayFrom:null;break;case'isOffline':if($.isFunction(embedPlayer.isOffline)){return embedPlayer.isOffline();}return true;break;case'kalturaMediaFlavorArray':if(!embedPlayer.kalturaFlavors){return null;}return embedPlayer.kalturaFlavors;break;}break;case'configProxy':var fv=embedPlayer.getFlashvars();switch(objectPath[1]){case'flashvars':if(objectPath[2]){switch(objectPath[2]){case'autoPlay':return embedPlayer.autoplay;break;case'referer':case'referrer':return getReffererURL(fv,objectPath);break;default:if(fv&&fv[objectPath[2]]){return fv[objectPath[2]]}return null;break;}}else{return fv;}break;case'kw':var kw={'objectType':"KalturaWidget",'id':embedPlayer.kwidgetid,'partnerId':embedPlayer.kpartnerid,'uiConfId':embedPlayer.kuiconfid}
if(objectPath[2]){if(typeof kw[objectPath[2]]!='undefined'){return kw[objectPath[2]]}return null;}return kw;break;case'targetId':return embedPlayer.id;break;case'sessionId':return window.kWidgetSupport.getGUID();break;}return{'flashvars':fv,'sessionId':window.kWidgetSupport.getGUID()};break;case'playerStatusProxy':switch(objectPath[1]){case'kdpStatus':if(embedPlayer.kdpEmptyFlag){return"empty";}if(embedPlayer.playerReadyFlag){return'ready';}return null;break;}break;case'playlistAPI':switch(objectPath[1]){case'dataProvider':if(!embedPlayer.kalturaPlaylistData){return null;}var plData=embedPlayer.kalturaPlaylistData;var plId=null;if(plData['currentPlaylistId']){plId=plData['currentPlaylistId'];}else{for(var plKey in plData)break;plId=plKey;}var dataProvider={'content':plData[plId],'length':plData[plId].length,'selectedIndex':plData['selectedIndex']}
if(objectPath[2]=='selectedIndex'){return dataProvider.selectedIndex;}return dataProvider;break;}break;case'utility':switch(objectPath[1]){case'random':return Math.floor(Math.random()*1000000000);break;case'timestamp':return new Date().getTime();break;case'referrer_url':var fv=embedPlayer.getFlashvars();return getReffererURL(fv,objectPath);break;case'referrer_host':var fv=embedPlayer.getFlashvars();var referrer=getReffererURL(fv,objectPath);var getLocation=function(href){var l=document.createElement("a");l.href=href;return l;};var location=getLocation(referrer);return location.hostname;break;case'nativeAdId':if(embedPlayer){return embedPlayer.getFlashvars('nativeAdId');}else{return"";}break;case'nativeVersion':if(embedPlayer){return embedPlayer.getFlashvars('nativeVersion');}else{return"";}break;case'streamerType':if(embedPlayer){return embedPlayer.streamerType;}return"";break;}break;case'embedServices':var proxyData=embedPlayer.getKalturaConfig('proxyData');var filedName=expression.replace('embedServices.','');return this.getProperty(filedName,proxyData);break;}var pluginConfigValue=null;if(!objectPath[1]&&$.isEmptyObject(embedPlayer.getKalturaConfig(objectPath[0]))){pluginConfigValue=embedPlayer.getKalturaConfig('',objectPath[0]);}else{pluginConfigValue=embedPlayer.getKalturaConfig(objectPath[0],objectPath[1]);if($.isEmptyObject(pluginConfigValue)){return;}}return pluginConfigValue;},evaluateExpression:function(embedPlayer,expression){var formatFunc=null;if(expression.indexOf('|')!==-1){var expArr=expression.split('|');expression=expArr[0];formatFunc=expArr[1];if(mw.util.formaters().exists(formatFunc)){formatFunc=mw.util.formaters().get(formatFunc);}else{formatFunc=null;}}var evalVal=this.getEvaluateExpression(embedPlayer,expression);if(evalVal===null||typeof evalVal=='undefined'||evalVal==='undefined'){return'';}if(formatFunc){return formatFunc(evalVal);}return evalVal;},evaluateStringFunction:function(functionName,value){switch(functionName){case'encodeUrl':return encodeURI(value);break;case'conditional':value
break;}},getProperty:function(propertyName,object){var parts=propertyName.split("."),length=parts.length,i,property=object||this;for(i=0;i<length;i++){if(property===undefined)break;property=property[parts[i]];}return property;},removeJsListener:function(embedPlayer,eventName,callbackName){mw.log("KDPMapping:: removeJsListener:: "+eventName);if(typeof eventName=='string'){var eventData=eventName.split('.',2);var eventNamespace=eventData[1];if(eventNamespace&&eventName[0]==='.'){$(embedPlayer).unbind('.'+eventNamespace);}else if(!eventNamespace){eventNamespace='kdpMapping';}eventName=eventData[0];if(!callbackName){callbackName='anonymous';}else{var listenerId=this.getListenerId(embedPlayer,eventName,eventNamespace,callbackName);if(!this.listenerList[listenerId]){return;}}if(this.listenerList[listenerId]){this.listenerList[listenerId]=null;}else{for(var listenerItem in this.listenerList){if(listenerItem.indexOf(embedPlayer.id+'_'+eventName+'.'+eventNamespace)!=-1){this.listenerList[listenerItem]=null;}}}}},getListenerId:function(embedPlayer,eventName,eventNamespace,callbackName){return embedPlayer.id+'_'+eventName+'.'+eventNamespace+'_'+callbackName;},addJsListener:function(embedPlayer,eventName,callbackName){var _this=this;if(typeof eventName=='string'){var eventData=eventName.split('.',2);var eventNamespace=(eventData[1])?eventData[1]:'kdpMapping';eventName=eventData[0];}if(typeof callbackName=='string'){var listenerId=this.getListenerId(embedPlayer,eventName,eventNamespace,callbackName);this.listenerList[listenerId]=callbackName;var callback=function(){var callbackName=_this.listenerList[listenerId];var callbackToRun=kWidgetSupport.getFunctionByName(callbackName,window);if(!$.isFunction(callbackToRun)){callbackToRun=kWidgetSupport.getFunctionByName(callbackName,window['parent']);}if($.isFunction(callbackToRun)){try{callbackToRun.apply(embedPlayer,$.makeArray(arguments));}catch(e){mw.log("Error when trying to run callbackToRun (probably JavaScript error in callbackToRun code)")};}else{mw.log('kdpMapping::addJsListener: callback name: '+callbackName+' not found');}};}else if(typeof callbackName=='function'){var listenerId=this.getListenerId(embedPlayer,eventName,eventNamespace,'anonymous');_this.listenerList[listenerId]=true;var callback=function(){if(_this.listenerList[listenerId]){callbackName.apply(embedPlayer,$.makeArray(arguments));}}}else{mw.log("Error: KDPMapping : bad callback type: "+callbackName);return;}var b=function(bindName,bindCallback){if(!bindCallback){bindCallback=function(){callback(embedPlayer.id);};}bindName+='.'+eventNamespace;embedPlayer.bindHelper(bindName,function(){bindCallback.apply(embedPlayer,$.makeArray(arguments));});};switch(eventName){case'layoutReady':b('KalturaSupport_DoneWithUiConf');break;case'mediaLoadError':b('mediaLoadError');break;case'mediaError':b('mediaError');break;case'kdpEmpty':case'readyToLoad':if(embedPlayer.playerReadyFlag){if(!embedPlayer.kalturaPlayerMetaData){embedPlayer.kdpEmptyFlag=true;callback(embedPlayer.id);}}else{b('playerReady',function(){if(!embedPlayer.kalturaPlayerMetaData){embedPlayer.kdpEmptyFlag=true;setTimeout(function(){callback(embedPlayer.id);},0)}});}break;case'kdpReady':b('playerReady',function(){if(!embedPlayer.getError()){embedPlayer.kdpEmptyFlag=false;}callback(embedPlayer.id);});break;case'playerLoaded':case'playerReady':b('playerReady');break;case'changeVolume':case'volumeChanged':b('volumeChanged',function(event,percent){callback({'newVolume':percent},embedPlayer.id);});break;case'playerStateChange':b('preCheckPlayerSources',function(){callback('loading',embedPlayer.id);})
b('playerReady',function(){callback('ready',embedPlayer.id);});b('bufferStartEvent',function(){callback('buffering',embedPlayer.id);});b('onpause',function(){callback('paused',embedPlayer.id);});b('onplay',function(){callback('playing',embedPlayer.id);});break;case'doStop':case'stop':b("doStop");break;case'playerPaused':case'pause':case'doPause':b("onpause");break;case'playerPlayed':b("onplay");break;case'play':case'doPlay':b("onplay");break;case'playerSeekStart':b("seeking");break;case'seek':case'doSeek':case'doIntelligentSeek':b("seeking",function(){var seekTime=(embedPlayer.kPreSeekTime!==null)?embedPlayer.kPreSeekTime:embedPlayer.currentTime;callback(seekTime,embedPlayer.id);});break;case'playerSeekEnd':b("seeked",function(){embedPlayer.kPreSeekTime=null
callback(embedPlayer.id);});break;case'playerPlayEnd':b("postEnded");break;case'playbackComplete':b("playbackComplete");b("AdSupport_EndAdPlayback",function(e,slotType){if(slotType!='postroll'){callback();}});break;case'durationChange':b("durationchange",function(){callback({'newValue':embedPlayer.duration},embedPlayer.id);});b("durationChange",function(){callback({'newValue':embedPlayer.duration},embedPlayer.id);});break;case'openFullScreen':case'hasOpenedFullScreen':b("onOpenFullScreen");break;case'hasCloseFullScreen':case'closeFullScreen':b("onCloseFullScreen");break;case'playerUpdatePlayhead':b('monitorEvent',function(){if(embedPlayer.isPlaying()){callback(embedPlayer.currentTime);}});break;case'changeMedia':b('playerReady',function(event){callback({'entryId':embedPlayer.kentryid},embedPlayer.id);});break;case'entryReady':b('KalturaSupport_EntryDataReady',function(event,entryData){callback(entryData,embedPlayer.id);});break;case'entryFailed':b('KalturaSupport_EntryFailed');break;case'mediaReady':b('playerReady',function(event){if(embedPlayer.kentryid){setTimeout(function(){callback(embedPlayer.id)},0);}});break;case'metadataReceived':b('KalturaSupport_MetadataReceived');break;case'bufferChange':var triggeredBufferStart=false;var triggeredBufferEnd=false;b('monitorEvent',function(){if(!triggeredBufferStart){callback(true,embedPlayer.id);triggeredBufferStart=true;}if(!triggeredBufferEnd&&embedPlayer.bufferedPercent==1){callback(false,embedPlayer.id);triggeredBufferEnd=true;}})
break;case'bytesDownloadedChange':var prevBufferBytes=0;b('monitorEvent',function(){if(typeof embedPlayer.bufferedPercent!='undefined'&&embedPlayer.mediaElement.selectedSource){var bufferBytes=parseInt(embedPlayer.bufferedPercent*embedPlayer.mediaElement.selectedSource.getSize());if(bufferBytes!=prevBufferBytes){callback({'newValue':bufferBytes},embedPlayer.id);prevBufferBytes=bufferBytes;}}})
break;case'playerDownloadComplete':b('monitorEvent',function(){if(embedPlayer.bufferedPercent==1){callback(embedPlayer.id);}});break;case'bufferProgress':var prevBufferTime=0;b('monitorEvent',function(){if(typeof embedPlayer.bufferedPercent!='undefined'){var bufferTime=parseInt(embedPlayer.bufferedPercent*embedPlayer.duration);if(bufferTime!=prevBufferTime){callback({'newTime':bufferTime},embedPlayer.id);prevBufferTime=bufferTime;}}})
break;case'bytesTotalChange':var prevBufferBytesTotal=0;b('mediaLoaded',function(){callback({'newValue':embedPlayer.mediaElement.selectedSource.getSize()});})
break;case'preSequenceStart':case'prerollStarted':b('AdSupport_prerollStarted',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'preSequenceComplete':b('AdSupport_preSequenceComplete',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'midSequenceStart':b('AdSupport_midrollStarted',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'midSequenceComplete':b('AdSupport_midSequenceComplete',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'postSequenceStart':b('AdSupport_postrollStarted',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'postSequenceComplete':b('AdSupport_postSequenceComplete',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'adStart':b('AdSupport_StartAdPlayback',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id);});break;case'adEnd':b('AdSupport_EndAdPlayback',function(e,slotType){callback({'timeSlot':slotType},embedPlayer.id)});break;case'adUpdatePlayhead':b('AdSupport_AdUpdatePlayhead',function(event,adTime){callback(adTime,embedPlayer.id);});break;case'pre1start':b('AdSupport_PreSequence');break;case'post1start':b('AdSupport_PostSequence');break;case'cuePointsReceived':b('KalturaSupport_CuePointsReady',function(event,cuePoints){callback(embedPlayer.rawCuePoints,embedPlayer.id);});break;case'cuePointReached':b('KalturaSupport_CuePointReached',function(event,cuePointWrapper){callback(cuePointWrapper,embedPlayer.id);});break;case'adOpportunity':b('KalturaSupport_AdOpportunity',function(event,cuePointWrapper){callback(cuePointWrapper,embedPlayer.id);});break;case'videoView':b('firstPlay');break;case'share':b('showShareEvent');break;case'openFullscreen':b('openFullScreen');break;case'closefullscreen':b('closeFullScreen');break;case'replay':case'doReplay':b('replayEvent');break;case'save':case'gotoContributorWindow':case'gotoEditorWindow':mw.log("Warning: kdp event: "+eventName+" does not have an html5 mapping");break;case'freePreviewEnd':b('KalturaSupport_FreePreviewEnd');break;case'switchingChangeStarted':b('sourceSwitchingStarted',function(event,data){callback(data);});break;case'switchingChangeComplete':b('sourceSwitchingEnd',function(event,data){callback(data);});break;default:b(eventName,function(){var args=$.makeArray(arguments);if(args.length){args.shift();}callback.apply(embedPlayer,args);});break;};return true;},sendNotification:function(embedPlayer,notificationName,notificationData){mw.log('KDPMapping:: sendNotification > '+notificationName,notificationData);switch(notificationName){case'showSpinner':embedPlayer.addPlayerSpinner();break;case'hideSpinner':embedPlayer.hideSpinner();break;case'doPlay':if(embedPlayer.sequenceProxy&&embedPlayer.sequenceProxy.isInSequence){embedPlayer.triggerHelper('doPlay');if(mw.getConfig("EmbedPlayer.ForceNativeComponent")){embedPlayer.play();}break;}if(embedPlayer.playerReadyFlag==false){mw.log('Warning:: KDPMapping, Calling doPlay before player ready');$(embedPlayer).bind('playerReady.sendNotificationDoPlay',function(){$(embedPlayer).unbind('.sendNotificationDoPlay');embedPlayer.play();})
return;}if(notificationData&&notificationData.userInitiated){embedPlayer.triggerHelper('userInitiatedPlay');}embedPlayer.play();break;case'doPause':if(embedPlayer.sequenceProxy&&embedPlayer.sequenceProxy.isInSequence){embedPlayer.triggerHelper('doPause');break;}if(notificationData&&notificationData.userInitiated){embedPlayer.triggerHelper('userInitiatedPause');}embedPlayer.pause();break;case'doStop':if(!embedPlayer.stopped){setTimeout(function(){embedPlayer.ignoreNextNativeEvent=true;embedPlayer.seek(0,true);embedPlayer.stop();},10);}break;case'doReplay':embedPlayer.replay();break;case'doSeek':var seekTime=(parseFloat(notificationData)-embedPlayer.startOffset);embedPlayer.kPreSeekTime=embedPlayer.currentTime;embedPlayer.bindHelper('seeked.kdpMapOnce',function(){embedPlayer.kPreSeekTime=null;});embedPlayer.seek(seekTime);break;case'changeVolume':embedPlayer.setVolume(parseFloat(notificationData),true);break;case'openFullScreen':embedPlayer.layoutBuilder.fullScreenManager.doFullScreenPlayer();break;case'closeFullScreen':embedPlayer.layoutBuilder.fullScreenManager.restoreWindowPlayer();break;case'cleanMedia':embedPlayer.emptySources();break;case'changeMedia':if((!notificationData.entryId||notificationData.entryId==""||notificationData.entryId==-1)&&(!notificationData.referenceId||notificationData.referenceId==""||notificationData.referenceId==-1)&&!notificationData.mediaProxy){mw.log("KDPMapping:: ChangeMedia missing entryId or refrenceid, empty sources.")
embedPlayer.emptySources();break;}if((notificationData.entryId&&notificationData.entryId!=-1)||(notificationData.referenceId&&notificationData.referenceId!=-1)||(notificationData.mediaProxy)){if(embedPlayer.changeMediaStarted){break;}embedPlayer.changeMediaStarted=true;if(!notificationData.entryId&&notificationData.referenceId){embedPlayer.setFlashvars('referenceId',notificationData.referenceId);}else{embedPlayer.setFlashvars('referenceId',null);}embedPlayer.kentryid=notificationData.entryId;if(notificationData.referenceId){embedPlayer.referenceId=notificationData.referenceId;}embedPlayer.setKalturaConfig("proxyData",notificationData.proxyData);embedPlayer.setKalturaConfig("proxyData","data",notificationData.proxyData);embedPlayer.setKalturaConfig('originalProxyData',notificationData.proxyData);embedPlayer.kalturaPlayerMetaData=null;embedPlayer.kalturaEntryMetaData=null;embedPlayer.rawCuePoints=null;embedPlayer.kCuePoints=null;embedPlayer.kAds=null;embedPlayer.updatePoster();if(notificationData.mediaProxy){window.kalturaIframePackageData.entryResult=notificationData.mediaProxy;embedPlayer.playerConfig.plugins['mediaProxy']=notificationData.mediaProxy;embedPlayer.playerConfig.plugins['mediaProxy'].manualProvider=true;}embedPlayer.changeMedia();break;}case'alert':embedPlayer.layoutBuilder.displayAlert(notificationData);break;case'removealert':embedPlayer.layoutBuilder.closeAlert();break;case'enableGui':if(notificationData.guiEnabled==true){embedPlayer.enablePlayControls();}else{embedPlayer.disablePlayControls();}break;case'addBlackScreen':embedPlayer.addBlackScreen();break;case'removeBlackScreen':embedPlayer.removeBlackScreen();break;default:$(embedPlayer).trigger(notificationName,[notificationData]);break;}$(embedPlayer).trigger('Kaltura_SendNotification',[notificationName,notificationData]);}};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.KEntryLoader",function($){(function(mw,$){"use strict";mw.KEntryLoader=function(client,kProperties){return this.init(client,kProperties);};mw.KEntryLoader.prototype={baseDataInx:0,playerLoaderCache:[],init:function(client,kProperties){this.clinet=client;this.kProperties=kProperties;},get:function(callback){var _this=this,requestObject=[];var kProperties=this.kProperties;kProperties.flashvars=kProperties.flashvars||{};if(this.getCacheKey(kProperties)&&this.playerLoaderCache[this.getCacheKey(kProperties)]){mw.log("KApi:: playerLoader load from cache: "+!!(this.playerLoaderCache[this.getCacheKey(kProperties)]));callback(this.playerLoaderCache[this.getCacheKey(kProperties)]);return;}var fillCacheAndRunCallback=function(namedData){if(!mw.getConfig("EmbedPlayer.DisableEntryCache")){_this.playerLoaderCache[_this.getCacheKey(kProperties)]=namedData;}callback(namedData);};if(!kProperties.flashvars.referenceId&&!kProperties.entry_id){mw.log("KApi:: entryId and referenceId not found, exit.");callback({error:"Empty player"});return;}if(kProperties.flashvars&&kProperties.flashvars.ks){this.clinet.setKs(kProperties.flashvars.ks);}var entryIdValue='{1:result:objects:0:id}';var baseEntryRequestObj={'service':'baseentry','action':'list','filter:objectType':'KalturaBaseEntryFilter'};if(!kProperties.entry_id&&kProperties.flashvars.referenceId){baseEntryRequestObj['filter:referenceIdEqual']=kProperties.flashvars.referenceId;}else if(kProperties.entry_id){if(kProperties.features['entryRedirect']&&kProperties.flashvars.disableEntryRedirect!==true){baseEntryRequestObj['filter:redirectFromEntryId']=kProperties.entry_id;}else{baseEntryRequestObj['filter:idEqual']=kProperties.entry_id;}}var withProxyData=false;if(kProperties.proxyData){baseEntryRequestObj['filter:freeText']=JSON.stringify(kProperties.proxyData);withProxyData=true;}requestObject.push(baseEntryRequestObj);var streamerType=kProperties.flashvars.streamerType||'http';var flavorTags=kProperties.flashvars.flavorTags||'all';requestObject.push({'contextDataParams':{'referrer':window.kWidgetSupport.getHostPageUrl(),'objectType':'KalturaEntryContextDataParams','flavorTags':flavorTags,'streamerType':streamerType},'service':'baseentry','entryId':entryIdValue,'action':'getContextData'});requestObject.push({'service':'metadata_metadata','action':'list','version':'-1','filter:metadataObjectTypeEqual':1,'filter:orderBy':'+createdAt','filter:objectIdEqual':entryIdValue,'pager:pageSize':1});if(typeof kProperties.flashvars['metadataProfileId']!='undefined'){requestObject[requestObject.length-1]['filter:metadataProfileIdEqual']=kProperties.flashvars['metadataProfileId'];}if(kProperties.flashvars.getCuePointsData!==false){requestObject.push({'service':'cuepoint_cuepoint','action':'list','filter:objectType':'KalturaCuePointFilter','filter:orderBy':'+startTime','filter:statusEqual':1,'filter:entryIdEqual':entryIdValue});}_this.getNamedDataFromRequest(requestObject,fillCacheAndRunCallback,withProxyData);},getNamedDataFromRequest:function(requestObject,callback,withProxyData){var _this=this;this.clinet.doRequest(requestObject,function(data){var namedData={};if(data[0].code){mw.log('Error in kaltura api response: '+data[0].message);callback({'error':data[0].message});return;}var dataIndex=_this.baseDataInx;if(!data[dataIndex].objects||(data[dataIndex].objects&&data[dataIndex].objects.length==0)){namedData['meta']={code:'ENTRY_ID_NOT_FOUND',message:'Entry not found'};}else{namedData['meta']=data[dataIndex].objects[0];}dataIndex++;namedData['contextData']=data[dataIndex];dataIndex++;namedData['entryMeta']=_this.convertCustomDataXML(data[dataIndex]);dataIndex++;if(data[dataIndex]&&data[dataIndex].totalCount>0){namedData['entryCuePoints']=data[dataIndex].objects;}callback(namedData);},undefined,undefined,withProxyData);},convertCustomDataXML:function(data){var result={};if(data&&data.objects&&data.objects[0]){var xml=$.parseXML(data.objects[0].xml);var $xml=$(xml).find('metadata').children();$.each($xml,function(inx,node){result[node.nodeName]=node.textContent;});}return result;},getCacheKey:function(kProperties){var rKey='';if(kProperties){$.each(kProperties,function(inx,value){if(inx=='flashvars'){if(typeof kProperties.flashvars=='object'){rKey+=kProperties.flashvars.getCuePointsData;rKey+=kProperties.flashvars.ks;rKey+=kProperties.flashvars.referenceId;}}else{rKey+=inx+'_'+value;}});}return rKey;}};mw.kApiEntryLoader=function(kProperties,callback){if(!kProperties.widget_id){mw.log("Error:: mw.KApiPlayerLoader:: cant run player loader with widget_id "+kProperties.widget_id);}if(!kProperties.features){kProperties.features={};}var client=mw.kApiGetPartnerClient(kProperties.widget_id);var entryLoader=new mw.KEntryLoader(client,kProperties);entryLoader.get(callback);return client;};})(window.mw,jQuery);;},{},{});mw.loader.implement("mw.KWidgetSupport",function($){(function(mw,$){"use strict";mw.KApiPartnerCache=[];mw.kApiGetPartnerClient=function(widgetId){if(!mw.KApiPartnerCache[widgetId]){mw.KApiPartnerCache[widgetId]=new kWidget.api({'wid':widgetId});}return mw.KApiPartnerCache[widgetId];};mw.KWidgetSupport=function(options){return this.init(options);};mw.KWidgetSupport.prototype={kClient:null,kSessionId:null,originalStreamerType:null,init:function(options){if(options){$.extend(this,options);}this.addStringsSupport();this.addPlayerHooks();},addStringsSupport:function(){window.getStringByKey=function(key){var playerConfig=window.kalturaIframePackageData.playerConfig;var localizationCode=window.kalturaIframePackageData.enviornmentConfig["localizationCode"]||false;if(playerConfig&&playerConfig.plugins&&playerConfig.plugins.strings){if(localizationCode&&playerConfig.plugins.strings[localizationCode+"."+key]){return playerConfig.plugins.strings[localizationCode+"."+key];}else if(localizationCode&&playerConfig.plugins.strings[localizationCode]&&playerConfig.plugins.strings[localizationCode][key]){return playerConfig.plugins.strings[localizationCode][key];}else if(playerConfig.plugins.strings[key]){return playerConfig.plugins.strings[key];}else{return false;}}else{return false;}}},isIframeApiServer:function(){return(mw.getConfig('EmbedPlayer.IsIframeServer')&&mw.getConfig('EmbedPlayer.IframeParentUrl'));},addPlayerHooks:function(){var _this=this;$(mw).bind('KalturaSupportNewPlayer',function(event,embedPlayer){if(!embedPlayer.kwidgetid){mw.log("Error:: KalturaSupportNewPlayer without kwidgetid");return;}_this.bindPlayer(embedPlayer);new mw.KDPMapping(embedPlayer);if(kWidget.isIE8()&&!kWidget.supportsFlash()){embedPlayer.setError(embedPlayer.getKalturaMsg('ks-FLASH-REQUIRED'));}});},bindPlayer:function(embedPlayer){var _this=this;this.addPlayerMethods(embedPlayer);if(!embedPlayer.playerConfig){mw.log('Error: KWidgetSupport::bindPlayer error playerConfig not found');return;}mw.setConfig("nativeVersion",embedPlayer.getFlashvars("nativeVersion"));embedPlayer.bindHelper('directDownloadLink',function(event,downloadUrlCallback){var baseUrl=mw.getConfig('wgLoadScript').replace('load.php','');var downloadUrl=baseUrl+'modules/KalturaSupport/download.php/wid/'+embedPlayer.kwidgetid;if(embedPlayer.kuiconfid){downloadUrl+='/uiconf_id/'+embedPlayer.kuiconfid;}if(embedPlayer.kentryid){downloadUrl+='/entry_id/'+embedPlayer.kentryid;}var client=mw.kApiGetPartnerClient(embedPlayer.kwidgetid);downloadUrl+='/referrer/'+base64_encode(kWidgetSupport.getHostPageUrl());var ks=client.getKs();if(ks){downloadUrl+='/ks/'+ks;}downloadUrl+='/?playSessionId='+_this.getGUID();downloadUrlCallback(downloadUrl);});embedPlayer.bindHelper('checkPlayerSourcesEvent',function(event,callback){_this.originalStreamerType=embedPlayer.getKalturaConfig(null,'streamerType')?embedPlayer.getKalturaConfig(null,'streamerType'):'http';_this.loadAndUpdatePlayerData(embedPlayer,callback);});embedPlayer.bindHelper('KalturaSupport_EntryDataReady',function(){embedPlayer.setDuration(embedPlayer.kalturaPlayerMetaData.duration);var thumbUrl=_this.getKalturaThumbnailUrl({url:embedPlayer.evaluate('{mediaProxy.entry.thumbnailUrl}'),width:embedPlayer.getWidth(),height:embedPlayer.getHeight()});if(embedPlayer.getFlashvars('loadThumbnailWithKs')===true){thumbUrl+='/ks/'+embedPlayer.getFlashvars('ks');}if(mw.getConfig('thumbnailUrl')){thumbUrl=embedPlayer.evaluate(mw.getConfig('thumbnailUrl'));}var alt=gM('mwe-embedplayer-video-thumbnail-for',embedPlayer.evaluate('{mediaProxy.entry.name}'));embedPlayer.updatePoster(thumbUrl,alt);embedPlayer.isAudioPlayer=(embedPlayer.kalturaPlayerMetaData.mediaType===5);});embedPlayer.bindHelper('AddEmptyBlackSources',function(event,vid){$(vid).empty();$.each(mw.getConfig('Kaltura.BlackVideoSources'),function(inx,sourceAttr){$(vid).append($('<source />').attr(sourceAttr));});});embedPlayer.bindHelper('getShareIframeSrc',function(event,callback){var uiconf_id=(embedPlayer.kuiconfid)?'/uiconf_id/'+embedPlayer.kuiconfid:'';var iframeUrl=mw.getMwEmbedPath()+'mwEmbedFrame.php';iframeUrl+='/wid/'+embedPlayer.kwidgetid+uiconf_id+'/entry_id/'+embedPlayer.kentryid+'/'+'?'+kWidget.flashVarsToUrl(embedPlayer.getFlashvars());callback(iframeUrl);});if(!this.isEmbedServicesEnabled(kalturaIframePackageData.entryResult)){embedPlayer.shouldHandlePlayerError=false;embedPlayer.bindHelper('embedPlayerError',function(event,data,doneCallback){var displayedAcError=false;if(mw.getConfig("manualProvider")){embedPlayer.shouldHandlePlayerError=true;embedPlayer.handlePlayerError(data);return;}_this.getEntryIdSourcesFromApi(embedPlayer,embedPlayer.kentryid,function(sources){if(!sources||sources.message){embedPlayer.showErrorMsg(sources);displayedAcError=true;doneCallback();}});setTimeout(function(){if(displayedAcError){return;}embedPlayer.handlePlayerError(data,true);},3000);});}embedPlayer.bindHelper('Kaltura_SetKDPAttribute',function(e,componentName,property,value){if(!value&&value!==0){return;}var segmentChange=false;switch(property){case'mediaPlayFrom':embedPlayer.startTime=parseFloat(value);segmentChange=true;clearTimeout(window.timeoutID);break;case'mediaPlayTo':embedPlayer.pauseTime=parseFloat(value);segmentChange=true;embedPlayer.stopMonitor();clearTimeout(window.timeoutID);break;}if(segmentChange){window.timeoutID=setTimeout(function(){$(embedPlayer).trigger("playSegmentEvent",[embedPlayer.startTime,embedPlayer.pauseTime]);embedPlayer.playSegment(embedPlayer.startTime,embedPlayer.pauseTime);},100);}});},loadAndUpdatePlayerData:function(embedPlayer,callback){var _this=this;mw.log("KWidgetSupport::loadAndUpdatePlayerData");_this.loadPlayerData(embedPlayer,function(playerData){if(!playerData){mw.log("KWidgetSupport::loadAndUpdatePlayerData> error no player data!");callback();return;}_this.updatePlayerData(embedPlayer,playerData,callback);});},updatePlayerData:function(embedPlayer,playerData,callback){this.updatePlayerEntryData(embedPlayer,playerData);this.updatePlayerMetaData(embedPlayer,playerData);this.handlePlayerError(embedPlayer,playerData);this.updatePlayerContextData(embedPlayer,playerData);if(this.isLive(playerData)){this.updateLivePlayerData(embedPlayer,playerData);}else{if(this.isEmbedServicesEnabled(playerData)){this.updateEmbedServicesData(embedPlayer,playerData);}else{this.updateVodPlayerData(embedPlayer,playerData);this.updateDrmPlayerData(embedPlayer);}}this.updateImagePlayerData(embedPlayer,playerData);this.updateExternalPlayerData(embedPlayer,playerData);if(this.isNoEntryId(playerData)){this.handleNoEntryId();}this.initCuePointsService(embedPlayer,playerData);this.handleUiConf(embedPlayer,callback);},updatePlayerContextData:function(embedPlayer,playerData){if(playerData.contextData){if(playerData.contextData.msDuration){embedPlayer.kalturaPlayerMetaData.duration=Math.floor(playerData.contextData.msDuration/1000);}embedPlayer.kalturaContextData=playerData.contextData;if(playerData.contextData&&$.isArray(playerData.contextData.accessControlActions)){var kalturaAccessControlModifyRequestHostRegexActions=$.grep(playerData.contextData.accessControlActions,function(action){return action.type===7;});if(kalturaAccessControlModifyRequestHostRegexActions.length>0){var action=kalturaAccessControlModifyRequestHostRegexActions[0];if(action.pattern&&action.replacement){var regExp=new RegExp(action.pattern,"i");var urlsToModify=['Kaltura.ServiceUrl','Kaltura.StatsServiceUrl','Kaltura.ServiceBase','Kaltura.LiveStatsServiceUrl','Kaltura.AnalyticsUrl'];urlsToModify.forEach(function(key){var serviceUrl=mw.config.get(key);var match=serviceUrl.match(regExp);if(match){serviceUrl=serviceUrl.replace(regExp,action.replacement);mw.config.set(key,serviceUrl);}});}}}}},isLive:function(playerData){return playerData.meta&&(playerData.meta.type==7||playerData.meta.type==8);},updateLivePlayerData:function(embedPlayer,playerData){var isStreamSupported=false;if(this.isOnlyHlsSources(playerData)){mw.setConfig("LeadWithHLSOnFlash",true);}if(playerData&&playerData.meta&&(playerData.meta.sourceType==="32"||playerData.meta.sourceType==="33")&&!mw.getConfig('forceHDS')){mw.setConfig("LeadWithHLSOnFlash",true);mw.setConfig("isLiveKalturaHLS",true);}var legacyMulticastSource=this.getLegacyLiveMulticastSource(playerData);if(legacyMulticastSource){this.addLiveEntrySource(embedPlayer,playerData.meta,false,true,'multicast_silverlight');isStreamSupported=true;embedPlayer.setLive(true);}if(embedPlayer.getFlashvars("LeadWithUnicastToMulticast")===true){this.addLiveEntrySource(embedPlayer,playerData.meta,false,true,'applehttp_to_mc');isStreamSupported=true;embedPlayer.setLive(true);if(embedPlayer.getFlashvars("disableMulticastFallback")){return;}}if(this.hasHlsSourcse(playerData)&&mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('application/vnd.apple.mpegurl').length){if(this.isManualProvider(playerData)){this.addManualProviderSources(embedPlayer,playerData);embedPlayer.setLive(true);}else{this.addLiveEntrySource(embedPlayer,playerData.meta,false,false,'applehttp');embedPlayer.setLive(true);}}else if(mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('kplayer')){var streamerType=this.resolveFlashStreamerType(embedPlayer,playerData);this.addLiveEntrySource(embedPlayer,playerData.meta,true,false,streamerType);embedPlayer.setLive(true);}else if(!isStreamSupported){embedPlayer.setError(embedPlayer.getKalturaMsg('LIVE-STREAM-NOT-SUPPORTED'));}},hasLivestreamConfig:function(playerData,protocol){var configurations=playerData.meta.liveStreamConfigurations;if(configurations&&configurations.length){for(var i=0;i<configurations.length;i++){if(configurations[i].protocol==protocol){return true;}}}return false;},isOnlyHlsSources:function(playerData){var hasOnlyHLS=false;var configurations=playerData.meta.liveStreamConfigurations;if(playerData.meta.hlsStreamUrl&&(!configurations||configurations.length==0)){hasOnlyHLS=true;}else if(configurations){for(var i=0;i<configurations.length;i++){if(configurations[i].protocol!="hls"&&configurations[i].protocol!="applehttp"){hasOnlyHLS=false;break;}hasOnlyHLS=true;}}return hasOnlyHLS;},getLegacyLiveMulticastSource:function(playerData){var source=null;if(mw.EmbedTypes.getMediaPlayers().isSupportedPlayer('splayer')){if(playerData.contextData&&playerData.contextData.flavorAssets){var flavorData=playerData.contextData.flavorAssets;for(var i=0;i<flavorData.length;i++){var tags=flavorData[i].tags.toLowerCase().split(',');if($.inArray('multicast_silverlight',tags)!=-1){source=flavorData;break;}}}}return source;},hasHlsSourcse:function(playerData){return(playerData.meta.hlsStreamUrl||this.hasLivestreamConfig(playerData,'hls')||this.hasLivestreamConfig(playerData,'applehttp'));},isManualProvider:function(playerData){return(playerData.entry&&playerData.entry.manualProvider);},addManualProviderSources:function(embedPlayer,playerData){if(playerData.meta.hdsStreamUrl){embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':playerData.meta.hdsStreamUrl,'type':'application/vnd.apple.mpegurl'})[0]);}embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':playerData.meta.hlsStreamUrl,'type':'application/vnd.apple.mpegurl'})[0]);},resolveFlashStreamerType:function(embedPlayer,playerData){var streamerType;var streamerTypeFV=embedPlayer.getKalturaConfig(null,'streamerType');if(streamerTypeFV&&this.hasLivestreamConfig(playerData,streamerTypeFV)){streamerType=streamerTypeFV;}else if(this.hasLivestreamConfig(playerData,'hdnetworkmanifest')){streamerType='hdnetworkmanifest';}else if(this.hasLivestreamConfig(playerData,'hds')){streamerType='hds';}else{streamerType='rtmp';}return streamerType;},isEmbedServicesEnabled:function(playerData){if(playerData&&playerData.meta&&playerData.meta.partnerData&&playerData.meta.partnerData["proxyEnabled"]&&playerData.meta.partnerData["proxyEnabled"]==="true"){return true;}else{return false;}},updateEmbedServicesData:function(embedPlayer,playerData){var _this=this;var flavorAssets=[];var flavorData=playerData.contextData.flavorAssets;var flavorDrmData=this.getFlavorAssetsDrmData(playerData);$.each(flavorData,function(index,flavorAsset){var flavorPartnerData=flavorAsset.partnerData;if(flavorPartnerData.url!=""){var flavorAssetObj={"data-assetid":flavorAsset.id,src:_this.addSessionIdToSrc(flavorPartnerData.url),type:flavorPartnerData.type,"data-width":flavorAsset.width,"data-height":flavorAsset.height,"data-bitrate":flavorAsset.bitrate,"data-bandwidth":(flavorAsset.bitrate?(flavorAsset.bitrate*1024):0),"data-frameRate":flavorAsset.frameRate,"data-flavorid":flavorPartnerData.flavorid};if(flavorPartnerData["default"]==="true"){flavorAssetObj["default"]=true;}_this.attachFlavorAssetDrmData(flavorAssetObj,flavorAsset.id,flavorDrmData);if(flavorAssetObj.type==="application/vnd.apple.mpegurl"){flavorAssetObj.fpsCertificate=_this.getFairplayCert(playerData);}flavorAssets.push(flavorAssetObj);}});embedPlayer.replaceSources(flavorAssets);if(playerData.meta.partnerData["isLive"]&&playerData.meta.partnerData["isLive"]=="true"){embedPlayer.setLive(true);}embedPlayer.setKalturaConfig('originalProxyData',embedPlayer.getKalturaConfig('proxyData'));embedPlayer.setKalturaConfig('proxyData',playerData.meta.partnerData);},addSessionIdToSrc:function(srcURL){if(srcURL&&srcURL.toLowerCase().indexOf("playmanifest")===-1){return srcURL;}var nativeVersion=mw.getConfig("nativeVersion");nativeVersion=(nativeVersion!=null&&nativeVersion.length>0)?'_'+nativeVersion:'';var clientTag='html5:v'+window['MWEMBED_VERSION']+nativeVersion;var qp=(srcURL.indexOf('?')===-1)?'?':'&';return srcURL+qp+'playSessionId='+this.getGUID()+'&clientTag='+clientTag;},updateVodPlayerData:function(embedPlayer,playerData){embedPlayer.setLive(false);if(playerData.contextData&&playerData.contextData.flavorAssets){this.addFlavorSources(embedPlayer,playerData);}if(playerData.sources){this.addSources(embedPlayer,playerData.sources);}},updateDrmPlayerData:function(embedPlayer){var drmSources=embedPlayer.mediaElement.sources.filter(function(source){return(source.signature&&source.custom_data);});var drmRequired=(drmSources.length>0);embedPlayer.setDrmRequired(drmRequired);},updateImagePlayerData:function(embedPlayer,playerData){if(playerData.meta&&playerData.meta.mediaType==2){mw.log('KWidgetSupport::updatePlayerData: Add Entry Image');embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':this.getKalturaThumbnailUrl({url:playerData.meta.thumbnailUrl,width:embedPlayer.getWidth(),height:embedPlayer.getHeight()}),'type':'image/jpeg'}).get(0));}},updateExternalPlayerData:function(embedPlayer,playerData){if(playerData.meta&&playerData.meta.type=="externalMedia.externalMedia"){$(embedPlayer).trigger('KalturaSupport_AddExternalMedia',playerData.meta);}},isNoEntryId:function(playerData){return playerData.meta&&playerData.meta.code=='ENTRY_ID_NOT_FOUND';},handleNoEntryId:function(embedPlayer){$(embedPlayer).trigger('KalturaSupport_EntryFailed');},updatePlayerEntryData:function(embedPlayer,playerData){embedPlayer.kalturaEntryMetaData=(playerData.entryMeta)?playerData.entryMeta:playerData.entryMetadata;},updatePlayerMetaData:function(embedPlayer,playerData){var meta=(playerData.meta)?playerData.meta:playerData.entry;if(meta){embedPlayer.kalturaPlayerMetaData=meta;if(meta.moderationStatus&&(!playerData.contextData||!playerData.contextData.isAdmin)){if(meta.moderationStatus==1){embedPlayer.setError(embedPlayer.getKalturaMsgObject('ks-ENTRY_MODERATE'));}else if(meta.moderationStatus==3){embedPlayer.setError(embedPlayer.getKalturaMsgObject('ks-ENTRY_REJECTED'));}}}},initCuePointsService:function(embedPlayer,playerData){if((playerData.entryCuePoints&&playerData.entryCuePoints.length>0)||(embedPlayer.isLive()&&mw.getConfig("EmbedPlayer.LiveCuepoints"))){embedPlayer.rawCuePoints=playerData.entryCuePoints||[];embedPlayer.kCuePoints=new mw.KCuePoints(embedPlayer);}},addPlayerMethods:function(embedPlayer){var _this=this;embedPlayer.getRawKalturaConfig=function(confPrefix,attr){var rawConfigArray=_this.getRawPluginConfig(embedPlayer,confPrefix,attr);if($.isPlainObject(rawConfigArray)&&attr){return rawConfigArray[attr];}return rawConfigArray;};embedPlayer.getKalturaConfig=function(confPrefix,attr){return _this.getPluginConfig(embedPlayer,confPrefix,attr);};embedPlayer.setKalturaConfig=function(pluginName,key,value,quiet){if(!key){return;}var objectSet={};if(typeof key==="string"){objectSet[key]=value;}if(typeof key==="object"){objectSet=key;}if(!embedPlayer.playerConfig){embedPlayer.playerConfig={'plugins':{},'vars':{}};}if(!pluginName){embedPlayer.playerConfig['vars'][key]=value;}else if(!embedPlayer.playerConfig['plugins'][pluginName]){embedPlayer.playerConfig['plugins'][pluginName]=objectSet;}else{if(typeof key==='object'){$.extend(embedPlayer.playerConfig['plugins'][pluginName],objectSet);mw.log('merged:: ',embedPlayer.playerConfig['plugins'][pluginName]);}else if($.isArray(embedPlayer.playerConfig['plugins'][pluginName][key])&&$.isArray(value)){embedPlayer.playerConfig['plugins'][pluginName][key]=value;}else if(typeof embedPlayer.playerConfig['plugins'][pluginName][key]==='object'&&typeof value==='object'){$.extend(embedPlayer.playerConfig['plugins'][pluginName][key],value);}else{embedPlayer.playerConfig['plugins'][pluginName][key]=value;}}if(!quiet){embedPlayer.triggerHelper('Kaltura_ConfigChanged',[pluginName,key,value]);}};embedPlayer.addExportedObject=function(pluginName,objectSet){mw.log("KwidgetSupport:: addExportedObject is deprecated, please use standard setKalturaConfig");for(var key in objectSet){embedPlayer.setKalturaConfig(pluginName,key,objectSet[key]);}};embedPlayer.isPluginEnabled=function(pluginName){var lcPluginName=(pluginName.substr(0,1))?pluginName.substr(0,1).toLowerCase()+pluginName.substr(1):false;if(lcPluginName){if(_this.getRawPluginConfig(embedPlayer,lcPluginName)===undefined){return false;}if(_this.getPluginConfig(embedPlayer,lcPluginName,'plugin')===false){return false;}if(_this.getPluginConfig(embedPlayer,lcPluginName,'disableHTML5')){return false;}return true;}return false;};embedPlayer.getFlashvars=function(param){if(!embedPlayer.playerConfig||!embedPlayer.playerConfig.vars){return{};}var fv=embedPlayer.playerConfig['vars']||{};if(param){if(param in fv){return fv[param];}else{return undefined;}}return fv;}
embedPlayer.setFlashvars=function(key,value){if(key){embedPlayer.playerConfig['vars'][key]=value;}}
embedPlayer.getKalturaMsg=function(msgKey){var localeMsgKey=msgKey;if(embedPlayer.currentLocale){localeMsgKey=embedPlayer.currentLocale+'_'+msgKey;}if(_this.getPluginConfig(embedPlayer,'strings',localeMsgKey)){return _this.getPluginConfig(embedPlayer,'strings',localeMsgKey);}if(mw.messages.exists(msgKey)){return gM(msgKey);}msgKey='ks-'+msgKey;if(mw.messages.exists(msgKey)){return gM(msgKey);}if(msgKey.indexOf('_TITLE')==-1){return gM('ks-GENERIC_ERROR');}return gM('ks-GENERIC_ERROR_TITLE');};embedPlayer.getKalturaMsgTitle=function(msgKey){return embedPlayer.getKalturaMsg(msgKey+'_TITLE');};embedPlayer.getKalturaMsgObject=function(msgKey){return{'title':embedPlayer.getKalturaMsgTitle(msgKey),'message':embedPlayer.getKalturaMsg(msgKey)}};embedPlayer.resolveSrcURL=function(srcURL){var deferred=$.Deferred();var eventObj={"src":srcURL,"promise":deferred,"handled":false};embedPlayer.triggerHelper('preResolveSrc',eventObj);if(eventObj.handled){return eventObj.promise;}if(mw.getConfig("EmbedPlayer.UseDirectManifestLinks")){return deferred.resolve(srcURL);}if(srcURL&&srcURL.toLowerCase().indexOf("playmanifest")===-1){return deferred.resolve(srcURL);}var srcToPlay=null;var qp=(srcURL.indexOf('?')===-1)?'?':'&';$.ajax({url:srcURL+qp+"responseFormat=jsonp",timeout:7000,dataType:'jsonp',success:function(playmanifest){var flavors=playmanifest.flavors;if(flavors&&flavors.length===1){srcToPlay=flavors[0].url;deferred.resolve(srcToPlay);}else if(flavors&&flavors.length>1){if(srcURL.indexOf("applehttp_to_mc")===-1)deferred.resolve(srcURL);else deferred.resolve(playmanifest);}else{deferred.reject();}},error:function(){deferred.reject();}});return deferred.promise();};},handleUiConf:function(embedPlayer,callback){var _this=this;var doneWithUiConf=function(){if(embedPlayer.rawCuePoints||(embedPlayer.isLive()&&mw.getConfig("EmbedPlayer.LiveCuepoints"))){mw.log("KWidgetSupport:: trigger KalturaSupport_CuePointsReady",embedPlayer.rawCuePoints);$(embedPlayer).trigger('KalturaSupport_CuePointsReady',[embedPlayer.rawCuePoints]);}if(embedPlayer.kalturaPlayerMetaData){$(embedPlayer).trigger('KalturaSupport_EntryDataReady',embedPlayer.kalturaPlayerMetaData);}if(embedPlayer.kalturaEntryMetaData){$(embedPlayer).trigger('KalturaSupport_MetadataReceived',embedPlayer.kalturaEntryMetaData);}mw.log("KWidgetSupport:: trigger KalturaSupport_DoneWithUiConf");setTimeout(function(){$(embedPlayer).trigger('KalturaSupport_DoneWithUiConf');callback();},0);};if(embedPlayer.playerConfig){_this.baseUiConfChecks(embedPlayer);embedPlayer.$uiConf=$({});mw.log("KWidgetSupport:: trigger Kaltura_CheckConfig");$(embedPlayer).triggerQueueCallback('Kaltura_CheckConfig',embedPlayer,function(){doneWithUiConf();});}else{doneWithUiConf();}},baseUiConfChecks:function(embedPlayer){var _this=this;var getAttr=function(attrName){return _this.getPluginConfig(embedPlayer,'',attrName);}
var autoPlay=getAttr('autoPlay');if(autoPlay){embedPlayer.autoplay=true;}var inline=getAttr('EmbedPlayer.WebKitPlaysInline');if(inline){embedPlayer.inline=true;}var autoMute=getAttr('autoMute');if(autoMute&&!mw.isMobileDevice()){setTimeout(function(){embedPlayer.toggleMute(true);},300);embedPlayer.setKalturaConfig('','autoMute',null);}var loop=getAttr('loop');if(loop){embedPlayer.loop=true;}if(getAttr('disableAlerts')){mw.setConfig('EmbedPlayer.ShowPlayerAlerts',false);}var mediaProxy=embedPlayer.getKalturaConfig('mediaProxy');if(mediaProxy){var preferedFlavorBR=mediaProxy.preferedFlavorBR;if(getAttr('disableBitrateCookie')&&preferedFlavorBR){embedPlayer.setCookie('EmbedPlayer.UserBandwidth',preferedFlavorBR*1000);}if(preferedFlavorBR&&embedPlayer.mediaElement){embedPlayer.mediaElement.preferedFlavorBR=preferedFlavorBR*1000;}var mediaPlayFrom=kWidget.getHashParam("t");if(mediaPlayFrom){mediaPlayFrom=kWidget.npt2seconds(mediaPlayFrom);}if(mediaProxy.mediaPlayFrom){mediaPlayFrom=mediaProxy.mediaPlayFrom;}if(mediaPlayFrom&&!embedPlayer.startTime){embedPlayer.startTime=parseFloat(mediaPlayFrom);mw.setConfig("Kaltura.UseAppleAdaptive",true);}var mediaPlayTo=mediaProxy.mediaPlayTo;if(mediaPlayTo&&!embedPlayer.pauseTime){embedPlayer.pauseTime=parseFloat(mediaPlayTo);}}if(getAttr('enableTooltips')===false){embedPlayer.enableTooltips=false;}var imageDuration=getAttr('imageDefaultDuration');if(imageDuration){$(embedPlayer).data('imageDuration',imageDuration);}if(getAttr('adsOnReplay')){embedPlayer.adsOnReplay=true;}if(getAttr('disablePlayerSpinner')){mw.setConfig('LoadingSpinner.Disabled',true);}var streamerType=embedPlayer.getKalturaConfig(null,'streamerType');if(embedPlayer.kalturaContextData&&streamerType=='auto'){embedPlayer.streamerType=embedPlayer.kalturaContextData.streamerType;}else if(streamerType){embedPlayer.streamerType=streamerType;}embedPlayer.setFlashvars('streamerType',_this.originalStreamerType);},getPluginConfig:function(embedPlayer,confPrefix,attr){var singleAttrName=false;if(typeof attr=='string'){singleAttrName=attr;}var rawConfigArray=this.getRawPluginConfig(embedPlayer,confPrefix,singleAttrName);var configArray=this.postProcessConfig(embedPlayer,rawConfigArray);if(singleAttrName!=false){return configArray[singleAttrName];}else{return configArray;}},getRawPluginConfig:function(embedPlayer,confPrefix,attr){var _this=this;if(!embedPlayer.playerConfig){if(window.kalturaIframePackageData.playerConfig){embedPlayer.playerConfig=window.kalturaIframePackageData.playerConfig;delete(window.kalturaIframePackageData.playerConfig);}}var plugins=embedPlayer.playerConfig['plugins'];var returnConfig={};if(confPrefix&&confPrefix[0]){confPrefix=confPrefix[0].toLowerCase()+confPrefix.substr(1);}if(confPrefix&&plugins[confPrefix]){if(!attr){return plugins[confPrefix];}if(attr&&typeof plugins[confPrefix][attr]!=='undefined'){returnConfig[attr]=plugins[confPrefix][attr];}if(attr&&typeof attr=='object'){for(var currAttr in attr){if(plugins[confPrefix][attr[currAttr]]){returnConfig[attr[currAttr]]=plugins[confPrefix][attr[currAttr]];}}}}else if(!confPrefix&&attr){returnConfig[attr]=embedPlayer.playerConfig['vars'][attr];}else{return undefined;}return returnConfig;},postProcessConfig:function(embedPlayer,config){var _this=this;var returnSet=$.extend({},config);$.each(returnSet,function(attrName,value){if(value&&(typeof value==='string')){returnSet[attrName]=unescape(value);}if(embedPlayer.evaluate){returnSet[attrName]=embedPlayer.evaluate(returnSet[attrName]);}});return returnSet;},getEntryIdSourcesFromApi:function(embedPlayer,entryId,callback){var _this=this;var sources;mw.log("KWidgetSupport:: getEntryIdSourcesFromApi: w:"+embedPlayer.kwidgetid+' entry:'+embedPlayer.kentryid);this.kClient=mw.kApiEntryLoader({'widget_id':embedPlayer.kwidgetid,'entry_id':entryId},function(playerData){if(playerData.contextData){var acStatus=_this.getAccessControlStatus(playerData.contextData,embedPlayer);if(acStatus!==true){callback(acStatus);return;}}if(playerData.meta&&playerData.meta.mediaType==2){sources=[{'src':_this.getKalturaThumbnailUrl({url:playerData.meta.thumbnailUrl,width:embedPlayer.getWidth(),height:embedPlayer.getHeight()}),'type':'image/jpeg'}];}else{sources=_this.getEntryIdSourcesFromPlayerData(embedPlayer.kpartnerid,playerData);}callback(sources);});},loadPlayerData:function(embedPlayer,callback){var _this=this;var playerRequest={};if(!embedPlayer.kwidgetid){mw.log("Error: missing required widget paramater ( kwidgetid ) ");callback(false);return;}else{playerRequest.widget_id=embedPlayer.kwidgetid;}if(!this.checkForUrlEntryId(embedPlayer)&&embedPlayer.kentryid){playerRequest.entry_id=embedPlayer.kentryid;}var proxyData=embedPlayer.getKalturaConfig('proxyData','data');if(proxyData){playerRequest.proxyData=proxyData;}playerRequest.flashvars=embedPlayer.getFlashvars();playerRequest.features=kalturaIframePackageData.apiFeatures;this.kClient=mw.kApiGetPartnerClient(playerRequest.widget_id);this.kClient.setKs(embedPlayer.getFlashvars('ks'));if(window.kalturaIframePackageData&&window.kalturaIframePackageData.playlistResult){var pl=window.kalturaIframePackageData.playlistResult;for(var plId in pl)break;if(pl[plId].content.indexOf('<?xml')===0){var entryList=[];for(var i in pl[plId].items){entryList.push(pl[plId].items[i].id);}pl[plId].content=entryList.join(',');}embedPlayer.kalturaPlaylistData=pl;delete(window.kalturaIframePackageData.playlistResult);}if(window.kalturaIframePackageData&&window.kalturaIframePackageData.entryResult){var entryResult=window.kalturaIframePackageData.entryResult;_this.handlePlayerData(embedPlayer,entryResult);var kpartnerid=embedPlayer.kpartnerid?embedPlayer.kpartnerid:"";if(this.isEmbedServicesEnabled(entryResult)||"_"+kpartnerid==playerRequest.widget_id||_this.kClient.getKs()){callback(entryResult);}else{this.kClient.forceKs(playerRequest.widget_id,function(ks){_this.kClient.setKs(ks);if(embedPlayer.playerConfig&&!embedPlayer.playerConfig.vars){embedPlayer.playerConfig.vars={};}embedPlayer.playerConfig.vars.ks=ks;callback(entryResult);},function(){mw.log("Error occur while trying to create widget KS");callback(entryResult);});}delete(window.kalturaIframePackageData.entryResult);return;}_this.kClient=mw.kApiEntryLoader(playerRequest,function(playerData){_this.handlePlayerData(embedPlayer,playerData);callback(playerData);});},handlePlayerError:function(embedPlayer,data){var errObj=null;if(data.meta&&data.meta.code=="INVALID_KS"){errObj=embedPlayer.getKalturaMsgObject("NO_KS");}if(data.meta&&(data.meta.status==1||data.meta.status==0)){errObj=embedPlayer.getKalturaMsgObject("ks-ENTRY_CONVERTING");}if(data.error){errObj=embedPlayer.getKalturaMsgObject('GENERIC_ERROR');errObj.message=data.error;if(data.contextData&&data.contextData.isScheduledNow===false){errObj=embedPlayer.getKalturaMsgObject("OUT_OF_SCHEDULING");}}if(errObj){embedPlayer.hideSpinner();embedPlayer.setError(errObj);}},handlePlayerData:function(embedPlayer,entryResult){if(entryResult.meta&&entryResult.meta.id){embedPlayer.kentryid=entryResult.meta.id;embedPlayer.kpartnerid=entryResult.meta.partnerId;}this.handlePlayerError(embedPlayer,entryResult);if(entryResult.entry&&entryResult.entry.manualProvider){mw.setConfig("manualProvider",true);}},getAccessControlStatus:function(ac,embedPlayer){if(ac.isCountryRestricted){return embedPlayer.getKalturaMsgObject('UNAUTHORIZED_COUNTRY');}if(ac.isScheduledNow===0){return embedPlayer.getKalturaMsgObject('OUT_OF_SCHEDULING');}if(ac.isIpAddressRestricted){return embedPlayer.getKalturaMsgObject('UNAUTHORIZED_IP_ADDRESS');}if(ac.isSessionRestricted&&ac.previewLength===-1){return embedPlayer.getKalturaMsgObject('NO_KS');}if(ac.isSiteRestricted){return embedPlayer.getKalturaMsgObject('UNAUTHORIZED_DOMAIN');}if(ac.isUserAgentRestricted){return embedPlayer.getKalturaMsgObject('USER_AGENT_RESTRICTED');}if(ac.accessControlActions&&ac.accessControlActions.length){var msgObj=embedPlayer.getKalturaMsgObject('GENERIC_ERROR');var err=false;$.each(ac.accessControlActions,function(){if(this.type==1){msgObj.message='';if(ac.accessControlMessages&&ac.accessControlMessages.length){$.each(ac.accessControlMessages,function(){msgObj.message+=this.value+'\n';err=true;});}else{msgObj=embedPlayer.getKalturaMsgObject('NO_KS');err=true;}}});if(err){return msgObj;}}return true;},getUiConfId:function(embedPlayer){return embedPlayer.kuiconfid;},checkForUrlEntryId:function(embedPlayer){if(embedPlayer.kentryid&&typeof embedPlayer.kentryid=='string'&&embedPlayer.kentryid.indexOf('://')!=-1){embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':embedPlayer.kentryid}).get(0));return true;}return false;},addSources:function(embedPlayer,sources){$.each(sources,function(inx,source){embedPlayer.mediaElement.tryAddSource($('<source />').attr(source).get(0));});},addFlavorSources:function(embedPlayer,playerData){var _this=this;var sources=embedPlayer.mediaElement.getSources();if(sources[0]&&sources[0]['data-flavorid']){return;}var flavorSources=_this.getEntryIdSourcesFromPlayerData(embedPlayer.kpartnerid,playerData);embedPlayer.kalturaFlavors=flavorSources;var preferedBitRate=embedPlayer.evaluate('{mediaProxy.preferedFlavorBR}');var flashvarsPlayMainfestParams=this.getPlayMainfestParams(embedPlayer);var qp='';for(var i=0;i<flavorSources.length;i++){var source=flavorSources[i];if(preferedBitRate&&source.type=='application/vnd.apple.mpegurl'){qp=(source.src.indexOf('?')===-1)?'?':'&';source.src=source.src+qp+'preferredBitrate='+preferedBitRate;}if(source['disableQueryString']){var mParams=this.getPlayMainfestParams(embedPlayer,true);if(mParams!=''){var index=source.src.lastIndexOf('/a.');source.src=source.src.substring(0,index)+'/'+mParams+source.src.substring(index);}}else{qp=(source.src.indexOf('?')===-1)?'?':'&';source.src=source.src+qp+flashvarsPlayMainfestParams;}mw.log('KWidgetSupport:: addSource::'+embedPlayer.id+' : '+source.src+' type: '+source.type);var sourceElm=$('<source />').attr(source).get(0);embedPlayer.mediaElement.tryAddSource(sourceElm);}},getPlayMainfestParams:function(embedPlayer,disableQueryString){var p='';var and='';var equalDelimiter='=';var andDelimiter='&';if(disableQueryString){andDelimiter=equalDelimiter='/';}var urlParms=["deliveryCode","storageId","maxBitrate","playbackContext","seekFrom","clipTo"];$.each(urlParms,function(inx,param){if(embedPlayer.getFlashvars(param)){p+=and+param+equalDelimiter+embedPlayer.getFlashvars(param);and=andDelimiter;}});p+=and+'uiConfId'+equalDelimiter+embedPlayer.kuiconfid;return p;},getHostPageUrl:function(){var hostUrl=(mw.getConfig('EmbedPlayer.IframeParentUrl'))?mw.getConfig('EmbedPlayer.IframeParentUrl'):(document.referrer||document.URL);if(hostUrl.indexOf("#")!==-1){hostUrl=hostUrl.substr(0,hostUrl.indexOf("#"));}hostUrl=hostUrl.substr(0,hostUrl.indexOf("/",8));return hostUrl;},getBaseFlavorUrl:function(partnerId){if(mw.getConfig('Kaltura.UseManifestUrls')){return mw.getConfig('Kaltura.ServiceUrl')+'/p/'+partnerId+'/sp/'+partnerId+'00/playManifest';}else{return mw.getConfig('Kaltura.CdnUrl')+'/p/'+partnerId+'/sp/'+partnerId+'00/flvclipper';}},getEntryIdSourcesFromPlayerData:function(partnerId,playerData){var _this=this;if(!playerData.contextData||(playerData.contextData&&!playerData.contextData.flavorAssets)){mw.log("Error: KWidgetSupport: contextData.flavorAssets is not defined ");return;}var flavorData=playerData.contextData.flavorAssets;var flavorDrmData=this.getFlavorAssetsDrmData(playerData);var protocol=mw.getConfig('Kaltura.Protocol');if(!protocol){protocol=window.location.protocol.replace(':','');}var deviceSources=[];var ipadAdaptiveFlavors=[];var iphoneAdaptiveFlavors=[];var androidNativeAdaptiveFlavors=[];var dashAdaptiveFlavors=[];var flavorUrl=_this.getBaseFlavorUrl(partnerId);var hasH264Flavor=false;var hasIsmFlavor=false;for(var i=0;i<flavorData.length;i++){var asset=flavorData[i];var sourceAspect=Math.round((asset.width/asset.height)*100)/100
var source={'data-sizebytes':asset.size*1024,'data-bandwidth':asset.bitrate*1024,'data-width':asset.width,'data-height':asset.height,'data-aspect':sourceAspect,'data-tags':asset.tags,'data-assetid':asset.id};var tags=asset.tags.toLowerCase().split(',');if(asset.status!=2){if(asset.status==4){source.error='not-ready-transcoding';mw.log("KWidgetSupport:: Skip sources that are not ready: "+asset.id+' '+asset.tags);}continue;}if(mw.getConfig('Kaltura.UseManifestUrls')){var src=flavorUrl+'/entryId/'+asset.entryId;if(mw.getConfig('Kaltura.UseAppleAdaptive')&&$.inArray('applembr',tags)!=-1){src+='/format/applehttp/protocol/'+protocol+'/a.m3u8';deviceSources.push({'data-aspect':sourceAspect,'data-flavorid':'AppleMBR','type':'application/vnd.apple.mpegurl','src':src});continue;}else{src+='/flavorId/'+asset.id+'/format/url/protocol/'+protocol;}}else{mw.log("Error: KWidgetSupport: non-manifest urls are deprecated");var src=flavorUrl+'/entry_id/'+asset.entryId+'/flavor/'+asset.id;}if($.inArray('ipad',tags)!=-1){source['src']=src+'/a.mp4';source['data-flavorid']='iPad';source['type']='video/mp4; codecs="avc1.42E01E, mp4a.40.2';hasH264Flavor=true;}if($.inArray('iphone',tags)!=-1){source['src']=src+'/a.mp4';source['data-flavorid']='iPhone';source['type']='video/mp4; codecs="avc1.42E01E, mp4a.40.2';hasH264Flavor=true;}if(($.inArray('mbr',tags)!=-1||$.inArray('web',tags)!=-1)&&$.isEmptyObject(source['src'])&&!mw.isMobileDevice()&&asset.fileExt){if(asset.fileExt.toLowerCase()=='mp4'){source['src']=src+'/a.mp4';source['type']='video/mp4; codecs="avc1.42E01E, mp4a.40.2';hasH264Flavor=true;}else if(asset.fileExt.toLowerCase()=='flv'){source['src']=src+'/a.flv';source['type']='video/x-flv';}}if(asset.fileExt&&(asset.fileExt.toLowerCase()=='ogg'||asset.fileExt.toLowerCase()=='ogv'||(asset.containerFormat&&asset.containerFormat.toLowerCase()=='ogg'))){source['src']=src+'/a.ogg';source['data-flavorid']='ogg';source['type']='video/ogg';}if(asset.fileExt&&asset.containerFormat&&(asset.fileExt=='webm'||$.inArray('webm',tags)!=-1||(asset.containerFormat.toLowerCase()=='webm'))){source['src']=src+'/a.webm';source['data-flavorid']='webm';source['type']='video/webm; codecs="vp8, vorbis';}if(asset.fileExt&&asset.fileExt=='mov'){source['src']=src+'/a.mov';source['data-flavorid']='mov';source['type']='video/mp4';}if(asset.fileExt&&asset.fileExt=='3gp'){source['src']=src+'/a.3gp';source['data-flavorid']='3gp';source['type']='video/3gp';}if(asset.fileExt&&asset.fileExt=='mp3'){source['src']=src+'/a.mp3';source['data-flavorid']='mp3';source['type']='audio/mp3';}if(asset.fileExt&&asset.fileExt=='wvm'){source['src']=src+'/a.wvm';source['data-flavorid']='wvm';source['type']='video/wvm';source['disableQueryString']=true;}if(asset.tags&&asset.tags=='kontiki'){source['src']=src+'/a.mp4';source['data-flavorid']='kontiki';source['type']='video/kontiki';}if(asset.tags&&asset.tags.indexOf('ism_manifest')!=-1){src=src.replace("/format/url/","/format/sl/");source['src']=src+'/a.ism';source['data-flavorid']='ism';if(asset.tags.indexOf('playready')!=-1){source['type']='video/playreadySmooth';}else{source['type']='video/ism';}hasIsmFlavor=true;}var assetDrmData=this.getFlavorAssetDrmData(asset.id,flavorDrmData);$.extend(source,assetDrmData);if(source['src']){deviceSources.push(source);}if(navigator.userAgent.indexOf('Android')!==-1&&asset.width==0&&asset.height==0){continue;}if($.inArray('ipadnew',tags)!=-1){ipadAdaptiveFlavors.push(asset.id);}if($.inArray('iphonenew',tags)!=-1){ipadAdaptiveFlavors.push(asset.id);iphoneAdaptiveFlavors.push(asset.id);}if($.inArray('h264b',tags)!=-1){androidNativeAdaptiveFlavors.push(asset.id);}if($.inArray('dash',tags)!=-1){dashAdaptiveFlavors.push(asset.id);}}for(var i=0;i<deviceSources.length;i++){var source=deviceSources[i];if(!this.isValidAspect(source['data-aspect'])){source['data-aspect']=this.getValidAspect(deviceSources);}}if(mw.getConfig('Kaltura.UseFlavorIdsUrls')&&mw.getConfig('Kaltura.UseAppleAdaptive')&&$.grep(deviceSources,function(a){if(a['data-flavorid']=='AppleMBR'){return true;}}).length==0){var addedHlsStream=false;if(iphoneAdaptiveFlavors.length||ipadAdaptiveFlavors.length||androidNativeAdaptiveFlavors.length){var validClipAspect=this.getValidAspect(deviceSources);var lowResolutionDevice=(mw.isMobileDevice()&&mw.isDeviceLessThan480P()&&iphoneAdaptiveFlavors.length);var targetFlavors;if(mw.getConfig('Kaltura.ForceHighResFlavors')){mw.log('KWidgetSupport::Forcing High resolution flavours');if(ipadAdaptiveFlavors.length||dashAdaptiveFlavors.length){mw.log('KWidgetSupport::High resolution flavours found');targetFlavors=ipadAdaptiveFlavors;if(dashAdaptiveFlavors.length){targetFlavors=targetFlavors.concat(dashAdaptiveFlavors);for(var i=0;i<targetFlavors.length;++i){for(var j=i+1;j<targetFlavors.length;++j){if(targetFlavors[i]===targetFlavors[j])targetFlavors.splice(j--,1);}}}}else{mw.log('KWidgetSupport::High resolution flavours not found - will use low resolution flavours');targetFlavors=iphoneAdaptiveFlavors;}}else{if(androidNativeAdaptiveFlavors.length&&mw.isNativeApp()&&mw.isAndroid()){targetFlavors=androidNativeAdaptiveFlavors;}else if(lowResolutionDevice){targetFlavors=iphoneAdaptiveFlavors;}else if(mw.isMobileDevice()||dashAdaptiveFlavors.length==0){targetFlavors=ipadAdaptiveFlavors;}else{targetFlavors=dashAdaptiveFlavors;}}var assetId=targetFlavors[0];var hlsSource=this.generateAbrSource({entryId:asset.entryId,flavorUrl:flavorUrl,flavorId:(lowResolutionDevice?'iPhoneNew':'iPadNew'),type:'application/vnd.apple.mpegurl',flavors:targetFlavors,format:"applehttp",ext:"m3u8",protocol:protocol,clipAspect:validClipAspect});this.attachFlavorAssetDrmData(hlsSource,targetFlavors[0],flavorDrmData);hlsSource.fpsCertificate=this.getFairplayCert(playerData);deviceSources.push(hlsSource);addedHlsStream=true;}}if(mw.getConfig('Kaltura.UseFlavorIdsUrls')){var validClipAspect=this.getValidAspect(deviceSources);if(dashAdaptiveFlavors.length){var dashSource=this.generateAbrSource({entryId:asset.entryId,flavorUrl:flavorUrl,flavorId:'mpd',type:'application/dash+xml',flavors:dashAdaptiveFlavors,format:"mpegdash",ext:"mpd",protocol:protocol,clipAspect:validClipAspect});this.attachFlavorAssetDrmData(dashSource,dashAdaptiveFlavors[0],flavorDrmData);deviceSources.push(dashSource);}if((iphoneAdaptiveFlavors.length||ipadAdaptiveFlavors.length)&&this.getSourcesByAttribute(deviceSources,"type","video/playreadySmooth").length===0&&!$.isEmptyObject(flavorDrmData)){var targetFlavors=ipadAdaptiveFlavors.length?ipadAdaptiveFlavors:iphoneAdaptiveFlavors;var assetId=targetFlavors[0];var ismSource=this.generateAbrSource({entryId:asset.entryId,flavorUrl:flavorUrl,flavorId:"ism",type:'video/playreadySmooth',flavors:targetFlavors,format:"sl",ext:"ism",protocol:protocol,clipAspect:validClipAspect});this.attachFlavorAssetDrmData(ismSource,assetId,flavorDrmData);deviceSources.push(ismSource);}}this.removedAdaptiveFlavors=false;if(playerData.meta.duration<10){deviceSources=this.removeAdaptiveFlavors(deviceSources);}if(!this.removedAdaptiveFlavors&&mw.getConfig('playlistAPI.kpl0Url')&&playerData.meta&&playerData.meta.mediaType==5){deviceSources=this.removeAdaptiveFlavors(deviceSources);}if(!this.removedAdaptiveFlavors&&(mw.isAndroid()&&!mw.isNativeApp())&&hasH264Flavor&&!mw.getConfig('Kaltura.LeadHLSOnAndroid')){deviceSources=this.removeHlsFlavor(deviceSources);}if(mw.isWindowsPhone()){deviceSources=this.removeAdaptiveFlavors(deviceSources);}if(mw.supportsFlash()&&this.originalStreamerType&&this.originalStreamerType!=="hls"&&mw.getConfig("LeadWithHLSOnFlash")===null){deviceSources=this.removeHlsFlavor(deviceSources);}var ks=this.kClient.getKs();var ksStr='';var ksQueryString='';if(ks){var manifestKs=_this.fixPlaymanifestParam(ks);ksStr='/ks/'+manifestKs;ksQueryString='&ks='+manifestKs;}var referrer=_this.fixPlaymanifestParam(base64_encode(_this.getHostPageUrl()));var nativeVersion=mw.getConfig("nativeVersion");nativeVersion=(nativeVersion!=null&&nativeVersion.length>0)?'_'+nativeVersion:'';var clientTag='html5:v'+window['MWEMBED_VERSION']+nativeVersion;$.each(deviceSources,function(inx,source){if(deviceSources[inx]['disableQueryString']==true){var index=deviceSources[inx]['src'].lastIndexOf('/a.');deviceSources[inx]['src']=deviceSources[inx]['src'].substring(0,index)+ksStr+'/referrer/'+referrer+'/clientTag/'+clientTag+'/playSessionId/'+_this.getGUID()+deviceSources[inx]['src'].substring(index);}else{deviceSources[inx]['src']=deviceSources[inx]['src']+'?referrer='+referrer+ksQueryString+'&playSessionId='+_this.getGUID()+'&clientTag='+clientTag;}});return deviceSources;},generateAbrSource:function(options){var flavorsString=options.flavors.join(',');var dashSource={'data-aspect':options.clipAspect,'data-flavorid':options.flavorId,'type':options.type,'src':options.flavorUrl+'/entryId/'+options.entryId+'/flavorIds/'+flavorsString+'/format/'+options.format+'/protocol/'+options.protocol+'/a.'+options.ext,'flavors':flavorsString};return dashSource;},attachFlavorAssetDrmData:function(source,assetId,flavorDrmData){var assetDrmData=this.getFlavorAssetDrmData(assetId,flavorDrmData);$.extend(source,assetDrmData);return source;},getFairplayCert:function(playerData){var publicCertificate=null;if(playerData&&playerData.contextData&&playerData.contextData.pluginData&&playerData.contextData.pluginData.KalturaFairplayEntryContextPluginData&&playerData.contextData.pluginData.KalturaFairplayEntryContextPluginData.publicCertificate){publicCertificate=playerData.contextData.pluginData.KalturaFairplayEntryContextPluginData.publicCertificate;}return publicCertificate;},getFlavorAssetsDrmData:function(playerData){var flavorDrmData={};if(playerData.contextData.pluginData&&playerData.contextData.pluginData.KalturaDrmEntryContextPluginData&&playerData.contextData.pluginData.KalturaDrmEntryContextPluginData.flavorData){flavorDrmData=playerData.contextData.pluginData.KalturaDrmEntryContextPluginData.flavorData;}return flavorDrmData;},getFlavorAssetDrmData:function(id,flavorDrmData){var assetDrmData=flavorDrmData&&flavorDrmData[id];var drmData={};if(assetDrmData){drmData.custom_data=assetDrmData.custom_data;drmData.signature=assetDrmData.signature;drmData.contentId=assetDrmData.contentId;}return drmData;},getSourcesByAttribute:function(source,attribute,value){return $.grep(source,function(a){if(a[attribute]==value){return true;}});},fixPlaymanifestParam:function(value){return value.replace(/\+/g,"-").replace(/\//g,"_");},removeAdaptiveFlavors:function(sources){this.removeHlsFlavor(sources);this.removeDashFlavor(sources);this.removedAdaptiveFlavors=true;return sources;},removeHlsFlavor:function(sources){for(var i=0;i<sources.length;i++){if(sources[i].type=='application/vnd.apple.mpegurl'){sources.splice(i,1);i--;}}return sources;},removeDashFlavor:function(sources){for(var i=0;i<sources.length;i++){if(sources[i].type=="application/dash+xml"){sources.splice(i,1);i--;}}return sources;},getValidAspect:function(sources){var _this=this;for(var i=0;i<sources.length;i++){var source=sources[i];var aspect=source['data-aspect'];if(this.isValidAspect(aspect)){return aspect;}}var aspectParts=mw.getConfig('EmbedPlayer.DefaultSize').split('x');return Math.round((aspectParts[0]/aspectParts[1])*100)/100;},addLiveEntrySource:function(embedPlayer,entry,isFlash,isSilverlight,streamerType){var _this=this;var extension;var mimeType;var format=streamerType;var protocol;if(isFlash){extension='f4m';embedPlayer.setFlashvars('streamerType',streamerType);protocol='rtmp';if(embedPlayer.kalturaContextData){protocol=embedPlayer.kalturaContextData.mediaProtocol;}mimeType='video/live';}else if(isSilverlight){extension='f4m';protocol='http';mimeType='video/multicast';}else{embedPlayer.setFlashvars('streamerType','http');extension='m3u8';protocol=mw.getConfig('Kaltura.Protocol');if(!protocol){protocol=window.location.protocol.replace(':','');}mimeType='application/vnd.apple.mpegurl';}var srcUrl=this.getBaseFlavorUrl(entry.partnerId)+'/entryId/'+entry.id+'/format/'+format+'/protocol/'+protocol+'/uiConfId/'+embedPlayer.kuiconfid+'/a.'+extension;srcUrl+='?referrer='+base64_encode(_this.getHostPageUrl())+'&playSessionId='+_this.getGUID();var deferred=$.Deferred();var ks=_this.kClient.getKs();if(ks){srcUrl+='&ks='+ks;}mw.log('KWidgetSupport::addLiveEntrySource: Add Live Entry Source - '+srcUrl);embedPlayer.mediaElement.tryAddSource($('<source />').attr({'src':srcUrl,'type':mimeType})[0]);},isValidAspect:function(aspect){return!isNaN(aspect)&&isFinite(aspect);},generateGUID:function(){var S4=function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);};return(S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4()+S4());},getGUID:function(){if(!this.kSessionId){this.kSessionId=this.generateGUID();}return this.kSessionId;},getKalturaThumbnailUrl:function(thumb){if(!thumb.url){return mw.getConfig('EmbedPlayer.BlackPixel');}var thumbUrl=thumb.url;if(thumbUrl.indexOf("thumbnail/entry_id")!=-1){if(mw.getConfig('EmbedPlayer.ShowOriginalPoster')){thumbUrl+='/width/0/height/0';}else{thumbUrl+='/width/'+thumb.width+'/height/'+thumb.height;}}return thumbUrl;},getFunctionByName:function(functionName,context){try{var args=Array.prototype.slice.call(arguments).splice(2);var namespaces=functionName.split(".");var func=namespaces.pop();for(var i=0;i<namespaces.length;i++){context=context[namespaces[i]];}return context[func];}catch(e){mw.log("kWidgetSupport::executeFunctionByName: Error could not find function: "+functionName+' error: '+e);return false;}}};if(!window.kWidgetSupport){window.kWidgetSupport=new mw.KWidgetSupport();}mw.getEntryIdSourcesFromApi=function(embedPlayer,entryId,callback){kWidgetSupport.getEntryIdSourcesFromApi(embedPlayer,entryId,callback);};})(window.mw,jQuery);;},{},{"ks-CLIP_NOT_FOUND":"An error was experienced when playing the video. Please check your Internet connection and try again.","ks-CLIP_NOT_FOUND_TITLE":"Sorry, clip not found","ks-ENTRY_CONVERTING":"Media is currently being converted, please try again in a few minutes.","ks-ENTRY_CONVERTING_TITLE":"Entry is converting","ks-ENTRY_DELETED":"We're sorry, this content is no longer available.","ks-ENTRY_DELETED_TITLE":"Entry is deleted ","ks-ENTRY_IMPORTING":"Media is currently being converted, please try again in a few minutes.","ks-ENTRY_IMPORTING_TITLE":"Entry is converting","ks-ENTRY_MODERATE":"Media is awaiting moderation","ks-ENTRY_MODERATE_TITLE":"Entry is awaiting moderation","ks-ENTRY_PENDING":"Free preview completed, need to purchase ","ks-ENTRY_PENDING_TITLE":"Free preview completed, need to purchase ","ks-ENTRY_PRECONVERT":"Media is currently being converted, please try again in a few minutes.","ks-ENTRY_PRECONVERT_TITLE":"Entry is converting","ks-ENTRY_REJECTED":"We're sorry, this content was removed","ks-ENTRY_REJECTED_TITLE":"Entry is rejected","ks-ERROR_PROCESSING_MEDIA":"There was an error processing this media.","ks-ERROR_PROCESSING_MEDIA_TITLE":"Error processing media ","ks-FREE_PREVIEW_END":"Access to the rest of the content is restricted.","ks-FREE_PREVIEW_END_TITLE":"Free preview completed, need to purchase ","ks-GENERIC_ERROR":"An internal error has occurred","ks-GENERIC_ERROR_TITLE":"Error","ks-NO_KS":"We're sorry, access to this content is restricted. ","ks-NO_KS_TITLE":"No KS where KS is required ","ks-NO_MIX_PLUGIN":"In order to view mix entry, you must add the mix plugin to the uiconf xml","ks-NO_MIX_PLUGIN_TITLE":"No Mix Plugin","ks-OUT_OF_SCHEDULING":"We're sorry, this content is currently unavailable.","ks-OUT_OF_SCHEDULING_TITLE":"Out of scheduling  ","ks-SERVICE_ERROR":"Service error","ks-SERVICE_GET_ENTRY_ERROR":"Error in Get Entry","ks-SERVICE_GET_EXTRA_ERROR":"Error in get base entry extra data","ks-SERVICE_GET_EXTRA_ERROR_TITLE":"Error Get Extra Data","ks-SERVICE_GET_FLAVORS_ERROR":"Error in Get Flavors","ks-SERVICE_GET_UICONF_ERROR":"Error in Get Uiconf","ks-SERVICE_GET_WIDGET_ERROR":"Error in Get Widget","ks-SERVICE_START_WIDGET_ERROR":"Error in Start Widget Session","ks-UNAUTHORIZED_COUNTRY":"We're sorry, this content is only available in certain countries.","ks-UNAUTHORIZED_COUNTRY_TITLE":"Unauthorized country","ks-UNAUTHORIZED_DOMAIN":"We're sorry, this content is only available on certain domains.","ks-UNAUTHORIZED_DOMAIN_TITLE":"Unauthorized domain","ks-UNAUTHORIZED_IP_ADDRESS":"We're sorry, this content is only available for certain IP addresses.","ks-UNAUTHORIZED_IP_ADDRESS_TITLE":"Unauthorized IP address","ks-UNKNOWN_STATUS":"Unknown status","ks-UNKNOWN_STATUS_TITLE":"Unknown status","ks-USER_AGENT_RESTRICTED":"User Agent Restricted\nWe're sorry, this content is not available for your device.","ks-LIVE-STREAM-NOT-SUPPORTED":"Your browser does not support Live stream playback.","ks-LIVE-STREAM-OFFLINE-TITLE":"Currently not broadcasting","ks-LIVE-STREAM-OFFLINE":"video will play once broadcasting starts","ks-FLASH-REQUIRED":"This video requires Adobe Flash Player, which is currently not available on your browser. Please <a href='http:\/\/www.adobe.com\/support\/flashplayer\/downloads.html' target='_blank'> install Adobe Flash Player <\/a> to view this video.","ks-NO-DRM-LICENSE":"We're sorry, you don\u2019t have a valid license for this video.","ks-ERROR":"Error","ks-LIVE-STREAM-NOT-AVAILABLE":"Live stream is not available","ks-adBlockDetector-title":"Ad Block Detected","ks-adBlockDetector-message":"Ad Block Detected, Please disable ad block in order to watch content","ks-adBlockDetector-btn-ok":"OK","ks-adBlockDetector-btn-no":"NO","ks-adBlockDetector-btn-cancel":"Cancel","ks-adBlockDetector-btn-close":"Close","ks-adBlockDetector-btn-resume":"Continue","ks-chapters-search-placeholder":"Search","ks-chapters-search-clear":"Clear","ks-chapters-search-empty-result":"Sorry, no results were found","ks-chapters-locate-active-media":"Locate current chapter\/slide","ks-chapters-toggle-chapter":"Expand\/collapse chapter","ks-chapters-toggle-all-chapter":"Expand\/collapse all chapters","ks-chapters-chapterNumber":"Chapter number","ks-chapters-chapter-start-time":"Chapter start time","ks-chapters-chapter-duration":"Chapter duration","ks-chapters-slideNumber":"Slide number","ks-chapters-slide-start-time":"Slide start time","ks-chapters-slide-duration":"Slide duration","ks-sidebar-toggleBtn":"Navigation","ks-FLASH-BLOCKED-TITLE":"Flash is not active","ks-FLASH-BLOCKED":"Flash does not appear to be installed or active.<br>Please <a href='http:\/\/get.adobe.com\/flashplayer\/' target='_blank'>install<\/a> or <a href='http:\/\/knowledge.kaltura.com\/faq\/how-activate-flash-safari-desktop' target='_blank'>activate<\/a> flash","ks-PLUGIN-BLOCKED-TITLE":"Microsoft Silverlight is not active","ks-PLUGIN-BLOCKED":"Silverlight plug-in does not appear to be active.<br>Please <a href='http:\/\/knowledge.kaltura.com\/faq\/how-activate-silverlight-safari-desktop' target='_blank'>activate<\/a> Microsoft Silverlight","ks-DUAL-SCREEN-SBS":"Side By Side","ks-DUAL-SCREEN-HIDE":"Single View","ks-DUAL-SCREEN-PIP":"Picture In Picture","ks-DUAL-SCREEN-SWITCH":"Toggle View","ks-MODERATION-CANCEL":"Cancel","ks-MODERATION-SUBMIT":"Submit","ks-MODERATION-THANKS":"Thank you for sharing your concerns","ks-MODERATION-DONE":"Done","ks-MODERATION-HEADER":"Report","ks-MODERATION-TEXT":"Please describe your concerns about this video.","ks-MODERATION-PLACEHOLDER":"Anything else to add?","ks-MODERATION-REPORT":"Report","ks-MODERATION-REASON-SEX":"Sexual Content","ks-MODERATION-REASON-VIOLENCE":"Violent Or Repulsive","ks-MODERATION-REASON-HARMFUL":"Harmful Or Dangerous Act","ks-MODERATION-REASON-SPAM":"Spam \/ Commercials"});mw.loader.implement("mw.KalturaIframePlayerSetup",function($){(function(mw,$,playerData){"use strict";function resolvePlayerConfig(serverSettings,clientSettings){var resolvedSettings=jQuery.extend(true,{},serverSettings);if(serverSettings.vars["inlineScript"]&&(clientSettings!==null)){var clientFlashvars=clientSettings.flashvars;var clientPlugins={};var clientVars={};$.each(clientFlashvars,function(name,value){if($.isPlainObject(value)){clientPlugins[name]=value;}else{clientVars[name]=value;}});if(serverSettings&&serverSettings.uiVars){var resolvedVars=resolvedSettings.vars;var serverUiVars=serverSettings.uiVars;$.each(serverUiVars,function(i,serverUiVar){var name=serverUiVar.key;if(clientVars[name]&&!serverUiVar.overrideFlashvar){resolvedVars[name]=clientVars[name];}});$.each(clientVars,function(name,value){if(!resolvedVars[name]){resolvedVars[name]=value;}});}$.extend(true,resolvedSettings.plugins,clientPlugins);}return resolvedSettings;}try{if(window['parent']&&window['parent']['kWidget']&&window!==window['parent']){mw.config.set('EmbedPlayer.IsFriendlyIframe',true);}else{mw.config.set('EmbedPlayer.IsFriendlyIframe',false);}}catch(e){mw.config.set('EmbedPlayer.IsFriendlyIframe',false);}if(mw.config.get('EmbedPlayer.IsFriendlyIframe')){try{if(window['parent']&&window['parent']['preMwEmbedConfig']){mw.config.set(window['parent']['preMwEmbedConfig']);mw.config.set('EmbedPlayer.IframeParentUrl',document.URL.replace(/#.*/,''));}}catch(e){}}else{try{var hashString=window.location.hash;if(hashString){var hashObj=JSON.parse(decodeURIComponent(hashString.replace(/^#/,'')));if(hashObj&&hashObj.mwConfig){mw.config.set(hashObj.mwConfig);}}}catch(e){kWidget.log("KalturaIframePlayerSetup, could not get configuration ");}}var serverSettings=playerData['playerConfig'];var clientSettings=mw.getConfig("widgetOriginalSettings_"+playerData.playerId);var playerConfig=resolvePlayerConfig(serverSettings,clientSettings);mw.config.set('KalturaSupport.PlayerConfig',playerConfig);mw.config.set('Kaltura.IframeRewrite',false);mw.config.set('Mw.LogPrepend','iframe:');mw.config.set('Kaltura.LoadScriptForVideoTags',false);mw.config.set('EmbedPlayer.WaitForMeta',false);mw.config.set('EmbedPlayer.IframeParentPlayerId',playerData['playerId']);mw.config.set(playerData['enviornmentConfig']);if(mw.config.get('EmbedPlayer.IsFullscreenIframe')){mw.config.set('EmbedPlayer.EnableFullscreen',false);}else{if(mw.config.get('EmbedPlayer.IframeParentUrl')===null&&!mw.config.get('EmbedPlayer.ForceNativeComponent')){mw.config.set('EmbedPlayer.NewWindowFullscreen',true);mw.config.set('EmbedPlayer.EnableIpadNativeFullscreen',true);}}var removeElement=function(elemId){if(document.getElementById(elemId)){try{var el=document.getElementById(elemId);el.parentNode.removeChild(el);}catch(e){}}};if(kWidget.isUiConfIdHTML5(playerData.playerConfig.uiConfId)||!(kWidget.supportsFlash()||mw.config.get('Kaltura.ForceFlashOnDesktop'))){removeElement('kaltura_player_iframe_no_rewrite');$('#'+playerData.playerId).embedPlayer(function(){$('#kaltura_player_iframe_no_rewrite').remove();var embedPlayer=$('#'+playerData.playerId)[0];if(mw.config.get('EmbedPlayer.IframeCurrentTime')){embedPlayer.currentTime=mw.config.get('EmbedPlayer.IframeCurrentTime');}if(mw.config.get('EmbedPlayer.IframeIsPlaying')){embedPlayer.play();}});}else{mw.log("Error: KalturaIframePlayer:: rendering flash player after loading html5 lib");}if(playerData.error){$('body').append($('<div />').attr('id','error').html(playerData.error));}})(window.mw,window.jQuery,window.kalturaIframePackageData);;},{},{});mw.loader.implement("mw.MediaElement",function($){(function(mw,$){"use strict";mw.MediaElement=function(element){this.init(element);};mw.MediaElement.prototype={sources:null,addedROEData:false,selectedSource:null,preferedFlavorBR:null,init:function(videoElement){var _this=this;mw.log("EmbedPlayer::mediaElement:init:"+videoElement.id);this.parentEmbedId=videoElement.id;this.sources=new Array();if(videoElement){var src=$(videoElement).attr("src");var found=false;if(src){$.each(mw.getConfig('Kaltura.BlackVideoSources'),function(inx,sourceAttr){if(src.indexOf(sourceAttr.src)!==-1){found=true;return false;}});if(!found){_this.tryAddSource(videoElement);}}$(videoElement).find('source,track').each(function(){_this.tryAddSource(this);});}},updateSourceTimes:function(startNpt,endNpt){var _this=this;$.each(this.sources,function(inx,mediaSource){mediaSource.updateSrcTime(startNpt,endNpt);});},getTextTracks:function(){var textTracks=[];$.each(this.sources,function(inx,source){if(source.nodeName=='track'||(source.mimeType&&source.mimeType.indexOf('text/')!==-1)){textTracks.push(source);}});return textTracks;},getSources:function(mimeFilter){if(!mimeFilter){return this.sources;}var source_set=new Array();for(var i=0;i<this.sources.length;i++){if(this.sources[i].mimeType&&this.sources[i].mimeType.indexOf(mimeFilter)!=-1){source_set.push(this.sources[i]);}}return source_set;},getSourceById:function(sourceId){for(var i=0;i<this.sources.length;i++){if(this.sources[i].id==sourceId){return this.sources[i];}}return null;},setSourceByIndex:function(index){mw.log('EmbedPlayer::mediaElement:selectSource: '+index);var playableSources=this.getPlayableSources();var oldSrc;if(this.selectedSource){oldSrc=this.selectedSource.getSrc();}for(var i=0;i<playableSources.length;i++){if(i==index){this.selectedSource=playableSources[i];break;}}if(!oldSrc||oldSrc!=this.selectedSource.getSrc()){$('#'+this.parentEmbedId).trigger('SourceChange');}},setSource:function(source){var oldSrc=this.selectedSource;this.selectedSource=source;if(!oldSrc||oldSrc.getSrc()!=source.getSrc()){$('#'+this.parentEmbedId).trigger('SourceChange');}return this.selectedSource;},autoSelectSource:function(options){if(!options){options={};}if(this.autoSelectSourceExecute(options)){var updatedDuration=0;if(options.supportsURLTimeEncoding&&!!options.endTime){updatedDuration=options.endTime;this.selectedSource.src=this.selectedSource.src.replace(/clipTo\/\d+\//,'');this.selectedSource.src=this.selectedSource.src.replace("playManifest/","playManifest/clipTo/"+parseInt(options.endTime)*1000+"/");}if(options.supportsURLTimeEncoding&&!!options.startTime){updatedDuration-=options.startTime;this.selectedSource.src=this.selectedSource.src.replace(/seekFrom\/\d+\//,'');this.selectedSource.src=this.selectedSource.src.replace("playManifest/","playManifest/seekFrom/"+parseInt(options.startTime)*1000+"/");}$('#'+this.parentEmbedId).trigger('SourceSelected',this.selectedSource);if(updatedDuration>0){try{$('#'+this.parentEmbedId)[0].setDuration(updatedDuration);}catch(e){$('#'+this.parentEmbedId).trigger('durationChange',updatedDuration);}}return this.selectedSource;}return false;},autoSelectSourceExecute:function(options){mw.log('EmbedPlayer::mediaElement::autoSelectSource');var _this=this;if(!options){options={};}var playableSources=options.sources||this.getPlayableSources();this.removeSourceFlavor(playableSources);var flash_flag=false,ogg_flag=false;this.selectedSource=null;if(playableSources.length==0){return false;}$('#'+this.parentEmbedId).trigger('onSelectSource',[playableSources]);if(_this.selectedSource){mw.log('MediaElement::autoSelectSource: Set via trigger::'+_this.selectedSource.getTitle());return _this.selectedSource;}var hasDefaultSource=false;$.each(playableSources,function(inx,source){if(source.markedDefault){mw.log('MediaElement::autoSelectSource: Set via marked default: '+source.markedDefault);hasDefaultSource=true;_this.setSource(source);return false;}});if(hasDefaultSource){return _this.selectedSource;}mw.setConfig('EmbedPlayer.IgnoreStreamerType',false);var typesToCheck=['application/dash+xml','video/playreadySmooth','video/ism','video/multicast','video/wvm'];for(var i=0;i<typesToCheck.length;i++){var matchingSources=this.getPlayableSources(typesToCheck[i],playableSources);if(matchingSources.length){mw.log('MediaElement::autoSelectSource: Set prefered mimeType flavor '+typesToCheck[i]);mw.setConfig('EmbedPlayer.IgnoreStreamerType',true);return _this.setSource(matchingSources[0]);}}var vndSources=this.getPlayableSources('application/vnd.apple.mpegurl',playableSources);this.removeSourceFlavor(vndSources);if(vndSources.length&&mw.EmbedTypes.getMediaPlayers().getMIMETypePlayers('application/vnd.apple.mpegurl').length){var desktopVdn,mobileVdn;$.each(vndSources,function(inx,source){if(source.getFlavorId()&&source.getFlavorId().toLowerCase()=='iphonenew'){mobileVdn=source;}else{desktopVdn=source;}});if((mw.isNativeApp()||mw.isIphone()||mw.isAndroid4andUp())&&mobileVdn){_this.setSource(mobileVdn);}else if(desktopVdn){_this.setSource(desktopVdn);}}if(this.selectedSource){mw.log('MediaElement::autoSelectSource: Set via Adaptive HLS: source flavor id:'+_this.selectedSource.getFlavorId()+' src: '+_this.selectedSource.getSrc());return this.selectedSource;}if($.cookie('EmbedPlayer.UserBandwidth')||this.preferedFlavorBR){var bandwidthDelta=999999999;var bandwidthTarget=$.cookie('EmbedPlayer.UserBandwidth')||this.preferedFlavorBR;$.each(playableSources,function(inx,source){if(source.bandwidth){if(Math.abs(source.bandwidth-bandwidthTarget)<bandwidthDelta){bandwidthDelta=Math.abs(source.bandwidth-bandwidthTarget);_this.setSource(source);}}});if(this.selectedSource){var setTypeName=($.cookie('EmbedPlayer.UserBandwidth'))?'cookie':'preferedFlavorBR'
mw.log('MediaElement::autoSelectSource: '+'Set via bandwidth, '+setTypeName+' source:'+this.selectedSource.bandwidth+' target: '+bandwidthTarget);return this.selectedSource;}}var nativePlayableSources=this.getNativePlayableSources(playableSources);this.removeSourceFlavor(nativePlayableSources);var namedSourceSet={};$.each(nativePlayableSources,function(inx,source){var mimeType=source.mimeType;var player=mw.EmbedTypes.getMediaPlayers().getNativePlayer(mimeType);switch(player.id){case'mp3Native':var shortName='mp3';break;case'oggNative':var shortName='ogg';break;case'webmNative':var shortName='webm';break;case'h264Native':var shortName='h264';break;case'appleVdn':var shortName='appleVdn';break;}if(!namedSourceSet[shortName]){namedSourceSet[shortName]=[];}namedSourceSet[shortName].push(source);});if(mw.isMobileDevice()&&namedSourceSet['h264']&&namedSourceSet['h264'].length){var minSize=99999999;$.each(namedSourceSet['h264'],function(inx,source){if(parseInt(source.width)<parseInt(minSize)&&parseInt(source.width)!=0){minSize=source.width;_this.setSource(source);}})}if(this.selectedSource){mw.log('MediaElement::autoSelectSource: mobileDevice; most compatible h.264 because of resolution:'+this.selectedSource.width);return this.selectedSource;}var codecPref=mw.getConfig('EmbedPlayer.CodecPreference');if(!$.isArray(codecPref)){codecPref=codecPref.split(",");}if(codecPref){for(var i=0;i<codecPref.length;i++){var codec=codecPref[i];if(!namedSourceSet[codec]){continue;}if(namedSourceSet[codec].length==1){mw.log('MediaElement::autoSelectSource: Set 1 source via EmbedPlayer.CodecPreference: '+namedSourceSet[codec][0].getTitle());return _this.setSource(namedSourceSet[codec][0]);}else if(namedSourceSet[codec].length>1){var minSizeDelta=null;if(this.parentEmbedId){var displayWidth=$('#'+this.parentEmbedId).width();$.each(namedSourceSet[codec],function(inx,source){if(parseInt(source.width)&&displayWidth){var sizeDelta=Math.abs(source.width-displayWidth);if(minSizeDelta==null||sizeDelta<minSizeDelta){minSizeDelta=sizeDelta;_this.setSource(source);}}});}if(this.selectedSource){mw.log('MediaElement::autoSelectSource: from  '+this.selectedSource.mimeType+' because of resolution:'+this.selectedSource.width+' close to: '+displayWidth);return this.selectedSource;}if(namedSourceSet[codec][0]){mw.log('MediaElement::autoSelectSource: first codec prefrence source');return _this.setSource(namedSourceSet[codec][0]);}}}}$.each(playableSources,function(inx,source){var mimeType=source.mimeType;var player=mw.EmbedTypes.getMediaPlayers().getDefaultPlayer(mimeType);if((mimeType=='video/mp4'||mimeType=='video/h264')&&player&&(player.library=='Native'||player.library=='Kplayer')){if(source){mw.log('MediaElement::autoSelectSource: Set h264 via native or flash fallback:'+source.getTitle());return _this.setSource(source);}}});if(this.selectedSource){mw.log('MediaElement::autoSelectSource: from  '+this.selectedSource.mimeType+' because of resolution:'+this.selectedSource.width+' close to: '+displayWidth);return this.selectedSource;}if(!this.selectedSource){for(var i=0;i<playableSources.length;i++){if(playableSources[i].tags&&playableSources[i].tags.indexOf("mbr")!==-1){return _this.setSource(playableSources[i]);}}}if(!this.selectedSource&&playableSources[0]){mw.log('MediaElement::autoSelectSource: Set via first source: '+playableSources[0].getTitle()+' mime: '+playableSources[0].getMIMEType());return _this.setSource(playableSources[0]);}mw.log('MediaElement::autoSelectSource: no match found');return false;},autoSelectNativeSource:function(){mw.log("MediaElement::autoSelectNativeSource");if(!this.selectedSource&&!this.autoSelectSource()){return false;}var player=mw.EmbedTypes.getMediaPlayers().getNativePlayer(this.selectedSource.mimeType);if(player){return this.selectedSource;}mw.log("MediaElement::autoSelectNativeSource: no native player found");return null;},isOgg:function(mimeType){if(mimeType=='video/ogg'||mimeType=='ogg/video'||mimeType=='video/annodex'||mimeType=='application/ogg'){return true;}return false;},getPosterSrc:function(){return this.poster;},hasStreamOfMIMEType:function(mimeType){for(var i=0;i<this.sources.length;i++){if(this.sources[i].getMIMEType()==mimeType){return true;}}return false;},getNativePlayableSources:function(sources){var playableSources=sources||this.getPlayableSources();var nativePlayableSources=[];$.each(playableSources,function(inx,source){var mimeType=source.mimeType;var player=mw.EmbedTypes.getMediaPlayers().getNativePlayer(mimeType);if(player&&player.library=='Native'){nativePlayableSources.push(source);}});return nativePlayableSources;},isPlayableType:function(mimeType){if(mw.EmbedTypes.getMediaPlayers().getDefaultPlayer(mimeType)){return true;}else{return false;}},tryAddSource:function(element){if(element instanceof mw.MediaSource){this.sources.push(element);return element;}var newSrc=$(element).attr('src');if(newSrc){for(var i=0;i<this.sources.length;i++){if(this.sources[i].src==newSrc){this.sources[i].updateSource(element);return this.sources[i];}}}var source=new mw.MediaSource(element);this.sources.push(source);if(element.nodeName&&element.nodeName.toLowerCase()==='track'){if(!mw.isIOS()||(mw.isIOS()&&!mw.getConfig('disableTrackElement'))){if(!mw.isIE8()){var $vid=$('#pid_'+this.parentEmbedId);if($vid.length){if(mw.isIphone()){$vid.attr('crossorigin','anonymous');}$vid.append(element);}}}}return source;},getPlayableSources:function(mimeFilter,sources){var playableSources=[];var sourcesList=sources||this.sources;for(var i=0;i<sourcesList.length;i++){if(this.isPlayableType(sourcesList[i].mimeType)&&(!mimeFilter||sourcesList[i].mimeType.indexOf(mimeFilter)!=-1)){playableSources.push(sourcesList[i]);}};mw.log("MediaElement::GetPlayableSources mimeFilter:"+mimeFilter+" "+playableSources.length+' sources playable out of '+sourcesList.length);return playableSources;},removeSourceFlavor:function(sources){if(sources.length>1){for(var i=sources.length-1;i>=0;i--){if(sources[i].tags&&sources[i].tags.indexOf("source")!==-1){sources.splice(i,1);}}}},getLicenseData:function(){var licenseData={custom_data:this.selectedSource["custom_data"],signature:this.selectedSource["signature"]};if(this.selectedSource.flavors){var base64encode=window.btoa?window.btoa:window.base64_encode;licenseData.files=encodeURIComponent(base64encode(this.selectedSource.flavors));}return licenseData;},getLicenseUriComponent:function(){var licenseData=this.getLicenseData();var licenseDataString="";if(licenseData){$.each(licenseData,function(key,val){if(val){licenseDataString+=key+"="+val+"&";}});}return licenseDataString;},getAuthenticationToken:function(){return this.selectedSource["contentId"];}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.MediaPlayer",function($){(function(mw,$){"use strict";mw.MediaPlayer=function(id,supportedTypes,library){this.id=id;this.supportedTypes=supportedTypes;this.library=library;this.loaded=false;this.loading_callbacks=new Array();return this;};mw.MediaPlayer.prototype={id:null,supportedTypes:null,library:null,loaded:false,supportsMIMEType:function(type){for(var i=0;i<this.supportedTypes.length;i++){if(this.supportedTypes[i]==type)return true;}return false;},getName:function(){return gM('mwe-embedplayer-ogg-player-'+this.id);},load:function(callback){mw.load(['mw.EmbedPlayer'+this.library.substr(0,1).toUpperCase()+this.library.substr(1)],function(){if(callback){callback();}});}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.MediaPlayers",function($){(function(mw,$){"use strict";mw.MediaPlayers=function(){this.init();};mw.MediaPlayers.prototype={players:null,preference:{},defaultPlayers:{},init:function(){this.players=new Array();this.loadPreferences();this.defaultPlayers['video/wvm']=['NativeComponent'];this.defaultPlayers['video/live']=['Kplayer'];this.defaultPlayers['video/kontiki']=['Kplayer'];this.defaultPlayers['video/x-flv']=['Kplayer','Vlc'];this.defaultPlayers['video/h264']=['NativeComponent','Native','Kplayer','Silverlight','Vlc'];this.defaultPlayers['video/mp4']=['NativeComponent','Native','Kplayer','Silverlight','Vlc'];this.defaultPlayers['application/vnd.apple.mpegurl']=['Native'];this.defaultPlayers['application/x-shockwave-flash']=['Kplayer'];this.defaultPlayers['video/ogg']=['Native','Vlc','Java','Generic'];this.defaultPlayers['video/webm']=['Native','Vlc'];this.defaultPlayers['application/ogg']=['Native','Vlc','Java','Generic'];this.defaultPlayers['audio/ogg']=['Native','Vlc','Java'];this.defaultPlayers['audio/mpeg']=['Native','Kplayer'];this.defaultPlayers['audio/mp3']=['Native','Kplayer'];this.defaultPlayers['video/mpeg']=['Vlc'];this.defaultPlayers['video/x-msvideo']=['Vlc'];this.defaultPlayers['video/multicast']=['Silverlight'];this.defaultPlayers['video/ism']=['Silverlight'];this.defaultPlayers['video/playreadySmooth']=['Silverlight'];this.defaultPlayers['image/jpeg']=['ImageOverlay'];this.defaultPlayers['image/png']=['ImageOverlay'];if(mw.getConfig("LeadWithHLSOnFlash")){this.defaultPlayers['application/vnd.apple.mpegurl'].push('Kplayer');}if(mw.getConfig("chromecastReceiver")){this.defaultPlayers['application/vnd.apple.mpegurl'].push('ChromecastReceiver');}if($.inArray('application/dash+xml',window.kNativeSdk&&window.kNativeSdk.allFormats)>=0){this.defaultPlayers['application/dash+xml']=['NativeComponent'];}if(window.kNativeSdk&&window.kNativeSdk.allFormats){if($.inArray('application/vnd.apple.mpegurl',window.kNativeSdk&&window.kNativeSdk.allFormats)>=0){this.defaultPlayers['application/vnd.apple.mpegurl']=['NativeComponent'];}}else{this.defaultPlayers['application/vnd.apple.mpegurl'].push('NativeComponent');}},addPlayer:function(player){for(var i=0;i<this.players.length;i++){if(this.players[i].id==player.id){return;}}this.players.push(player);},isSupportedPlayer:function(playerId){for(var i=0;i<this.players.length;i++){if(this.players[i].id==playerId){return true;}}return false;},getPlayerById:function(playerId){for(var i=0;i<this.players.length;i++){if(this.players[i].id.toLowerCase()==playerId.toLowerCase()){return this.players[i];}}return null;},getMIMETypePlayers:function(mimeType){var mimePlayers=new Array();var _this=this;if(this.defaultPlayers[mimeType]){$.each(this.defaultPlayers[mimeType],function(d,lib){var library=_this.defaultPlayers[mimeType][d];for(var i=0;i<_this.players.length;i++){if(_this.players[i].library==library&&_this.players[i].supportsMIMEType(mimeType)){mimePlayers.push(_this.players[i]);}}});}return mimePlayers;},setMIMETypePlayers:function(mimeType,playerName){if(this.defaultPlayers[mimeType]&&$.isArray(this.defaultPlayers[mimeType])){var contains=false;$.each(this.defaultPlayers[mimeType],function(index,name){if(name===playerName){contains=true;return false;}});if(!contains){this.defaultPlayers[mimeType].push(playerName);}}else{this.defaultPlayers[mimeType]=[playerName];}},removeMIMETypePlayers:function(mimeType,playerName){if(this.defaultPlayers[mimeType]&&$.isArray(this.defaultPlayers[mimeType])){var _this=this;$.each(this.defaultPlayers[mimeType],function(index,name){if(name===playerName){_this.defaultPlayers[mimeType].splice(index,1);return false;}});}},defaultPlayer:function(mimeType){mw.log("MediaPlayer:: defaultPlayer has been deprecated, use getDefaultPlayer method instead");return getDefaultPlayer(mimeType);},getDefaultPlayer:function(mimeType){var mimePlayers=this.getMIMETypePlayers(mimeType);if(mw.getConfig('chromecastReceiver')){return this.getPlayerById('chromecastReceiver');}if(mw.getConfig('EmbedPlayer.ForceNativeComponent')&&this.isSupportedPlayer('nativeComponentPlayer')){var nativeComponentPlayer=mw.EmbedTypes.getNativeComponentPlayerVideo();var imageOverlayPlayer=mw.EmbedTypes.getNativeImageOverlayPlayer();if(this.isPlayerSupportMimeType(mimePlayers,nativeComponentPlayer)){mimePlayers=[nativeComponentPlayer];}else if(imageOverlayPlayer.supportsMIMEType(mimeType)){mimePlayers=[imageOverlayPlayer];}else{mimePlayers=[];}}if((mw.getConfig('EmbedPlayer.ForceKPlayer')||(mw.getConfig('ForceFlashOnDesktopSafari')&&mw.isDesktopSafari()))&&this.isSupportedPlayer('kplayer')&&mimeType!=="video/youtube"){var kplayer=mw.EmbedTypes.getKplayer();if(this.isPlayerSupportMimeType(mimePlayers,kplayer)){mimePlayers=[kplayer];}else{mimePlayers=[];}}if(mw.getConfig('EmbedPlayer.ForceSPlayer')&&this.isSupportedPlayer('splayer')){var silverlightPlayer=mw.EmbedTypes.getSilverlightPlayer();if(this.isPlayerSupportMimeType(mimePlayers,silverlightPlayer)){mimePlayers=[silverlightPlayer];}else{mimePlayers=[];}}for(var i=0;i<mimePlayers.length;i++){if(mimePlayers[i].id==this.preference[mimeType]){mimePlayers=[mimePlayers[i]];break;}}if(mimePlayers[0]){return mimePlayers[0];}return null;},isPlayerSupportMimeType:function(mimePlayers,player){var playerSupported=mimePlayers.filter(function(mimePlayer){return mimePlayer.id===player.id;});return(playerSupported.length>0);},getNativePlayer:function(mimeType){var mimePlayers=this.getMIMETypePlayers(mimeType);for(var i=0;i<mimePlayers.length;i++){if(mimePlayers[i].library=='Native'){return mimePlayers[i];}}return null;},setFormatPreference:function(mimeFormat){this.preference['formatPreference']=mimeFormat;$.cookie('EmbedPlayer.Preference',JSON.stringify(this.preference));},loadPreferences:function(){this.preference={};if($.cookie('EmbedPlayer.Preference')){this.preference=JSON.parse($.cookie('EmbedPlayer.Preference'));}},setPlayerPreference:function(playerId,mimeType){var selectedPlayer=null;for(var i=0;i<this.players.length;i++){if(this.players[i].id==playerId){selectedPlayer=this.players[i];mw.log('EmbedPlayer::setPlayerPreference: choosing '+playerId+' for '+mimeType);this.preference[mimeType]=playerId;$.cookie('EmbedPlayer.Preference',JSON.stringify(this.preference));break;}}if(selectedPlayer){$('.mwEmbedPlayer').each(function(inx,playerTarget){var embedPlayer=$(playerTarget).get(0);if(embedPlayer.mediaElement.selectedSource&&(embedPlayer.mediaElement.selectedSource.mimeType==mimeType)){embedPlayer.selectPlayer(selectedPlayer);}});}}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.MediaSource",function($){(function(mw,$){"use strict";mw.mergeConfig('EmbedPlayer.SourceAttributes',['id','src','title','URLTimeEncoding','nodeName','data-startoffset','data-durationhint','data-shorttitle','data-width','data-height','data-bandwidth','data-sizebytes','data-framerate','data-flavorid','data-aspect','data-tags','data-assetid','data-mwtitle','data-mwprovider','start','end','default','type','height','assetid','bandwidth','srclang','custom_data','signature','contentId','flavors','fpsCertificate']);mw.MediaSource=function(element){this.init(element);};mw.MediaSource.prototype={mimeType:null,uri:null,title:null,markedDefault:false,URLTimeEncoding:false,startOffset:0,duration:0,id:null,startNpt:null,endNpt:null,srclang:null,init:function(element){var _this=this;this.src=$(element).attr('src');var sourceAttr=mw.getConfig('EmbedPlayer.SourceAttributes');$.each(sourceAttr,function(inx,attr){if($(element).attr(attr)!==undefined){var attrName=(attr.indexOf('data-')===0)?attr.substr(5):attr
_this[attrName]=$(element).attr(attr);if(attrName=='default'){_this[attrName]=$(element).attr(attr)=="true"?true:false;}}});if(this.label){this.title=this.label;}if($(element).attr('type')){this.mimeType=$(element).attr('type');}else if($(element).attr('content-type')){this.mimeType=$(element).attr('content-type');}else if($(element)[0].tagName.toLowerCase()=='audio'){this.mimeType='audio/ogg';}else{this.mimeType=this.detectType(this.src);}if(this.mimeType=='video/theora'){this.mimeType='video/ogg';}if(this.mimeType=='audio/vorbis'){this.mimeType='audio/ogg';}if(this.mimeType){this.mimeType=this.mimeType.split(';')[0];}if($(element).parent().attr('category')){this.category=$(element).parent().attr('category');}if($(element).attr('default')){this.markedDefault=true;}this.getURLDuration();},updateSource:function(element){if($(element).attr("title")){this.title=$(element).attr("title");}},updateSrcTime:function(startNpt,endNpt){if(this.URLTimeEncoding){if(!mw.npt2seconds(startNpt)){startNpt=this.startNpt;}if(!mw.npt2seconds(endNpt)){endNpt=this.endNpt;}this.src=mw.replaceUrlParams(this.src,{'t':startNpt+'/'+endNpt});this.getURLDuration();}},setDuration:function(duration){this.duration=duration;if(!this.endNpt){this.endNpt=mw.seconds2npt(this.startOffset+duration);}},getMIMEType:function(){if(this.mimeType){return this.mimeType;}this.mimeType=this.detectType(this.src);return this.mimeType;},setSrc:function(src){this.src=src;},getSrc:function(){return this.src;},getTitle:function(){if(this.title){return this.title;}if(this.label){return this.label;}switch(this.getMIMEType()){case'video/h264':return gM('mwe-embedplayer-video-h264');break;case'video/x-flv':return gM('mwe-embedplayer-video-flv');break;case'video/webm':return gM('mwe-embedplayer-video-webm');break;case'video/ogg':return gM('mwe-embedplayer-video-ogg');break;case'audio/ogg':return gM('mwe-embedplayer-video-audio');break;case'audio/mpeg':return gM('mwe-embedplayer-audio-mpeg');break;case'video/3gp':return gM('mwe-embedplayer-video-3gp');break;case'video/mpeg':return gM('mwe-embedplayer-video-mpeg');break;case'video/x-msvideo':return gM('mwe-embedplayer-video-msvideo');break;}try{var fileName=new mw.Uri(mw.absoluteUrl(this.getSrc())).path.split('/').pop();if(fileName){return fileName;}}catch(e){}return this.mimeType;},getShortTitle:function(){var _this=this;if(this.shorttitle){return this.shorttitle;}var genTitle='';if(this.height){if(this.heigth<255){genTitle+='240P ';}else if(this.height<370){genTitle+='360P ';}else if(this.height<500){genTitle+='480P ';}else if(this.height<800){genTitle+='720P ';}else{genTitle+='1080P ';}}genTitle+=this.getTitle().replace('video','').replace('a.','');if(genTitle.length>20){genTitle=genTitle.substring(0,17)+"...";}if(this.getBitrate()){var bits=(Math.round(this.getBitrate()/1024*10)/10)+'';if(bits[0]=='0'){bits=bits.substring(1);}genTitle+=' '+bits+'Mbs ';}return genTitle},getURLDuration:function(){if(this.URLTimeEncoding){var annoURL=new mw.Uri(this.src);if(annoURL.query.t){var times=annoURL.query.t.split('/');this.startNpt=times[0];this.endNpt=times[1];this.startOffset=mw.npt2seconds(this.startNpt);this.duration=mw.npt2seconds(this.endNpt)-this.startOffset;}else{if(this.startOffset){this.startNpt=mw.seconds2npt(this.startOffset);}if(this.duration){this.endNpt=mw.seconds2npt(parseInt(this.duration)+parseInt(this.startOffset));}}}},getExt:function(uri){var urlParts=new mw.Uri(uri);var ext=(urlParts.file)?/[^.]+$/.exec(urlParts.file):/[^.]+$/.exec(uri);if(!ext){return'';}ext=/[^#]*/g.exec(ext.toString());return ext.toString().toLowerCase();},getFlavorId:function(){if(this.flavorid){return this.flavorid;}return;},detectType:function(uri){switch(this.getExt(uri)){case'smil':case'sml':return'application/smil';break;case'm4v':case'mp4':return'video/h264';break;case'm3u8':return'application/vnd.apple.mpegurl';break;case'webm':return'video/webm';break;case'3gp':return'video/3gp';break;case'srt':return'text/x-srt';break;case'vtt':return'text/vtt';break;case'flv':return'video/x-flv';break;case'ogg':case'ogv':return'video/ogg';break;case'oga':return'audio/ogg';break;case'mp3':return'audio/mpeg';break;case'anx':return'video/ogg';break;case'dfxp':case'xml':return'text/xml';break;case'avi':return'video/x-msvideo';break;case'mpg':return'video/mpeg';break;case'mpeg':return'video/mpeg';break;}mw.log("Error: could not detect type of media src: "+uri);},getBitrate:function(){if(this.bandwidth){return this.bandwidth/1024;}return 0;},getSize:function(){if(this.sizebytes){return this.sizebytes;}return 0;},getTags:function(){return this.tags;},getAssetId:function(){return this.assetid;},getHeight:function(){if(this.height){return this.height;}return 0;}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.PlayerElement",function($){(function(mw,$){"use strict";mw.PlayerElement=Class.extend({element:null,src:null,init:function(containerId,playerId){mw.log('PlayerElement::Error: function init should be implemented by playerElement interface ');},getElement:function(){return this.element;},play:function(){mw.log('PlayerElement::Error: function play should be implemented by playerElement interface ');},pause:function(){mw.log('PlayerElement::Error: function pause should be implemented by playerElement interface ');},seek:function(val){mw.log('PlayerElement::Error: function seek should be implemented by playerElement interface ');},load:function(){mw.log('PlayerElement::Error: function load should be implemented by playerElement interface ');},changeVolume:function(val){mw.log('PlayerElement::Error: function changeVolume should be implemented by playerElement interface ');}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.PlayerElementFlash",function($){(function(mw,$){"use strict";mw.PlayerElementFlash=mw.PlayerElement.extend({jsReadyFunName:'elementJsReadyFunc',playerElement:null,currentTime:0,duration:0,paused:true,muted:false,volume:1,id:null,readyState:0,disabled:false,listenerCounter:0,targetObj:null,initialized:false,detectFlashInterval:null,detectFlashIntervalLoops:3,flashDetected:false,init:function(containerId,playerId,elementFlashvars,target,readyCallback,failCallback){var _this=this;this.element=this;this.id=playerId;this.targetObj=target;var flashvars={};flashvars.jsCallBackReadyFunc=this.jsReadyFunName;flashvars.externalInterfaceDisabled="false";flashvars.disableOnScreenClick=true;if(mw.getConfig('debug',true)){flashvars.debugMode='true';}if(elementFlashvars){$.extend(flashvars,elementFlashvars);}var mwEmbedPath=mw.getMwEmbedPath();if(window.location.protocol){mwEmbedPath=window.location.protocol+mwEmbedPath.substring(mwEmbedPath.indexOf(":")+1);}var kdpPath=mwEmbedPath+'modules/EmbedPlayer/binPlayers/kaltura-player/kdp3.swf';if(mw.getConfig('forceNoKdpCache')){kdpPath+='?'+new Date().getTime();}if(mw.getConfig("ForceFlashOnDesktopSafari")){_this.detectFlashInterval=setInterval(function(){_this.detectFlash(failCallback);},500);}window[this.jsReadyFunName]=function(playerId){if(!_this.initialized){_this.initialized=true;_this.flashDetected=true;_this.cleanInterval(_this.detectFlashInterval);setTimeout(function(){_this.playerElement=$('#'+playerId)[0];if(!_this.targetObj){_this.targetObj=_this;var bindEventMap={'playerPaused':'onPause','playerPlayed':'onPlay','durationChange':'onDurationChange','playbackComplete':'onClipDone','playerUpdatePlayhead':'onUpdatePlayhead','playerSeekEnd':'onPlayerSeekEnd','alert':'onAlert','mute':'onMute','unmute':'onUnMute','volumeChanged':'onVolumeChanged','mediaError':'onMediaError'};$.each(bindEventMap,function(bindName,localMethod){_this.bindPlayerFunction(bindName,localMethod);});}_this.readyState=4;if($.isFunction(readyCallback)){readyCallback.apply(_this);}$(_this).trigger('playerJsReady');},0);}};var wmode="transparent";if(mw.getConfig("wmode")){wmode=mw.getConfig("wmode");}flashembed(containerId,{id:playerId,src:kdpPath,bgcolor:"#000000",allowNetworking:"all",version:[10,0],wmode:wmode},flashvars);return this;},detectFlash:function(failCallback){mw.log("PlayerElementFlash::detectFlash::detect loop "+this.detectFlashIntervalLoops);if(this.detectFlashIntervalLoops===0){if(!this.flashDetected){mw.log("PlayerElementFlash::detectFlash::failed to detecting Flash Player");failCallback();}this.cleanInterval(this.detectFlashInterval);}this.detectFlashIntervalLoops--;},cleanInterval:function(interval){clearInterval(interval);interval=null;},play:function(){this.sendNotification('doPlay');},pause:function(){this.sendNotification('doPause');},seek:function(val){this.sendNotification('doSeek',val);$(this).trigger('seeking');},load:function(){this.sendNotification('changeMedia',{'entryUrl':this.src});},changeVolume:function(volume){this.sendNotification('changeVolume',volume);},sendNotification:function(noteName,value){if(this.disabled){return false;}if(this.playerElement){this.playerElement.sendNotification(noteName,value);}else{$(this).bind('playerJsReady',function(){if(!this.disabled){this.playerElement.sendNotification(noteName,value);}});}},setKDPAttribute:function(obj,property,value){if(this.playerElement&&!this.disabled){this.playerElement.setKDPAttribute(obj,property,value);}},addJsListener:function(eventName,methodName){if(this.playerElement){this.bindPlayerFunction(eventName,methodName);}},removeJsListener:function(eventName,methodName){if(this.playerElement){mw.log('PlayerElementFlash:: unbindPlayerFunction:'+eventName);var gKdpCallbackName='kdp_'+methodName+'_cb_'+this.id.replace(/[^a-zA-Z 0-9]+/g,'');this.playerElement.removeJsListener(eventName,gKdpCallbackName);}},getCurrentTime:function(){if(this.playerElement){return this.playerElement.getCurrentTime();}return null;},getCurrentBufferLength:function(){if(this.playerElement){return this.playerElement.getCurrentBufferLength();}return null;},subscribe:function(callback,eventName,disregardEventCounter){if(this.playerElement){var methodName=!!disregardEventCounter?eventName:eventName+this.listenerCounter;this.listenerCounter++;this.targetObj[methodName]=callback;this.bindPlayerFunction(eventName,methodName);}},bindPlayerFunction:function(bindName,methodName,target){var _this=this;mw.log('PlayerElementFlash:: bindPlayerFunction:'+bindName);var gKdpCallbackName='kdp_'+methodName+'_cb_'+this.id.replace(/[^a-zA-Z 0-9]+/g,'');var createGlobalCB=function(cName){window[cName]=function(data){if(bindName!='playerUpdatePlayhead'&&bindName!='bytesDownloadedChange'){mw.log("PlayerElementFlash:: event: "+bindName);}_this.targetObj[methodName](data);};}(gKdpCallbackName,this);this.playerElement.removeJsListener(bindName,gKdpCallbackName);this.playerElement.addJsListener(bindName,gKdpCallbackName);},onUpdatePlayhead:function(playheadVal){this.currentTime=playheadVal;},onPause:function(){this.paused=true;},onPlay:function(){this.paused=false;$(this).trigger('playing');},onDurationChange:function(data,id){this.duration=data.newValue;$(this).trigger('loadedmetadata');},onClipDone:function(){$(this).trigger('ended');},onPlayerSeekEnd:function(){$(this).trigger('seeked');},onAlert:function(data,id){},onMute:function(){this.muted=true;},onUnMute:function(){this.muted=false;},onVolumeChanged:function(data){this.volume=data.newVolume;$(this).trigger('volumechange');},onMediaError:function(){$(this).trigger('error');},redrawObject:function(timeout){var _this=this;if(!timeout){timeout=250;}this.playerElement.style.width="99%";setTimeout(function(){_this.playerElement.style.width="100%";},timeout);}});})(window.mw,jQuery);(function(){function f(a,b){if(b)for(var c in b)if(b.hasOwnProperty(c))a[c]=b[c];return a}function l(a,b){var c=[];for(var d in a)if(a.hasOwnProperty(d))c[d]=b(a[d]);return c}function m(a,b,c){if(e.isSupported(b.version))a.innerHTML=e.getHTML(b,c);else if(b.expressInstall&&e.isSupported([6,65]))a.innerHTML=e.getHTML(f(b,{src:b.expressInstall}),{MMredirectURL:location.href,MMplayerType:"PlugIn",MMdoctitle:document.title});else{if(!a.innerHTML.replace(/\s/g,"")){a.innerHTML="<h2>Flash version "+b.version+" or greater is required</h2><h3>"+(g[0]>0?"Your version is "+g:"You have no flash plugin installed")+"</h3>"+(a.tagName=="A"?"<p>Click here to download latest version</p>":"<p>Download latest version from <a href='"+k+"'>here</a></p>");if(a.tagName=="A")a.onclick=function(){location.href=k}}if(b.onFail){var d=b.onFail.call(this);if(typeof d=="string")a.innerHTML=d}}if(i)window[b.id]=document.getElementById(b.id);f(this,{getRoot:function(){return a},getOptions:function(){return b},getConf:function(){return c},getApi:function(){return a.firstChild}})}var i=document.all,k="http://www.adobe.com/go/getflashplayer",n=typeof jQuery=="function",o=/(\d+)[^\d]+(\d+)[^\d]*(\d*)/,j={width:"100%",height:"100%",id:"_"+(""+Math.random()).slice(9),allowfullscreen:true,allowscriptaccess:"always",quality:"high",version:[3,0],onFail:null,expressInstall:null,w3c:false,cachebusting:false};window.attachEvent&&window.attachEvent("onbeforeunload",function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){}});window.flashembed=function(a,b,c){if(typeof a=="string")a=document.getElementById(a.replace("#",""));if(a){if(typeof b=="string")b={src:b};return new m(a,f(f({},j),b),c)}};var e=f(window.flashembed,{conf:j,getVersion:function(){var a,b;try{b=navigator.plugins["Shockwave Flash"].description.slice(16)}catch(c){try{b=(a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"))&&a.GetVariable("$version")}catch(d){try{b=(a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"))&&a.GetVariable("$version")}catch(h){}}}return(b=o.exec(b))?[b[1],b[3]]:[0,0]},asString:function(a){if(a===null||a===undefined)return null;var b=typeof a;if(b=="object"&&a.push)b="array";switch(b){case"string":a=a.replace(new RegExp('(["\\\\])',"g"),"\\$1");a=a.replace(/^\s?(\d+\.?\d+)%/,"$1pct");return'"'+a+'"';case"array":return"["+l(a,function(d){return e.asString(d)}).join(",")+"]";case"function":return'"function()"';case"object":b=[];for(var c in a)a.hasOwnProperty(c)&&b.push('"'+c+'":'+e.asString(a[c]));return"{"+b.join(",")+"}"}return String(a).replace(/\s/g," ").replace(/\'/g,'"')},getHTML:function(a,b){a=f({},a);var c='<object alt="video content" role="video content" width="'+a.width+'" height="'+a.height+'" id="'+a.id+'" name="'+a.id+'"';if(a.cachebusting)a.src+=(a.src.indexOf("?")!=-1?"&":"?")+Math.random();c+=a.w3c||!i?' data="'+a.src+'" type="application/x-shockwave-flash"':' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';c+=">";if(a.w3c||i)c+='<param name="movie" value="'+a.src+'" />';a.width=a.height=a.id=a.w3c=a.src=null;a.onFail=a.version=a.expressInstall=null;for(var d in a)if(a[d])c+='<param name="'+d+'" value="'+a[d]+'" />';a="";if(b){for(var h in b)if(b[h]){d=b[h];a+=h+"="+(/function|object/.test(typeof d)?e.asString(d):d)+"&"}a=a.slice(0,-1);c+='<param name="flashvars" value=\''+a+"' />"}c+="</object>";return c},isSupported:function(a){return g[0]>a[0]||g[0]==a[0]&&g[1]>=a[1]}}),g=e.getVersion();if(n){jQuery.tools=jQuery.tools||{version:"1.2.5"};jQuery.tools.flashembed={conf:j};jQuery.fn.flashembed=function(a,b){return this.each(function(){$(this).data("flashembed",flashembed(this,a,b))})}}})();;},{},{});mw.loader.implement("mw.PlayerElementHTML",function($){(function(mw,$){"use strict";mw.PlayerElementHTML=mw.PlayerElement.extend({init:function(containerId,playerId){var $vidSibling=$('<video />').attr({'id':playerId}).css({'-webkit-transform-style':'preserve-3d','position':'relative','width':'100%','height':'100%'});$('#'+containerId).append($vidSibling);this.element=$vidSibling[0];return this;},play:function(){this.element.play();},pause:function(){mw.log('PlayerElement::Error: function pause should be implemented by playerElement interface ');},seek:function(val){mw.log('PlayerElement::Error: function seek should be implemented by playerElement interface ');},load:function(){this.element.src=this.src;this.element.load();},changeVolume:function(val){this.element.volume=val;}});})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.PluginManager",function($){(function(mw,$){if(mw.PluginManager)return;mw.PluginManager={registerdPlugins:{},totalPlugins:0,initialisedPlugins:0,define:function(pluginName,pluginClass){if(this.registerdPlugins[pluginName]){mw.log('PluginManager::register: Plugin "'+pluginName+'" already registered.');return;}this.registerdPlugins[pluginName]=pluginClass;var playerConfig=window.kalturaIframePackageData.playerConfig;if(playerConfig.plugins&&playerConfig.plugins[pluginName]&&playerConfig.plugins[pluginName].plugin===false){mw.log('PluginManager::register: Plugin "'+pluginName+'" is disabled, omitted from total plugin count.');}else{this.totalPlugins++;}},getClass:function(pluginName){if(!this.registerdPlugins[pluginName]){mw.log('PluginManager::getClass: Plugin "'+pluginName+'" not registered.');return false;}return this.registerdPlugins[pluginName];},make:function(pluginName,embedPlayer,callback){var pluginClass=this.getClass(pluginName);return(pluginClass)?new pluginClass(embedPlayer,callback,pluginName):false;},registerLoader:function(pluginName){if(!this.registerdPlugins[pluginName]){mw.log('PluginManager::init: Plugin "'+pluginName+'" not registered.');return;}var _this=this;mw.addKalturaPlugin(pluginName,function(embedPlayer,callback){if(embedPlayer.plugins[pluginName]){callback();return;}embedPlayer.plugins[pluginName]=_this.make(pluginName,embedPlayer,callback);_this.initialisedPlugins++;if(_this.totalPlugins===_this.initialisedPlugins){embedPlayer.triggerHelper('pluginsReady',embedPlayer.plugins);}});return this;},add:function(pluginName,pluginClass){this.define(pluginName,pluginClass);this.registerLoader(pluginName);}};})(mediaWiki,jQuery);;},{},{});mw.loader.implement("mw.TextSource",function($){(function(mw,$){"use strict";mw.TextSource=function(source,embedPlayer){this.embedPlayer=embedPlayer;return this.init(source);};mw.TextSource.prototype={init:function(source,textProvider){this.loaded=false;this.captions=[];this.prevIndex=0;this.styleCss={};this.bodyStyleId='';for(var i in source){this[i]=source[i];}if(!this.kind){this.kind='subtitle';}if(textProvider){this.textProvider=textProvider;}return this;},load:function(callback){var _this=this;if(!callback){callback=function(){return;};}if(this.loaded){return callback();}if(!this.getSrc||!this.getSrc()){mw.log("Error: TextSource no source url for text track");return callback();}$(mw).triggerQueueCallback('TimedText_LoadTextSource',_this,function(){new mw.ajaxProxy({url:_this.getSrc(),success:function(resultXML){_this.captions=_this.getCaptions(resultXML);_this.loaded=true;mw.log("mw.TextSource :: loaded from "+_this.getSrc()+" Found: "+_this.captions.length+' captions');callback();},error:function(){mw.log("Error: TextSource Error with http response");_this.loaded=true;callback();}});});},getCaptionForTime:function(time){var captionSet={};var prevIndexUpdated=false;if(time<this.captions[this.prevIndex].start){this.prevIndex=0;}for(var i=this.prevIndex;i<this.captions.length;i++){var caption=this.captions[i];if(caption.end==0||caption.end==-1)continue;if(time>=caption.start&&time<=caption.end){captionSet[i]=caption;if(!prevIndexUpdated){this.prevIndex=i;prevIndexUpdated=true;}}}if(this.mimeType==="text/vtt"){var getValues=function(obj){var values=[];for(var i in obj){values.push(obj[i]);}return values;};WebVTT.processCues(window,getValues(captionSet),this.captionsArea);for(var j in captionSet){captionSet[j]['content']=captionSet[j].displayState;}}return captionSet;},isOverlay:function(){return this.mimeType=='text/xml';},getCaptions:function(data){switch(this.mimeType){case'text/mw-srt':return this.getCaptiosnFromMediaWikiSrt(data);break;case'text/x-srt':return this.getCaptionsFromSrt(data);break;case'text/xml':return this.getCaptionsFromTMML(data);break;case'text/vtt':return this.getCaptionsFromVTT(data);break;}if(this.src&&(this.src.substr(this.src.length-4)=='ttml'||this.src.substr(this.src.length-2)=="tt")||this.src.substr(this.src.length-4)=='dfxp'){return this.getCaptionsFromTMML(data);}if(this.src&&this.src.substr(this.src.length-3)=='srt'){return this.getCaptionsFromSrt(data);}return[];},getStyleCssById:function(styleId){if(this.styleCss[styleId]){return this.styleCss[styleId];}return{};},getCaptionsFromTMML:function(data){var _this=this;mw.log("TextSource::getCaptionsFromTMML",data);var captions=[];var parsedData=data;if(typeof(data)=="string"){parsedData=data.replace(/&amp;/g,'&').replace(/&/g,'&amp;');}var xml=($(parsedData).find("tt").length)?parsedData:$.parseXML(parsedData);try{if(!xml||$(xml).find('parsererror').length){mw.log("Error: close caption parse error: "+$(xml).find('parsererror').text());return captions;}}catch(e){mw.log("Error: close caption parse error: "+e.toString());return captions;}this.parseStylesTTML(xml);var captionLineToRemove=[];$(xml).find('p').each(function(inx,p){captions.push(_this.parseCaptionObjTTML(p));if(captions.length>1){if(captions[inx-1].start==captions[inx].start){captions[inx-1].content=(captions[inx-1].content).concat(captions[inx].content);captionLineToRemove.push(inx);}}});for(var inx=captionLineToRemove.length-1;inx>=0;inx--){captions.splice(captionLineToRemove[inx],1)}return captions;},parseStylesTTML:function(xml){var _this=this;this.bodyStyleId=$(xml).find('body').attr('style');if(!this.bodyStyleId){this.bodyStyleId=$(xml).find('body').attr('region');}$(xml).find('style').each(function(inx,style){var styleId=$(style).attr('id')||$(style).attr('xml:id')
if(styleId){var cssObject={};_this.buildStyleCss(style,cssObject);_this.styleCss[styleId]=cssObject;}});$(xml).find('region').each(function(inx,region){var cssObject={};if($(region).attr('style')){cssObject=_this.styleCss[$(region).attr('style')]}else{$(region).find('style').each(function(inx,style){_this.buildStyleCss(style,cssObject);});}var idVal=$(region).attr('id')||$(region).attr('xml:id');_this.styleCss[idVal]=cssObject;});},buildStyleCss:function(style,cssObject){$(style.attributes).each(function(inx,attr){var attrName=attr.name;if(attrName.substr(0,4)!=='tts:'){return true;}var cssName='';for(var c=4;c<attrName.length;c++){if(attrName[c].toLowerCase()!=attrName[c]){cssName+='-'+attrName[c].toLowerCase();}else{cssName+=attrName[c]}}cssObject[cssName]=attr.nodeValue;});},parseCaptionObjTTML:function(p){var _this=this;var content='';$.each(p.childNodes,function(inx,node){content+=_this.convertTTML2HTML(node);});var end=null;if($(p).attr('end')){end=mw.npt2seconds($(p).attr('end'));}if(!end&&$(p).attr('dur')){end=mw.npt2seconds($(p).attr('begin'))+mw.npt2seconds($(p).attr('dur'));}var captionObj={'start':mw.npt2seconds($(p).attr('begin')),'end':end,'content':content};var $meta=$(p).find('metadata');if($meta.length){captionObj['css']={'position':'absolute'};if($meta.attr('cccol')){captionObj['css']['left']=($meta.attr('cccol')/35)*100+'%';}if($meta.attr('ccrow')){captionObj['css']['top']=($meta.attr('ccrow')/15)*100+'%';}}if($(p).attr('tts:textAlign')){if(!captionObj['css']){captionObj['css']={};}captionObj['css']['text-align']=$(p).attr('tts:textAlign');if(captionObj['css']['text-align']=='right'&&captionObj['css']['left']){captionObj['css']['left']=null;}}if($(p).attr('style')){captionObj['styleId']=$(p).attr('style');}else{if($(p).attr('region')){captionObj['styleId']=$(p).attr('region');}else{captionObj['styleId']=_this.bodyStyleId;}}return captionObj;},convertTTML2HTML:function(node){var _this=this;if(node.nodeType==3||node.nodeType==4){return node.nodeValue;}if(node.nodeName=='metadata'){return'';}if(node.nodeName=='br'){return'<br />';}var ttsStyleMap={'tts:color':'color','tts:fontWeight':'font-weight','tts:fontStyle':'font-style'};if(node.childNodes.length){var nodeString='';var styleVal='';for(var attr in ttsStyleMap){if(node.getAttribute(attr)){styleVal+=ttsStyleMap[attr]+':'+node.getAttribute(attr)+';';}}nodeString+='<'+node.nodeName+' style="'+styleVal+'" >';$.each(node.childNodes,function(inx,childNode){nodeString+=_this.convertTTML2HTML(childNode);});nodeString+='</'+node.nodeName+'>';return nodeString;}return'';},getCaptionsFromSrt:function(data){mw.log("TextSource::getCaptionsFromSrt");var _this=this;try{var xml=$.parseXML(data);if(xml&&$(xml).find('parsererror').length==0){return this.getCaptionsFromTMML(data);}}catch(e){}var srt=data.replace(/\r\n/g,'\n').replace(/\r/g,'\n');srt=srt.replace(/^\s+|\s+$/g,'');srt=srt.replace(/<[a-zA-Z\/][^>]*>/g,'');var captions=[];var caplist=srt.split('\n\n');for(var i=0;i<caplist.length;i++){var captionText="";var caption=false;captionText=caplist[i].replace(/^\s+|\s+$/g,'');var s=captionText.split(/\n/);if(s.length<2){continue;}if(s[0].match(/^\d+$/)&&s[1].match(/\d+:\d+:\d+/)){var m=s[1].match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);if(m){caption=_this.match2caption(m);}else{continue;}if(caption){caption['content']=s.slice(2).join("<br>");}}else{continue;}captions.push(caption);}return captions;},getCaptiosnFromMediaWikiSrt:function(data){mw.log("TimedText::getCaptiosnFromMediaWikiSrt:");var _this=this;var captions=[];var curentCap={'content':''};var parseNextAsTime=false;$('<div>'+data+'</div>').find('p').each(function(){var currentPtext=$(this).html();var m=currentPtext.replace('--&gt;','-->').match(/\d+\s([\d\-]+):([\d\-]+):([\d\-]+)(?:,([\d\-]+))?\s*--?>\s*([\d\-]+):([\d\-]+):([\d\-]+)(?:,([\d\-]+))?\n?(.*)/);if(m){captions.push(_this.match2caption(m));return true;}if(parseInt(currentPtext)==currentPtext){if(curentCap.content!=''){captions.push(curentCap);}curentCap={'content':''};return true;}var m=currentPtext.replace('--&gt;','-->').match(/(\d+):(\d+):(\d+)(?:,(\d+))?\s*--?>\s*(\d+):(\d+):(\d+)(?:,(\d+))?/);if(m){curentCap=_this.match2caption(m);return true;}if(currentPtext!='<br>'){curentCap['content']+=currentPtext;}});if(curentCap.length!=0){captions.push(curentCap);}mw.log("TimedText::getCaptiosnFromMediaWikiSrt found "+captions.length+' captions');return captions;},getCaptionsFromVTT:function(data){window.VTTCue=window.VttjsCue;var parser=new WebVTT.Parser(window,WebVTT.StringDecoder());var cues=[];var regions=[];parser.oncue=function(cue){cues.push(cue);};parser.onregion=function(region){regions.push(region);};parser.onparsingerror=function(error){mw.log("TextSource::getCaptionsFromVTT ",error);};parser.parse(data);parser.flush();if(!this.embedPlayer.getInterface().find('.captionsArea')[0]){this.embedPlayer.getVideoHolder().append($('<div />').addClass('captionsArea').css('visibility','hidden'));}this.captionsArea=this.embedPlayer.getInterface().find('.captionsArea')[0];for(var i=0;i<cues.length;i++){cues[i]['start']=cues[i].startTime;cues[i]['end']=cues[i].endTime;}mw.log("TextSource::getCaptionsFromVTT captions: ",cues);return cues;},match2caption:function(m){var caption={};var startMs=(m[4])?(parseInt(m[4],10)/1000):0;var endMs=(m[8])?(parseInt(m[8],10)/1000):0;caption['start']=this.timeParts2seconds(m[1],m[2],m[3],startMs);caption['end']=this.timeParts2seconds(m[5],m[6],m[7],endMs);if(m[9]){caption['content']=$.trim(m[9]);}return caption;},timeParts2seconds:function(hours,min,sec,ms){return mw.measurements2seconds({'hours':hours,'minutes':min,'seconds':sec,'milliseconds':ms});}};window.VttjsCue=window.VTTCue;window.VTTCue=window.originalVTTCue;})(window.mediaWiki,window.jQuery);;},{},{});mw.loader.implement("mw.ajaxProxy",function($){(function(mw,$){var ajaxProxy=function(options){if(!$.isFunction(options.success)){mw.log("mw.ajaxProxy :: Error: missing success callback.");return;}if(!options.url){mw.log("mw.ajaxProxy :: Error: missing url to proxy.");}if(options.ajaxOptions){options.enableCORS=options.ajaxOptions.enableCORS||false;}var defaults={error:function(){},proxyUrl:mw.getConfig('Mw.XmlProxyUrl'),proxyType:'jsonp',startWithProxy:false,timeout:mw.getConfig('Mw.AjaxTimeout',10000),enableCORS:false};this.options=$.extend({},defaults,options);this.ajax();};ajaxProxy.prototype={ajax:function(useProxy){var _this=this;if(_this.options.startWithProxy){_this.proxy();return;}var ajaxOptions={success:function(result){_this.handleResult(result);},timeout:_this.options.timeout,xhrFields:{withCredentials:_this.options.enableCORS}};if(useProxy){ajaxOptions.url=_this.options.proxyUrl+encodeURIComponent(_this.options.url);ajaxOptions.error=function(){mw.log("mw.ajaxProxy :: Error: request failed with proxy.");_this.options.error();};}else{ajaxOptions.url=_this.options.url;ajaxOptions.error=function(jqXHR,textStatus,errorThrown){mw.log("mw.ajaxProxy :: Error: cross domain request failed, trying with proxy");_this.proxy();};}try{$.ajax(ajaxOptions);}catch(e){}},proxy:function(){var _this=this;if(_this.options.proxyUrl){if(_this.options.proxyType=='jsonp'){$.ajax({url:_this.options.proxyUrl+'?url='+encodeURIComponent(_this.options.url)+'&callback=?',dataType:'json',success:function(result){_this.handleResult(result,true);},error:function(error){mw.log("mw.ajaxProxy :: Error: could not load:",error);_this.options.error();},timeout:_this.options.timeout});}else{_this.ajax(true);}}else{mw.log("mw.ajaxProxy :: Error: please setup proxy configuration");this.options.error();}},handleResult:function(result,isJsonP){var _this=this;if(isJsonP){if(result['http_code']=='ERROR'||result['http_code']==0){mw.log("mw.ajaxProxy :: Error: load error with http response");_this.options.error();return;}try{var resultXML=$.parseXML(result['contents']);if(resultXML){result=resultXML;}}catch(e){result=result['contents'];}_this.options.success(result);}else{_this.options.success(result);}}};mw.ajaxProxy=ajaxProxy;})(window.mw,window.jQuery);;},{},{});mw.loader.implement("mw.Language.names",function($){if(!mw.Language){mw.Language={};}mw.Language.names={"aa":"Qaf\u00e1r af","ab":"\u0410\u04a7\u0441\u0443\u0430","ace":"Ac\u00e8h","af":"Afrikaans","ak":"Akan","aln":"Geg\u00eb","als":"Alemannisch","am":"\u12a0\u121b\u122d\u129b","an":"Aragon\u00e9s","ang":"Anglo-Saxon","ar":"\u0627\u0644\u0639\u0631\u0628\u064a\u0629","arc":"\u0710\u072a\u0721\u071d\u0710","arn":"Mapudungun","arz":"\u0645\u0635\u0631\u0649","as":"\u0985\u09b8\u09ae\u09c0\u09af\u09bc\u09be","ast":"Asturianu","av":"\u0410\u0432\u0430\u0440","avk":"Kotava","ay":"Aymar aru","az":"Az\u0259rbaycan","ba":"\u0411\u0430\u0448\u04a1\u043e\u0440\u0442","bar":"Boarisch","bat-smg":"\u017demait\u0117\u0161ka","bcc":"\u0628\u0644\u0648\u0686\u06cc \u0645\u06a9\u0631\u0627\u0646\u06cc","bcl":"Bikol Central","be":"\u0411\u0435\u043b\u0430\u0440\u0443\u0441\u043a\u0430\u044f","be-tarask":"\u0411\u0435\u043b\u0430\u0440\u0443\u0441\u043a\u0430\u044f (\u0442\u0430\u0440\u0430\u0448\u043a\u0435\u0432\u0456\u0446\u0430)","be-x-old":"\u0411\u0435\u043b\u0430\u0440\u0443\u0441\u043a\u0430\u044f (\u0442\u0430\u0440\u0430\u0448\u043a\u0435\u0432\u0456\u0446\u0430)","bg":"\u0411\u044a\u043b\u0433\u0430\u0440\u0441\u043a\u0438","bh":"\u092d\u094b\u091c\u092a\u0941\u0930\u0940","bi":"Bislama","bm":"Bamanankan","bn":"\u09ac\u09be\u0982\u09b2\u09be","bo":"\u0f56\u0f7c\u0f51\u0f0b\u0f61\u0f72\u0f42","bpy":"\u0987\u09ae\u09be\u09b0 \u09a0\u09be\u09b0\/\u09ac\u09bf\u09b7\u09cd\u09a3\u09c1\u09aa\u09cd\u09b0\u09bf\u09af\u09bc\u09be \u09ae\u09a3\u09bf\u09aa\u09c1\u09b0\u09c0","bqi":"\u0628\u062e\u062a\u064a\u0627\u0631\u064a","br":"Brezhoneg","bs":"Bosanski","bug":"\u1a05\u1a14 \u1a15\u1a18\u1a01\u1a17","bxr":"\u0411\u0443\u0440\u044f\u0430\u0434","ca":"Catal\u00e0","cbk-zam":"Chavacano de Zamboanga","cdo":"M\u00ecng-d\u0115\u0324ng-ng\u1e73\u0304","ce":"\u041d\u043e\u0445\u0447\u0438\u0439\u043d","ceb":"Cebuano","ch":"Chamoru","cho":"Choctaw","chr":"\u13e3\u13b3\u13a9","chy":"Tsets\u00eahest\u00e2hese","ckb":"Soran\u00ee \/ \u06a9\u0648\u0631\u062f\u06cc","ckb-latn":"\u202aSoran\u00ee (lat\u00een\u00ee)\u202c","ckb-arab":"\u202b\u06a9\u0648\u0631\u062f\u06cc (\u0639\u06d5\u0631\u06d5\u0628\u06cc)\u202c","co":"Corsu","cr":"N\u0113hiyaw\u0113win \/ \u14c0\u1426\u1403\u152d\u140d\u140f\u1423","crh":"Q\u0131r\u0131mtatarca","crh-latn":"\u202aQ\u0131r\u0131mtatarca (Latin)\u202c","crh-cyrl":"\u202a\u041a\u044a\u044b\u0440\u044b\u043c\u0442\u0430\u0442\u0430\u0440\u0434\u0436\u0430 (\u041a\u0438\u0440\u0438\u043b\u043b)\u202c","cs":"\u010cesky","csb":"Kasz\u00ebbsczi","cu":"\u0421\u043b\u043e\u0432\u0463\u0301\u043d\u044c\u0441\u043a\u044a \/ \u2c14\u2c0e\u2c11\u2c02\u2c21\u2c10\u2c20\u2c14\u2c0d\u2c1f","cv":"\u0427\u04d1\u0432\u0430\u0448\u043b\u0430","cy":"Cymraeg","da":"Dansk","de":"Deutsch","de-at":"\u00d6sterreichisches Deutsch","de-ch":"Schweizer Hochdeutsch","de-formal":"Deutsch (Sie-Form)","diq":"Zazaki","dk":"Dansk (deprecated:da)","dsb":"Dolnoserbski","dv":"\u078b\u07a8\u0788\u07ac\u0780\u07a8\u0784\u07a6\u0790\u07b0","dz":"\u0f47\u0f7c\u0f44\u0f0b\u0f41","ee":"E\u028begbe","el":"\u0395\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac","eml":"Emili\u00e0n e rumagn\u00f2l","en":"English","en-gb":"British English","eo":"Esperanto","es":"Espa\u00f1ol","et":"Eesti","eu":"Euskara","ext":"Estreme\u00f1u","fa":"\u0641\u0627\u0631\u0633\u06cc","ff":"Fulfulde","fi":"Suomi","fiu-vro":"V\u00f5ro","fj":"Na Vosa Vakaviti","fo":"F\u00f8royskt","fr":"Fran\u00e7ais","frc":"Fran\u00e7ais cadien","frp":"Arpetan","fur":"Furlan","fy":"Frysk","ga":"Gaeilge","gag":"Gagauz","gan":"\u8d1b\u8a9e","gan-hans":"\u8d63\u8bed(\u7b80\u4f53)","gan-hant":"\u8d1b\u8a9e(\u7e41\u9ad4)","gd":"G\u00e0idhlig","gl":"Galego","glk":"\u06af\u06cc\u0644\u06a9\u06cc","gn":"Ava\u00f1e'\u1ebd","got":"\ud800\udf32\ud800\udf3f\ud800\udf44\ud800\udf39\ud800\udf43\ud800\udf3a","grc":"\u1f08\u03c1\u03c7\u03b1\u03af\u03b1 \u1f11\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u1f74","gsw":"Alemannisch","gu":"\u0a97\u0ac1\u0a9c\u0ab0\u0abe\u0aa4\u0ac0","gv":"Gaelg","ha":"\u0647\u064e\u0648\u064f\u0633\u064e","hak":"Hak-k\u00e2-fa","haw":"Hawai`i","he":"\u05e2\u05d1\u05e8\u05d9\u05ea","hi":"\u0939\u093f\u0928\u094d\u0926\u0940","hif":"Fiji Hindi","hif-deva":"\u092b\u093c\u0940\u091c\u0940 \u0939\u093f\u0928\u094d\u0926\u0940","hif-latn":"Fiji Hindi","hil":"Ilonggo","ho":"Hiri Motu","hr":"Hrvatski","hsb":"Hornjoserbsce","ht":"Krey\u00f2l ayisyen","hu":"Magyar","hy":"\u0540\u0561\u0575\u0565\u0580\u0565\u0576","hz":"Otsiherero","ia":"Interlingua","id":"Bahasa Indonesia","ie":"Interlingue","ig":"Igbo","ii":"\ua187\ua259","ik":"I\u00f1upiak","ike-cans":"\u1403\u14c4\u1483\u144e\u1450\u1466","ike-latn":"inuktitut","ilo":"Ilokano","inh":"\u0413\u0406\u0430\u043b\u0433\u0406\u0430\u0439 \u011eal\u011faj","io":"Ido","is":"\u00cdslenska","it":"Italiano","iu":"\u1403\u14c4\u1483\u144e\u1450\u1466\/inuktitut","ja":"\u65e5\u672c\u8a9e","jbo":"Lojban","jut":"Jysk","jv":"Basa Jawa","ka":"\u10e5\u10d0\u10e0\u10d7\u10e3\u10da\u10d8","kaa":"Qaraqalpaqsha","kab":"Taqbaylit","kg":"Kongo","ki":"G\u0129k\u0169y\u0169","kiu":"Kurmanc\u00ee","kj":"Kwanyama","kk":"\u049a\u0430\u0437\u0430\u049b\u0448\u0430","kk-arab":"\u202b\u0642\u0627\u0632\u0627\u0642\u0634\u0627 (\u062a\u0674\u0648\u062a\u06d5)\u202c","kk-cyrl":"\u202a\u049a\u0430\u0437\u0430\u049b\u0448\u0430 (\u043a\u0438\u0440\u0438\u043b)\u202c","kk-latn":"\u202aQazaq\u015fa (lat\u0131n)\u202c","kk-cn":"\u202b\u0642\u0627\u0632\u0627\u0642\u0634\u0627 (\u062c\u06c7\u0646\u06af\u0648)\u202c","kk-kz":"\u202a\u049a\u0430\u0437\u0430\u049b\u0448\u0430 (\u049a\u0430\u0437\u0430\u049b\u0441\u0442\u0430\u043d)\u202c","kk-tr":"\u202aQazaq\u015fa (T\u00fcrk\u00efya)\u202c","kl":"Kalaallisut","km":"\u1797\u17b6\u179f\u17b6\u1781\u17d2\u1798\u17c2\u179a","kn":"\u0c95\u0ca8\u0ccd\u0ca8\u0ca1","ko":"\ud55c\uad6d\uc5b4","ko-kp":"\ud55c\uad6d\uc5b4 (\uc870\uc120)","kr":"Kanuri","kri":"Krio","krj":"Kinaray-a","ks":"\u0915\u0936\u094d\u092e\u0940\u0930\u0940 - (\u0643\u0634\u0645\u064a\u0631\u064a)","ksh":"Ripoarisch","ku":"Kurd\u00ee \/ \u0643\u0648\u0631\u062f\u06cc","ku-latn":"\u202aKurd\u00ee (lat\u00een\u00ee)\u202c","ku-arab":"\u202b\u0643\u0648\u0631\u062f\u064a (\u0639\u06d5\u0631\u06d5\u0628\u06cc)\u202c","kv":"\u041a\u043e\u043c\u0438","kw":"Kernowek","ky":"\u041a\u044b\u0440\u0433\u044b\u0437\u0447\u0430","la":"Latina","lad":"Ladino","lb":"L\u00ebtzebuergesch","lbe":"\u041b\u0430\u043a\u043a\u0443","lez":"\u041b\u0435\u0437\u0433\u0438","lfn":"Lingua Franca Nova","lg":"Luganda","li":"Limburgs","lij":"L\u00edguru","lmo":"Lumbaart","ln":"Ling\u00e1la","lo":"\u0ea5\u0eb2\u0ea7","loz":"Silozi","lt":"Lietuvi\u0173","lv":"Latvie\u0161u","lzh":"\u6587\u8a00","mai":"\u092e\u0948\u0925\u093f\u0932\u0940","map-bms":"Basa Banyumasan","mdf":"\u041c\u043e\u043a\u0448\u0435\u043d\u044c","mg":"Malagasy","mh":"Ebon","mhr":"\u041e\u043b\u044b\u043a \u041c\u0430\u0440\u0438\u0439","mi":"M\u0101ori","mk":"\u041c\u0430\u043a\u0435\u0434\u043e\u043d\u0441\u043a\u0438","ml":"\u0d2e\u0d32\u0d2f\u0d3e\u0d33\u0d02","mn":"\u041c\u043e\u043d\u0433\u043e\u043b","mo":"\u041c\u043e\u043b\u0434\u043e\u0432\u0435\u043d\u044f\u0441\u043a\u044d","mr":"\u092e\u0930\u093e\u0920\u0940","ms":"Bahasa Melayu","mt":"Malti","mus":"Mvskoke","mwl":"Mirand\u00e9s","my":"\u1019\u103c\u1014\u103a\u1019\u102c\u1018\u102c\u101e\u102c","myv":"\u042d\u0440\u0437\u044f\u043d\u044c","mzn":"\u0645\u064e\u0632\u0650\u0631\u0648\u0646\u064a","na":"Dorerin Naoero","nah":"N\u0101huatl","nan":"B\u00e2n-l\u00e2m-g\u00fa","nap":"Nnapulitano","nb":"\u202aNorsk (bokm\u00e5l)\u202c","nds":"Plattd\u00fc\u00fctsch","nds-nl":"Nedersaksisch","ne":"\u0928\u0947\u092a\u093e\u0932\u0940","new":"\u0928\u0947\u092a\u093e\u0932 \u092d\u093e\u0937\u093e","ng":"Oshiwambo","niu":"Niu\u0113","nl":"Nederlands","nn":"\u202aNorsk (nynorsk)\u202c","no":"\u202aNorsk (bokm\u00e5l)\u202c","nov":"Novial","nrm":"Nouormand","nso":"Sesotho sa Leboa","nv":"Din\u00e9 bizaad","ny":"Chi-Chewa","oc":"Occitan","om":"Oromoo","or":"\u0b13\u0b21\u0b3c\u0b3f\u0b06","os":"\u0418\u0440\u043e\u043d\u0430\u0443","pa":"\u0a2a\u0a70\u0a1c\u0a3e\u0a2c\u0a40","pag":"Pangasinan","pam":"Kapampangan","pap":"Papiamentu","pcd":"Picard","pdc":"Deitsch","pdt":"Plautdietsch","pfl":"Pf\u00e4lzisch","pi":"\u092a\u093e\u093f\u0934","pih":"Norfuk \/ Pitkern","pl":"Polski","pms":"Piemont\u00e8is","pnb":"\u067e\u0646\u062c\u0627\u0628\u06cc","pnt":"\u03a0\u03bf\u03bd\u03c4\u03b9\u03b1\u03ba\u03ac","ps":"\u067e\u069a\u062a\u0648","pt":"Portugu\u00eas","pt-br":"Portugu\u00eas do Brasil","qu":"Runa Simi","rif":"Tarifit","rm":"Rumantsch","rmy":"Romani","rn":"Kirundi","ro":"Rom\u00e2n\u0103","roa-rup":"Arm\u00e3neashce","roa-tara":"Tarand\u00edne","ru":"\u0420\u0443\u0441\u0441\u043a\u0438\u0439","ruq":"Vl\u0103he\u015fte","ruq-cyrl":"\u0412\u043b\u0430\u0445\u0435\u0441\u0442\u0435","ruq-latn":"Vl\u0103he\u015fte","rw":"Kinyarwanda","sa":"\u0938\u0902\u0938\u094d\u0915\u0943\u0924","sah":"\u0421\u0430\u0445\u0430 \u0442\u044b\u043b\u0430","sc":"Sardu","scn":"Sicilianu","sco":"Scots","sd":"\u0633\u0646\u068c\u064a","sdc":"Sassaresu","se":"S\u00e1megiella","sei":"Cmique Itom","sg":"S\u00e4ng\u00f6","sh":"Srpskohrvatski \/ \u0421\u0440\u043f\u0441\u043a\u043e\u0445\u0440\u0432\u0430\u0442\u0441\u043a\u0438","shi":"Ta\u0161l\u1e25iyt","si":"\u0dc3\u0dd2\u0d82\u0dc4\u0dbd","simple":"Simple English","sk":"Sloven\u010dina","sl":"Sloven\u0161\u010dina","sli":"Schl\u00e4sch","sm":"Gagana Samoa","sma":"\u00c5arjelsaemien","sn":"chiShona","so":"Soomaaliga","sq":"Shqip","sr":"\u0421\u0440\u043f\u0441\u043a\u0438 \/ Srpski","sr-ec":"\u0421\u0440\u043f\u0441\u043a\u0438 (\u045b\u0438\u0440\u0438\u043b\u0438\u0446\u0430)","sr-el":"Srpski (latinica)","srn":"Sranantongo","ss":"SiSwati","st":"Sesotho","stq":"Seeltersk","su":"Basa Sunda","sv":"Svenska","sw":"Kiswahili","szl":"\u015al\u016fnski","ta":"\u0ba4\u0bae\u0bbf\u0bb4\u0bcd","tcy":"\u0ca4\u0cc1\u0cb3\u0cc1","te":"\u0c24\u0c46\u0c32\u0c41\u0c17\u0c41","tet":"Tetun","tg":"\u0422\u043e\u04b7\u0438\u043a\u04e3","tg-cyrl":"\u0422\u043e\u04b7\u0438\u043a\u04e3","tg-latn":"tojik\u012b","th":"\u0e44\u0e17\u0e22","ti":"\u1275\u130d\u122d\u129b","tk":"T\u00fcrkmen\u00e7e","tl":"Tagalog","tn":"Setswana","to":"lea faka-Tonga","tokipona":"Toki Pona","tp":"Toki Pona (deprecated:tokipona)","tpi":"Tok Pisin","tr":"T\u00fcrk\u00e7e","ts":"Xitsonga","tt":"\u0422\u0430\u0442\u0430\u0440\u0447\u0430\/Tatar\u00e7a","tt-cyrl":"\u0422\u0430\u0442\u0430\u0440\u0447\u0430","tt-latn":"Tatar\u00e7a","tum":"chiTumbuka","tw":"Twi","ty":"Reo M\u0101`ohi","tyv":"\u0422\u044b\u0432\u0430 \u0434\u044b\u043b","udm":"\u0423\u0434\u043c\u0443\u0440\u0442","ug":"Uyghurche\u200e \/ \u0626\u06c7\u064a\u063a\u06c7\u0631\u0686\u06d5","ug-arab":"\u0626\u06c7\u064a\u063a\u06c7\u0631\u0686\u06d5","ug-latn":"Uyghurche\u200e","uk":"\u0423\u043a\u0440\u0430\u0457\u043d\u0441\u044c\u043a\u0430","ur":"\u0627\u0631\u062f\u0648","uz":"O'zbek","ve":"Tshivenda","vec":"V\u00e8neto","vep":"Vepsan kel'","vi":"Ti\u1ebfng Vi\u1ec7t","vls":"West-Vlams","vo":"Volap\u00fck","vro":"V\u00f5ro","wa":"Walon","war":"Winaray","wo":"Wolof","wuu":"\u5434\u8bed","xal":"\u0425\u0430\u043b\u044c\u043c\u0433","xh":"isiXhosa","xmf":"\u10db\u10d0\u10e0\u10d2\u10d0\u10da\u10e3\u10e0\u10d8","yi":"\u05d9\u05d9\u05b4\u05d3\u05d9\u05e9","yo":"Yor\u00f9b\u00e1","yue":"\u7cb5\u8a9e","za":"Vahcuengh","zea":"Ze\u00eauws","zh":"\u4e2d\u6587","zh-classical":"\u6587\u8a00","zh-cn":"\u202a\u4e2d\u6587(\u4e2d\u56fd\u5927\u9646)\u202c","zh-hans":"\u202a\u4e2d\u6587(\u7b80\u4f53)\u202c","zh-hant":"\u202a\u4e2d\u6587(\u7e41\u9ad4)\u202c","zh-hk":"\u202a\u4e2d\u6587(\u9999\u6e2f)\u202c","zh-min-nan":"B\u00e2n-l\u00e2m-g\u00fa","zh-mo":"\u202a\u4e2d\u6587(\u6fb3\u9580)\u202c","zh-my":"\u202a\u4e2d\u6587(\u9a6c\u6765\u897f\u4e9a)\u202c","zh-sg":"\u202a\u4e2d\u6587(\u65b0\u52a0\u5761)\u202c","zh-tw":"\u202a\u4e2d\u6587(\u53f0\u7063)\u202c","zh-yue":"\u7cb5\u8a9e","zu":"isiZulu"};;},{},{});mw.loader.implement("mw.MwEmbedSupport.style",function($){;},{"all":".modal_editor{ left:10px;top:10px;right:10px;bottom:10px;position:fixed;z-index:100}.displayHTML a:visited{color:white}.loadingSpinner{width:32px;height:32px;display:block;padding:0px;background-image:url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50/modules/MwEmbedSupport/skins/common/images/loading_ani.gif?2016-11-17T08:31:40Z)}.mw-imported-resource{border:thin solid black}.kaltura-icon{background-image:url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50/modules/MwEmbedSupport/skins/common/images/kaltura_logo_sm_transparent.png?2016-11-17T08:31:40Z) !important;background-repeat:no-repeat;display:block;height:12px;width:12px;margin-top:2px !important;margin-left:3px !important}.mw-fullscreen-overlay{background:rgb(0,0,0) none repeat scroll 0% 0%;position:fixed;top:0pt;left:0pt;width:100%;height:100%;-moz-background-clip:border;-moz-background-origin:padding;-moz-background-inline-policy:continuous} .play-btn-large{width:70px;height:53px;background :url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAA1CAYAAAD8mJ3rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA+RJREFUeNrsm0tPGlEYhg/MIDcZLhqqqcYYY1GimJgYjRovcePadKm7rrvgX3TT/ozWhW5duLCJMerCaBSroASVaJRquBSQmeHS76vYWqmpF844g/MmLwmjQHj8bud4RkP+yAAeAb8BN5OXpRA4AP4KzuAFTfEHbrAX/Iq8bJ2BP4K/IZh68CewmagixYh5z8DDO7BL5fFbLNikhQePyqJEHgRjUjmU6FfEqPqHVDAqGBWMMsDU1tbqGhsb9Urs2VSk0+m0Xq/3dU9Pjw2fn5+fCzMzM5H5+fmoEsDggPcWXFXuN56amnIODQ3VFAoFgjYajUx3dzc3MDBgvbi4EE5OTgQZcxGpgZmcnKznOE53+7rFYmH7+/vtnZ2dZoDDA6TsiwIzPj5eYzabmeuIuW2Hw1E1MjLiaG5u1ofDYT6RSOTkBIZajcnlcgXwf3+vq6vL2tHRYVlZWYlNT09HYrFYtqJrzNjYmMNkMt0ZMTeN2x8NDQ3G4mu0oVAoI4pioSJTaXR01H5fMNfWgFpaWkzDw8N2eF44ODjg8/l8oaLAwJfDvz4LX4w81AzDaNva2qr7+vo4QRByR0dHfMWAgVZtxxb9GDDX1uv1DNYfaPMWrD1nZ2eC4sEMDg7aHppKdxm6G4szkMvlMiIcCQo0PTAwyNmeGjG3bbVadb29vTYo1FU4IKZSKVotnmq7JtlslkrhhMixtLa2Vm9sbCTm5ubOacxAVOcYAEMz3DUej8fqdrsty8vL0YWFhSjP83nZg8FoyWP8094e0Goxbe0wKHKzs7One3t7l7LediimkmQ2GAzMxMREHXQyrRJSSdLhjGVZbVNTkyEQCKRlCwazCOFIPbImk8ms7GuM1BFzfHx8Wa59HpoRc6/Vdbk+y+fzJRYXF2OK6EpSREwwGEwuLS3F4vF4WWcDqgMezZUxpE0G5xda6yeqxZdGxOB+8erqaiwcDmeodjil1BjsNmtrazEY4NJEAlEFU45UymQy+c3Nzfj29naqUNzuUzoY8pQVgSAI+d3d3R9bW1tJURTzRGLJLmLwNfv7+6n19fVEOReFcouYB4E5PDxMIxCoJ8/+rxRqYLAc3DeVIpEID0Di0HFEIhOxz/nh0WhURCCnp6c8kZmogYFukuM4jr2r9UJRTYRCoUsiU1EDs7Ozk3Q6nX8d/8BiCm034ff701K23scIz/l+IZTO+NbV1enb29urGYbRYLoAkNRztN5HKEUVjIKVUo+a3SEVjApGBVM2MGkVQ4nSCManciiRD8F8JsW7ulRd7XggEzztkAT7ydXtOS99nvkO/gAOam5cVO+JvHFP5E8BBgBjuVwnLBcrSQAAAABJRU5ErkJggg==);background :url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50/modules/MwEmbedSupport/skins/common/images/player_big_play_button.png?2016-11-17T08:31:40Z)!ie;position :absolute;cursor :pointer;border :none !important;z-index :1;left :50%;top :50%;margin-left:-35px;margin-top :-26px}.play-btn-large:hover{background :url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAA1CAYAAAD8mJ3rAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA9RJREFUeNrsm8tPGlEUxgcBQamNSavVKBoa05I2AWNaW2IlJDauXJkaE1cuumbByv/A1AVsjRtjorEujFEDC3ykvhZGWGgIAtKqUYrTgmjLAPLsuVZbqrUxOheGcr/km8WQ3MWPc+acc2cuj/otMVgDfgSWUfmlbbAL/AEcQTd4Zz88AevAD6j8Fg3Wg+0ITCXYAJZQRNRZxGj5cHkLfkx4/JIAXFwAFwVhcUkKBKaYcLik04gh+osIGAKGgMkNMDKZTFRfXy8hYM7nC7G4wGg0Kt1u92ur1arZ29vTaLXaqlwBgxq8N+BCthc2GAx1HR0dsmQySSFLJJLC1tbWiq6uroqDg4PQ5uZmiMNcYtgiRq1WlwOQ1EVDapUMDw83Li8vNzY3N9/Nu1QqAMXj8dRVViqV90wmU9PExIRSoVBI8gbMv6CkW6PRVM7NzTUNDg4+raqqKvzvwSQSidR14aDtj7a2turV1dXm3t7eutLSUkHeR0y6+aDu7u6HAOiVTqeTikSirPVZaD/mPY69mMXFRVVtbe2d26yBqld/f/8nSDNvhrkw2MDMz8+/rKmpYWXdnZ2doF6vd8PD2p/zYMxm8wu2wJxrY2PjsK+vz22xWII5Cwb+3edSqRRLGYYeiIYGcsflcoVzDszU1NSz6upqbP0JVL0klPkDBIim6RjbYLCVxVgslopGoymchQP1QCqVqnxycnJ/YGBgPxgMJthaHCsYKMFJ7MMen89rb2+XtrS0VEAP5IA0O+Y8GMwR84eKiooEPT098s7OTgvDMAnOgkENG4KTyeZDKBTyGxoaSpaWlo44DSYTqXRRfr8/yulUykbEOJ3OY7vdHiJg0gbWhYUFemhoyJMLVSmJjBuK1Wr1j4yMeGCuirK5Lu5nDLaIga7329jY2P7W1haW7hcnGApHKnk8ntD4+LhnfX39O85IFODMezYjJhAInExPT39eWVk5ojIgrGCQbz20MEx8dnbWOzMzc4g20zNV4TgbMScnJ0lo77+YzWZfOBxOUBkWNjDnr0tuAtRisfghbWg2h8KcTiWbzRZAQHw+X4zKsnBGzKmvo+3t7aDRaPTu7u5GKI4oq68pvF5v2GQyeR0OB0NxTNjAQDWJlZWVia8qvVBl6LW1tWOKo8IGBmYXP3p9wgOll14004ADmSy9NxG2PV8kuVwuUavV94VCIc/tdjMA5DASiSQo7ovBCiaHxZBPza4QAUPAEDCsgQkRDJcUQmBshMPlsQ2BGaXOTnURnQrtHY+iz1nRJxVO6ufxnHzvZ76C34E/8tJukjORaWcifwgwAL3bpBIa2UbLAAAAAElFTkSuQmCC);background :url(https://cdnapisec.kaltura.com/html5/html5lib/v2.50/modules/MwEmbedSupport/skins/common/images/player_big_play_button_hover.png?2016-11-17T08:31:40Z)!ie}.carouselContainer{position :absolute;width :100%;z-index :2}.carouselVideoTitle{position :absolute;top :0px;left :0px;width :100%;background :rgba(0,0,0,0.8);color :white;font-size :small;font-weight :bold;z-index :2}.carouselVideoTitleText{display :block;padding :10px 10px 10px 20px}.carouselTitleDuration{position :absolute;top :0px;right :0px;padding :2px;background-color :#5A5A5A;color :#D9D9D9;font-size :smaller;z-index :2}.carouselImgTitle{position :absolute;width :100%;text-align :center;color :white;font-size :small;background :rgba(0,0,0,0.4)}.carouselImgDuration{position :absolute;top :2px;left :2px;background :rgba( 0,0,0,0.7 );color :white;padding :1px 6px;font-size :small}.carouselPrevButton,.carouselNextButton{display :block;position :absolute;bottom:23px}.carouselPrevButton{left :5px}.carouselNextButton{right:6px}.alert-container{-webkit-border-radius:3px;-moz-border-radius:3px;border-radius:3px;background-color:#e6e6e6;background-image:linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-o-linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-moz-linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-webkit-linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-ms-linear-gradient(bottom,rgb(215,215,215) 4%,rgb(230,230,230) 55%,rgb(255,255,255) 100%);background-image:-webkit-gradient(linear,left bottom,left top,color-stop(0.04,rgb(215,215,215)),color-stop(0.55,rgb(230,230,230)),color-stop(1,rgb(255,255,255)));margin:auto;position:absolute;top:0;left:0;right:0;bottom:0;max-width:80%;max-height:40%}.alert-container-with-buttons{max-height:44%}.ie8 .alert-container{top:50%;background-color:#e6e6e6}.alert-title{background-color :#E6E6E6;padding :5px;border-bottom :1px solid #D1D1D1;font-weight :normal !important;font-size:14px !important;-webkit-border-top-left-radius:3px;-moz-border-radius-topleft:3px;border-top-left-radius:3px;-webkit-border-top-right-radius:3px;-moz-border-radius-topright:3px;border-top-right-radius:3px }.alert-message{overflow:auto;max-height:inherit;padding :5px;font-weight :normal !important;text-align:center;font-size:14px !important;-webkit-text-size-adjust:none}.alert-buttons-container{text-align:center;padding-bottom:5px}.alert-button{background-color:#474747;color:white;-webkit-border-radius:.5em;-moz-border-radius:.5em;border-radius:.5em;padding:2px 10px;background-image:linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-o-linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-moz-linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-webkit-linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-ms-linear-gradient(bottom,rgb(25,25,25) 4%,rgb(47,47,47) 55%,rgb(71,71,71) 68%);background-image:-webkit-gradient( linear,left bottom,left top,color-stop(0.04,rgb(25,25,25)),color-stop(0.55,rgb(47,47,47)),color-stop(0.68,rgb(71,71,71)) )}.alert-text{color :black !important}\n\n/* cache key: resourceloader:filter:minify-css:7:88a0cf9193f44d5b7e7d5cc7be919ff0 */\n"},{});mw.loader.implement("vtt.js",function($){(function(root){var autoKeyword="auto";var directionSetting={"":true,"lr":true,"rl":true};var alignSetting={"start":true,"middle":true,"end":true,"left":true,"right":true};function findDirectionSetting(value){if(typeof value!=="string"){return false;}var dir=directionSetting[value.toLowerCase()];return dir?value.toLowerCase():false;}function findAlignSetting(value){if(typeof value!=="string"){return false;}var align=alignSetting[value.toLowerCase()];return align?value.toLowerCase():false;}function extend(obj){var i=1;for(;i<arguments.length;i++){var cobj=arguments[i];for(var p in cobj){obj[p]=cobj[p];}}return obj;}function VTTCue(startTime,endTime,text){var cue=this;var isIE8=(/MSIE\s8\.0/).test(navigator.userAgent);var baseObj={};if(isIE8){cue=document.createElement('custom');}else{baseObj.enumerable=true;}cue.hasBeenReset=false;var _id="";var _pauseOnExit=false;var _startTime=startTime;var _endTime=endTime;var _text=text;var _region=null;var _vertical="";var _snapToLines=true;var _line="auto";var _lineAlign="start";var _position=50;var _positionAlign="middle";var _size=50;var _align="middle";Object.defineProperty(cue,"id",extend({},baseObj,{get:function(){return _id;},set:function(value){_id=""+value;}}));Object.defineProperty(cue,"pauseOnExit",extend({},baseObj,{get:function(){return _pauseOnExit;},set:function(value){_pauseOnExit=!!value;}}));Object.defineProperty(cue,"startTime",extend({},baseObj,{get:function(){return _startTime;},set:function(value){if(typeof value!=="number"){throw new TypeError("Start time must be set to a number.");}_startTime=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,"endTime",extend({},baseObj,{get:function(){return _endTime;},set:function(value){if(typeof value!=="number"){throw new TypeError("End time must be set to a number.");}_endTime=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,"text",extend({},baseObj,{get:function(){return _text;},set:function(value){_text=""+value;this.hasBeenReset=true;}}));Object.defineProperty(cue,"region",extend({},baseObj,{get:function(){return _region;},set:function(value){_region=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,"vertical",extend({},baseObj,{get:function(){return _vertical;},set:function(value){var setting=findDirectionSetting(value);if(setting===false){throw new SyntaxError("An invalid or illegal string was specified.");}_vertical=setting;this.hasBeenReset=true;}}));Object.defineProperty(cue,"snapToLines",extend({},baseObj,{get:function(){return _snapToLines;},set:function(value){_snapToLines=!!value;this.hasBeenReset=true;}}));Object.defineProperty(cue,"line",extend({},baseObj,{get:function(){return _line;},set:function(value){if(typeof value!=="number"&&value!==autoKeyword){throw new SyntaxError("An invalid number or illegal string was specified.");}_line=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,"lineAlign",extend({},baseObj,{get:function(){return _lineAlign;},set:function(value){var setting=findAlignSetting(value);if(!setting){throw new SyntaxError("An invalid or illegal string was specified.");}_lineAlign=setting;this.hasBeenReset=true;}}));Object.defineProperty(cue,"position",extend({},baseObj,{get:function(){return _position;},set:function(value){if(value<0||value>100){throw new Error("Position must be between 0 and 100.");}_position=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,"positionAlign",extend({},baseObj,{get:function(){return _positionAlign;},set:function(value){var setting=findAlignSetting(value);if(!setting){throw new SyntaxError("An invalid or illegal string was specified.");}_positionAlign=setting;this.hasBeenReset=true;}}));Object.defineProperty(cue,"size",extend({},baseObj,{get:function(){return _size;},set:function(value){if(value<0||value>100){throw new Error("Size must be between 0 and 100.");}_size=value;this.hasBeenReset=true;}}));Object.defineProperty(cue,"align",extend({},baseObj,{get:function(){return _align;},set:function(value){var setting=findAlignSetting(value);if(!setting){throw new SyntaxError("An invalid or illegal string was specified.");}_align=setting;this.hasBeenReset=true;}}));cue.displayState=undefined;if(isIE8){return cue;}}VTTCue.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text);};root.VTTCue=VTTCue||root.VTTCue;}(this));(function(root){var scrollSetting={"":true,"up":true};function findScrollSetting(value){if(typeof value!=="string"){return false;}var scroll=scrollSetting[value.toLowerCase()];return scroll?value.toLowerCase():false;}function isValidPercentValue(value){return typeof value==="number"&&(value>=0&&value<=100);}function VTTRegion(){var _width=100;var _lines=3;var _regionAnchorX=0;var _regionAnchorY=100;var _viewportAnchorX=0;var _viewportAnchorY=100;var _scroll="";Object.defineProperties(this,{"width":{enumerable:true,get:function(){return _width;},set:function(value){if(!isValidPercentValue(value)){throw new Error("Width must be between 0 and 100.");}_width=value;}},"lines":{enumerable:true,get:function(){return _lines;},set:function(value){if(typeof value!=="number"){throw new TypeError("Lines must be set to a number.");}_lines=value;}},"regionAnchorY":{enumerable:true,get:function(){return _regionAnchorY;},set:function(value){if(!isValidPercentValue(value)){throw new Error("RegionAnchorX must be between 0 and 100.");}_regionAnchorY=value;}},"regionAnchorX":{enumerable:true,get:function(){return _regionAnchorX;},set:function(value){if(!isValidPercentValue(value)){throw new Error("RegionAnchorY must be between 0 and 100.");}_regionAnchorX=value;}},"viewportAnchorY":{enumerable:true,get:function(){return _viewportAnchorY;},set:function(value){if(!isValidPercentValue(value)){throw new Error("ViewportAnchorY must be between 0 and 100.");}_viewportAnchorY=value;}},"viewportAnchorX":{enumerable:true,get:function(){return _viewportAnchorX;},set:function(value){if(!isValidPercentValue(value)){throw new Error("ViewportAnchorX must be between 0 and 100.");}_viewportAnchorX=value;}},"scroll":{enumerable:true,get:function(){return _scroll;},set:function(value){var setting=findScrollSetting(value);if(setting===false){throw new SyntaxError("An invalid or illegal string was specified.");}_scroll=setting;}}});}root.VTTRegion=root.VTTRegion||VTTRegion;}(this));(function(global){function makeColorSet(color,opacity){if(opacity===undefined){opacity=1;}return"rgba("+[parseInt(color.substring(0,2),16),parseInt(color.substring(2,4),16),parseInt(color.substring(4,6),16),opacity].join(",")+")";}var WebVTTPrefs=['webvtt.font.color','webvtt.font.opacity','webvtt.font.scale','webvtt.bg.color','webvtt.bg.opacity','webvtt.edge.color','webvtt.edge.type'];var fontScale=1;function observe(subject,topic,data){switch(data){case"webvtt.font.color":case"webvtt.font.opacity":var fontColor=Services.prefs.getCharPref("webvtt.font.color");var fontOpacity=Services.prefs.getIntPref("webvtt.font.opacity")/100;WebVTTSet.fontSet=makeColorSet(fontColor,fontOpacity);break;case"webvtt.font.scale":fontScale=Services.prefs.getIntPref("webvtt.font.scale")/100;break;case"webvtt.bg.color":case"webvtt.bg.opacity":var backgroundColor=Services.prefs.getCharPref("webvtt.bg.color");var backgroundOpacity=Services.prefs.getIntPref("webvtt.bg.opacity")/100;WebVTTSet.backgroundSet=makeColorSet(backgroundColor,backgroundOpacity);break;case"webvtt.edge.color":case"webvtt.edge.type":var edgeTypeList=["","0px 0px ","4px 4px 4px ","-2px -2px ","2px 2px "];var edgeType=Services.prefs.getIntPref("webvtt.edge.type");var edgeColor=Services.prefs.getCharPref("webvtt.edge.color");WebVTTSet.edgeSet=edgeTypeList[edgeType]+makeColorSet(edgeColor);break;}}if(typeof Services!=="undefined"){var WebVTTSet={};WebVTTPrefs.forEach(function(pref){observe(undefined,undefined,pref);Services.prefs.addObserver(pref,observe,false);});}var _objCreate=Object.create||(function(){function F(){}return function(o){if(arguments.length!==1){throw new Error('Object.create shim only accepts one parameter.');}F.prototype=o;return new F();};})();function ParsingError(errorData,message){this.name="ParsingError";this.code=errorData.code;this.message=message||errorData.message;}ParsingError.prototype=_objCreate(Error.prototype);ParsingError.prototype.constructor=ParsingError;ParsingError.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}};function parseTimeStamp(input){function computeSeconds(h,m,s,f){return(h|0)*3600+(m|0)*60+(s|0)+(f|0)/1000;}var m=input.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);if(!m){return null;}if(m[3]){return computeSeconds(m[1],m[2],m[3].replace(":",""),m[4]);}else if(m[1]>59){return computeSeconds(m[1],m[2],0,m[4]);}else{return computeSeconds(0,m[1],m[2],m[4]);}}function Settings(){this.values=_objCreate(null);}Settings.prototype={set:function(k,v){if(!this.get(k)&&v!==""){this.values[k]=v;}},get:function(k,dflt,defaultKey){if(defaultKey){return this.has(k)?this.values[k]:dflt[defaultKey];}return this.has(k)?this.values[k]:dflt;},has:function(k){return k in this.values;},alt:function(k,v,a){for(var n=0;n<a.length;++n){if(v===a[n]){this.set(k,v);break;}}},integer:function(k,v){if(/^-?\d+$/.test(v)){this.set(k,parseInt(v,10));}},percent:function(k,v){var m;if((m=v.match(/^([\d]{1,3})(\.[\d]*)?%$/))){v=parseFloat(v);if(v>=0&&v<=100){this.set(k,v);return true;}}return false;}};function parseOptions(input,callback,keyValueDelim,groupDelim){var groups=groupDelim?input.split(groupDelim):[input];for(var i in groups){if(typeof groups[i]!=="string"){continue;}var kv=groups[i].split(keyValueDelim);if(kv.length!==2){continue;}var k=kv[0];var v=kv[1];callback(k,v);}}function parseCue(input,cue,regionList){var oInput=input;function consumeTimeStamp(){var ts=parseTimeStamp(input);if(ts===null){throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed timestamp: "+oInput);}input=input.replace(/^[^\sa-zA-Z-]+/,"");return ts;}function consumeCueSettings(input,cue){var settings=new Settings();parseOptions(input,function(k,v){switch(k){case"region":for(var i=regionList.length-1;i>=0;i--){if(regionList[i].id===v){settings.set(k,regionList[i].region);break;}}break;case"vertical":settings.alt(k,v,["rl","lr"]);break;case"line":var vals=v.split(","),vals0=vals[0];settings.integer(k,vals0);settings.percent(k,vals0)?settings.set("snapToLines",false):null;settings.alt(k,vals0,["auto"]);if(vals.length===2){settings.alt("lineAlign",vals[1],["start","middle","end"]);}break;case"position":vals=v.split(",");settings.percent(k,vals[0]);if(vals.length===2){settings.alt("positionAlign",vals[1],["start","middle","end"]);}break;case"size":settings.percent(k,v);break;case"align":settings.alt(k,v,["start","middle","end","left","right"]);break;}},/:/,/\s/);cue.region=settings.get("region",null);cue.vertical=settings.get("vertical","");cue.line=settings.get("line","auto");cue.lineAlign=settings.get("lineAlign","start");cue.snapToLines=settings.get("snapToLines",true);cue.size=settings.get("size",100);cue.align=settings.get("align","middle");cue.position=settings.get("position",{start:0,left:0,middle:50,end:100,right:100},cue.align);cue.positionAlign=settings.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},cue.align);}function skipWhitespace(){input=input.replace(/^\s+/,"");}skipWhitespace();cue.startTime=consumeTimeStamp();skipWhitespace();if(input.substr(0,3)!=="-->"){throw new ParsingError(ParsingError.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '-->'): "+oInput);}input=input.substr(3);skipWhitespace();cue.endTime=consumeTimeStamp();skipWhitespace();consumeCueSettings(input,cue);}var ESCAPE={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"\u200e","&rlm;":"\u200f","&nbsp;":"\u00a0"};var TAG_NAME={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"};var TAG_ANNOTATION={v:"title",lang:"lang"};var NEEDS_PARENT={rt:"ruby"};function parseContent(window,input){function nextToken(){if(!input){return null;}function consume(result){input=input.substr(result.length);return result;}var m=input.match(/^([^<]*)(<[^>]+>?)?/);return consume(m[1]?m[1]:m[2]);}function unescape1(e){return ESCAPE[e];}function unescape(s){while((m=s.match(/&(amp|lt|gt|lrm|rlm|nbsp);/))){s=s.replace(m[0],unescape1);}return s;}function shouldAdd(current,element){return!NEEDS_PARENT[element.localName]||NEEDS_PARENT[element.localName]===current.localName;}function createElement(type,annotation){var tagName=TAG_NAME[type];if(!tagName){return null;}var element=window.document.createElement(tagName);element.localName=tagName;var name=TAG_ANNOTATION[type];if(name&&annotation){element[name]=annotation.trim();}return element;}var rootDiv=window.document.createElement("div"),current=rootDiv,t,tagStack=[];while((t=nextToken())!==null){if(t[0]==='<'){if(t[1]==="/"){if(tagStack.length&&tagStack[tagStack.length-1]===t.substr(2).replace(">","")){tagStack.pop();current=current.parentNode;}continue;}var ts=parseTimeStamp(t.substr(1,t.length-2));var node;if(ts){node=window.document.createProcessingInstruction("timestamp",ts);current.appendChild(node);continue;}var m=t.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!m){continue;}node=createElement(m[1],m[3]);if(!node){continue;}if(!shouldAdd(current,node)){continue;}if(m[2]){node.className=m[2].substr(1).replace('.',' ');}tagStack.push(m[1]);current.appendChild(node);current=node;continue;}current.appendChild(window.document.createTextNode(unescape(t)));}return rootDiv;}var strongRTLChars=[0x05BE,0x05C0,0x05C3,0x05C6,0x05D0,0x05D1,0x05D2,0x05D3,0x05D4,0x05D5,0x05D6,0x05D7,0x05D8,0x05D9,0x05DA,0x05DB,0x05DC,0x05DD,0x05DE,0x05DF,0x05E0,0x05E1,0x05E2,0x05E3,0x05E4,0x05E5,0x05E6,0x05E7,0x05E8,0x05E9,0x05EA,0x05F0,0x05F1,0x05F2,0x05F3,0x05F4,0x0608,0x060B,0x060D,0x061B,0x061E,0x061F,0x0620,0x0621,0x0622,0x0623,0x0624,0x0625,0x0626,0x0627,0x0628,0x0629,0x062A,0x062B,0x062C,0x062D,0x062E,0x062F,0x0630,0x0631,0x0632,0x0633,0x0634,0x0635,0x0636,0x0637,0x0638,0x0639,0x063A,0x063B,0x063C,0x063D,0x063E,0x063F,0x0640,0x0641,0x0642,0x0643,0x0644,0x0645,0x0646,0x0647,0x0648,0x0649,0x064A,0x066D,0x066E,0x066F,0x0671,0x0672,0x0673,0x0674,0x0675,0x0676,0x0677,0x0678,0x0679,0x067A,0x067B,0x067C,0x067D,0x067E,0x067F,0x0680,0x0681,0x0682,0x0683,0x0684,0x0685,0x0686,0x0687,0x0688,0x0689,0x068A,0x068B,0x068C,0x068D,0x068E,0x068F,0x0690,0x0691,0x0692,0x0693,0x0694,0x0695,0x0696,0x0697,0x0698,0x0699,0x069A,0x069B,0x069C,0x069D,0x069E,0x069F,0x06A0,0x06A1,0x06A2,0x06A3,0x06A4,0x06A5,0x06A6,0x06A7,0x06A8,0x06A9,0x06AA,0x06AB,0x06AC,0x06AD,0x06AE,0x06AF,0x06B0,0x06B1,0x06B2,0x06B3,0x06B4,0x06B5,0x06B6,0x06B7,0x06B8,0x06B9,0x06BA,0x06BB,0x06BC,0x06BD,0x06BE,0x06BF,0x06C0,0x06C1,0x06C2,0x06C3,0x06C4,0x06C5,0x06C6,0x06C7,0x06C8,0x06C9,0x06CA,0x06CB,0x06CC,0x06CD,0x06CE,0x06CF,0x06D0,0x06D1,0x06D2,0x06D3,0x06D4,0x06D5,0x06E5,0x06E6,0x06EE,0x06EF,0x06FA,0x06FB,0x06FC,0x06FD,0x06FE,0x06FF,0x0700,0x0701,0x0702,0x0703,0x0704,0x0705,0x0706,0x0707,0x0708,0x0709,0x070A,0x070B,0x070C,0x070D,0x070F,0x0710,0x0712,0x0713,0x0714,0x0715,0x0716,0x0717,0x0718,0x0719,0x071A,0x071B,0x071C,0x071D,0x071E,0x071F,0x0720,0x0721,0x0722,0x0723,0x0724,0x0725,0x0726,0x0727,0x0728,0x0729,0x072A,0x072B,0x072C,0x072D,0x072E,0x072F,0x074D,0x074E,0x074F,0x0750,0x0751,0x0752,0x0753,0x0754,0x0755,0x0756,0x0757,0x0758,0x0759,0x075A,0x075B,0x075C,0x075D,0x075E,0x075F,0x0760,0x0761,0x0762,0x0763,0x0764,0x0765,0x0766,0x0767,0x0768,0x0769,0x076A,0x076B,0x076C,0x076D,0x076E,0x076F,0x0770,0x0771,0x0772,0x0773,0x0774,0x0775,0x0776,0x0777,0x0778,0x0779,0x077A,0x077B,0x077C,0x077D,0x077E,0x077F,0x0780,0x0781,0x0782,0x0783,0x0784,0x0785,0x0786,0x0787,0x0788,0x0789,0x078A,0x078B,0x078C,0x078D,0x078E,0x078F,0x0790,0x0791,0x0792,0x0793,0x0794,0x0795,0x0796,0x0797,0x0798,0x0799,0x079A,0x079B,0x079C,0x079D,0x079E,0x079F,0x07A0,0x07A1,0x07A2,0x07A3,0x07A4,0x07A5,0x07B1,0x07C0,0x07C1,0x07C2,0x07C3,0x07C4,0x07C5,0x07C6,0x07C7,0x07C8,0x07C9,0x07CA,0x07CB,0x07CC,0x07CD,0x07CE,0x07CF,0x07D0,0x07D1,0x07D2,0x07D3,0x07D4,0x07D5,0x07D6,0x07D7,0x07D8,0x07D9,0x07DA,0x07DB,0x07DC,0x07DD,0x07DE,0x07DF,0x07E0,0x07E1,0x07E2,0x07E3,0x07E4,0x07E5,0x07E6,0x07E7,0x07E8,0x07E9,0x07EA,0x07F4,0x07F5,0x07FA,0x0800,0x0801,0x0802,0x0803,0x0804,0x0805,0x0806,0x0807,0x0808,0x0809,0x080A,0x080B,0x080C,0x080D,0x080E,0x080F,0x0810,0x0811,0x0812,0x0813,0x0814,0x0815,0x081A,0x0824,0x0828,0x0830,0x0831,0x0832,0x0833,0x0834,0x0835,0x0836,0x0837,0x0838,0x0839,0x083A,0x083B,0x083C,0x083D,0x083E,0x0840,0x0841,0x0842,0x0843,0x0844,0x0845,0x0846,0x0847,0x0848,0x0849,0x084A,0x084B,0x084C,0x084D,0x084E,0x084F,0x0850,0x0851,0x0852,0x0853,0x0854,0x0855,0x0856,0x0857,0x0858,0x085E,0x08A0,0x08A2,0x08A3,0x08A4,0x08A5,0x08A6,0x08A7,0x08A8,0x08A9,0x08AA,0x08AB,0x08AC,0x200F,0xFB1D,0xFB1F,0xFB20,0xFB21,0xFB22,0xFB23,0xFB24,0xFB25,0xFB26,0xFB27,0xFB28,0xFB2A,0xFB2B,0xFB2C,0xFB2D,0xFB2E,0xFB2F,0xFB30,0xFB31,0xFB32,0xFB33,0xFB34,0xFB35,0xFB36,0xFB38,0xFB39,0xFB3A,0xFB3B,0xFB3C,0xFB3E,0xFB40,0xFB41,0xFB43,0xFB44,0xFB46,0xFB47,0xFB48,0xFB49,0xFB4A,0xFB4B,0xFB4C,0xFB4D,0xFB4E,0xFB4F,0xFB50,0xFB51,0xFB52,0xFB53,0xFB54,0xFB55,0xFB56,0xFB57,0xFB58,0xFB59,0xFB5A,0xFB5B,0xFB5C,0xFB5D,0xFB5E,0xFB5F,0xFB60,0xFB61,0xFB62,0xFB63,0xFB64,0xFB65,0xFB66,0xFB67,0xFB68,0xFB69,0xFB6A,0xFB6B,0xFB6C,0xFB6D,0xFB6E,0xFB6F,0xFB70,0xFB71,0xFB72,0xFB73,0xFB74,0xFB75,0xFB76,0xFB77,0xFB78,0xFB79,0xFB7A,0xFB7B,0xFB7C,0xFB7D,0xFB7E,0xFB7F,0xFB80,0xFB81,0xFB82,0xFB83,0xFB84,0xFB85,0xFB86,0xFB87,0xFB88,0xFB89,0xFB8A,0xFB8B,0xFB8C,0xFB8D,0xFB8E,0xFB8F,0xFB90,0xFB91,0xFB92,0xFB93,0xFB94,0xFB95,0xFB96,0xFB97,0xFB98,0xFB99,0xFB9A,0xFB9B,0xFB9C,0xFB9D,0xFB9E,0xFB9F,0xFBA0,0xFBA1,0xFBA2,0xFBA3,0xFBA4,0xFBA5,0xFBA6,0xFBA7,0xFBA8,0xFBA9,0xFBAA,0xFBAB,0xFBAC,0xFBAD,0xFBAE,0xFBAF,0xFBB0,0xFBB1,0xFBB2,0xFBB3,0xFBB4,0xFBB5,0xFBB6,0xFBB7,0xFBB8,0xFBB9,0xFBBA,0xFBBB,0xFBBC,0xFBBD,0xFBBE,0xFBBF,0xFBC0,0xFBC1,0xFBD3,0xFBD4,0xFBD5,0xFBD6,0xFBD7,0xFBD8,0xFBD9,0xFBDA,0xFBDB,0xFBDC,0xFBDD,0xFBDE,0xFBDF,0xFBE0,0xFBE1,0xFBE2,0xFBE3,0xFBE4,0xFBE5,0xFBE6,0xFBE7,0xFBE8,0xFBE9,0xFBEA,0xFBEB,0xFBEC,0xFBED,0xFBEE,0xFBEF,0xFBF0,0xFBF1,0xFBF2,0xFBF3,0xFBF4,0xFBF5,0xFBF6,0xFBF7,0xFBF8,0xFBF9,0xFBFA,0xFBFB,0xFBFC,0xFBFD,0xFBFE,0xFBFF,0xFC00,0xFC01,0xFC02,0xFC03,0xFC04,0xFC05,0xFC06,0xFC07,0xFC08,0xFC09,0xFC0A,0xFC0B,0xFC0C,0xFC0D,0xFC0E,0xFC0F,0xFC10,0xFC11,0xFC12,0xFC13,0xFC14,0xFC15,0xFC16,0xFC17,0xFC18,0xFC19,0xFC1A,0xFC1B,0xFC1C,0xFC1D,0xFC1E,0xFC1F,0xFC20,0xFC21,0xFC22,0xFC23,0xFC24,0xFC25,0xFC26,0xFC27,0xFC28,0xFC29,0xFC2A,0xFC2B,0xFC2C,0xFC2D,0xFC2E,0xFC2F,0xFC30,0xFC31,0xFC32,0xFC33,0xFC34,0xFC35,0xFC36,0xFC37,0xFC38,0xFC39,0xFC3A,0xFC3B,0xFC3C,0xFC3D,0xFC3E,0xFC3F,0xFC40,0xFC41,0xFC42,0xFC43,0xFC44,0xFC45,0xFC46,0xFC47,0xFC48,0xFC49,0xFC4A,0xFC4B,0xFC4C,0xFC4D,0xFC4E,0xFC4F,0xFC50,0xFC51,0xFC52,0xFC53,0xFC54,0xFC55,0xFC56,0xFC57,0xFC58,0xFC59,0xFC5A,0xFC5B,0xFC5C,0xFC5D,0xFC5E,0xFC5F,0xFC60,0xFC61,0xFC62,0xFC63,0xFC64,0xFC65,0xFC66,0xFC67,0xFC68,0xFC69,0xFC6A,0xFC6B,0xFC6C,0xFC6D,0xFC6E,0xFC6F,0xFC70,0xFC71,0xFC72,0xFC73,0xFC74,0xFC75,0xFC76,0xFC77,0xFC78,0xFC79,0xFC7A,0xFC7B,0xFC7C,0xFC7D,0xFC7E,0xFC7F,0xFC80,0xFC81,0xFC82,0xFC83,0xFC84,0xFC85,0xFC86,0xFC87,0xFC88,0xFC89,0xFC8A,0xFC8B,0xFC8C,0xFC8D,0xFC8E,0xFC8F,0xFC90,0xFC91,0xFC92,0xFC93,0xFC94,0xFC95,0xFC96,0xFC97,0xFC98,0xFC99,0xFC9A,0xFC9B,0xFC9C,0xFC9D,0xFC9E,0xFC9F,0xFCA0,0xFCA1,0xFCA2,0xFCA3,0xFCA4,0xFCA5,0xFCA6,0xFCA7,0xFCA8,0xFCA9,0xFCAA,0xFCAB,0xFCAC,0xFCAD,0xFCAE,0xFCAF,0xFCB0,0xFCB1,0xFCB2,0xFCB3,0xFCB4,0xFCB5,0xFCB6,0xFCB7,0xFCB8,0xFCB9,0xFCBA,0xFCBB,0xFCBC,0xFCBD,0xFCBE,0xFCBF,0xFCC0,0xFCC1,0xFCC2,0xFCC3,0xFCC4,0xFCC5,0xFCC6,0xFCC7,0xFCC8,0xFCC9,0xFCCA,0xFCCB,0xFCCC,0xFCCD,0xFCCE,0xFCCF,0xFCD0,0xFCD1,0xFCD2,0xFCD3,0xFCD4,0xFCD5,0xFCD6,0xFCD7,0xFCD8,0xFCD9,0xFCDA,0xFCDB,0xFCDC,0xFCDD,0xFCDE,0xFCDF,0xFCE0,0xFCE1,0xFCE2,0xFCE3,0xFCE4,0xFCE5,0xFCE6,0xFCE7,0xFCE8,0xFCE9,0xFCEA,0xFCEB,0xFCEC,0xFCED,0xFCEE,0xFCEF,0xFCF0,0xFCF1,0xFCF2,0xFCF3,0xFCF4,0xFCF5,0xFCF6,0xFCF7,0xFCF8,0xFCF9,0xFCFA,0xFCFB,0xFCFC,0xFCFD,0xFCFE,0xFCFF,0xFD00,0xFD01,0xFD02,0xFD03,0xFD04,0xFD05,0xFD06,0xFD07,0xFD08,0xFD09,0xFD0A,0xFD0B,0xFD0C,0xFD0D,0xFD0E,0xFD0F,0xFD10,0xFD11,0xFD12,0xFD13,0xFD14,0xFD15,0xFD16,0xFD17,0xFD18,0xFD19,0xFD1A,0xFD1B,0xFD1C,0xFD1D,0xFD1E,0xFD1F,0xFD20,0xFD21,0xFD22,0xFD23,0xFD24,0xFD25,0xFD26,0xFD27,0xFD28,0xFD29,0xFD2A,0xFD2B,0xFD2C,0xFD2D,0xFD2E,0xFD2F,0xFD30,0xFD31,0xFD32,0xFD33,0xFD34,0xFD35,0xFD36,0xFD37,0xFD38,0xFD39,0xFD3A,0xFD3B,0xFD3C,0xFD3D,0xFD50,0xFD51,0xFD52,0xFD53,0xFD54,0xFD55,0xFD56,0xFD57,0xFD58,0xFD59,0xFD5A,0xFD5B,0xFD5C,0xFD5D,0xFD5E,0xFD5F,0xFD60,0xFD61,0xFD62,0xFD63,0xFD64,0xFD65,0xFD66,0xFD67,0xFD68,0xFD69,0xFD6A,0xFD6B,0xFD6C,0xFD6D,0xFD6E,0xFD6F,0xFD70,0xFD71,0xFD72,0xFD73,0xFD74,0xFD75,0xFD76,0xFD77,0xFD78,0xFD79,0xFD7A,0xFD7B,0xFD7C,0xFD7D,0xFD7E,0xFD7F,0xFD80,0xFD81,0xFD82,0xFD83,0xFD84,0xFD85,0xFD86,0xFD87,0xFD88,0xFD89,0xFD8A,0xFD8B,0xFD8C,0xFD8D,0xFD8E,0xFD8F,0xFD92,0xFD93,0xFD94,0xFD95,0xFD96,0xFD97,0xFD98,0xFD99,0xFD9A,0xFD9B,0xFD9C,0xFD9D,0xFD9E,0xFD9F,0xFDA0,0xFDA1,0xFDA2,0xFDA3,0xFDA4,0xFDA5,0xFDA6,0xFDA7,0xFDA8,0xFDA9,0xFDAA,0xFDAB,0xFDAC,0xFDAD,0xFDAE,0xFDAF,0xFDB0,0xFDB1,0xFDB2,0xFDB3,0xFDB4,0xFDB5,0xFDB6,0xFDB7,0xFDB8,0xFDB9,0xFDBA,0xFDBB,0xFDBC,0xFDBD,0xFDBE,0xFDBF,0xFDC0,0xFDC1,0xFDC2,0xFDC3,0xFDC4,0xFDC5,0xFDC6,0xFDC7,0xFDF0,0xFDF1,0xFDF2,0xFDF3,0xFDF4,0xFDF5,0xFDF6,0xFDF7,0xFDF8,0xFDF9,0xFDFA,0xFDFB,0xFDFC,0xFE70,0xFE71,0xFE72,0xFE73,0xFE74,0xFE76,0xFE77,0xFE78,0xFE79,0xFE7A,0xFE7B,0xFE7C,0xFE7D,0xFE7E,0xFE7F,0xFE80,0xFE81,0xFE82,0xFE83,0xFE84,0xFE85,0xFE86,0xFE87,0xFE88,0xFE89,0xFE8A,0xFE8B,0xFE8C,0xFE8D,0xFE8E,0xFE8F,0xFE90,0xFE91,0xFE92,0xFE93,0xFE94,0xFE95,0xFE96,0xFE97,0xFE98,0xFE99,0xFE9A,0xFE9B,0xFE9C,0xFE9D,0xFE9E,0xFE9F,0xFEA0,0xFEA1,0xFEA2,0xFEA3,0xFEA4,0xFEA5,0xFEA6,0xFEA7,0xFEA8,0xFEA9,0xFEAA,0xFEAB,0xFEAC,0xFEAD,0xFEAE,0xFEAF,0xFEB0,0xFEB1,0xFEB2,0xFEB3,0xFEB4,0xFEB5,0xFEB6,0xFEB7,0xFEB8,0xFEB9,0xFEBA,0xFEBB,0xFEBC,0xFEBD,0xFEBE,0xFEBF,0xFEC0,0xFEC1,0xFEC2,0xFEC3,0xFEC4,0xFEC5,0xFEC6,0xFEC7,0xFEC8,0xFEC9,0xFECA,0xFECB,0xFECC,0xFECD,0xFECE,0xFECF,0xFED0,0xFED1,0xFED2,0xFED3,0xFED4,0xFED5,0xFED6,0xFED7,0xFED8,0xFED9,0xFEDA,0xFEDB,0xFEDC,0xFEDD,0xFEDE,0xFEDF,0xFEE0,0xFEE1,0xFEE2,0xFEE3,0xFEE4,0xFEE5,0xFEE6,0xFEE7,0xFEE8,0xFEE9,0xFEEA,0xFEEB,0xFEEC,0xFEED,0xFEEE,0xFEEF,0xFEF0,0xFEF1,0xFEF2,0xFEF3,0xFEF4,0xFEF5,0xFEF6,0xFEF7,0xFEF8,0xFEF9,0xFEFA,0xFEFB,0xFEFC,0x10800,0x10801,0x10802,0x10803,0x10804,0x10805,0x10808,0x1080A,0x1080B,0x1080C,0x1080D,0x1080E,0x1080F,0x10810,0x10811,0x10812,0x10813,0x10814,0x10815,0x10816,0x10817,0x10818,0x10819,0x1081A,0x1081B,0x1081C,0x1081D,0x1081E,0x1081F,0x10820,0x10821,0x10822,0x10823,0x10824,0x10825,0x10826,0x10827,0x10828,0x10829,0x1082A,0x1082B,0x1082C,0x1082D,0x1082E,0x1082F,0x10830,0x10831,0x10832,0x10833,0x10834,0x10835,0x10837,0x10838,0x1083C,0x1083F,0x10840,0x10841,0x10842,0x10843,0x10844,0x10845,0x10846,0x10847,0x10848,0x10849,0x1084A,0x1084B,0x1084C,0x1084D,0x1084E,0x1084F,0x10850,0x10851,0x10852,0x10853,0x10854,0x10855,0x10857,0x10858,0x10859,0x1085A,0x1085B,0x1085C,0x1085D,0x1085E,0x1085F,0x10900,0x10901,0x10902,0x10903,0x10904,0x10905,0x10906,0x10907,0x10908,0x10909,0x1090A,0x1090B,0x1090C,0x1090D,0x1090E,0x1090F,0x10910,0x10911,0x10912,0x10913,0x10914,0x10915,0x10916,0x10917,0x10918,0x10919,0x1091A,0x1091B,0x10920,0x10921,0x10922,0x10923,0x10924,0x10925,0x10926,0x10927,0x10928,0x10929,0x1092A,0x1092B,0x1092C,0x1092D,0x1092E,0x1092F,0x10930,0x10931,0x10932,0x10933,0x10934,0x10935,0x10936,0x10937,0x10938,0x10939,0x1093F,0x10980,0x10981,0x10982,0x10983,0x10984,0x10985,0x10986,0x10987,0x10988,0x10989,0x1098A,0x1098B,0x1098C,0x1098D,0x1098E,0x1098F,0x10990,0x10991,0x10992,0x10993,0x10994,0x10995,0x10996,0x10997,0x10998,0x10999,0x1099A,0x1099B,0x1099C,0x1099D,0x1099E,0x1099F,0x109A0,0x109A1,0x109A2,0x109A3,0x109A4,0x109A5,0x109A6,0x109A7,0x109A8,0x109A9,0x109AA,0x109AB,0x109AC,0x109AD,0x109AE,0x109AF,0x109B0,0x109B1,0x109B2,0x109B3,0x109B4,0x109B5,0x109B6,0x109B7,0x109BE,0x109BF,0x10A00,0x10A10,0x10A11,0x10A12,0x10A13,0x10A15,0x10A16,0x10A17,0x10A19,0x10A1A,0x10A1B,0x10A1C,0x10A1D,0x10A1E,0x10A1F,0x10A20,0x10A21,0x10A22,0x10A23,0x10A24,0x10A25,0x10A26,0x10A27,0x10A28,0x10A29,0x10A2A,0x10A2B,0x10A2C,0x10A2D,0x10A2E,0x10A2F,0x10A30,0x10A31,0x10A32,0x10A33,0x10A40,0x10A41,0x10A42,0x10A43,0x10A44,0x10A45,0x10A46,0x10A47,0x10A50,0x10A51,0x10A52,0x10A53,0x10A54,0x10A55,0x10A56,0x10A57,0x10A58,0x10A60,0x10A61,0x10A62,0x10A63,0x10A64,0x10A65,0x10A66,0x10A67,0x10A68,0x10A69,0x10A6A,0x10A6B,0x10A6C,0x10A6D,0x10A6E,0x10A6F,0x10A70,0x10A71,0x10A72,0x10A73,0x10A74,0x10A75,0x10A76,0x10A77,0x10A78,0x10A79,0x10A7A,0x10A7B,0x10A7C,0x10A7D,0x10A7E,0x10A7F,0x10B00,0x10B01,0x10B02,0x10B03,0x10B04,0x10B05,0x10B06,0x10B07,0x10B08,0x10B09,0x10B0A,0x10B0B,0x10B0C,0x10B0D,0x10B0E,0x10B0F,0x10B10,0x10B11,0x10B12,0x10B13,0x10B14,0x10B15,0x10B16,0x10B17,0x10B18,0x10B19,0x10B1A,0x10B1B,0x10B1C,0x10B1D,0x10B1E,0x10B1F,0x10B20,0x10B21,0x10B22,0x10B23,0x10B24,0x10B25,0x10B26,0x10B27,0x10B28,0x10B29,0x10B2A,0x10B2B,0x10B2C,0x10B2D,0x10B2E,0x10B2F,0x10B30,0x10B31,0x10B32,0x10B33,0x10B34,0x10B35,0x10B40,0x10B41,0x10B42,0x10B43,0x10B44,0x10B45,0x10B46,0x10B47,0x10B48,0x10B49,0x10B4A,0x10B4B,0x10B4C,0x10B4D,0x10B4E,0x10B4F,0x10B50,0x10B51,0x10B52,0x10B53,0x10B54,0x10B55,0x10B58,0x10B59,0x10B5A,0x10B5B,0x10B5C,0x10B5D,0x10B5E,0x10B5F,0x10B60,0x10B61,0x10B62,0x10B63,0x10B64,0x10B65,0x10B66,0x10B67,0x10B68,0x10B69,0x10B6A,0x10B6B,0x10B6C,0x10B6D,0x10B6E,0x10B6F,0x10B70,0x10B71,0x10B72,0x10B78,0x10B79,0x10B7A,0x10B7B,0x10B7C,0x10B7D,0x10B7E,0x10B7F,0x10C00,0x10C01,0x10C02,0x10C03,0x10C04,0x10C05,0x10C06,0x10C07,0x10C08,0x10C09,0x10C0A,0x10C0B,0x10C0C,0x10C0D,0x10C0E,0x10C0F,0x10C10,0x10C11,0x10C12,0x10C13,0x10C14,0x10C15,0x10C16,0x10C17,0x10C18,0x10C19,0x10C1A,0x10C1B,0x10C1C,0x10C1D,0x10C1E,0x10C1F,0x10C20,0x10C21,0x10C22,0x10C23,0x10C24,0x10C25,0x10C26,0x10C27,0x10C28,0x10C29,0x10C2A,0x10C2B,0x10C2C,0x10C2D,0x10C2E,0x10C2F,0x10C30,0x10C31,0x10C32,0x10C33,0x10C34,0x10C35,0x10C36,0x10C37,0x10C38,0x10C39,0x10C3A,0x10C3B,0x10C3C,0x10C3D,0x10C3E,0x10C3F,0x10C40,0x10C41,0x10C42,0x10C43,0x10C44,0x10C45,0x10C46,0x10C47,0x10C48,0x1EE00,0x1EE01,0x1EE02,0x1EE03,0x1EE05,0x1EE06,0x1EE07,0x1EE08,0x1EE09,0x1EE0A,0x1EE0B,0x1EE0C,0x1EE0D,0x1EE0E,0x1EE0F,0x1EE10,0x1EE11,0x1EE12,0x1EE13,0x1EE14,0x1EE15,0x1EE16,0x1EE17,0x1EE18,0x1EE19,0x1EE1A,0x1EE1B,0x1EE1C,0x1EE1D,0x1EE1E,0x1EE1F,0x1EE21,0x1EE22,0x1EE24,0x1EE27,0x1EE29,0x1EE2A,0x1EE2B,0x1EE2C,0x1EE2D,0x1EE2E,0x1EE2F,0x1EE30,0x1EE31,0x1EE32,0x1EE34,0x1EE35,0x1EE36,0x1EE37,0x1EE39,0x1EE3B,0x1EE42,0x1EE47,0x1EE49,0x1EE4B,0x1EE4D,0x1EE4E,0x1EE4F,0x1EE51,0x1EE52,0x1EE54,0x1EE57,0x1EE59,0x1EE5B,0x1EE5D,0x1EE5F,0x1EE61,0x1EE62,0x1EE64,0x1EE67,0x1EE68,0x1EE69,0x1EE6A,0x1EE6C,0x1EE6D,0x1EE6E,0x1EE6F,0x1EE70,0x1EE71,0x1EE72,0x1EE74,0x1EE75,0x1EE76,0x1EE77,0x1EE79,0x1EE7A,0x1EE7B,0x1EE7C,0x1EE7E,0x1EE80,0x1EE81,0x1EE82,0x1EE83,0x1EE84,0x1EE85,0x1EE86,0x1EE87,0x1EE88,0x1EE89,0x1EE8B,0x1EE8C,0x1EE8D,0x1EE8E,0x1EE8F,0x1EE90,0x1EE91,0x1EE92,0x1EE93,0x1EE94,0x1EE95,0x1EE96,0x1EE97,0x1EE98,0x1EE99,0x1EE9A,0x1EE9B,0x1EEA1,0x1EEA2,0x1EEA3,0x1EEA5,0x1EEA6,0x1EEA7,0x1EEA8,0x1EEA9,0x1EEAB,0x1EEAC,0x1EEAD,0x1EEAE,0x1EEAF,0x1EEB0,0x1EEB1,0x1EEB2,0x1EEB3,0x1EEB4,0x1EEB5,0x1EEB6,0x1EEB7,0x1EEB8,0x1EEB9,0x1EEBA,0x1EEBB,0x10FFFD];function determineBidi(cueDiv){var nodeStack=[],text="",charCode;if(!cueDiv||!cueDiv.childNodes){return"ltr";}function pushNodes(nodeStack,node){for(var i=node.childNodes.length-1;i>=0;i--){nodeStack.push(node.childNodes[i]);}}function nextTextNode(nodeStack){if(!nodeStack||!nodeStack.length){return null;}var node=nodeStack.pop(),text=node.textContent||node.innerText;if(text){var m=text.match(/^.*(\n|\r)/);if(m){nodeStack.length=0;return m[0];}return text;}if(node.tagName==="ruby"){return nextTextNode(nodeStack);}if(node.childNodes){pushNodes(nodeStack,node);return nextTextNode(nodeStack);}}pushNodes(nodeStack,cueDiv);while((text=nextTextNode(nodeStack))){for(var i=0;i<text.length;i++){charCode=text.charCodeAt(i);for(var j=0;j<strongRTLChars.length;j++){if(strongRTLChars[j]===charCode){return"rtl";}}}}return"ltr";}function computeLinePos(cue){if(typeof cue.line==="number"&&(cue.snapToLines||(cue.line>=0&&cue.line<=100))){return cue.line;}if(!cue.track||!cue.track.textTrackList||!cue.track.textTrackList.mediaElement){return-1;}var track=cue.track,trackList=track.textTrackList,count=0;for(var i=0;i<trackList.length&&trackList[i]!==track;i++){if(trackList[i].mode==="showing"){count++;}}return++count*-1;}function StyleBox(){}StyleBox.prototype.applyStyles=function(styles,div){div=div||this.div;for(var prop in styles){if(styles.hasOwnProperty(prop)){div.style[prop]=styles[prop];}}};StyleBox.prototype.formatStyle=function(val,unit){return val===0?0:val+unit;};function CueStyleBox(window,cue,styleOptions){var isIE8=(typeof navigator!=="undefined")&&(/MSIE\s8\.0/).test(navigator.userAgent);var color="rgba(255, 255, 255, 1)";var backgroundColor="rgba(0, 0, 0, 0.8)";var textShadow="";if(typeof WebVTTSet!=="undefined"){color=WebVTTSet.fontSet;backgroundColor=WebVTTSet.backgroundSet;textShadow=WebVTTSet.edgeSet;}if(isIE8){color="rgb(255, 255, 255)";backgroundColor="rgb(0, 0, 0)";}StyleBox.call(this);this.cue=cue;this.cueDiv=parseContent(window,cue.text);var styles={color:color,backgroundColor:backgroundColor,textShadow:textShadow,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};if(!isIE8){styles.writingMode=cue.vertical===""?"horizontal-tb":cue.vertical==="lr"?"vertical-lr":"vertical-rl";styles.unicodeBidi="plaintext";}this.applyStyles(styles,this.cueDiv);this.div=window.document.createElement("div");styles={textAlign:cue.align==="middle"?"center":cue.align,font:styleOptions.font,whiteSpace:"pre-line",position:"absolute"};if(!isIE8){styles.direction=determineBidi(this.cueDiv);styles.writingMode=cue.vertical===""?"horizontal-tb":cue.vertical==="lr"?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext";}this.applyStyles(styles);this.div.appendChild(this.cueDiv);var textPos=0;switch(cue.positionAlign){case"start":textPos=cue.position;break;case"middle":textPos=cue.position-(cue.size/2);break;case"end":textPos=cue.position-cue.size;break;}if(cue.vertical===""){this.applyStyles({left:this.formatStyle(textPos,"%"),width:this.formatStyle(cue.size,"%")});}else{this.applyStyles({top:this.formatStyle(textPos,"%"),height:this.formatStyle(cue.size,"%")});}this.move=function(box){this.applyStyles({top:this.formatStyle(box.top,"px"),bottom:this.formatStyle(box.bottom,"px"),left:this.formatStyle(box.left,"px"),right:this.formatStyle(box.right,"px"),height:this.formatStyle(box.height,"px"),width:this.formatStyle(box.width,"px")});};}CueStyleBox.prototype=_objCreate(StyleBox.prototype);CueStyleBox.prototype.constructor=CueStyleBox;function BoxPosition(obj){var isIE8=(typeof navigator!=="undefined")&&(/MSIE\s8\.0/).test(navigator.userAgent);var lh,height,width,top;if(obj.div){height=obj.div.offsetHeight;width=obj.div.offsetWidth;top=obj.div.offsetTop;var rects=(rects=obj.div.childNodes)&&(rects=rects[0])&&rects.getClientRects&&rects.getClientRects();obj=obj.div.getBoundingClientRect();lh=rects?Math.max((rects[0]&&rects[0].height)||0,obj.height/rects.length):0;}this.left=obj.left;this.right=obj.right;this.top=obj.top||top;this.height=obj.height||height;this.bottom=obj.bottom||(top+(obj.height||height));this.width=obj.width||width;this.lineHeight=lh!==undefined?lh:obj.lineHeight;if(isIE8&&!this.lineHeight){this.lineHeight=13;}}BoxPosition.prototype.move=function(axis,toMove){toMove=toMove!==undefined?toMove:this.lineHeight;switch(axis){case"+x":this.left+=toMove;this.right+=toMove;break;case"-x":this.left-=toMove;this.right-=toMove;break;case"+y":this.top+=toMove;this.bottom+=toMove;break;case"-y":this.top-=toMove;this.bottom-=toMove;break;}};BoxPosition.prototype.overlaps=function(b2){return this.left<b2.right&&this.right>b2.left&&this.top<b2.bottom&&this.bottom>b2.top;};BoxPosition.prototype.overlapsAny=function(boxes){for(var i=0;i<boxes.length;i++){if(this.overlaps(boxes[i])){return true;}}return false;};BoxPosition.prototype.within=function(container){return this.top>=container.top&&this.bottom<=container.bottom&&this.left>=container.left&&this.right<=container.right;};BoxPosition.prototype.overlapsOppositeAxis=function(container,axis){switch(axis){case"+x":return this.left<container.left;case"-x":return this.right>container.right;case"+y":return this.top<container.top;case"-y":return this.bottom>container.bottom;}};BoxPosition.prototype.intersectPercentage=function(b2){var x=Math.max(0,Math.min(this.right,b2.right)-Math.max(this.left,b2.left)),y=Math.max(0,Math.min(this.bottom,b2.bottom)-Math.max(this.top,b2.top)),intersectArea=x*y;return intersectArea/(this.height*this.width);};BoxPosition.prototype.toCSSCompatValues=function(reference){return{top:this.top-reference.top,bottom:reference.bottom-this.bottom,left:this.left-reference.left,right:reference.right-this.right,height:this.height,width:this.width};};BoxPosition.getSimpleBoxPosition=function(obj){var height=obj.div?obj.div.offsetHeight:obj.tagName?obj.offsetHeight:0;var width=obj.div?obj.div.offsetWidth:obj.tagName?obj.offsetWidth:0;var top=obj.div?obj.div.offsetTop:obj.tagName?obj.offsetTop:0;obj=obj.div?obj.div.getBoundingClientRect():obj.tagName?obj.getBoundingClientRect():obj;var ret={left:obj.left,right:obj.right,top:obj.top||top,height:obj.height||height,bottom:obj.bottom||(top+(obj.height||height)),width:obj.width||width};return ret;};function moveBoxToLinePosition(window,styleBox,containerBox,boxPositions){function findBestPosition(b,axis){var bestPosition,specifiedPosition=new BoxPosition(b),percentage=1;for(var i=0;i<axis.length;i++){while(b.overlapsOppositeAxis(containerBox,axis[i])||(b.within(containerBox)&&b.overlapsAny(boxPositions))){b.move(axis[i]);}if(b.within(containerBox)){return b;}var p=b.intersectPercentage(containerBox);if(percentage>p){bestPosition=new BoxPosition(b);percentage=p;}b=new BoxPosition(specifiedPosition);}return bestPosition||specifiedPosition;}var boxPosition=new BoxPosition(styleBox),cue=styleBox.cue,linePos=computeLinePos(cue),axis=[];if(cue.snapToLines){var size;switch(cue.vertical){case"":axis=["+y","-y"];size="height";break;case"rl":axis=["+x","-x"];size="width";break;case"lr":axis=["-x","+x"];size="width";break;}var step=boxPosition.lineHeight,position=step*Math.round(linePos),maxPosition=containerBox[size]+step,initialAxis=axis[0];if(Math.abs(position)>maxPosition){position=position<0?-1:1;position*=Math.ceil(maxPosition/step)*step;}if(linePos<0){position+=cue.vertical===""?containerBox.height:containerBox.width;axis=axis.reverse();}boxPosition.move(initialAxis,position);}else{var calculatedPercentage=(boxPosition.lineHeight/containerBox.height)*100;switch(cue.lineAlign){case"middle":linePos-=(calculatedPercentage/2);break;case"end":linePos-=calculatedPercentage;break;}switch(cue.vertical){case"":styleBox.applyStyles({top:styleBox.formatStyle(linePos,"%")});break;case"rl":styleBox.applyStyles({left:styleBox.formatStyle(linePos,"%")});break;case"lr":styleBox.applyStyles({right:styleBox.formatStyle(linePos,"%")});break;}axis=["+y","-x","+x","-y"];boxPosition=new BoxPosition(styleBox);}var bestPosition=findBestPosition(boxPosition,axis);styleBox.move(bestPosition.toCSSCompatValues(containerBox));}function WebVTT(){}WebVTT.StringDecoder=function(){return{decode:function(data){if(!data){return"";}if(typeof data!=="string"){throw new Error("Error - expected string data.");}return decodeURIComponent(encodeURIComponent(data));}};};WebVTT.convertCueToDOMTree=function(window,cuetext){if(!window||!cuetext){return null;}return parseContent(window,cuetext);};var FONT_SIZE_PERCENT=0.05;var FONT_STYLE="sans-serif";var CUE_BACKGROUND_PADDING="1.5%";WebVTT.processCues=function(window,cues,overlay){if(!window||!cues||!overlay){return null;}while(overlay.firstChild){overlay.removeChild(overlay.firstChild);}var paddedOverlay=window.document.createElement("div");paddedOverlay.style.position="absolute";paddedOverlay.style.left="0";paddedOverlay.style.right="0";paddedOverlay.style.top="0";paddedOverlay.style.bottom="0";paddedOverlay.style.margin=CUE_BACKGROUND_PADDING;overlay.appendChild(paddedOverlay);function shouldCompute(cues){for(var i=0;i<cues.length;i++){if(cues[i].hasBeenReset||!cues[i].displayState){return true;}}return false;}if(!shouldCompute(cues)){for(var i=0;i<cues.length;i++){paddedOverlay.appendChild(cues[i].displayState);}return;}var boxPositions=[],containerBox=BoxPosition.getSimpleBoxPosition(paddedOverlay),fontSize=Math.round(containerBox.height*FONT_SIZE_PERCENT*100)/100;var styleOptions={font:(fontSize*fontScale)+"px "+FONT_STYLE};(function(){var styleBox,cue;for(var i=0;i<cues.length;i++){cue=cues[i];styleBox=new CueStyleBox(window,cue,styleOptions);paddedOverlay.appendChild(styleBox.div);moveBoxToLinePosition(window,styleBox,containerBox,boxPositions);cue.displayState=styleBox.div;boxPositions.push(BoxPosition.getSimpleBoxPosition(styleBox));}})();};WebVTT.Parser=function(window,decoder){this.window=window;this.state="INITIAL";this.buffer="";this.decoder=decoder||new TextDecoder("utf8");this.regionList=[];};WebVTT.Parser.prototype={reportOrThrowError:function(e){if(e instanceof ParsingError){this.onparsingerror&&this.onparsingerror(e);}else{throw e;}},parse:function(data){var self=this;if(data){self.buffer+=self.decoder.decode(data,{stream:true});}function collectNextLine(){var buffer=self.buffer;var pos=0;while(pos<buffer.length&&buffer[pos]!=='\r'&&buffer[pos]!=='\n'){++pos;}var line=buffer.substr(0,pos);if(buffer[pos]==='\r'){++pos;}if(buffer[pos]==='\n'){++pos;}self.buffer=buffer.substr(pos);return line;}function parseRegion(input){var settings=new Settings();parseOptions(input,function(k,v){switch(k){case"id":settings.set(k,v);break;case"width":settings.percent(k,v);break;case"lines":settings.integer(k,v);break;case"regionanchor":case"viewportanchor":var xy=v.split(',');if(xy.length!==2){break;}var anchor=new Settings();anchor.percent("x",xy[0]);anchor.percent("y",xy[1]);if(!anchor.has("x")||!anchor.has("y")){break;}settings.set(k+"X",anchor.get("x"));settings.set(k+"Y",anchor.get("y"));break;case"scroll":settings.alt(k,v,["up"]);break;}},/=/,/\s/);if(settings.has("id")){var region=new self.window.VTTRegion();region.width=settings.get("width",100);region.lines=settings.get("lines",3);region.regionAnchorX=settings.get("regionanchorX",0);region.regionAnchorY=settings.get("regionanchorY",100);region.viewportAnchorX=settings.get("viewportanchorX",0);region.viewportAnchorY=settings.get("viewportanchorY",100);region.scroll=settings.get("scroll","");self.onregion&&self.onregion(region);self.regionList.push({id:settings.get("id"),region:region});}}function parseHeader(input){parseOptions(input,function(k,v){switch(k){case"Region":parseRegion(v);break;}},/:/);}try{var line;if(self.state==="INITIAL"){if(!/\r\n|\n/.test(self.buffer)){return this;}line=collectNextLine();var m=line.match(/^WEBVTT([ \t].*)?$/);if(!m||!m[0]){throw new ParsingError(ParsingError.Errors.BadSignature);}self.state="HEADER";}var alreadyCollectedLine=false;while(self.buffer){if(!/\r\n|\n/.test(self.buffer)){return this;}if(!alreadyCollectedLine){line=collectNextLine();}else{alreadyCollectedLine=false;}switch(self.state){case"HEADER":if(/:/.test(line)){parseHeader(line);}else if(!line){self.state="ID";}continue;case"NOTE":if(!line){self.state="ID";}continue;case"ID":if(/^NOTE($|[ \t])/.test(line)){self.state="NOTE";break;}if(!line){continue;}self.cue=new self.window.VTTCue(0,0,"");self.state="CUE";if(line.indexOf("-->")===-1){self.cue.id=line;continue;}case"CUE":try{parseCue(line,self.cue,self.regionList);}catch(e){self.reportOrThrowError(e);self.cue=null;self.state="BADCUE";continue;}self.state="CUETEXT";continue;case"CUETEXT":var hasSubstring=line.indexOf("-->")!==-1;if(!line||hasSubstring&&(alreadyCollectedLine=true)){self.oncue&&self.oncue(self.cue);self.cue=null;self.state="ID";continue;}if(self.cue.text){self.cue.text+="\n";}self.cue.text+=line;continue;case"BADCUE":if(!line){self.state="ID";}continue;}}}catch(e){self.reportOrThrowError(e);if(self.state==="CUETEXT"&&self.cue&&self.oncue){self.oncue(self.cue);}self.cue=null;self.state=self.state==="INITIAL"?"BADWEBVTT":"BADCUE";}return this;},flush:function(){var self=this;try{self.buffer+=self.decoder.decode();if(self.cue||self.state==="HEADER"){self.buffer+="\n\n";self.parse();}if(self.state==="INITIAL"){throw new ParsingError(ParsingError.Errors.BadSignature);}}catch(e){self.reportOrThrowError(e);}self.onflush&&self.onflush();return this;}};global.WebVTT=WebVTT;}(this));if(typeof module!=="undefined"&&module.exports){this["encoding-indexes"]=require("./encoding-indexes.js")["encoding-indexes"];}(function(global){'use strict';function inRange(a,min,max){return min<=a&&a<=max;}function div(n,d){return Math.floor(n/d);}var EOF_byte=-1;var EOF_code_point=-1;function ByteInputStream(bytes){var pos=0;this.get=function(){return(pos>=bytes.length)?EOF_byte:Number(bytes[pos]);};this.offset=function(n){pos+=n;if(pos<0){throw new Error('Seeking past start of the buffer');}if(pos>bytes.length){throw new Error('Seeking past EOF');}};this.match=function(test){if(test.length>pos+bytes.length){return false;}var i;for(i=0;i<test.length;i+=1){if(Number(bytes[pos+i])!==test[i]){return false;}}return true;};}function ByteOutputStream(bytes){var pos=0;this.emit=function(var_args){var last=EOF_byte;var i;for(i=0;i<arguments.length;++i){last=Number(arguments[i]);bytes[pos++]=last;}return last;};}function CodePointInputStream(string){function stringToCodePoints(string){var cps=[];var i=0,n=string.length;while(i<string.length){var c=string.charCodeAt(i);if(!inRange(c,0xD800,0xDFFF)){cps.push(c);}else if(inRange(c,0xDC00,0xDFFF)){cps.push(0xFFFD);}else{if(i===n-1){cps.push(0xFFFD);}else{var d=string.charCodeAt(i+1);if(inRange(d,0xDC00,0xDFFF)){var a=c&0x3FF;var b=d&0x3FF;i+=1;cps.push(0x10000+(a<<10)+b);}else{cps.push(0xFFFD);}}}i+=1;}return cps;}var pos=0;var cps=stringToCodePoints(string);this.offset=function(n){pos+=n;if(pos<0){throw new Error('Seeking past start of the buffer');}if(pos>cps.length){throw new Error('Seeking past EOF');}};this.get=function(){if(pos>=cps.length){return EOF_code_point;}return cps[pos];};}function CodePointOutputStream(){var string='';this.string=function(){return string;};this.emit=function(c){if(c<=0xFFFF){string+=String.fromCharCode(c);}else{c-=0x10000;string+=String.fromCharCode(0xD800+((c>>10)&0x3ff));string+=String.fromCharCode(0xDC00+(c&0x3ff));}};}function EncodingError(message){this.name='EncodingError';this.message=message;this.code=0;}EncodingError.prototype=Error.prototype;function decoderError(fatal,opt_code_point){if(fatal){throw new EncodingError('Decoder error');}return opt_code_point||0xFFFD;}function encoderError(code_point){throw new EncodingError('The code point '+code_point+' could not be encoded.');}function getEncoding(label){label=String(label).trim().toLowerCase();if(Object.prototype.hasOwnProperty.call(label_to_encoding,label)){return label_to_encoding[label];}return null;}var encodings=[{"encodings":[{"labels":["unicode-1-1-utf-8","utf-8","utf8"],"name":"utf-8"}],"heading":"The Encoding"},{"encodings":[{"labels":["866","cp866","csibm866","ibm866"],"name":"ibm866"},{"labels":["csisolatin2","iso-8859-2","iso-ir-101","iso8859-2","iso88592","iso_8859-2","iso_8859-2:1987","l2","latin2"],"name":"iso-8859-2"},{"labels":["csisolatin3","iso-8859-3","iso-ir-109","iso8859-3","iso88593","iso_8859-3","iso_8859-3:1988","l3","latin3"],"name":"iso-8859-3"},{"labels":["csisolatin4","iso-8859-4","iso-ir-110","iso8859-4","iso88594","iso_8859-4","iso_8859-4:1988","l4","latin4"],"name":"iso-8859-4"},{"labels":["csisolatincyrillic","cyrillic","iso-8859-5","iso-ir-144","iso8859-5","iso88595","iso_8859-5","iso_8859-5:1988"],"name":"iso-8859-5"},{"labels":["arabic","asmo-708","csiso88596e","csiso88596i","csisolatinarabic","ecma-114","iso-8859-6","iso-8859-6-e","iso-8859-6-i","iso-ir-127","iso8859-6","iso88596","iso_8859-6","iso_8859-6:1987"],"name":"iso-8859-6"},{"labels":["csisolatingreek","ecma-118","elot_928","greek","greek8","iso-8859-7","iso-ir-126","iso8859-7","iso88597","iso_8859-7","iso_8859-7:1987","sun_eu_greek"],"name":"iso-8859-7"},{"labels":["csiso88598e","csisolatinhebrew","hebrew","iso-8859-8","iso-8859-8-e","iso-ir-138","iso8859-8","iso88598","iso_8859-8","iso_8859-8:1988","visual"],"name":"iso-8859-8"},{"labels":["csiso88598i","iso-8859-8-i","logical"],"name":"iso-8859-8-i"},{"labels":["csisolatin6","iso-8859-10","iso-ir-157","iso8859-10","iso885910","l6","latin6"],"name":"iso-8859-10"},{"labels":["iso-8859-13","iso8859-13","iso885913"],"name":"iso-8859-13"},{"labels":["iso-8859-14","iso8859-14","iso885914"],"name":"iso-8859-14"},{"labels":["csisolatin9","iso-8859-15","iso8859-15","iso885915","iso_8859-15","l9"],"name":"iso-8859-15"},{"labels":["iso-8859-16"],"name":"iso-8859-16"},{"labels":["cskoi8r","koi","koi8","koi8-r","koi8_r"],"name":"koi8-r"},{"labels":["koi8-u"],"name":"koi8-u"},{"labels":["csmacintosh","mac","macintosh","x-mac-roman"],"name":"macintosh"},{"labels":["dos-874","iso-8859-11","iso8859-11","iso885911","tis-620","windows-874"],"name":"windows-874"},{"labels":["cp1250","windows-1250","x-cp1250"],"name":"windows-1250"},{"labels":["cp1251","windows-1251","x-cp1251"],"name":"windows-1251"},{"labels":["ansi_x3.4-1968","ascii","cp1252","cp819","csisolatin1","ibm819","iso-8859-1","iso-ir-100","iso8859-1","iso88591","iso_8859-1","iso_8859-1:1987","l1","latin1","us-ascii","windows-1252","x-cp1252"],"name":"windows-1252"},{"labels":["cp1253","windows-1253","x-cp1253"],"name":"windows-1253"},{"labels":["cp1254","csisolatin5","iso-8859-9","iso-ir-148","iso8859-9","iso88599","iso_8859-9","iso_8859-9:1989","l5","latin5","windows-1254","x-cp1254"],"name":"windows-1254"},{"labels":["cp1255","windows-1255","x-cp1255"],"name":"windows-1255"},{"labels":["cp1256","windows-1256","x-cp1256"],"name":"windows-1256"},{"labels":["cp1257","windows-1257","x-cp1257"],"name":"windows-1257"},{"labels":["cp1258","windows-1258","x-cp1258"],"name":"windows-1258"},{"labels":["x-mac-cyrillic","x-mac-ukrainian"],"name":"x-mac-cyrillic"}],"heading":"Legacy single-byte encodings"},{"encodings":[{"labels":["chinese","csgb2312","csiso58gb231280","gb18030","gb2312","gb_2312","gb_2312-80","gbk","iso-ir-58","x-gbk"],"name":"gb18030"},{"labels":["hz-gb-2312"],"name":"hz-gb-2312"}],"heading":"Legacy multi-byte Chinese (simplified) encodings"},{"encodings":[{"labels":["big5","big5-hkscs","cn-big5","csbig5","x-x-big5"],"name":"big5"}],"heading":"Legacy multi-byte Chinese (traditional) encodings"},{"encodings":[{"labels":["cseucpkdfmtjapanese","euc-jp","x-euc-jp"],"name":"euc-jp"},{"labels":["csiso2022jp","iso-2022-jp"],"name":"iso-2022-jp"},{"labels":["csshiftjis","ms_kanji","shift-jis","shift_jis","sjis","windows-31j","x-sjis"],"name":"shift_jis"}],"heading":"Legacy multi-byte Japanese encodings"},{"encodings":[{"labels":["cseuckr","csksc56011987","euc-kr","iso-ir-149","korean","ks_c_5601-1987","ks_c_5601-1989","ksc5601","ksc_5601","windows-949"],"name":"euc-kr"}],"heading":"Legacy multi-byte Korean encodings"},{"encodings":[{"labels":["csiso2022kr","iso-2022-cn","iso-2022-cn-ext","iso-2022-kr"],"name":"replacement"},{"labels":["utf-16be"],"name":"utf-16be"},{"labels":["utf-16","utf-16le"],"name":"utf-16le"},{"labels":["x-user-defined"],"name":"x-user-defined"}],"heading":"Legacy miscellaneous encodings"}];var name_to_encoding={};var label_to_encoding={};encodings.forEach(function(category){category['encodings'].forEach(function(encoding){name_to_encoding[encoding['name']]=encoding;encoding['labels'].forEach(function(label){label_to_encoding[label]=encoding;});});});function indexCodePointFor(pointer,index){if(!index)return null;return index[pointer]||null;}function indexPointerFor(code_point,index){var pointer=index.indexOf(code_point);return pointer===-1?null:pointer;}function index(name){if(!('encoding-indexes'in global))throw new Error("Indexes missing. Did you forget to include encoding-indexes.js?");return global['encoding-indexes'][name];}function indexGB18030CodePointFor(pointer){if((pointer>39419&&pointer<189000)||(pointer>1237575)){return null;}var offset=0,code_point_offset=0,idx=index('gb18030');var i;for(i=0;i<idx.length;++i){var entry=idx[i];if(entry[0]<=pointer){offset=entry[0];code_point_offset=entry[1];}else{break;}}return code_point_offset+pointer-offset;}function indexGB18030PointerFor(code_point){var offset=0,pointer_offset=0,idx=index('gb18030');var i;for(i=0;i<idx.length;++i){var entry=idx[i];if(entry[1]<=code_point){offset=entry[1];pointer_offset=entry[0];}else{break;}}return pointer_offset+code_point-offset;}var DEFAULT_ENCODING='utf-8';function TextDecoder(opt_encoding,options){if(!(this instanceof TextDecoder)){return new TextDecoder(opt_encoding,options);}opt_encoding=opt_encoding?String(opt_encoding):DEFAULT_ENCODING;options=Object(options);this._encoding=getEncoding(opt_encoding);if(this._encoding===null||this._encoding.name==='replacement')throw new TypeError('Unknown encoding: '+opt_encoding);if(!this._encoding.getDecoder)throw new Error('Decoder not present. Did you forget to include encoding-indexes.js?');this._streaming=false;this._BOMseen=false;this._decoder=null;this._options={fatal:Boolean(options.fatal)};if(Object.defineProperty){Object.defineProperty(this,'encoding',{get:function(){return this._encoding.name;}});}else{this.encoding=this._encoding.name;}return this;}TextDecoder.prototype={decode:function decode(opt_view,options){if(opt_view&&!('buffer'in opt_view&&'byteOffset'in opt_view&&'byteLength'in opt_view)){throw new TypeError('Expected ArrayBufferView');}else if(!opt_view){opt_view=new Uint8Array(0);}options=Object(options);if(!this._streaming){this._decoder=this._encoding.getDecoder(this._options);this._BOMseen=false;}this._streaming=Boolean(options.stream);var bytes=new Uint8Array(opt_view.buffer,opt_view.byteOffset,opt_view.byteLength);var input_stream=new ByteInputStream(bytes);var output_stream=new CodePointOutputStream();var code_point;while(input_stream.get()!==EOF_byte){code_point=this._decoder.decode(input_stream);if(code_point!==null&&code_point!==EOF_code_point){output_stream.emit(code_point);}}if(!this._streaming){do{code_point=this._decoder.decode(input_stream);if(code_point!==null&&code_point!==EOF_code_point){output_stream.emit(code_point);}}while(code_point!==EOF_code_point&&input_stream.get()!=EOF_byte);this._decoder=null;}var result=output_stream.string();if(!this._BOMseen&&result.length){this._BOMseen=true;if(['utf-8','utf-16le','utf-16be'].indexOf(this.encoding)!==-1&&result.charCodeAt(0)===0xFEFF){result=result.substring(1);}}return result;}};function TextEncoder(opt_encoding,options){if(!(this instanceof TextEncoder)){return new TextEncoder(opt_encoding,options);}opt_encoding=opt_encoding?String(opt_encoding):DEFAULT_ENCODING;options=Object(options);this._encoding=getEncoding(opt_encoding);var allowLegacyEncoding=options.NONSTANDARD_allowLegacyEncoding;var isLegacyEncoding=(this._encoding.name!=='utf-8'&&this._encoding.name!=='utf-16le'&&this._encoding.name!=='utf-16be');if(this._encoding===null||(isLegacyEncoding&&!allowLegacyEncoding))throw new TypeError('Unknown encoding: '+opt_encoding);if(!this._encoding.getEncoder)throw new Error('Encoder not present. Did you forget to include encoding-indexes.js?');this._streaming=false;this._encoder=null;this._options={fatal:Boolean(options.fatal)};if(Object.defineProperty){Object.defineProperty(this,'encoding',{get:function(){return this._encoding.name;}});}else{this.encoding=this._encoding.name;}return this;}TextEncoder.prototype={encode:function encode(opt_string,options){opt_string=opt_string?String(opt_string):'';options=Object(options);if(!this._streaming){this._encoder=this._encoding.getEncoder(this._options);}this._streaming=Boolean(options.stream);var bytes=[];var output_stream=new ByteOutputStream(bytes);var input_stream=new CodePointInputStream(opt_string);while(input_stream.get()!==EOF_code_point){this._encoder.encode(output_stream,input_stream);}if(!this._streaming){var last_byte;do{last_byte=this._encoder.encode(output_stream,input_stream);}while(last_byte!==EOF_byte);this._encoder=null;}return new Uint8Array(bytes);}};function UTF8Decoder(options){var fatal=options.fatal;var utf8_code_point=0,utf8_bytes_needed=0,utf8_bytes_seen=0,utf8_lower_boundary=0;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte){if(utf8_bytes_needed!==0){return decoderError(fatal);}return EOF_code_point;}byte_pointer.offset(1);if(utf8_bytes_needed===0){if(inRange(bite,0x00,0x7F)){return bite;}if(inRange(bite,0xC2,0xDF)){utf8_bytes_needed=1;utf8_lower_boundary=0x80;utf8_code_point=bite-0xC0;}else if(inRange(bite,0xE0,0xEF)){utf8_bytes_needed=2;utf8_lower_boundary=0x800;utf8_code_point=bite-0xE0;}else if(inRange(bite,0xF0,0xF4)){utf8_bytes_needed=3;utf8_lower_boundary=0x10000;utf8_code_point=bite-0xF0;}else{return decoderError(fatal);}utf8_code_point=utf8_code_point*Math.pow(64,utf8_bytes_needed);return null;}if(!inRange(bite,0x80,0xBF)){utf8_code_point=0;utf8_bytes_needed=0;utf8_bytes_seen=0;utf8_lower_boundary=0;byte_pointer.offset(-1);return decoderError(fatal);}utf8_bytes_seen+=1;utf8_code_point=utf8_code_point+(bite-0x80)*Math.pow(64,utf8_bytes_needed-utf8_bytes_seen);if(utf8_bytes_seen!==utf8_bytes_needed){return null;}var code_point=utf8_code_point;var lower_boundary=utf8_lower_boundary;utf8_code_point=0;utf8_bytes_needed=0;utf8_bytes_seen=0;utf8_lower_boundary=0;if(inRange(code_point,lower_boundary,0x10FFFF)&&!inRange(code_point,0xD800,0xDFFF)){return code_point;}return decoderError(fatal);};}function UTF8Encoder(options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0xD800,0xDFFF)){return encoderError(code_point);}if(inRange(code_point,0x0000,0x007f)){return output_byte_stream.emit(code_point);}var count,offset;if(inRange(code_point,0x0080,0x07FF)){count=1;offset=0xC0;}else if(inRange(code_point,0x0800,0xFFFF)){count=2;offset=0xE0;}else if(inRange(code_point,0x10000,0x10FFFF)){count=3;offset=0xF0;}var result=output_byte_stream.emit(div(code_point,Math.pow(64,count))+offset);while(count>0){var temp=div(code_point,Math.pow(64,count-1));result=output_byte_stream.emit(0x80+(temp%64));count-=1;}return result;};}name_to_encoding['utf-8'].getEncoder=function(options){return new UTF8Encoder(options);};name_to_encoding['utf-8'].getDecoder=function(options){return new UTF8Decoder(options);};function SingleByteDecoder(index,options){var fatal=options.fatal;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte){return EOF_code_point;}byte_pointer.offset(1);if(inRange(bite,0x00,0x7F)){return bite;}var code_point=index[bite-0x80];if(code_point===null){return decoderError(fatal);}return code_point;};}function SingleByteEncoder(index,options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0x0000,0x007F)){return output_byte_stream.emit(code_point);}var pointer=indexPointerFor(code_point,index);if(pointer===null){encoderError(code_point);}return output_byte_stream.emit(pointer+0x80);};}(function(){if(!('encoding-indexes'in global))return;encodings.forEach(function(category){if(category['heading']!=='Legacy single-byte encodings')return;category['encodings'].forEach(function(encoding){var idx=index(encoding['name']);encoding.getDecoder=function(options){return new SingleByteDecoder(idx,options);};encoding.getEncoder=function(options){return new SingleByteEncoder(idx,options);};});});}());function GB18030Decoder(options){var fatal=options.fatal;var gb18030_first=0x00,gb18030_second=0x00,gb18030_third=0x00;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte&&gb18030_first===0x00&&gb18030_second===0x00&&gb18030_third===0x00){return EOF_code_point;}if(bite===EOF_byte&&(gb18030_first!==0x00||gb18030_second!==0x00||gb18030_third!==0x00)){gb18030_first=0x00;gb18030_second=0x00;gb18030_third=0x00;decoderError(fatal);}byte_pointer.offset(1);var code_point;if(gb18030_third!==0x00){code_point=null;if(inRange(bite,0x30,0x39)){code_point=indexGB18030CodePointFor((((gb18030_first-0x81)*10+(gb18030_second-0x30))*126+(gb18030_third-0x81))*10+bite-0x30);}gb18030_first=0x00;gb18030_second=0x00;gb18030_third=0x00;if(code_point===null){byte_pointer.offset(-3);return decoderError(fatal);}return code_point;}if(gb18030_second!==0x00){if(inRange(bite,0x81,0xFE)){gb18030_third=bite;return null;}byte_pointer.offset(-2);gb18030_first=0x00;gb18030_second=0x00;return decoderError(fatal);}if(gb18030_first!==0x00){if(inRange(bite,0x30,0x39)){gb18030_second=bite;return null;}var lead=gb18030_first;var pointer=null;gb18030_first=0x00;var offset=bite<0x7F?0x40:0x41;if(inRange(bite,0x40,0x7E)||inRange(bite,0x80,0xFE)){pointer=(lead-0x81)*190+(bite-offset);}code_point=pointer===null?null:indexCodePointFor(pointer,index('gb18030'));if(pointer===null){byte_pointer.offset(-1);}if(code_point===null){return decoderError(fatal);}return code_point;}if(inRange(bite,0x00,0x7F)){return bite;}if(bite===0x80){return 0x20AC;}if(inRange(bite,0x81,0xFE)){gb18030_first=bite;return null;}return decoderError(fatal);};}function GB18030Encoder(options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0x0000,0x007F)){return output_byte_stream.emit(code_point);}var pointer=indexPointerFor(code_point,index('gb18030'));if(pointer!==null){var lead=div(pointer,190)+0x81;var trail=pointer%190;var offset=trail<0x3F?0x40:0x41;return output_byte_stream.emit(lead,trail+offset);}pointer=indexGB18030PointerFor(code_point);var byte1=div(div(div(pointer,10),126),10);pointer=pointer-byte1*10*126*10;var byte2=div(div(pointer,10),126);pointer=pointer-byte2*10*126;var byte3=div(pointer,10);var byte4=pointer-byte3*10;return output_byte_stream.emit(byte1+0x81,byte2+0x30,byte3+0x81,byte4+0x30);};}name_to_encoding['gb18030'].getEncoder=function(options){return new GB18030Encoder(options);};name_to_encoding['gb18030'].getDecoder=function(options){return new GB18030Decoder(options);};function HZGB2312Decoder(options){var fatal=options.fatal;var hzgb2312=false,hzgb2312_lead=0x00;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte&&hzgb2312_lead===0x00){return EOF_code_point;}if(bite===EOF_byte&&hzgb2312_lead!==0x00){hzgb2312_lead=0x00;return decoderError(fatal);}byte_pointer.offset(1);if(hzgb2312_lead===0x7E){hzgb2312_lead=0x00;if(bite===0x7B){hzgb2312=true;return null;}if(bite===0x7D){hzgb2312=false;return null;}if(bite===0x7E){return 0x007E;}if(bite===0x0A){return null;}byte_pointer.offset(-1);return decoderError(fatal);}if(hzgb2312_lead!==0x00){var lead=hzgb2312_lead;hzgb2312_lead=0x00;var code_point=null;if(inRange(bite,0x21,0x7E)){code_point=indexCodePointFor((lead-1)*190+(bite+0x3F),index('gb18030'));}if(bite===0x0A){hzgb2312=false;}if(code_point===null){return decoderError(fatal);}return code_point;}if(bite===0x7E){hzgb2312_lead=0x7E;return null;}if(hzgb2312){if(inRange(bite,0x20,0x7F)){hzgb2312_lead=bite;return null;}if(bite===0x0A){hzgb2312=false;}return decoderError(fatal);}if(inRange(bite,0x00,0x7F)){return bite;}return decoderError(fatal);};}function HZGB2312Encoder(options){var fatal=options.fatal;var hzgb2312=false;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0x0000,0x007F)&&hzgb2312){code_point_pointer.offset(-1);hzgb2312=false;return output_byte_stream.emit(0x7E,0x7D);}if(code_point===0x007E){return output_byte_stream.emit(0x7E,0x7E);}if(inRange(code_point,0x0000,0x007F)){return output_byte_stream.emit(code_point);}if(!hzgb2312){code_point_pointer.offset(-1);hzgb2312=true;return output_byte_stream.emit(0x7E,0x7B);}var pointer=indexPointerFor(code_point,index('gb18030'));if(pointer===null){return encoderError(code_point);}var lead=div(pointer,190)+1;var trail=pointer%190-0x3F;if(!inRange(lead,0x21,0x7E)||!inRange(trail,0x21,0x7E)){return encoderError(code_point);}return output_byte_stream.emit(lead,trail);};}name_to_encoding['hz-gb-2312'].getEncoder=function(options){return new HZGB2312Encoder(options);};name_to_encoding['hz-gb-2312'].getDecoder=function(options){return new HZGB2312Decoder(options);};function Big5Decoder(options){var fatal=options.fatal;var big5_lead=0x00,big5_pending=null;this.decode=function(byte_pointer){if(big5_pending!==null){var pending=big5_pending;big5_pending=null;return pending;}var bite=byte_pointer.get();if(bite===EOF_byte&&big5_lead===0x00){return EOF_code_point;}if(bite===EOF_byte&&big5_lead!==0x00){big5_lead=0x00;return decoderError(fatal);}byte_pointer.offset(1);if(big5_lead!==0x00){var lead=big5_lead;var pointer=null;big5_lead=0x00;var offset=bite<0x7F?0x40:0x62;if(inRange(bite,0x40,0x7E)||inRange(bite,0xA1,0xFE)){pointer=(lead-0x81)*157+(bite-offset);}if(pointer===1133){big5_pending=0x0304;return 0x00CA;}if(pointer===1135){big5_pending=0x030C;return 0x00CA;}if(pointer===1164){big5_pending=0x0304;return 0x00EA;}if(pointer===1166){big5_pending=0x030C;return 0x00EA;}var code_point=(pointer===null)?null:indexCodePointFor(pointer,index('big5'));if(pointer===null){byte_pointer.offset(-1);}if(code_point===null){return decoderError(fatal);}return code_point;}if(inRange(bite,0x00,0x7F)){return bite;}if(inRange(bite,0x81,0xFE)){big5_lead=bite;return null;}return decoderError(fatal);};}function Big5Encoder(options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0x0000,0x007F)){return output_byte_stream.emit(code_point);}var pointer=indexPointerFor(code_point,index('big5'));if(pointer===null){return encoderError(code_point);}var lead=div(pointer,157)+0x81;var trail=pointer%157;var offset=trail<0x3F?0x40:0x62;return output_byte_stream.emit(lead,trail+offset);};}name_to_encoding['big5'].getEncoder=function(options){return new Big5Encoder(options);};name_to_encoding['big5'].getDecoder=function(options){return new Big5Decoder(options);};function EUCJPDecoder(options){var fatal=options.fatal;var eucjp_first=0x00,eucjp_second=0x00;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte){if(eucjp_first===0x00&&eucjp_second===0x00){return EOF_code_point;}eucjp_first=0x00;eucjp_second=0x00;return decoderError(fatal);}byte_pointer.offset(1);var lead,code_point;if(eucjp_second!==0x00){lead=eucjp_second;eucjp_second=0x00;code_point=null;if(inRange(lead,0xA1,0xFE)&&inRange(bite,0xA1,0xFE)){code_point=indexCodePointFor((lead-0xA1)*94+bite-0xA1,index('jis0212'));}if(!inRange(bite,0xA1,0xFE)){byte_pointer.offset(-1);}if(code_point===null){return decoderError(fatal);}return code_point;}if(eucjp_first===0x8E&&inRange(bite,0xA1,0xDF)){eucjp_first=0x00;return 0xFF61+bite-0xA1;}if(eucjp_first===0x8F&&inRange(bite,0xA1,0xFE)){eucjp_first=0x00;eucjp_second=bite;return null;}if(eucjp_first!==0x00){lead=eucjp_first;eucjp_first=0x00;code_point=null;if(inRange(lead,0xA1,0xFE)&&inRange(bite,0xA1,0xFE)){code_point=indexCodePointFor((lead-0xA1)*94+bite-0xA1,index('jis0208'));}if(!inRange(bite,0xA1,0xFE)){byte_pointer.offset(-1);}if(code_point===null){return decoderError(fatal);}return code_point;}if(inRange(bite,0x00,0x7F)){return bite;}if(bite===0x8E||bite===0x8F||(inRange(bite,0xA1,0xFE))){eucjp_first=bite;return null;}return decoderError(fatal);};}function EUCJPEncoder(options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0x0000,0x007F)){return output_byte_stream.emit(code_point);}if(code_point===0x00A5){return output_byte_stream.emit(0x5C);}if(code_point===0x203E){return output_byte_stream.emit(0x7E);}if(inRange(code_point,0xFF61,0xFF9F)){return output_byte_stream.emit(0x8E,code_point-0xFF61+0xA1);}var pointer=indexPointerFor(code_point,index('jis0208'));if(pointer===null){return encoderError(code_point);}var lead=div(pointer,94)+0xA1;var trail=pointer%94+0xA1;return output_byte_stream.emit(lead,trail);};}name_to_encoding['euc-jp'].getEncoder=function(options){return new EUCJPEncoder(options);};name_to_encoding['euc-jp'].getDecoder=function(options){return new EUCJPDecoder(options);};function ISO2022JPDecoder(options){var fatal=options.fatal;var state={ASCII:0,escape_start:1,escape_middle:2,escape_final:3,lead:4,trail:5,Katakana:6};var iso2022jp_state=state.ASCII,iso2022jp_jis0212=false,iso2022jp_lead=0x00;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite!==EOF_byte){byte_pointer.offset(1);}switch(iso2022jp_state){default:case state.ASCII:if(bite===0x1B){iso2022jp_state=state.escape_start;return null;}if(inRange(bite,0x00,0x7F)){return bite;}if(bite===EOF_byte){return EOF_code_point;}return decoderError(fatal);case state.escape_start:if(bite===0x24||bite===0x28){iso2022jp_lead=bite;iso2022jp_state=state.escape_middle;return null;}if(bite!==EOF_byte){byte_pointer.offset(-1);}iso2022jp_state=state.ASCII;return decoderError(fatal);case state.escape_middle:var lead=iso2022jp_lead;iso2022jp_lead=0x00;if(lead===0x24&&(bite===0x40||bite===0x42)){iso2022jp_jis0212=false;iso2022jp_state=state.lead;return null;}if(lead===0x24&&bite===0x28){iso2022jp_state=state.escape_final;return null;}if(lead===0x28&&(bite===0x42||bite===0x4A)){iso2022jp_state=state.ASCII;return null;}if(lead===0x28&&bite===0x49){iso2022jp_state=state.Katakana;return null;}if(bite===EOF_byte){byte_pointer.offset(-1);}else{byte_pointer.offset(-2);}iso2022jp_state=state.ASCII;return decoderError(fatal);case state.escape_final:if(bite===0x44){iso2022jp_jis0212=true;iso2022jp_state=state.lead;return null;}if(bite===EOF_byte){byte_pointer.offset(-2);}else{byte_pointer.offset(-3);}iso2022jp_state=state.ASCII;return decoderError(fatal);case state.lead:if(bite===0x0A){iso2022jp_state=state.ASCII;return decoderError(fatal,0x000A);}if(bite===0x1B){iso2022jp_state=state.escape_start;return null;}if(bite===EOF_byte){return EOF_code_point;}iso2022jp_lead=bite;iso2022jp_state=state.trail;return null;case state.trail:iso2022jp_state=state.lead;if(bite===EOF_byte){return decoderError(fatal);}var code_point=null;var pointer=(iso2022jp_lead-0x21)*94+bite-0x21;if(inRange(iso2022jp_lead,0x21,0x7E)&&inRange(bite,0x21,0x7E)){code_point=(iso2022jp_jis0212===false)?indexCodePointFor(pointer,index('jis0208')):indexCodePointFor(pointer,index('jis0212'));}if(code_point===null){return decoderError(fatal);}return code_point;case state.Katakana:if(bite===0x1B){iso2022jp_state=state.escape_start;return null;}if(inRange(bite,0x21,0x5F)){return 0xFF61+bite-0x21;}if(bite===EOF_byte){return EOF_code_point;}return decoderError(fatal);}};}function ISO2022JPEncoder(options){var fatal=options.fatal;var state={ASCII:0,lead:1,Katakana:2};var iso2022jp_state=state.ASCII;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if((inRange(code_point,0x0000,0x007F)||code_point===0x00A5||code_point===0x203E)&&iso2022jp_state!==state.ASCII){code_point_pointer.offset(-1);iso2022jp_state=state.ASCII;return output_byte_stream.emit(0x1B,0x28,0x42);}if(inRange(code_point,0x0000,0x007F)){return output_byte_stream.emit(code_point);}if(code_point===0x00A5){return output_byte_stream.emit(0x5C);}if(code_point===0x203E){return output_byte_stream.emit(0x7E);}if(inRange(code_point,0xFF61,0xFF9F)&&iso2022jp_state!==state.Katakana){code_point_pointer.offset(-1);iso2022jp_state=state.Katakana;return output_byte_stream.emit(0x1B,0x28,0x49);}if(inRange(code_point,0xFF61,0xFF9F)){return output_byte_stream.emit(code_point-0xFF61-0x21);}if(iso2022jp_state!==state.lead){code_point_pointer.offset(-1);iso2022jp_state=state.lead;return output_byte_stream.emit(0x1B,0x24,0x42);}var pointer=indexPointerFor(code_point,index('jis0208'));if(pointer===null){return encoderError(code_point);}var lead=div(pointer,94)+0x21;var trail=pointer%94+0x21;return output_byte_stream.emit(lead,trail);};}name_to_encoding['iso-2022-jp'].getEncoder=function(options){return new ISO2022JPEncoder(options);};name_to_encoding['iso-2022-jp'].getDecoder=function(options){return new ISO2022JPDecoder(options);};function ShiftJISDecoder(options){var fatal=options.fatal;var shiftjis_lead=0x00;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte&&shiftjis_lead===0x00){return EOF_code_point;}if(bite===EOF_byte&&shiftjis_lead!==0x00){shiftjis_lead=0x00;return decoderError(fatal);}byte_pointer.offset(1);if(shiftjis_lead!==0x00){var lead=shiftjis_lead;shiftjis_lead=0x00;if(inRange(bite,0x40,0x7E)||inRange(bite,0x80,0xFC)){var offset=(bite<0x7F)?0x40:0x41;var lead_offset=(lead<0xA0)?0x81:0xC1;var code_point=indexCodePointFor((lead-lead_offset)*188+bite-offset,index('jis0208'));if(code_point===null){return decoderError(fatal);}return code_point;}byte_pointer.offset(-1);return decoderError(fatal);}if(inRange(bite,0x00,0x80)){return bite;}if(inRange(bite,0xA1,0xDF)){return 0xFF61+bite-0xA1;}if(inRange(bite,0x81,0x9F)||inRange(bite,0xE0,0xFC)){shiftjis_lead=bite;return null;}return decoderError(fatal);};}function ShiftJISEncoder(options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0x0000,0x0080)){return output_byte_stream.emit(code_point);}if(code_point===0x00A5){return output_byte_stream.emit(0x5C);}if(code_point===0x203E){return output_byte_stream.emit(0x7E);}if(inRange(code_point,0xFF61,0xFF9F)){return output_byte_stream.emit(code_point-0xFF61+0xA1);}var pointer=indexPointerFor(code_point,index('jis0208'));if(pointer===null){return encoderError(code_point);}var lead=div(pointer,188);var lead_offset=lead<0x1F?0x81:0xC1;var trail=pointer%188;var offset=trail<0x3F?0x40:0x41;return output_byte_stream.emit(lead+lead_offset,trail+offset);};}name_to_encoding['shift_jis'].getEncoder=function(options){return new ShiftJISEncoder(options);};name_to_encoding['shift_jis'].getDecoder=function(options){return new ShiftJISDecoder(options);};function EUCKRDecoder(options){var fatal=options.fatal;var euckr_lead=0x00;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte&&euckr_lead===0){return EOF_code_point;}if(bite===EOF_byte&&euckr_lead!==0){euckr_lead=0x00;return decoderError(fatal);}byte_pointer.offset(1);if(euckr_lead!==0x00){var lead=euckr_lead;var pointer=null;euckr_lead=0x00;if(inRange(lead,0x81,0xC6)){var temp=(26+26+126)*(lead-0x81);if(inRange(bite,0x41,0x5A)){pointer=temp+bite-0x41;}else if(inRange(bite,0x61,0x7A)){pointer=temp+26+bite-0x61;}else if(inRange(bite,0x81,0xFE)){pointer=temp+26+26+bite-0x81;}}if(inRange(lead,0xC7,0xFD)&&inRange(bite,0xA1,0xFE)){pointer=(26+26+126)*(0xC7-0x81)+(lead-0xC7)*94+(bite-0xA1);}var code_point=(pointer===null)?null:indexCodePointFor(pointer,index('euc-kr'));if(pointer===null){byte_pointer.offset(-1);}if(code_point===null){return decoderError(fatal);}return code_point;}if(inRange(bite,0x00,0x7F)){return bite;}if(inRange(bite,0x81,0xFD)){euckr_lead=bite;return null;}return decoderError(fatal);};}function EUCKREncoder(options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0x0000,0x007F)){return output_byte_stream.emit(code_point);}var pointer=indexPointerFor(code_point,index('euc-kr'));if(pointer===null){return encoderError(code_point);}var lead,trail;if(pointer<((26+26+126)*(0xC7-0x81))){lead=div(pointer,(26+26+126))+0x81;trail=pointer%(26+26+126);var offset=trail<26?0x41:trail<26+26?0x47:0x4D;return output_byte_stream.emit(lead,trail+offset);}pointer=pointer-(26+26+126)*(0xC7-0x81);lead=div(pointer,94)+0xC7;trail=pointer%94+0xA1;return output_byte_stream.emit(lead,trail);};}name_to_encoding['euc-kr'].getEncoder=function(options){return new EUCKREncoder(options);};name_to_encoding['euc-kr'].getDecoder=function(options){return new EUCKRDecoder(options);};function UTF16Decoder(utf16_be,options){var fatal=options.fatal;var utf16_lead_byte=null,utf16_lead_surrogate=null;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte&&utf16_lead_byte===null&&utf16_lead_surrogate===null){return EOF_code_point;}if(bite===EOF_byte&&(utf16_lead_byte!==null||utf16_lead_surrogate!==null)){return decoderError(fatal);}byte_pointer.offset(1);if(utf16_lead_byte===null){utf16_lead_byte=bite;return null;}var code_point;if(utf16_be){code_point=(utf16_lead_byte<<8)+bite;}else{code_point=(bite<<8)+utf16_lead_byte;}utf16_lead_byte=null;if(utf16_lead_surrogate!==null){var lead_surrogate=utf16_lead_surrogate;utf16_lead_surrogate=null;if(inRange(code_point,0xDC00,0xDFFF)){return 0x10000+(lead_surrogate-0xD800)*0x400+(code_point-0xDC00);}byte_pointer.offset(-2);return decoderError(fatal);}if(inRange(code_point,0xD800,0xDBFF)){utf16_lead_surrogate=code_point;return null;}if(inRange(code_point,0xDC00,0xDFFF)){return decoderError(fatal);}return code_point;};}function UTF16Encoder(utf16_be,options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){function convert_to_bytes(code_unit){var byte1=code_unit>>8;var byte2=code_unit&0x00FF;if(utf16_be){return output_byte_stream.emit(byte1,byte2);}return output_byte_stream.emit(byte2,byte1);}var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0xD800,0xDFFF)){encoderError(code_point);}if(code_point<=0xFFFF){return convert_to_bytes(code_point);}var lead=div((code_point-0x10000),0x400)+0xD800;var trail=((code_point-0x10000)%0x400)+0xDC00;convert_to_bytes(lead);return convert_to_bytes(trail);};}name_to_encoding['utf-16be'].getEncoder=function(options){return new UTF16Encoder(true,options);};name_to_encoding['utf-16be'].getDecoder=function(options){return new UTF16Decoder(true,options);};name_to_encoding['utf-16le'].getEncoder=function(options){return new UTF16Encoder(false,options);};name_to_encoding['utf-16le'].getDecoder=function(options){return new UTF16Decoder(false,options);};function XUserDefinedDecoder(options){var fatal=options.fatal;this.decode=function(byte_pointer){var bite=byte_pointer.get();if(bite===EOF_byte){return EOF_code_point;}byte_pointer.offset(1);if(inRange(bite,0x00,0x7F)){return bite;}return 0xF780+bite-0x80;};}function XUserDefinedEncoder(index,options){var fatal=options.fatal;this.encode=function(output_byte_stream,code_point_pointer){var code_point=code_point_pointer.get();if(code_point===EOF_code_point){return EOF_byte;}code_point_pointer.offset(1);if(inRange(code_point,0x0000,0x007F)){return output_byte_stream.emit(code_point);}if(inRange(code_point,0xF780,0xF7FF)){return output_byte_stream.emit(code_point-0xF780+0x80);}encoderError(code_point);};}name_to_encoding['x-user-defined'].getEncoder=function(options){return new XUserDefinedEncoder(false,options);};name_to_encoding['x-user-defined'].getDecoder=function(options){return new XUserDefinedDecoder(false,options);};function detectEncoding(label,input_stream){if(input_stream.match([0xFF,0xFE])){input_stream.offset(2);return'utf-16le';}if(input_stream.match([0xFE,0xFF])){input_stream.offset(2);return'utf-16be';}if(input_stream.match([0xEF,0xBB,0xBF])){input_stream.offset(3);return'utf-8';}return label;}if(!('TextEncoder'in global))global['TextEncoder']=TextEncoder;if(!('TextDecoder'in global))global['TextDecoder']=TextDecoder;}(this));;},{},{});

/* cache key: resourceloader:filter:minify-js:7:abad1b1381762db0bf83fb297ef1dcc8 */
